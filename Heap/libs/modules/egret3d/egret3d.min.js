var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__decorate=this&&this.__decorate||function(t,e,r,a){var i,o=arguments.length,n=3>o?e:null===a?a=Object.getOwnPropertyDescriptor(e,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(t,e,r,a);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(n=(3>o?i(n):o>3?i(e,r,n):i(e,r))||n);return o>3&&n&&Object.defineProperty(e,r,n),n},__metadata=this&&this.__metadata||function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(e,r){function a(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(a.prototype=r.prototype,new a)}}(),__awaiter=this&&this.__awaiter||function(t,e,r,a){return new(r||(r=Promise))(function(i,o){function n(t){try{h(a.next(t))}catch(e){o(e)}}function s(t){try{h(a["throw"](t))}catch(e){o(e)}}function h(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(n,s)}h((a=a.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return a([t,e])}}function a(r){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,o&&(n=o[2&r[0]?"return":r[0]?"throw":"next"])&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[0,n.value]),r[0]){case 0:case 1:n=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,o=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(n=h.trys,!(n=n.length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){h.label=r[1];break}if(6===r[0]&&h.label<n[1]){h.label=n[1],n=r;break}if(n&&h.label<n[2]){h.label=n[2],h.ops.push(r);break}n[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(a){r=[6,a],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var i,o,n,s,h={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},egret3d;!function(t){var e;!function(t){function e(t,e){void 0==t.__gdmeta__&&(t.__gdmeta__={}),void 0==t.__gdmeta__["class"]&&(t.__gdmeta__["class"]={});var r=t.constructor.name;if(null==r){var a=t.constructor.toString(),i=a.indexOf("(");r=a.substring(9,i)}if(t.__gdmeta__["class"].typename=r,null==document.__gdmeta__&&(document.__gdmeta__={}),document.__gdmeta__[r]=t,null==t.__gdmeta__["class"].custom&&(t.__gdmeta__["class"].custom={}),null!=e)for(var o in e)t.__gdmeta__["class"].custom[o]=e[o]}function r(t,e,r){if(void 0==t.__gdmeta__&&(t.__gdmeta__={}),null==t.__gdmeta__[e]&&(t.__gdmeta__[e]={}),t.__gdmeta__[e].type="field",null==t.__gdmeta__[e].custom&&(t.__gdmeta__[e].custom={}),null!=r)for(var a in r)t.__gdmeta__[e].custom[a]=r[a]}function a(){return document.__gdmeta__}function i(t){return document.__gdmeta__[t]}function o(t,e){if(null==e){var r=t.constructor;return new r}var a=t.__gdmeta__["class"].custom;for(var i in e)if(a[i]!=e[i])return console.warn("createInstance:"+name+". tag do not match."),null;var r=t.constructor;return new r}function n(t){var e=t.__gdmeta__["class"].typename;return e}function s(t,e){var r=t.__gdmeta__["class"].custom;return r[e]}function h(t){var e=t.__gdmeta__;return e}function l(t){e(t.prototype,null)}function c(t){return void 0===t&&(t=null),function(e,a){r(e,a,t)}}function u(t){e(t.prototype,{usercode:"1"})}function d(t){e(t.prototype,{editorcode:"1"})}function p(t){e(t.prototype,{selfclone:"1"})}function m(t){e(t.prototype,{nodecomp:"1"})}function f(t){e(t.prototype,{nodecomp_inspector:"1"})}function v(t){e(t.prototype,{renderer:"1"})}function _(t){e(t.prototype,{camera:"1"})}function g(t){e(t.prototype,{light:"1"})}function y(t){e(t.prototype,{boxcollider:"1"})}function w(t){e(t.prototype,{spherecollider:"1"})}function x(t){e(t.prototype,{effectbatcher:"1"})}function b(t){e(t.prototype,{meshcollider:"1"})}function D(t){e(t.prototype,{canvasRenderer:"1"})}function T(t){e(t.prototype,{"2dcomp":"1"})}function E(t){e(t.prototype,{plugin_menuitem:"1"})}function P(t){e(t.prototype,{plugin_window:"1"})}function M(t){e(t.prototype,{plugin_ext:"1"})}function S(t,e,a,i){return void 0===t&&(t=!1),void 0===e&&(e=0),void 0===a&&(a=Number.MIN_VALUE),void 0===i&&(i=Number.MAX_VALUE),function(o,n){r(o,n,{compValue:"1",integer:t?"1":"0",defvalue:e.toString(),min:a.toString(),max:i.toString()})}}function A(t){e(t.prototype,{SerializeType:"1"})}function C(t,e,a){return void 0===e&&(e=void 0),void 0===a&&(a=void 0),function(a,i){r(a,i,{SerializeField:!0,valueType:t}),void 0==e||r(a,i,{defaultValue:e})}}function V(t){return function(e,a){r(e,a,{UIComment:t})}}function R(t,e,a,i){return function(o,n){r(o,n,{FieldUIStyle:t,min:e?e:null,max:a?a:null,defvalue:i?i:null})}}t.getPrototypes=a,t.getPrototype=i,t.createInstance=o,t.getClassName=n,t.getClassTag=s,t.getMeta=h,t.attr_Class=l,t.attr_Field=c,t.userCode=u,t.editorCode=d,t.selfClone=p,t.nodeComponent=m,t.nodeComponentInspector=f,t.nodeRender=v,t.nodeCamera=_,t.nodeLight=g,t.nodeBoxCollider=y,t.nodeSphereCollider=w,t.nodeEffectBatcher=x,t.nodeMeshCollider=b,t.nodeCanvasRendererCollider=D,t.node2DComponent=T,t.pluginMenuItem=E,t.pluginWindow=P,t.pluginExt=M,t.compValue=S,t.SerializeType=A,t.Field=C,t.UIComment=V;var k;!function(t){t[t.None=0]="None",t[t.RangeFloat=1]="RangeFloat",t[t.MultiLineString=2]="MultiLineString",t[t.Enum=3]="Enum"}(k=t.FieldUIStyle||(t.FieldUIStyle={})),t.UIStyle=R}(e=t.reflect||(t.reflect={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return e.prototype.toString=function(){return this.x+","+this.y},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"x",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"y",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number])],e)}();e.Vector2=r,__reflect(r.prototype,"egret3d.math.Vector2");var a=function(){function e(t,e,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),this.x=t,this.y=e,this.w=r,this.h=a}return e.prototype.toString=function(){return this.x+","+this.y+","+this.w+","+this.h},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"x",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"y",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"w",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"h",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],e)}();e.Rect=a,__reflect(a.prototype,"egret3d.math.Rect");var i=function(){function e(t,e,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),this.l=t,this.t=e,this.r=r,this.b=a}return __decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"l",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"t",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"r",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"b",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],e)}();e.Border=i,__reflect(i.prototype,"egret3d.math.Border");var o=function(){function e(t,e,r,a){void 0===t&&(t=1),void 0===e&&(e=1),void 0===r&&(r=1),void 0===a&&(a=1),this.r=t,this.g=e,this.b=r,this.a=a}return e.prototype.toString=function(){return this.r+","+this.g+","+this.b+","+this.a},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"r",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"g",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"b",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"a",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],e)}();e.Color=o,__reflect(o.prototype,"egret3d.math.Color");var n=function(){function e(t,e,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),this.x=t,this.y=e,this.z=r}return e.prototype.toString=function(){return this.x+","+this.y+","+this.z},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"x",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"y",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"z",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number])],e)}();e.Vector3=n,__reflect(n.prototype,"egret3d.math.Vector3");var s=function(){function e(t,e,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=0),this.x=t,this.y=e,this.z=r,this.w=a}return e.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"x",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"y",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"z",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"w",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],e)}();e.Vector4=s,__reflect(s.prototype,"egret3d.math.Vector4");var h=function(){function e(t,e,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===r&&(r=0),void 0===a&&(a=1),this.x=t,this.y=e,this.z=r,this.w=a}return e.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"x",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"y",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"z",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],e.prototype,"w",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Number,Number,Number])],e)}();e.Quaternion=h,__reflect(h.prototype,"egret3d.math.Quaternion");var l=function(){function t(t){void 0===t&&(t=null),t?this.rawData=t:this.rawData=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return t.prototype.toString=function(){return"["+this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]+","+this.rawData[3]+"],["+this.rawData[4]+","+this.rawData[5]+","+this.rawData[6]+","+this.rawData[7]+"],["+this.rawData[8]+","+this.rawData[9]+","+this.rawData[10]+","+this.rawData[11]+"],["+this.rawData[12]+","+this.rawData[13]+","+this.rawData[14]+","+this.rawData[15]+"]"},t}();e.Matrix=l,__reflect(l.prototype,"egret3d.math.Matrix");var c=function(){function t(t){void 0===t&&(t=null),t?this.rawData=t:this.rawData=new Float32Array([1,0,0,0,1,0])}return t.prototype.toString=function(){return"["+this.rawData[0]+","+this.rawData[1]+","+this.rawData[2]+"],["+this.rawData[3]+","+this.rawData[4]+","+this.rawData[5]+"]"},t}();e.Matrix3x2=c,__reflect(c.prototype,"egret3d.math.Matrix3x2")}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(e,r){void 0===e&&(e=void 0),this.defaultAsset=!1,this._name="",this._guid=t.IDCount++,e||(e=r+"_"+this.getGUID()),this._name=e}return t.prototype.getName=function(){return this._name},t.prototype.getGUID=function(){return this._guid},t.prototype.use=function(){},t.prototype.unuse=function(t){void 0===t&&(t=!1)},t.IDCount=1,t}();t.Asset=e,__reflect(e.prototype,"egret3d.framework.Asset")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function e(){this._init()}return e.prototype._init=function(){var e=t.WebAudio.instance.audioContext;this.source=e.createBufferSource(),this.gain=e.createGain(),this.source.connect(this.gain),this.gain.connect(e.destination)},Object.defineProperty(e.prototype,"buffer",{set:function(t){this.source.buffer=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this.gain.gain.value},set:function(t){t=Math.max(Math.min(t,1),-.999),this.gain.gain.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this.source.loop},set:function(t){this.source.loop=t},enumerable:!0,configurable:!0}),e.prototype.start=function(t){this.source.start(void 0,t||void 0)},e.prototype.stop=function(){this.source.stop()},e.prototype.dispose=function(){this.source.buffer=null},e}();t.WebAudioChannel2D=e,__reflect(e.prototype,"egret3d.sound.WebAudioChannel2D")}(e=t.sound||(t.sound={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){this._eventMap={}}return t.prototype.addEventListener=function(t,e,r){var a=this._eventMap[t];a||(a=this._eventMap[t]=[]),a.push({listener:e,thisObject:r||this})},t.prototype.removeEventListener=function(t,e,r){var a=this._eventMap[t];if(a)for(var i=0,o=a.length;o>i;i++){var n=a[i];if(n.listener==e&&n.thisObject==(r||this)){a.splice(i,1);break}}},t.prototype.dispatchEvent=function(t){t.target=this,this.notifyListener(t)},t.prototype.notifyListener=function(t){var e=this._eventMap[t.type||t];if(e)for(var r=0,a=e.length;a>r;r++){var i=e[r];i.listener.call(i.thisObject,t)}},t}();t.EventDispatcher=e,__reflect(e.prototype,"egret3d.framework.EventDispatcher")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(r){function a(){var t=null!==r&&r.apply(this,arguments)||this;return t.version="v1.0.0",t.build="b000000",t._resizeDirty=!0,t._aspectRatio=0,t._pixelRatio=1,t.limitFrame=!0,t._tar=-1,t._standDeltaTime=-1,t.be2dstate=!1,t.curcameraindex=-1,t._bePlay=!1,t._bePause=!1,t._beStepForward=!1,t.beStepNumber=0,t._userCode=[],t._userCodeNew=[],t._editorCode=[],t._editorCodeNew=[],t}return __extends(a,r),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"aspectRatio",{get:function(){return this._aspectRatio},set:function(t){this._aspectRatio=t,this._resizeDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pixelRatio",{get:function(){return this._pixelRatio},set:function(t){this._pixelRatio=t,this._resizeDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"timeScale",{get:function(){return this._timeScale},set:function(t){this._timeScale=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"targetFrame",{get:function(){return this._tar},set:function(t){0==t&&(t=-1),this._tar=t,this._standDeltaTime=1/this._tar},enumerable:!0,configurable:!0}),a.prototype.getScene=function(){return this._scene},Object.defineProperty(a.prototype,"inputManager",{get:function(){return this._inputManager},enumerable:!0,configurable:!0}),a.prototype.start=function(r,a){var i=this;void 0===a&&(a={antialias:!1}),console.log("version: "+this.version+",  build: "+this.build);var o=document.createElement("canvas");r.appendChild(o),this.container=r,this.webgl=o.getContext("webgl",a)||o.getContext("experimental-webgl",a),t.render.Webglkit.initConst(this.webgl),this._scene=new e.Scene(this),e.DefaultMeshes.init(this.webgl),e.DefaultTextures.init(this.webgl),e.DefaultShaders.init(this.webgl),this._inputManager=new e.InputManager(this),this._timeScale=1,this.beginTimer=this.lastTimer=this.pretimer=Date.now()/1e3,this.loop(),t.io.ReferenceInfo.regDefaultType(),window.addEventListener("resize",function(){i._resizeDirty=!0},!1)},a.prototype.checkFilter=function(e){return e instanceof t.framework.Transform&&e.gameObject.hideFlags&t.framework.HideFlags.HideInHierarchy?!1:e instanceof t.framework.Transform2D&&e.hideFlags&t.framework.HideFlags.HideInHierarchy?!1:!0},a.prototype.showFps=function(){null==this.stats?(this.stats=new Stats.Stats(this),this.stats.container.style.position="absolute",this.stats.container.style.left="0px",this.stats.container.style.top="0px",this.container.appendChild(this.stats.container)):this.container.appendChild(this.stats.container)},a.prototype.closeFps=function(){null!=this.stats&&this.container.removeChild(this.stats.container)},a.prototype.update=function(t){this._resizeDirty&&(this._resize(),this._resizeDirty=!1),this.bePlay&&(this.bePause?this.beStepForward&&this.beStepNumber>0&&(this.beStepNumber--,this.updateUserCode(t)):this.updateUserCode(t)),this.updateEditorCode(t),this.dispatchEvent("beforeRender"),null!=this._scene&&this._scene.update(t),this.dispatchEvent("afterRender"),this._inputManager.update(t)},a.prototype._resize=function(){var t,e,r,a,i=window.innerWidth,o=window.innerHeight;if(this.aspectRatio>0){var n=i/o;n>this.aspectRatio?(r=o*this.aspectRatio,a=o,t=(i-r)/2,e=0):(r=i,a=i/this.aspectRatio,t=0,e=(o-a)/2)}else r=i,a=o,t=0,e=0;this.webgl.canvas.width=r*this._pixelRatio,this.webgl.canvas.height=a*this._pixelRatio,this.webgl.canvas.style.width=r+"px",this.webgl.canvas.style.height=a+"px",this.webgl.canvas.style.position="absolute",this.webgl.canvas.style.left=t+"px",this.webgl.canvas.style.top=e+"px",this._width=r*this.pixelRatio,this._height=a*this.pixelRatio,this._inputManager.touch.updateOffsetAndScale(t,e,this._pixelRatio),this._inputManager.mouse.updateOffsetAndScale(t,e,this._pixelRatio),console.log("canvas resize -> width: "+r+", height: "+a)},a.prototype.getTotalTime=function(){return this.totalTime},Object.defineProperty(a.prototype,"deltaTime",{get:function(){return this._deltaTime*this._timeScale},enumerable:!0,configurable:!0}),a.prototype.getUpdateTimer=function(){return this.updateTimer},a.prototype.getUserUpdateTimer=function(){return 0},a.prototype.loop=function(){var t=Date.now()/1e3;if(this._deltaTime=t-this.lastTimer,this.totalTime=t-this.beginTimer,this.updateTimer=t-this.pretimer,this._deltaTime<this._standDeltaTime){var e=this,r=this._standDeltaTime-this._deltaTime;setTimeout(function(){var t=Date.now()/1e3;e.lastTimer=t,e.pretimer=t,e.update(e._standDeltaTime),null!=e.stats&&e.stats.update(),e.loop()},1e3*r)}else this.update(this.deltaTime),null!=this.stats&&this.stats.update(),this.lastTimer=t,this.pretimer=t,this.limitFrame?requestAnimationFrame(this.loop.bind(this)):setTimeout(this.loop.bind(this),1)},Object.defineProperty(a.prototype,"bePlay",{get:function(){return this._bePlay},set:function(t){this._bePlay=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"bePause",{get:function(){return this._bePause},set:function(t){this._bePause=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"beStepForward",{get:function(){return this._beStepForward},set:function(t){this._beStepForward=t},enumerable:!0,configurable:!0}),a.prototype.addUserCodeDirect=function(t){this._userCodeNew.push(t)},a.prototype.addUserCode=function(e){var r=t.reflect.getPrototype(e);if(null!=r){var a=t.reflect.createInstance(r,{usercode:"1"});this.addUserCodeDirect(a)}},a.prototype.updateUserCode=function(t){for(var e=this._userCodeNew.length-1;e>=0;e--){var r=this._userCodeNew[e];0==r.isClosed()&&(r.onStart(this),this._userCode.push(r),this._userCodeNew.splice(e,1))}for(var a=-1,e=0;e<this._userCode.length;e++){var r=this._userCode[e];0==r.isClosed()?r.onUpdate(t):0>a&&(a=e)}a>=0&&this._userCode.splice(a,1)},a.prototype.addEditorCode=function(e){var r=t.reflect.getPrototype(e);if(null!=r){var a=t.reflect.createInstance(r,{editorcode:"1"});this.addEditorCodeDirect(a)}},a.prototype.addEditorCodeDirect=function(t){this._editorCodeNew.push(t)},a.prototype.updateEditorCode=function(t){for(var e=this._editorCodeNew.length-1;e>=0;e--){var r=this._editorCodeNew[e];0==r.isClosed()&&(r.onStart(this),this._editorCode.push(r),this._editorCodeNew.splice(e,1))}for(var e=this._editorCode.length-1;e>=0;e--){var r=this._editorCode[e];r.isClosed()?this._editorCode.splice(e,1):r.onUpdate(t)}},a}(e.EventDispatcher);e.Application=r,__reflect(r.prototype,"egret3d.framework.Application")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){t.licence="xxxxxxx"}(egret3d||(egret3d={}));var Stats;!function(t){var e=function(){function t(t){var e=this;this.mode=0,this.app=t,this.container=document.createElement("div"),this.container.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.7;z-index:1",this.container.addEventListener("click",function(t){t.preventDefault(),e.showPanel(++e.mode%e.container.children.length)},!1),this.beginTime=(performance||Date).now(),this.prevTime=this.beginTime,this.frames=0,this.fpsPanel=this.addPanel(new r("FPS","#0ff","#002")),this.msPanel=this.addPanel(new r("MS","#0f0","#020")),this.ratePanel=this.addPanel(new r("%","#0f0","#020")),this.userratePanel=this.addPanel(new r("%","#0f0","#020")),self.performance&&self.performance.memory&&(this.memPanel=this.addPanel(new r("MB","#f08","#201"))),this.showPanel(0)}return t.prototype.update=function(){this.beginTime=this.end()},t.prototype.showPanel=function(t){for(var e=0;e<this.container.children.length;e++)this.container.children[e].style.display=e===t?"block":"none";this.mode=t},t.prototype.addPanel=function(t){return this.container.appendChild(t.canvas),t},t.prototype.begin=function(){this.beginTime=(performance||Date).now()},t.prototype.end=function(){this.frames++;var t=(performance||Date).now();if(this.msPanel.update(t-this.beginTime,200),t>this.prevTime+1e3){var e=1e3*this.frames/(t-this.prevTime);if(this.fpsPanel.update(e,100),this.ratePanel.update(this.app.getUpdateTimer()*this.frames/10,100),this.userratePanel.update(this.app.getUserUpdateTimer()*this.frames/10,100),this.prevTime=t,this.frames=0,this.memPanel){var r=performance.memory;this.memPanel.update(r.usedJSHeapSize/1048576,r.jsHeapSizeLimit/1048576)}}return t},t}();t.Stats=e,__reflect(e.prototype,"Stats.Stats");var r=function(){function t(t,e,r){this.name=t,this.fg=e,this.bg=r,this.min=1/0,this.max=0,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=80*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=74*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.cssText="width:80px;height:48px",this.context=this.canvas.getContext("2d"),this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.context.fillStyle=r,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=e,this.context.fillText(t,this.TEXT_X,this.TEXT_Y),this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=r,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT)}return t.prototype.update=function(t,e){this.min=Math.min(this.min,t),this.max=Math.max(this.max,t),this.context.fillStyle=this.bg,this.context.globalAlpha=1,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(Math.round(t)+" "+this.name+" ("+Math.round(this.min)+"-"+Math.round(this.max)+")",this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT),this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y,this.PR,Math.round((1-t/e)*this.GRAPH_HEIGHT))},t}();__reflect(r.prototype,"Panel")}(Stats||(Stats={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.is2dUI=!0,this.pointDown=!1,this.pointSelect=null,this.pointEvent=new e.PointEvent,this.pointX=0,this.pointY=0,this.pixelWidth=640,this.pixelHeight=480,this.rootNode=new e.Transform2D,this.rootNode.canvas=this}return r.prototype.addChild=function(t){this.rootNode.addChild(t)},r.prototype.removeChild=function(t){this.rootNode.removeChild(t)},r.prototype.getChildren=function(){return this.rootNode.children},r.prototype.getChildCount=function(){return null==this.rootNode.children?0:this.rootNode.children.length},r.prototype.getChild=function(t){return this.rootNode.children[t]},r.prototype.update=function(t,r,a,i){this.pixelWidth/this.pixelHeight;this.rootNode.localScale.x=2/this.pixelWidth,this.rootNode.localScale.y=-2/this.pixelHeight,this.rootNode.localTranslate.y=1,this.rootNode.localTranslate.x=-1,this.rootNode.width=this.pixelWidth,this.rootNode.height=this.pixelHeight,this.rootNode.pivot.x=0,this.rootNode.pivot.y=0,this.rootNode.updateTran(!1),this.pointEvent.eated=!1,this.pointEvent.x=a,this.pointEvent.y=i,this.pointEvent.selected=this.pointSelect;var o=!1;0==this.pointDown&&0==r?o=!0:0==this.pointDown&&1==r?this.pointEvent.type=e.PointEventEnum.PointDown:1==this.pointDown&&1==r?(this.pointEvent.type=e.PointEventEnum.PointHold,this.pointX==this.pointEvent.x&&this.pointY==this.pointEvent.y&&(o=!0)):1==this.pointDown&&0==r&&(this.pointEvent.type=e.PointEventEnum.PointUp),o||(this.rootNode.onCapturePointEvent(this,this.pointEvent),this.rootNode.onPointEvent(this,this.pointEvent),this.pointSelect=this.pointEvent.selected,this.pointDown=r,this.pointX=this.pointEvent.x,this.pointY=this.pointEvent.y),this.rootNode.update(t)},r.prototype.render=function(r){if(this.context=r,this.lastMat=null,null==this.batcher){this.webgl=r.webgl,this.batcher=new e.Batcher2D;var a=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0|t.render.VertexFormatMask.ColorEX;this.batcher.initBuffer(r.webgl,a,t.render.DrawModeEnum.VboTri)}this.drawScene(this.rootNode,r),this.batcher.end(r.webgl),null!=this.afterRender&&this.afterRender()},r.prototype.pushRawData=function(t,e){if(t!=this.lastMat){this.lastMat=t,this.batcher.end(this.webgl);var r=this.lastMat.getShader().passes.base[this.is2dUI?0:1],a=r.program,i=r.use(this.webgl);a.uploadUniforms(t,this.context,i),this.batcher.begin(this.webgl,r)}this.batcher.push(this.webgl,e,null)},r.prototype.drawScene=function(t,e){if(null!=t.renderer&&t.renderer.render(this),null!=t.children)for(var r=0;r<t.children.length;r++)this.drawScene(t.children[r],e)},r.prototype.getRoot=function(){return null==this.rootNode&&(this.rootNode=new e.Transform2D,this.rootNode.canvas=this),this.rootNode},__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],r.prototype,"pixelWidth",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],r.prototype,"pixelHeight",void 0),__decorate([t.reflect.Field("Transform2D"),__metadata("design:type",e.Transform2D)],r.prototype,"rootNode",void 0),r=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[])],r)}();e.Canvas=r,__reflect(r.prototype,"egret3d.framework.Canvas")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){this.vboCount=0,this.eboCount=0}return e.prototype.initBuffer=function(e,r,a){this.mesh=new t.render.GlMesh,this.mesh.initBuffer(e,r,128,t.render.MeshTypeEnum.Dynamic),this.dataForVbo=new Float32Array(128),this.drawMode=a,(a==t.render.DrawModeEnum.EboLine||a==t.render.DrawModeEnum.EboTri)&&(this.mesh.addIndex(e,128),this.dataForEbo=new Uint16Array(128))},e.prototype.begin=function(t,e){this.vboCount>0&&this.end(t),this.curPass=e},e.prototype.push=function(e,r,a){if((this.vboCount+r.length>2048||null!=a&&this.eboCount+a.length>2048)&&this.end(e),this.vboCount+r.length>this.dataForVbo.length){for(var i=new Float32Array(2*this.dataForVbo.length),o=0;o<this.dataForVbo.length;o++)i[o]=this.dataForVbo[o];this.dataForVbo=i,this.mesh.resetVboSize(e,this.dataForVbo.length)}for(var o=0;o<r.length;o++)this.dataForVbo[this.vboCount+o]=r[o];if(this.vboCount+=r.length,this.drawMode!=t.render.DrawModeEnum.VboLine&&this.drawMode!=t.render.DrawModeEnum.VboTri&&null!=a){if(this.eboCount+a.length>this.dataForEbo.length){for(var i=new Uint16Array(2*this.dataForEbo.length),o=0;o<this.dataForEbo.length;o++)i[o]=this.dataForEbo[o];this.dataForEbo=i,this.mesh.resetEboSize(e,0,this.dataForEbo.length)}for(var o=0;o<a.length;o++)this.dataForEbo[this.eboCount+o]=a[o];this.eboCount+=a.length}},e.prototype.end=function(e){if(0!=this.vboCount){this.mesh.uploadVertexSubData(e,this.dataForVbo.slice(0,this.vboCount),0),this.eboCount>0&&this.mesh.uploadIndexSubData(e,0,this.dataForEbo.slice(0,this.eboCount),0);var r=this.vboCount/(this.mesh.vertexByteSize/4)|0,a=this.drawMode==t.render.DrawModeEnum.EboLine||this.drawMode==t.render.DrawModeEnum.EboTri?0:-1;this.curPass.program.bindAttributes(this.mesh,a,!0),this.drawMode==t.render.DrawModeEnum.EboLine?t.render.Webglkit.drawElementLines(e,0,this.eboCount):this.drawMode==t.render.DrawModeEnum.EboTri?t.render.Webglkit.drawElementTris(e,0,this.eboCount):this.drawMode==t.render.DrawModeEnum.VboLine?t.render.Webglkit.drawArrayLines(e,0,r):this.drawMode==t.render.DrawModeEnum.VboTri&&t.render.Webglkit.drawArrayTris(e,0,r),this.vboCount=0,this.eboCount=0}},e}();e.Batcher2D=r,__reflect(r.prototype,"egret3d.framework.Batcher2D");var a=function(){function r(){this.frustumTest=!1,this.layer=e.RenderLayerEnum.UI,this.renderLayer=e.CullingMask.Default,this.queue=0,this.canvas=new e.Canvas,this.canvas.is2dUI=!1}return r.prototype.getBound=function(){return null},r.prototype.intersectsTransform=function(t){return!1},r.prototype.setSize=function(t,e){this.canvas.pixelWidth=t,this.canvas.pixelHeight=e},r.prototype.start=function(){this.canvas.scene=this.gameObject.getScene(),this.canvas.parentTrans=this.gameObject.transform},r.prototype.addChild=function(t){this.canvas.addChild(t)},r.prototype.removeChild=function(t){this.canvas.removeChild(t)},r.prototype.getChildren=function(){return this.canvas.getChildren()},r.prototype.getChildCount=function(){return this.canvas.getChildCount()},r.prototype.getChild=function(t){return this.canvas.getChild(t)},r.prototype.update=function(e){var r=this.canvas.pixelWidth/this.canvas.pixelHeight,a=this.gameObject.transform.getLocalScale();if(this.gameObject.transform.setLocalScale(a.y*r,a.y,a.z),null!=this.cameraTouch){var i=this.gameObject.getScene(),o=i.app.inputManager,n=o.getTouchPoint(),s=this.cameraTouch.creatRayByScreen(n,i.app),h=i.pick(s);if(null!=h&&h.pickedtran==this.gameObject.transform){var l=this.gameObject.transform.getWorldMatrix(),c=new t.math.Matrix;t.math.matrixInverse(l,c);var u=new t.math.Vector3;t.math.matrixTransformVector3(h.hitposition,c,u),this.canvas.update(e,o.isPressed()||o.wasPressed(),u.x,u.y)}else this.canvas.update(e,!1,0,0)}else this.canvas.update(e,!1,0,0)},r.prototype.pick2d=function(e){var r=e.intersectPlaneTransform(this.gameObject.transform);if(null!=r){var a=this.gameObject.transform.getWorldMatrix(),i=t.math.Pool.new_matrix();t.math.matrixInverse(a,i);var o=t.math.Pool.new_vector3();t.math.matrixTransformVector3(r.hitposition,i,o);var n=t.math.Pool.new_vector2();n.x=o.x,n.y=o.y;var s=this.canvas.getRoot();return this.dopick2d(n,s)}return null},r.prototype.dopick2d=function(t,e){if(null!=e.components)for(var r=e.components.length-1;r>=0;r--){var a=e.components[r];
if(null!=a&&a.init&&a.comp.transform.ContainsCanvasPoint(t))return a.comp.transform}if(null!=e.children)for(var r=e.children.length-1;r>=0;r--){var i=this.dopick2d(t,e.children[r]);if(null!=i)return i}return null},r.prototype.render=function(t,e){t.updateModel(this.gameObject.transform),this.canvas.render(t)},r.prototype.jsonToAttribute=function(t){},r.prototype.remove=function(){},r.prototype.clone=function(){},__decorate([t.reflect.Field("Canvas"),__metadata("design:type",e.Canvas)],r.prototype,"canvas",void 0),r=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent,t.reflect.nodeCanvasRendererCollider,__metadata("design:paramtypes",[])],r)}();e.CanvasRenderer=a,__reflect(a.prototype,"egret3d.framework.CanvasRenderer",["egret3d.framework.IRenderer","egret3d.framework.INodeComponent","egret3d.framework.ICollider"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e;!function(t){t[t.PointNothing=0]="PointNothing",t[t.PointDown=1]="PointDown",t[t.PointHold=2]="PointHold",t[t.PointUp=3]="PointUp"}(e=t.PointEventEnum||(t.PointEventEnum={}));var r=function(){function t(){}return t}();t.PointEvent=r,__reflect(r.prototype,"egret3d.framework.PointEvent");var a=function(){function t(){this.funcs=[]}return t.prototype.addListener=function(t){this.funcs.push(t)},t.prototype.excute=function(){for(var t in this.funcs)this.funcs[t]()},t.prototype.clear=function(){this.funcs.length=0},t}();t.UIEvent=a,__reflect(a.prototype,"egret3d.framework.UIEvent")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret;!function(t){var e;!function(e){var r=function(){function r(e,r){this.context=e;var a=this.egretWebGLRenderContext=t.web.WebGLRenderContext.getInstance();a.setContext(e),this.drawCmdManager=a.drawCmdManager,this.vao=a.vao,a.drawFunc=this.$drawWebGL.bind(this),t.sys.RenderBuffer=t.web.WebGLRenderBuffer,t.sys.systemRenderer=new t.web.WebGLRenderer,t.sys.canvasRenderer=new t.CanvasRenderer,t.sys.customHitTestBuffer=new t.web.WebGLRenderBuffer(3,3),t.sys.canvasHitTestBuffer=new t.web.CanvasRenderBuffer(3,3),t.Capabilities.$renderMode="webgl",this.vertexBuffer=e.createBuffer(),this.indexBuffer=e.createBuffer(),r.addEventListener("beforeRender",function(){t.ticker.update()},this)}return r.getInstance=function(t,e){return this._instance||(this._instance=new r(t,e)),this._instance},r.prototype.beforeRender=function(){var t=this.context;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),t.enable(t.BLEND),t.disable(t.STENCIL_TEST),t.colorMask(!0,!0,!0,!0),this.setBlendMode("source-over"),t.activeTexture(t.TEXTURE0)},r.prototype.$drawWebGL=function(){if(0!=this.drawCmdManager.drawDataLen){this.uploadVerticesArray(this.vao.getVertices()),this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getMeshIndices());for(var t=this.drawCmdManager.drawDataLen,e=0,r=0;t>r;r++){var a=this.drawCmdManager.drawData[r];e=this.drawData(a,e),6==a.type&&(this.activatedBuffer=a.buffer,this.egretWebGLRenderContext.activatedBuffer=a.buffer),(0==a.type||1==a.type||2==a.type)&&this.activatedBuffer&&this.activatedBuffer.$computeDrawCall&&this.activatedBuffer.$drawCalls++}this.vao.isMesh()&&this.uploadIndicesArray(this.vao.getIndices()),this.drawCmdManager.clear(),this.vao.clear()}},r.prototype.drawData=function(t,r){if(t){var a,i=this.context,o=t.filter;switch(t.type){case 0:o?"custom"===o.type?a=e.EgretWebGLProgram.getProgram(i,o.$vertexSrc,o.$fragmentSrc,o.$shaderKey):"colorTransform"===o.type?a=e.EgretWebGLProgram.getProgram(i,e.EgretShaderLib.default_vert,e.EgretShaderLib.colorTransform_frag,"colorTransform"):"blurX"===o.type?a=e.EgretWebGLProgram.getProgram(i,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"blurY"===o.type?a=e.EgretWebGLProgram.getProgram(i,e.EgretShaderLib.default_vert,e.EgretShaderLib.blur_frag,"blur"):"glow"===o.type&&(a=e.EgretWebGLProgram.getProgram(i,e.EgretShaderLib.default_vert,e.EgretShaderLib.glow_frag,"glow")):a=e.EgretWebGLProgram.getProgram(i,e.EgretShaderLib.default_vert,e.EgretShaderLib.texture_frag,"texture"),this.activeProgram(i,a),this.syncUniforms(a,o,t.textureWidth,t.textureHeight),r+=this.drawTextureElements(t,r);break;case 1:a=e.EgretWebGLProgram.getProgram(i,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(i,a),this.syncUniforms(a,o,t.textureWidth,t.textureHeight),r+=this.drawPushMaskElements(t,r);break;case 2:a=e.EgretWebGLProgram.getProgram(i,e.EgretShaderLib.default_vert,e.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(i,a),this.syncUniforms(a,o,t.textureWidth,t.textureHeight),r+=this.drawPopMaskElements(t,r);break;case 3:this.setBlendMode(t.value);break;case 4:t.buffer.rootRenderTarget.resize(t.width,t.height),this.onResize(t.width,t.height);break;case 5:if(this.activatedBuffer){var n=this.activatedBuffer.rootRenderTarget;(0!=n.width||0!=n.height)&&n.clear(!0)}break;case 6:this.activateBuffer(t.buffer);break;case 7:var s=this.activatedBuffer;s&&(s.rootRenderTarget&&s.rootRenderTarget.enabledStencil(),s.enableScissor(t.x,t.y,t.width,t.height));break;case 8:s=this.activatedBuffer,s&&s.disableScissor()}return r}},r.prototype.activeProgram=function(t,e){t.useProgram(e.id);var r=e.attributes;for(var a in r)"aVertexPosition"===a?(t.vertexAttribPointer(r.aVertexPosition.location,2,t.FLOAT,!1,20,0),t.enableVertexAttribArray(r.aVertexPosition.location)):"aTextureCoord"===a?(t.vertexAttribPointer(r.aTextureCoord.location,2,t.FLOAT,!1,20,8),t.enableVertexAttribArray(r.aTextureCoord.location)):"aColor"===a&&(t.vertexAttribPointer(r.aColor.location,1,t.FLOAT,!1,20,16),t.enableVertexAttribArray(r.aColor.location));this.currentProgram=e},r.prototype.syncUniforms=function(t,e,r,a){var i=t.uniforms;for(var o in i)if("projectionVector"===o)i[o].setValue({x:this.projectionX,y:this.projectionY});else if("uTextureSize"===o)i[o].setValue({x:r,y:a});else if("uSampler"===o);else{var n=e.$uniforms[o];void 0!==n&&i[o].setValue(n)}},r.prototype.drawTextureElements=function(t,e){var r=this.context;r.bindTexture(r.TEXTURE_2D,t.texture);var a=3*t.count;return r.drawElements(r.TRIANGLES,a,r.UNSIGNED_SHORT,2*e),a},r.prototype.activateBuffer=function(t){t.rootRenderTarget.activate(),this.bindIndices||this.uploadIndicesArray(this.vao.getIndices()),t.restoreStencil(),t.restoreScissor(),this.onResize(t.width,t.height)},r.prototype.onResize=function(t,e){this.projectionX=t/2,this.projectionY=-e/2,this.context&&this.context.viewport(0,0,t,e)},r.prototype.uploadVerticesArray=function(t){var e=this.context;e.bufferData(e.ARRAY_BUFFER,t,e.STREAM_DRAW)},r.prototype.uploadIndicesArray=function(t){var e=this.context;e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW),this.bindIndices=!0},r.prototype.drawPushMaskElements=function(t,e){var r=this.context,a=3*t.count,i=this.activatedBuffer;if(i){i.rootRenderTarget&&i.rootRenderTarget.enabledStencil(),0==i.stencilHandleCount&&(i.enableStencil(),r.clear(r.STENCIL_BUFFER_BIT));var o=i.stencilHandleCount;i.stencilHandleCount++,r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,o,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR),r.drawElements(r.TRIANGLES,a,r.UNSIGNED_SHORT,2*e),r.stencilFunc(r.EQUAL,o+1,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return a},r.prototype.drawPopMaskElements=function(t,e){var r=this.context,a=3*t.count,i=this.activatedBuffer;if(i)if(i.stencilHandleCount--,0==i.stencilHandleCount)i.disableStencil();else{var o=i.stencilHandleCount;r.colorMask(!1,!1,!1,!1),r.stencilFunc(r.EQUAL,o+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR),r.drawElements(r.TRIANGLES,a,r.UNSIGNED_SHORT,2*e),r.stencilFunc(r.EQUAL,o,255),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP)}return a},r.prototype.setBlendMode=function(t){var e=this.context,a=r.blendModesForGL[t];a&&e.blendFunc(a[0],a[1])},r.initBlendMode=function(){r.blendModesForGL={},r.blendModesForGL["source-over"]=[1,771],r.blendModesForGL.lighter=[1,1],r.blendModesForGL["lighter-in"]=[770,771],r.blendModesForGL["destination-out"]=[0,771],r.blendModesForGL["destination-in"]=[0,770]},r.blendModesForGL=null,r}();e.Renderer=r,__reflect(r.prototype,"egret.web.Renderer"),r.initBlendMode()}(e=t.web||(t.web={}))}(egret||(egret={}));var egret3d;!function(t){var e;!function(e){var r,a=new t.math.Rect;!function(t){t[t.CONSTANT=0]="CONSTANT",t[t.SHRINK=1]="SHRINK",t[t.EXPAND=2]="EXPAND"}(r=e.SCREEN_MATCH_MODE||(e.SCREEN_MATCH_MODE={}));var i=function(){function i(){this.init=!1,this._screenAdaptDirty=!0,this._scaleFactor=1,this._resolution=new t.math.Vector2(300,400),this._screenMatchMode=r.CONSTANT,this._renderViewport=new t.math.Rect,this._viewport=new t.math.Vector4,this.autoAsp=!0,this.canvas=new e.Canvas}return Object.defineProperty(i.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(t){this._scaleFactor!=t&&(this._scaleFactor=t,this._screenAdaptDirty=!0)},enumerable:!0,configurable:!0}),i.prototype.setResolutionSize=function(t,e){(this._resolution.x!=t||this._resolution.y!=e)&&(this._resolution.x=t,this._resolution.y=e,this._screenAdaptDirty=!0)},i.prototype.setScreenMatchMode=function(t){this._screenMatchMode!=t&&(this._screenMatchMode=t,this._screenAdaptDirty=!0)},i.prototype.setRenderViewport=function(t,e,r,a){(this._renderViewport.x!=t||this._renderViewport.y!=e||this._renderViewport.w!=r||this._renderViewport.h!=a)&&(this._renderViewport.x=t,this._renderViewport.y=e,this._renderViewport.w=r,this._renderViewport.h=a,this._screenAdaptDirty=!0)},i.prototype._calculateScreenAdapt=function(){switch(this._screenMatchMode){case r.CONSTANT:this.canvas.pixelWidth=this._renderViewport.w/this._scaleFactor,this.canvas.pixelHeight=this._renderViewport.h/this._scaleFactor,this._viewport.x=this._renderViewport.x,this._viewport.y=this._renderViewport.y,this._viewport.z=this._renderViewport.w,this._viewport.w=this._renderViewport.h;break;case r.SHRINK:var t=this._renderViewport,e=t.x,a=t.y,i=t.w,o=t.h,n=this._resolution,s=(i-e)/(o-a),h=n.x/n.y,l=h>s,c=void 0,u=void 0,d=void 0,p=void 0;l?(d=i,p=Math.floor(d/h)):(p=o,d=Math.floor(p*h)),c=Math.floor((i-d)/2)+e,u=Math.floor((o-p)/2)+a,this._viewport.x=c,this._viewport.y=u,this._viewport.z=d,this._viewport.w=p,this.canvas.pixelWidth=n.x,this.canvas.pixelHeight=n.y;break;case r.EXPAND:var t=this._renderViewport,e=t.x,a=t.y,i=t.w,o=t.h,n=this._resolution,s=(i-e)/(o-a),h=n.x/n.y,l=h>s,c=void 0,u=void 0,d=void 0,p=void 0;l?(p=o,d=Math.floor(p*h)):(d=i,p=Math.floor(d/h)),c=Math.floor((i-d)/2)+e,u=Math.floor((o-p)/2)+a,this._viewport.x=c,this._viewport.y=u,this._viewport.z=d,this._viewport.w=p,this.canvas.pixelWidth=n.x,this.canvas.pixelHeight=n.y}this._screenAdaptDirty=!1},i.prototype.start=function(t){this.camera=t,this.app=t.gameObject.getScene().app,this.canvas.scene=t.gameObject.getScene()},i.prototype.addChild=function(t){this.canvas.addChild(t)},i.prototype.removeChild=function(t){this.canvas.removeChild(t)},i.prototype.getChildren=function(){return this.canvas.getChildren()},i.prototype.getChildCount=function(){return this.canvas.getChildCount()},i.prototype.getChild=function(t){return this.canvas.getChild(t)},i.prototype.render=function(t,e){this.canvas.getRoot().visible&&null!=this.camera&&void 0!=this.camera&&(t.updateOverlay(),t.webgl.viewport(this._viewport.x,this._viewport.y,this._viewport.z,this._viewport.w),this.canvas.render(t))},i.prototype.update=function(t){var e=this.app.inputManager,r=e.getTouchPoint();this.camera.calcViewPortPixel(this.app,a),this.setRenderViewport(a.x,a.y,a.w,a.h),this._screenAdaptDirty&&(this._calculateScreenAdapt(),this.canvas.getRoot().markDirty());var i=(r.x-this._viewport.x)/this._viewport.z*2-1,o=(r.y-this._viewport.y)/this._viewport.w*-2+1;this.canvas.update(t,e.isPressed()||e.wasPressed(),i,o)},i.prototype.pick2d=function(e,r){if(null==this.camera)return null;var a=new t.math.Rect,i=(this.camera.calcViewPortPixel(this.app,a),e/a.w*2-1),o=r/a.h*-2+1,n=t.math.Pool.new_vector2();n.x=i,n.y=o;var s=this.canvas.getRoot();return this.dopick2d(n,s)},i.prototype.dopick2d=function(t,e){if(null!=e.components)for(var r=e.components.length-1;r>=0;r--){var a=e.components[r];if(null!=a&&a.init&&a.comp.transform.ContainsCanvasPoint(t))return a.comp.transform}if(null!=e.children)for(var r=e.children.length-1;r>=0;r--){var i=this.dopick2d(t,e.children[r]);if(null!=i)return i}return null},i.prototype.calScreenPosToCanvasPos=function(e,r){var a=new t.math.Rect;this.camera.calcViewPortPixel(this.app,a);var i=t.math.Pool.new_vector2();i.x=e.x/a.w*2-1,i.y=e.y/a.h*-2+1;var o=t.math.Pool.new_matrix3x2();t.math.matrix3x2Clone(this.canvas.getRoot().getWorldMatrix(),o),t.math.matrix3x2Inverse(o,o),t.math.matrix3x2TransformVector2(o,i,r),t.math.Pool.delete_vector2(i)},__decorate([t.reflect.Field("Canvas"),__metadata("design:type",e.Canvas)],i.prototype,"canvas",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],i.prototype,"autoAsp",void 0),i=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[])],i)}();e.Overlay2D=i,__reflect(i.prototype,"egret3d.framework.Overlay2D",["egret3d.framework.IOverLay"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(t,e){void 0===e&&(e=!1),this.comp=t,this.init=e}return __decorate([t.reflect.Field("I2DComponent"),__metadata("design:type",Object)],e.prototype,"comp",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Object,Boolean])],e)}();e.C2DComponent=r,__reflect(r.prototype,"egret3d.framework.C2DComponent");var a=function(){function a(){this.name="noname",this.pivot=new t.math.Vector2(0,0),this.hideFlags=e.HideFlags.None,this._visible=!0,this.insId=new e.InsID,this.dirty=!0,this.dirtyChild=!0,this.dirtyWorldDecompose=!1,this.localTranslate=new t.math.Vector2(0,0),this.localScale=new t.math.Vector2(1,1),this.localRotate=0,this.localMatrix=new t.math.Matrix3x2,this.worldMatrix=new t.math.Matrix3x2,this.worldRotate=new t.math.Angelref,this.worldTranslate=new t.math.Vector2(0,0),this.worldScale=new t.math.Vector2(1,1),this.components=[]}return Object.defineProperty(a.prototype,"canvas",{get:function(){return null==this._canvas?null==this.parent?null:this.parent.canvas:this._canvas},set:function(t){this._canvas=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"visibleInScene",{get:function(){for(var t=this;t.visible;)t=t.parent;return t.visible},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"visible",{get:function(){return this._visible},set:function(t){t!=this._visible&&(this._visible=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"transform",{get:function(){return this},enumerable:!0,configurable:!0}),a.prototype.addChild=function(t){null!=t.parent&&t.parent.removeChild(t),null==this.children&&(this.children=[]),this.children.push(t),t.parent=this,t.canvas=this.canvas},a.prototype.addChildAt=function(t,e){0>e||(null!=t.parent&&t.parent.removeChild(t),null==this.children&&(this.children=[]),this.children.splice(e,0,t),t.canvas=this.canvas,t.parent=this)},a.prototype.removeChild=function(t){if(t.parent!=this||null==this.children)throw new Error("not my child.");var e=this.children.indexOf(t);e>=0&&this.children.splice(e,1)},a.prototype.removeAllChild=function(){for(;this.children.length>0;)this.removeChild(this.children[0])},a.prototype.markDirty=function(){this.dirty=!0;for(var t=this.parent;null!=t;)t.dirtyChild=!0,t=t.parent},a.prototype.updateTran=function(e){if(0!=this.dirtyChild||0!=this.dirty||0!=e){if(this.dirty&&t.math.matrix3x2MakeTransformRTS(this.localTranslate,this.localScale,this.localRotate,this.localMatrix),(this.dirty||e)&&(null==this.parent?t.math.matrix3x2Clone(this.localMatrix,this.worldMatrix):t.math.matrix3x2Multiply(this.parent.worldMatrix,this.localMatrix,this.worldMatrix),null!=this.renderer&&this.renderer.updateTran(),this.dirtyWorldDecompose=!0),null!=this.children)for(var r=0;r<this.children.length;r++)this.children[r].updateTran(e||this.dirty);this.dirty=!1,this.dirtyChild=!1}},a.prototype.updateWorldTran=function(){var t=this.parent,e=[];for(e.push(this);null!=t;)t.dirty&&e.push(t),t=t.parent;var r=e.pop();r.updateTran(!1)},a.prototype.getWorldTranslate=function(){return this.dirtyWorldDecompose&&(t.math.matrix3x2Decompose(this.worldMatrix,this.worldScale,this.worldRotate,this.worldTranslate),this.dirtyWorldDecompose=!1),this.worldTranslate},a.prototype.getWorldScale=function(){return this.dirtyWorldDecompose&&(t.math.matrix3x2Decompose(this.worldMatrix,this.worldScale,this.worldRotate,this.worldTranslate),this.dirtyWorldDecompose=!1),this.worldScale},a.prototype.getWorldRotate=function(){return this.dirtyWorldDecompose&&(t.math.matrix3x2Decompose(this.worldMatrix,this.worldScale,this.worldRotate,this.worldTranslate),this.dirtyWorldDecompose=!1),this.worldRotate},a.prototype.getLocalMatrix=function(){return this.localMatrix},a.prototype.getWorldMatrix=function(){return this.worldMatrix},a.prototype.setWorldPosition=function(e){this.dirty=!0,this.updateWorldTran();var r=this.getWorldTranslate(),a=t.math.Pool.new_vector2();a.x=e.x-r.x,a.y=e.y-r.y;var i=t.math.Pool.new_matrix3x2();null!=this.parent?t.math.matrix3x2Clone(this.parent.worldMatrix,i):t.math.matrix3x2MakeIdentity(i);var o=t.math.Pool.new_matrix3x2();t.math.matrix3x2Inverse(i,o);var n=t.math.Pool.new_vector2();t.math.matrix3x2TransformNormal(o,a,n),this.localTranslate.x+=n.x,this.localTranslate.y+=n.y,t.math.Pool.delete_matrix3x2(o),t.math.Pool.delete_vector2(a),t.math.Pool.delete_vector2(n)},a.prototype.dispose=function(){if(this.children){for(var t in this.children)this.children[t].dispose();this.removeAllChild()}this.removeAllComponents()},a.prototype.update=function(t){if(null!=this.components)for(var e=0;e<this.components.length;e++)0==this.components[e].init&&(this.components[e].comp.start(),this.components[e].init=!0),this.components[e].comp.update(t);if(null!=this.children)for(var e=0;e<this.children.length;e++)this.children[e].update(t)},a.prototype.addComponent=function(e){null==this.components&&(this.components=[]);for(var r in this.components){var a=this.components[r].comp.constructor.name;if(a==e)throw new Error("try to add a "+e+" component but already has one!")}var i=t.reflect.getPrototype(e),o=t.reflect.createInstance(i,{"2dcomp":"1"});return this.addComponentDirect(o)},a.prototype.addComponentDirect=function(e){if(null!=e.transform)throw new Error("try to add a component which has added to another game object!");e.transform=this,null==this.components&&(this.components=[]);var a=new r(e,!1);if(this.components.push(a),"1"==t.reflect.getClassTag(e.__proto__,"renderer")){if(null!=this.renderer)throw new Error("cannot add more than one render component");this.renderer=e}return e},a.prototype.removeComponent=function(t){for(var e=0;e<this.components.length;e++)this.components[e].comp==t&&(this.components[e].init,this.components.splice(e,1))},a.prototype.removeComponentByTypeName=function(e){for(var r=0;r<this.components.length;r++)if(t.reflect.getClassName(this.components[r].comp)==e){var a=this.components.splice(r,1);return a[0].comp==this.renderer&&(this.renderer=null),a[0]}},a.prototype.removeAllComponents=function(){for(var t=0;t<this.components.length;t++)this.components[t].comp.remove(),this.components[t].comp==this.renderer&&(this.renderer=null);this.components.length=0},a.prototype.getComponent=function(e){for(var r=0;r<this.components.length;r++){var a=t.reflect.getClassName(this.components[r].comp.__proto__);if(a==e)return this.components[r].comp}return null},a.prototype.getComponents=function(){for(var t=[],e=0;e<this.components.length;e++)t.push(this.components[e].comp);return t},a.prototype.getComponentsInChildren=function(t){var e=[];return this.getNodeCompoents(this,t,e),e},a.prototype.getNodeCompoents=function(e,r,a){for(var i in e.components){var o=t.reflect.getClassName(e.components[i].comp.__proto__);o==r&&a.push(this.components[i].comp)}if(null!=e.children)for(var i in e.children)this.getNodeCompoents(e.children[i],r,a)},a.prototype.onCapturePointEvent=function(t,e){if(null!=this.components)for(var r=0;r<=this.components.length;r++)if(0==e.eated){var a=this.components[r];null!=a&&a.init&&a.comp.onPointEvent(t,e,!0)}if(0==e.eated&&null!=this.children)for(var r=0;r<=this.children.length;r++){var i=this.children[r];null!=i&&i.onCapturePointEvent(t,e)}},a.prototype.ContainsCanvasPoint=function(e){var r=this.getWorldMatrix(),a=new t.math.Matrix3x2;t.math.matrix3x2Inverse(r,a);var i=new t.math.Vector2;return t.math.matrix3x2TransformVector2(a,e,i),i.x+=this.pivot.x*this.width,i.y+=this.pivot.y*this.height,i.x>=0&&i.y>=0&&i.x<this.width&&i.y<this.height},a.prototype.onPointEvent=function(t,e){if(null!=this.children)for(var r=this.children.length-1;r>=0;r--)if(0==e.eated){var a=this.children[r];null!=a&&a.onPointEvent(t,e),e.eated}if(0==e.eated&&null!=this.components)for(var r=this.components.length-1;r>=0;r--){var i=this.components[r];null!=i&&i.init&&i.comp.onPointEvent(t,e,!1)}},__decorate([t.reflect.Field("string"),__metadata("design:type",String)],a.prototype,"name",void 0),__decorate([t.reflect.Field("Transform2D[]"),__metadata("design:type",Array)],a.prototype,"children",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],a.prototype,"width",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],a.prototype,"height",void 0),__decorate([t.reflect.Field("vector2"),__metadata("design:type",t.math.Vector2)],a.prototype,"pivot",void 0),__decorate([t.reflect.Field("vector2"),__metadata("design:type",t.math.Vector2)],a.prototype,"localTranslate",void 0),__decorate([t.reflect.Field("vector2"),__metadata("design:type",t.math.Vector2)],a.prototype,"localScale",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],a.prototype,"localRotate",void 0),__decorate([t.reflect.Field("C2DComponent[]"),__metadata("design:type",Array)],a.prototype,"components",void 0),a=__decorate([t.reflect.SerializeType],a)}();e.Transform2D=a,__reflect(a.prototype,"egret3d.framework.Transform2D")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.None=0]="None",t[t.ColorTint=1]="ColorTint",t[t.SpriteSwap=2]="SpriteSwap"}(r=e.TransitionType||(e.TransitionType={}));var a=function(){function a(){this._transition=r.ColorTint,this._normalColor=new t.math.Color(1,1,1,1),this._pressedColor=new t.math.Color(.5,.5,.5,1),this._fadeDuration=.1,this.onClick=new e.UIEvent,this._downInThis=!1,this._dragOut=!1}return Object.defineProperty(a.prototype,"transition",{get:function(){return this._transition},set:function(t){this._transition=t,null!=this._targetImage&&(t==r.ColorTint?this._targetImage.color=this.normalColor:this._targetImage.color=this._originalColor)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"targetImage",{get:function(){return this._targetImage},set:function(t){null!=this._targetImage&&(this._targetImage.color=this._originalColor),null!=t?(this._originalColor=t.color,this._originalSprite=t.sprite,(this._transition=r.ColorTint)&&(t.color=this.normalColor)):(this._originalColor=null,this._originalSprite=null),this._targetImage=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pressedGraphic",{get:function(){return this._pressedSprite},set:function(t){this._pressedSprite=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"normalColor",{get:function(){return this._normalColor},set:function(t){this._normalColor=t,null!=this._targetImage&&this.transition==r.ColorTint&&(this._targetImage.color=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"pressedColor",{get:function(){return this._pressedColor},set:function(t){this._pressedColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"fadeDuration",{get:function(){return this._fadeDuration},set:function(t){this._fadeDuration=t},enumerable:!0,configurable:!0}),a.prototype.start=function(){},a.prototype.update=function(t){},a.prototype.remove=function(){},a.prototype.onPointEvent=function(r,a,i){if(0==i){var o=this.transform.ContainsCanvasPoint(new t.math.Vector2(a.x,a.y));o?a.type==e.PointEventEnum.PointDown?(this._downInThis=!0,this.showPress()):a.type==e.PointEventEnum.PointHold&&this._downInThis?1==this._dragOut&&(this._dragOut=!1,this.showPress()):a.type==e.PointEventEnum.PointUp&&this._downInThis&&(this._downInThis=!1,this.showNormal(),this.onClick.excute()):a.type==e.PointEventEnum.PointUp?this._downInThis=!1:a.type==e.PointEventEnum.PointHold&&this._downInThis&&0==this._dragOut&&(this._dragOut=!0,this.showNormal())}},a.prototype.showNormal=function(){this.transition==r.ColorTint?this.changeColor(this._normalColor):this.transition==r.SpriteSwap&&this.changeSprite(this._originalSprite)},a.prototype.showPress=function(){this.transition==r.ColorTint?this.changeColor(this._pressedColor):this.transition==r.SpriteSwap&&(null!=this._targetImage&&null!=this._targetImage.sprite&&null==this._originalSprite&&(this._originalSprite=this._targetImage.sprite),this.changeSprite(this._pressedSprite))},a.prototype.changeColor=function(t){null!=this._targetImage&&(this._targetImage.color=t,this._targetImage.transform.markDirty())},a.prototype.changeSprite=function(t){null!=t&&null!=this._targetImage&&(this._targetImage.sprite=t,this._targetImage.transform.markDirty())},__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],a.prototype,"transition",null),__decorate([t.reflect.Field("Color"),__metadata("design:type",Object),__metadata("design:paramtypes",[t.math.Color])],a.prototype,"normalColor",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],a.prototype,"fadeDuration",null),a=__decorate([t.reflect.node2DComponent],a)}();e.Button=a,__reflect(a.prototype,"egret3d.framework.Button",["egret3d.framework.I2DComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.Simple=0]="Simple",t[t.Sliced=1]="Sliced",t[t.Tiled=2]="Tiled",t[t.Filled=3]="Filled"}(r=e.ImageType||(e.ImageType={}));var a;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Radial_90=2]="Radial_90",t[t.Radial_180=3]="Radial_180",t[t.Radial_360=4]="Radial_360"}(a=e.FillMethod||(e.FillMethod={}));var i=function(){function i(){this.datar=[0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1],this.color=new t.math.Color(1,1,1,1),this._imageType=r.Simple,this._fillMethod=a.Horizontal,this._fillAmmount=1,t.io.EnumMgr.enumMap.ImageType=r,t.io.EnumMgr.enumMap.FillMethod=a}return Object.defineProperty(i.prototype,"imageType",{get:function(){return this._imageType},set:function(t){this._imageType=t,this.prepareData(),null!=this.transform&&this.transform.markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillMethod",{get:function(){return this._fillMethod},set:function(t){this._fillMethod=t,this.prepareData(),null!=this.transform&&this.transform.markDirty()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fillAmmount",{get:function(){return this._fillAmmount},set:function(t){this._fillAmmount=t,null!=this.transform&&this.transform.markDirty()},enumerable:!0,configurable:!0}),i.prototype.setTexture=function(r,a,i){var o=new e.Sprite;o.texture=r,null!=a?o.border=a:o.border=new t.math.Border(0,0,0,0),null!=i?o.rect=i:o.rect=new t.math.Rect(0,0,r.glTexture.width,r.glTexture.height),this.sprite=o},Object.defineProperty(i.prototype,"sprite",{get:function(){return this._sprite},set:function(t){this._sprite&&this._sprite.unuse(),this._sprite=t,this._sprite.use(),this.prepareData(),null!=this.transform&&this.transform.markDirty()},enumerable:!0,configurable:!0}),i.prototype.render=function(t){null==this.mat&&(this.mat=new e.Material,this.mat.setShader(e.DefaultShaders.UI));var r=null;null!=this._sprite&&null!=this._sprite.texture&&(r=this._sprite.texture),this.mat.setTexture("_MainTex",r),t.pushRawData(this.mat,this.datar)},i.prototype.start=function(){},i.prototype.update=function(t){},i.prototype.remove=function(){this._sprite.unuse(!0),this.datar.length=0},i.prototype.onPointEvent=function(t,e,r){},i.prototype.prepareData=function(){if(null!=this._sprite){var t=this._sprite.urange,e=this._sprite.vrange,i=t.y-t.x,o=e.y-e.x;switch(this._imageType){case r.Simple:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case r.Sliced:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case r.Tiled:this.datar=[];break;case r.Filled:var n=t.x+.5*i,s=e.x+.5*o;switch(this._fillMethod){case a.Horizontal:case a.Vertical:case a.Radial_90:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case a.Radial_180:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1];break;case a.Radial_360:this.datar=[0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.x,e.x,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.x,s,1,1,1,1,0,0,0,1,1,1,1,n,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.y,e.x,1,1,1,1,0,0,0,1,1,1,1,t.y,s,1,1,1,1,0,0,0,1,1,1,1,t.x,s,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,t.x,e.y,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.y,s,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,n,s,1,1,1,1,0,0,0,1,1,1,1,t.y,e.y,1,1,1,1,0,0,0,1,1,1,1,n,e.y,1,1,1,1]
}}}},i.prototype.updateTran=function(){var t=this.transform.getWorldMatrix(),e=-this.transform.pivot.x*this.transform.width,a=this.transform.width+e,i=-this.transform.pivot.y*this.transform.height,o=this.transform.height+i,n=e*t.rawData[0]+i*t.rawData[2]+t.rawData[4],s=e*t.rawData[1]+i*t.rawData[3]+t.rawData[5],h=a*t.rawData[0]+i*t.rawData[2]+t.rawData[4],l=a*t.rawData[1]+i*t.rawData[3]+t.rawData[5],c=e*t.rawData[0]+o*t.rawData[2]+t.rawData[4],u=e*t.rawData[1]+o*t.rawData[3]+t.rawData[5],d=a*t.rawData[0]+o*t.rawData[2]+t.rawData[4],p=a*t.rawData[1]+o*t.rawData[3]+t.rawData[5];if(null!=this._sprite){switch(this._imageType){case r.Simple:this.updateSimpleData(n,s,h,l,c,u,d,p);break;case r.Sliced:this.updateSlicedData(n,s,h,l,c,u,d,p);break;case r.Tiled:this.updateTiledData(n,s,h,l,c,u,d,p);break;case r.Filled:this.updateFilledData(n,s,h,l,c,u,d,p)}for(var m=this.datar.length/13,f=0;m>f;f++)this.datar[13*f+3]=this.color.r,this.datar[13*f+4]=this.color.g,this.datar[13*f+5]=this.color.b,this.datar[13*f+6]=this.color.a}},i.prototype.updateQuadData=function(t,e,r,a,i,o,n,s,h,l){void 0===h&&(h=0),void 0===l&&(l=!1);var c=6*h;l?(this.datar[13*(c+0)]=t,this.datar[13*(c+0)+1]=e,this.datar[13*(c+1)]=r,this.datar[13*(c+1)+1]=a,this.datar[13*(c+2)]=n,this.datar[13*(c+2)+1]=s,this.datar[13*(c+3)]=t,this.datar[13*(c+3)+1]=e,this.datar[13*(c+4)]=n,this.datar[13*(c+4)+1]=s,this.datar[13*(c+5)]=i,this.datar[13*(c+5)+1]=o):(this.datar[13*(c+0)]=t,this.datar[13*(c+0)+1]=e,this.datar[13*(c+1)]=r,this.datar[13*(c+1)+1]=a,this.datar[13*(c+2)]=i,this.datar[13*(c+2)+1]=o,this.datar[13*(c+3)]=i,this.datar[13*(c+3)+1]=o,this.datar[13*(c+4)]=r,this.datar[13*(c+4)+1]=a,this.datar[13*(c+5)]=n,this.datar[13*(c+5)+1]=s)},i.prototype.updateSimpleData=function(t,e,r,a,i,o,n,s){this.updateQuadData(t,e,r,a,i,o,n,s)},i.prototype.updateSlicedData=function(e,r,a,i,o,n,s,h){var l=this._sprite.border,c=this._sprite.rect,u=t.math.Pool.new_vector2(),d=t.math.Pool.new_vector2(),p=t.math.Pool.new_vector2(),m=t.math.Pool.new_vector2(),f=t.math.Pool.new_vector2(),v=t.math.Pool.new_vector2(),_=t.math.Pool.new_vector2(),g=t.math.Pool.new_vector2(),y=t.math.Pool.new_vector2(),w=t.math.Pool.new_vector2(),x=t.math.Pool.new_vector2(),b=t.math.Pool.new_vector2(),D=t.math.Pool.new_vector2(),T=t.math.Pool.new_vector2(),E=t.math.Pool.new_vector2(),P=t.math.Pool.new_vector2(),M=t.math.Pool.new_vector2(),S=t.math.Pool.new_vector2(),A=t.math.Pool.new_vector2(),C=t.math.Pool.new_vector2(),V=t.math.Pool.new_vector2(),R=t.math.Pool.new_vector2(),k=t.math.Pool.new_vector2(),F=t.math.Pool.new_vector2(),L=t.math.Pool.new_vector2(),I=t.math.Pool.new_vector2(),z=t.math.Pool.new_vector2(),U=t.math.Pool.new_vector2(),N=t.math.Pool.new_vector2(),O=t.math.Pool.new_vector2(),B=t.math.Pool.new_vector2(),W=t.math.Pool.new_vector2(),j=t.math.Pool.new_vector2(),G=t.math.Pool.new_vector2(),X=t.math.Pool.new_vector2();u.x=e,u.y=r,d.x=a,d.y=i,p.x=o,p.y=n,m.x=s,m.y=h;var H=(t.math.vec2Distance(u,d),t.math.vec2Distance(u,p),this._sprite.urange),q=this._sprite.vrange,Q=l.l/this.transform.width,Y=l.r/this.transform.width,K=l.t/this.transform.height,$=l.b/this.transform.height,Z=l.l/c.w*(H.y-H.x),J=l.r/c.w*(H.y-H.x),te=l.t/c.h*(q.y-q.x),ee=l.b/c.h*(q.y-q.x);t.math.vec2Subtract(d,u,f),t.math.vec2ScaleByNum(f,Q,f),t.math.vec2Add(f,u,f),t.math.vec2Subtract(u,d,v),t.math.vec2ScaleByNum(v,Y,v),t.math.vec2Add(v,d,v),t.math.vec2Subtract(p,u,_),t.math.vec2ScaleByNum(_,K,_),t.math.vec2Add(_,u,_),t.math.vec2Subtract(u,p,g),t.math.vec2ScaleByNum(g,$,g),t.math.vec2Add(g,p,g),t.math.vec2Subtract(f,u,j),t.math.vec2Subtract(_,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,y),t.math.vec2Subtract(v,u,j),t.math.vec2Subtract(_,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,w),t.math.vec2Subtract(d,u,j),t.math.vec2Subtract(_,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,x),t.math.vec2Subtract(f,u,j),t.math.vec2Subtract(g,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,b),t.math.vec2Subtract(v,u,j),t.math.vec2Subtract(g,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,D),t.math.vec2Subtract(d,u,j),t.math.vec2Subtract(g,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,T),t.math.vec2Subtract(f,u,j),t.math.vec2Subtract(p,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,E),t.math.vec2Subtract(v,u,j),t.math.vec2Subtract(p,u,G),t.math.vec2Add(j,G,X),t.math.vec2Add(X,u,P),M.x=H.x,M.y=q.x,V.x=Z+H.x,V.y=q.x,R.x=H.y-J,R.y=q.x,S.x=H.y,S.y=q.x,k.x=H.x,k.y=te+q.x,L.x=Z+H.x,L.y=te+q.x,I.x=H.y-J,I.y=te+q.x,z.x=H.y,z.y=te+q.x,F.x=H.x,F.y=q.y-ee,U.x=Z+H.x,U.y=q.y-ee,N.x=H.y-J,N.y=q.y-ee,O.x=H.y,O.y=q.y-ee,A.x=H.x,A.y=q.y,B.x=Z+H.x,B.y=q.y,W.x=H.y-J,W.y=q.y,C.x=H.y,C.y=q.y;for(var re,ae,ie=[u,f,v,d,_,y,w,x,g,b,D,T,p,E,P,m],oe=[M,V,R,S,k,L,I,z,F,U,N,O,A,B,W,C],ne=0;9>ne;ne++){var se=Math.floor(ne/3),he=ne%3;re=[ie[0+he+4*se],ie[1+he+4*se],ie[4+he+4*se],ie[5+he+4*se]],ae=[oe[0+he+4*se],oe[1+he+4*se],oe[4+he+4*se],oe[5+he+4*se]],this.updateQuadData(re[0].x,re[0].y,re[1].x,re[1].y,re[2].x,re[2].y,re[3].x,re[3].y,ne),this.datar[13*(0+6*ne)+7]=ae[0].x,this.datar[13*(0+6*ne)+8]=ae[0].y,this.datar[13*(1+6*ne)+7]=ae[1].x,this.datar[13*(1+6*ne)+8]=ae[1].y,this.datar[13*(2+6*ne)+7]=ae[2].x,this.datar[13*(2+6*ne)+8]=ae[2].y,this.datar[13*(3+6*ne)+7]=ae[2].x,this.datar[13*(3+6*ne)+8]=ae[2].y,this.datar[13*(4+6*ne)+7]=ae[1].x,this.datar[13*(4+6*ne)+8]=ae[1].y,this.datar[13*(5+6*ne)+7]=ae[3].x,this.datar[13*(5+6*ne)+8]=ae[3].y,re.length=0,ae.length=0}t.math.Pool.delete_vector2Array(ie),t.math.Pool.delete_vector2Array(oe),t.math.Pool.delete_vector2Array([j,G,X])},i.prototype.updateFilledData=function(t,e,r,i,o,n,s,h){var l=this._sprite.urange,c=this._sprite.vrange,u=l.y-l.x,d=c.y-c.x,p=l.x+.5*u,m=c.x+.5*d;switch(this._fillMethod){case a.Horizontal:case a.Vertical:case a.Radial_90:if(this._fillMethod==a.Horizontal)r-=(1-this.fillAmmount)*(r-t),i-=(1-this.fillAmmount)*(i-e),s-=(1-this.fillAmmount)*(s-o),h-=(1-this.fillAmmount)*(h-n),this.datar[20]=l.x+this.fillAmmount*u,this.datar[59]=l.x+this.fillAmmount*u,this.datar[72]=l.x+this.fillAmmount*u;else if(this._fillMethod==a.Vertical)t-=(1-this.fillAmmount)*(t-o),e-=(1-this.fillAmmount)*(e-n),r-=(1-this.fillAmmount)*(r-s),i-=(1-this.fillAmmount)*(i-h),this.datar[8]=c.y-this.fillAmmount*d,this.datar[21]=c.y-this.fillAmmount*d,this.datar[60]=c.y-this.fillAmmount*d;else if(this._fillMethod==a.Radial_90)if(this.fillAmmount>=.5){var f=2*(1-this.fillAmmount);t-=f*(t-r),e-=f*(e-i),this.datar[7]=l.x+f*u,this.datar[21]=c.x,this.datar[60]=c.x}else{var f=2*(.5-this.fillAmmount);r-=f*(r-s),i-=f*(i-h),t=r,e=i,this.datar[8]=c.x+f*d,this.datar[21]=c.x+f*d,this.datar[60]=c.x+f*d}this.updateQuadData(t,e,r,i,o,n,s,h);break;case a.Radial_180:var v=(t+r)/2,_=(e+i)/2,g=(o+s)/2,y=(n+h)/2;if(this.fillAmmount>=.75){var f=4*(1-this.fillAmmount);o-=f*(o-t),n-=f*(n-e),this.datar[73]=c.y-f*d,this.datar[7]=l.x,this.datar[46]=l.x,this.datar[85]=p,this.datar[99]=c.x,this.datar[138]=c.x}else if(this.fillAmmount>=.5){var f=4*(.75-this.fillAmmount);t-=f*(t-v),e-=f*(e-_),o=t,n=e,this.datar[7]=l.x+.5*u*f,this.datar[46]=l.x+.5*u*f,this.datar[85]=p,this.datar[99]=c.x,this.datar[138]=c.x}else if(this.fillAmmount>=.25){var f=4*(.5-this.fillAmmount);v-=f*(v-r),_-=f*(_-i),t=v,e=_,o=t,n=e,this.datar[85]=p+.5*u*f,this.datar[99]=c.x,this.datar[138]=c.x}else{var f=4*(.25-this.fillAmmount);r-=f*(r-s),i-=f*(i-h),v=r,_=i,t=v,e=_,o=t,n=e,this.datar[99]=c.x+f*d,this.datar[138]=c.x+f*d}this.updateQuadData(t,e,v,_,o,n,g,y,0,!0),this.updateQuadData(v,_,r,i,g,y,s,h,1);break;case a.Radial_360:var w=(t+r)/2,x=(e+i)/2,b=(t+o)/2,D=(e+n)/2,T=(o+s)/2,E=(n+h)/2,P=(r+s)/2,M=(i+h)/2,S=(b+P)/2,A=(D+M)/2,C=T,V=E;if(this.fillAmmount>=.875){var f=8*(1-this.fillAmmount);T-=f*(T-o),E-=f*(E-n),this.datar[228]=p-.5*f*u,this.datar[190]=c.y,this.datar[203]=c.y,this.datar[73]=m,this.datar[7]=l.x,this.datar[46]=l.x,this.datar[85]=p,this.datar[99]=c.x,this.datar[138]=c.x,this.datar[255]=m,this.datar[267]=l.y,this.datar[293]=l.y}else if(this.fillAmmount>=.75){var f=8*(.875-this.fillAmmount);o-=f*(o-b),n-=f*(n-D),T=o,E=n,this.datar[190]=c.y-.5*f*d,this.datar[203]=c.y-.5*f*d,this.datar[73]=m,this.datar[7]=l.x,this.datar[46]=l.x,this.datar[85]=p,this.datar[99]=c.x,this.datar[138]=c.x,this.datar[255]=m,this.datar[267]=l.y,this.datar[293]=l.y}else if(this.fillAmmount>=.625){var f=8*(.75-this.fillAmmount);b-=f*(b-t),D-=f*(D-e),o=b,n=D,T=o,E=n,this.datar[73]=m-.5*f*d,this.datar[7]=l.x,this.datar[46]=l.x,this.datar[85]=p,this.datar[99]=c.x,this.datar[138]=c.x,this.datar[255]=m,this.datar[267]=l.y,this.datar[293]=l.y}else if(this.fillAmmount>=.5){var f=8*(.625-this.fillAmmount);t-=f*(t-w),e-=f*(e-x),b=t,D=e,o=b,n=D,T=o,E=n,this.datar[7]=l.x+.5*f*u,this.datar[46]=l.x+.5*f*u,this.datar[85]=p,this.datar[99]=c.x,this.datar[138]=c.x,this.datar[255]=m,this.datar[267]=l.y,this.datar[293]=l.y}else if(this.fillAmmount>=.375){var f=8*(.5-this.fillAmmount);w-=f*(w-r),x-=f*(x-i),t=w,e=x,b=t,D=e,o=b,n=D,T=o,E=n,this.datar[85]=p+.5*f*u,this.datar[99]=c.x,this.datar[138]=c.x,this.datar[255]=m,this.datar[267]=l.y,this.datar[293]=l.y}else if(this.fillAmmount>=.25){var f=8*(.375-this.fillAmmount);r-=f*(r-P),i-=f*(i-M),w=r,x=i,t=w,e=x,b=t,D=e,o=b,n=D,T=o,E=n,this.datar[99]=c.x+.5*f*d,this.datar[138]=c.x+.5*f*d,this.datar[255]=m,this.datar[267]=l.y,this.datar[293]=l.y}else if(this.fillAmmount>=.125){var f=8*(.25-this.fillAmmount);P-=f*(P-s),M-=f*(M-h),r=P,i=M,w=r,x=i,t=w,e=x,b=t,D=e,o=b,n=D,T=o,E=n,this.datar[255]=m+.5*f*d,this.datar[267]=l.y,this.datar[293]=l.y}else{var f=8*(.125-this.fillAmmount);s-=f*(s-T),h-=f*(h-E),P=s,M=h,r=P,i=M,w=r,x=i,t=w,e=x,b=t,D=e,o=b,n=D,T=o,E=n,this.datar[267]=l.y-.5*f*u,this.datar[293]=l.y-.5*f*u}this.updateQuadData(t,e,w,x,b,D,S,A,0,!0),this.updateQuadData(w,x,r,i,S,A,P,M,1),this.updateQuadData(b,D,S,A,o,n,T,E,2),this.updateQuadData(S,A,P,M,C,V,s,h,3,!0)}},i.prototype.updateTiledData=function(t,e,r,a,i,o,n,s){for(var h=this._sprite.rect,l=(this._sprite.border,this._sprite.urange),c=this._sprite.vrange,u=l.y-l.x,d=c.y-c.x,p=r-t,m=o-e,f=this.transform.width/h.w,v=this.transform.height/h.h,_=1/f,g=1/v,y=0,w=0;v-1>w;w++)for(var x=0;f-1>x;x++){var b=[0,0,0,1,1,1,1,l.x,c.x,1,1,1,1,0,0,0,1,1,1,1,l.y,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x,c.y,1,1,1,1,0,0,0,1,1,1,1,l.x,c.y,1,1,1,1,0,0,0,1,1,1,1,l.y,c.x,1,1,1,1,0,0,0,1,1,1,1,l.y,c.y,1,1,1,1];this.datar=this.datar.concat(b);var D=t+_*p*x,T=e+g*m*w,E=t+_*p*(x+1),P=e+g*m*w,M=t+_*p*x,S=e+g*m*(w+1),A=t+_*p*(x+1),C=e+g*m*(w+1);this.updateQuadData(D,T,E,P,M,S,A,C,y),y++}for(var V=Math.ceil(v)-1,R=v-Math.ceil(v)+1,x=0;f-1>x;x++){var k=[0,0,0,1,1,1,1,l.x,c.x,1,1,1,1,0,0,0,1,1,1,1,l.y,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x,c.x+R*d,1,1,1,1,0,0,0,1,1,1,1,l.x,c.x+R*d,1,1,1,1,0,0,0,1,1,1,1,l.y,c.x,1,1,1,1,0,0,0,1,1,1,1,l.y,c.x+R*d,1,1,1,1];this.datar=this.datar.concat(k);var F=t+_*p*x,L=e+g*m*V,I=t+_*p*(x+1),z=e+g*m*V,U=t+_*p*x,N=e+g*m*(V+R),O=t+_*p*(x+1),B=e+g*m*(V+R);this.updateQuadData(F,L,I,z,U,N,O,B,y),y++}for(var W=Math.ceil(f)-1,j=f-Math.ceil(f)+1,w=0;v-1>w;w++){var G=[0,0,0,1,1,1,1,l.x,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x+j*u,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x,c.y,1,1,1,1,0,0,0,1,1,1,1,l.x,c.y,1,1,1,1,0,0,0,1,1,1,1,l.x+j*u,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x+j*u,c.y,1,1,1,1];this.datar=this.datar.concat(G);var X=t+_*p*W,H=e+g*m*w,q=t+_*p*(W+j),Q=e+g*m*w,Y=t+_*p*W,K=e+g*m*(w+1),$=t+_*p*(W+j),Z=e+g*m*(w+1);this.updateQuadData(X,H,q,Q,Y,K,$,Z,y),y++}var J=[0,0,0,1,1,1,1,l.x,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x+j*u,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x,c.x+R*d,1,1,1,1,0,0,0,1,1,1,1,l.x,c.x+R*d,1,1,1,1,0,0,0,1,1,1,1,l.x+j*u,c.x,1,1,1,1,0,0,0,1,1,1,1,l.x+j*u,c.x+R*d,1,1,1,1];this.datar=this.datar.concat(J);var te=t+_*p*W,ee=e+g*m*V,re=t+_*p*(W+j),ae=e+g*m*V,ie=t+_*p*W,oe=e+g*m*(V+R),ne=t+_*p*(W+j),se=e+g*m*(V+R);this.updateQuadData(te,ee,re,ae,ie,oe,ne,se,y),y++},__decorate([t.reflect.Field("Color"),t.reflect.UIStyle("vector4"),__metadata("design:type",t.math.Color)],i.prototype,"color",void 0),__decorate([t.reflect.Field("number"),t.reflect.UIStyle("ImageType"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],i.prototype,"imageType",null),__decorate([t.reflect.Field("number"),t.reflect.UIStyle("FillMethod"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],i.prototype,"fillMethod",null),i=__decorate([t.reflect.node2DComponent,t.reflect.nodeRender,__metadata("design:paramtypes",[])],i)}();e.Image2D=i,__reflect(i.prototype,"egret3d.framework.Image2D",["egret3d.framework.IRectRenderer","egret3d.framework.I2DComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.Center=0]="Center",t[t.Left=1]="Left",t[t.Right=2]="Right"}(r=e.HorizontalType||(e.HorizontalType={}));var a;!function(t){t[t.Center=0]="Center",t[t.Top=1]="Top",t[t.Boom=2]="Boom"}(a=e.VerticalType||(e.VerticalType={}));var i=function(){function i(){this._fontsize=14,this.linespace=1,this.horizontalType=r.Center,this.verticalType=a.Center,this.indexarr=[],this.remainarrx=[],this.data_begin=new t.math.Vector2(0,0),this.datar=[],this.color=new t.math.Color(1,1,1,1),this.color2=new t.math.Color(0,0,.5,.5),this.dirtyData=!0}return Object.defineProperty(i.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t;var e=78*this._text.length;for(this.datar.splice(0,this.datar.length);this.datar.length<e;)this.datar.push(0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1);for(;this.datar.length<e;)this.datar.pop();this.dirtyData=!0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"font",{get:function(){return this._font},set:function(t){this._font&&this._font.unuse(),this._font=t,this._font.use()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"fontsize",{get:function(){return this._fontsize},set:function(t){this._fontsize=t},enumerable:!0,configurable:!0}),i.prototype.updateData=function(t){this.dirtyData=!1;var e=this._fontsize/t.lineHeight,i=this.transform.getWorldMatrix(),o=i.rawData[0],n=i.rawData[2],s=i.rawData[1],h=i.rawData[3],l=this.data_begin.x,c=this.data_begin.y,u=0,d=0;this.indexarr=[],this.remainarrx=[];for(var p=0,m=0;m<this._text.length;m++){var f=this._text.charAt(m),v=t.cmap[f];if(void 0!=v){if(u+v.xAddvance*e>this.transform.width){if(d+this._fontsize*this.linespace>this.transform.height)break;this.indexarr.push(m),this.remainarrx.push(this.transform.width-u),u=0,d+=this._fontsize*this.linespace}u+=v.xAddvance*e}}this.indexarr.push(m),this.remainarrx.push(this.transform.width-u),p=this.transform.height-d;var m=0,_=0,g=0;this.verticalType==a.Center?g+=p/2:this.verticalType==a.Boom&&(g+=p);for(var y=0;y<this.indexarr.length;y++){for(_=0,this.horizontalType==r.Center?_+=this.remainarrx[y]/2:(this.horizontalType=r.Right)&&(_+=this.remainarrx[y]);m<this.indexarr[y];m++){var f=this._text.charAt(m),v=t.cmap[f];if(void 0!=v){var w=_+v.xOffset*e,x=g-v.yOffset*e+t.baseline*e,b=e*v.ySize,D=e*v.xSize;_+=v.xAddvance*e;var T=w+D,E=x,P=w,M=x+b,S=w+D,A=x+b;this.datar[6*m*13+0]=l+w*o+x*n,this.datar[6*m*13+1]=c+w*s+x*h,this.datar[6*m*13+13+0]=l+T*o+E*n,this.datar[6*m*13+13+1]=c+T*s+E*h,this.datar[6*m*13+26+0]=l+P*o+M*n,this.datar[6*m*13+26+1]=c+P*s+M*h,this.datar[6*m*13+39+0]=l+P*o+M*n,this.datar[6*m*13+39+1]=c+P*s+M*h,this.datar[6*m*13+52+0]=l+T*o+E*n,this.datar[6*m*13+52+1]=c+T*s+E*h,this.datar[6*m*13+65+0]=l+S*o+A*n,this.datar[6*m*13+65+1]=c+S*s+A*h;var C=v.x,V=v.y,R=v.x+v.w,k=v.y,F=v.x,L=v.y+v.h,I=v.x+v.w,z=v.y+v.h;this.datar[6*m*13+7]=C,this.datar[6*m*13+8]=V,this.datar[6*m*13+13+7]=R,this.datar[6*m*13+13+8]=k,this.datar[6*m*13+26+7]=F,this.datar[6*m*13+26+8]=L,this.datar[6*m*13+39+7]=F,this.datar[6*m*13+39+8]=L,this.datar[6*m*13+52+7]=R,this.datar[6*m*13+52+8]=k,this.datar[6*m*13+65+7]=I,this.datar[6*m*13+65+8]=z;for(var U=0;6>U;U++)this.datar[6*m*13+13*U+3]=this.color.r,this.datar[6*m*13+13*U+4]=this.color.g,this.datar[6*m*13+13*U+5]=this.color.b,this.datar[6*m*13+13*U+6]=this.color.a,this.datar[6*m*13+13*U+9]=this.color2.r,this.datar[6*m*13+13*U+10]=this.color2.g,this.datar[6*m*13+13*U+11]=this.color2.b,this.datar[6*m*13+13*U+12]=this.color2.a}}g+=this._fontsize*this.linespace}},i.prototype.render=function(t){if(null!=this._font){(this.dirtyData=!0)&&(this.updateData(this._font),this.dirtyData=!1),null==this.mat&&(this.mat=new e.Material,this.mat.setShader(e.DefaultShaders.UIFont));var r;if(null!=this._font&&(r=this._font.texture),null==r){this.transform.canvas.scene;r=e.DefaultTextures.Grid}this.mat.setTexture("_MainTex",r),0!=this.datar.length&&t.pushRawData(this.mat,this.datar)}},i.prototype.updateTran=function(){var t=this.transform.getWorldMatrix(),e=-this.transform.pivot.x*this.transform.width,r=-this.transform.pivot.y*this.transform.height;this.data_begin.x=e*t.rawData[0]+r*t.rawData[2]+t.rawData[4],this.data_begin.y=e*t.rawData[1]+r*t.rawData[3]+t.rawData[5]},i.prototype.start=function(){},i.prototype.update=function(t){},i.prototype.remove=function(){this._font.unuse(!0),this.indexarr.length=0,this.remainarrx.length=0,this.datar.length=0},i.prototype.onPointEvent=function(t,e,r){},__decorate([t.reflect.Field("string"),__metadata("design:type",String),__metadata("design:paramtypes",[String])],i.prototype,"text",null),__decorate([t.reflect.Field("Font"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.Font])],i.prototype,"font",null),__decorate([t.reflect.Field("number"),__metadata("design:type",Object),__metadata("design:paramtypes",[Number])],i.prototype,"fontsize",null),i=__decorate([t.reflect.node2DComponent,t.reflect.nodeRender],i)}();e.Label=i,__reflect(i.prototype,"egret3d.framework.Label",["egret3d.framework.IRectRenderer","egret3d.framework.I2DComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.datar=[0,0,0,1,1,1,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1],this.color=new t.math.Color(1,1,1,1)}return Object.defineProperty(r.prototype,"image",{get:function(){return this._image},set:function(t){this._image&&this._image.unuse(),this._image=t,this._image.use()},enumerable:!0,configurable:!0}),r.prototype.render=function(t){null==this.mat&&(this.mat=new e.Material,this.mat.setShader(e.DefaultShaders.UI));var r=this.image;null!=r&&(this.mat.setTexture("_MainTex",r),t.pushRawData(this.mat,this.datar))},r.prototype.updateTran=function(){var t=this.transform.getWorldMatrix(),e=-this.transform.pivot.x*this.transform.width,r=this.transform.width+e,a=-this.transform.pivot.y*this.transform.height,i=this.transform.height+a,o=e*t.rawData[0]+a*t.rawData[2]+t.rawData[4],n=e*t.rawData[1]+a*t.rawData[3]+t.rawData[5],s=r*t.rawData[0]+a*t.rawData[2]+t.rawData[4],h=r*t.rawData[1]+a*t.rawData[3]+t.rawData[5],l=e*t.rawData[0]+i*t.rawData[2]+t.rawData[4],c=e*t.rawData[1]+i*t.rawData[3]+t.rawData[5],u=r*t.rawData[0]+i*t.rawData[2]+t.rawData[4],d=r*t.rawData[1]+i*t.rawData[3]+t.rawData[5];this.datar[0]=o,this.datar[1]=n,this.datar[13]=s,this.datar[14]=h,this.datar[26]=l,this.datar[27]=c,this.datar[39]=l,this.datar[40]=c,this.datar[52]=s,this.datar[53]=h,this.datar[65]=u,this.datar[66]=d;for(var p=0;6>p;p++)this.datar[13*p+3]=this.color.r,this.datar[13*p+4]=this.color.g,this.datar[13*p+5]=this.color.b,this.datar[13*p+6]=this.color.a},r.prototype.start=function(){},r.prototype.update=function(t){},r.prototype.remove=function(){this._image.unuse(!0)},r.prototype.onPointEvent=function(t,e,r){},__decorate([t.reflect.Field("Texture"),__metadata("design:type",e.Texture)],r.prototype,"_image",void 0),__decorate([t.reflect.Field("Color"),t.reflect.UIStyle("vector4"),__metadata("design:type",t.math.Color)],r.prototype,"color",void 0),__decorate([t.reflect.Field("Material"),t.reflect.UIStyle("Material"),__metadata("design:type",e.Material)],r.prototype,"mat",void 0),r=__decorate([t.reflect.node2DComponent,t.reflect.nodeRender],r)}();e.RawImage2D=r,__reflect(r.prototype,"egret3d.framework.RawImage2D",["egret3d.framework.IRectRenderer","egret3d.framework.I2DComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function t(){this.$dirty=!0,this._scaleFactor=1}return Object.defineProperty(t.prototype,"scaleFactor",{set:function(t){this._scaleFactor=t,this.$dirty=!0},enumerable:!0,configurable:!0}),t.prototype.calculateScaler=function(t,e,r){var a=this._scaleFactor;r.s=a,r.w=t/a,r.h=e/a},t}();e.ConstantAdapter=r,__reflect(r.prototype,"egret3d.framework.ConstantAdapter",["egret3d.framework.IScreenAdapter"]);var a=function(){function e(){this.$dirty=!0,this._resolution=new t.math.Vector2(640,1136)}return e.prototype.setResolution=function(t,e){this._resolution.x=t,this._resolution.y=e,this.$dirty=!0},e.prototype.calculateScaler=function(t,e,r){var a=t/e,i=this._resolution.x/this._resolution.y,o=1;o=a>i?e/this._resolution.y:t/this._resolution.x,r.s=o,r.w=t/o,r.h=e/o},e}();e.ExpandAdapter=a,__reflect(a.prototype,"egret3d.framework.ExpandAdapter",["egret3d.framework.IScreenAdapter"]);var i=function(){function e(){this.$dirty=!0,this._resolution=new t.math.Vector2(640,1136)}return e.prototype.setResolution=function(t,e){this._resolution.x=t,this._resolution.y=e,this.$dirty=!0},e.prototype.calculateScaler=function(t,e,r){var a=t/e,i=this._resolution.x/this._resolution.y,o=1;o=a>i?t/this._resolution.x:e/this._resolution.y,r.s=o,r.w=t/o,r.h=e/o},e}();e.ShrinkAdapter=i,__reflect(i.prototype,"egret3d.framework.ShrinkAdapter",["egret3d.framework.IScreenAdapter"]);var o=function(){function e(){this.$dirty=!0,this._resolution=new t.math.Vector2(640,1136),this._matchFactor=0}return e.prototype.setResolution=function(t,e){this._resolution.x=t,this._resolution.y=e,this.$dirty=!0},Object.defineProperty(e.prototype,"matchFactor",{set:function(t){this._matchFactor=t,this.$dirty=!0},enumerable:!0,configurable:!0}),e.prototype.calculateScaler=function(t,e,r){var a=t/this._resolution.x,i=e/this._resolution.y,o=a+(i-a)*this._matchFactor;r.s=o,r.w=t/o,r.h=e/o},e}();e.MatchWidthOrHeightAdapter=o,__reflect(o.prototype,"egret3d.framework.MatchWidthOrHeightAdapter",["egret3d.framework.IScreenAdapter"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.register=function(t){var e=t.getGUID(),r=t.getName();this._map[e]=t,this._nameMap[r]||(this._nameMap[r]=[]),this._nameMap[r].push(e)},t.unregister=function(t){delete this._map[t.getGUID()];var e=t.getName();if(this._nameMap[e].length<=1)delete this._nameMap[e];else for(var r in this._nameMap[e])t.getGUID()==this._nameMap[e][r]&&this._nameMap[e].splice(parseInt(r),1)},t.find=function(t,e){var r=this._nameMap[t][0];if(e){var a=this._bundleName[e];a&&(r=a.mapNamed[t])}return this._map[r]},t.findById=function(t){return this._map[t]},t.registerBundle=function(t,e){this._bundleName[t]=e},t.unregisterBundle=function(t){delete this._bundleName[t]},t.findBundle=function(t){return this._bundleName[t]},t._map={},t._nameMap={},t._bundleName={},t}();t.AssetMap=e,__reflect(e.prototype,"egret3d.framework.AssetMap")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){}return Object.defineProperty(r,"isInit",{get:function(){return this._inited},enumerable:!0,configurable:!0}),r.init=function(r){this.Cube=this.createDefaultMesh("cube",t.render.MeshData.genBoxCCW(1),r),this.Quad=this.createDefaultMesh("circleline",t.render.MeshData.genQuad(1),r),this.QuadParticle=this.createDefaultMesh("quad_particle",t.render.MeshData.genQuad_forparticle(1),r),this.Plane=this.createDefaultMesh("plane",t.render.MeshData.genPlaneCCW(10),r),this.Sphere=this.createDefaultMesh("sphere",t.render.MeshData.genSphereCCW(),r),this.Pyramid=this.createDefaultMesh("pyramid",t.render.MeshData.genPyramid(2,.5),r),this.Cylinder=this.createDefaultMesh("cylinder",t.render.MeshData.genCylinderCCW(2,.5),r),this.CircleLine=this.createDefaultMesh("circleline",t.render.MeshData.genCircleLineCCW(1),r),e.AssetMap.register(this.Cube),e.AssetMap.register(this.Quad),e.AssetMap.register(this.QuadParticle),e.AssetMap.register(this.Plane),e.AssetMap.register(this.Sphere),e.AssetMap.register(this.Pyramid),e.AssetMap.register(this.Cylinder),e.AssetMap.register(this.CircleLine),this._inited=!0},r.createDefaultMesh=function(r,a,i){var o=new e.Mesh(r+".mesh.bin");o.defaultAsset=!0,o.data=a;var n=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal|t.render.VertexFormatMask.Tangent|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,s=o.data.genVertexDataArray(n),h=o.data.genIndexDataArray();o.glMesh=new t.render.GlMesh,o.glMesh.initBuffer(i,n,o.data.pos.length),o.glMesh.uploadVertexSubData(i,s),o.glMesh.addIndex(i,h.length),o.glMesh.uploadIndexSubData(i,0,h),o.submesh=[];var l=new e.SubMeshInfo;return l.matIndex=0,l.useVertexIndex=0,l.start=0,l.size=h.length,l.line=!1,o.submesh.push(l),o},r._inited=!1,r}();e.DefaultMeshes=r,__reflect(r.prototype,"egret3d.framework.DefaultMeshes")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){}return Object.defineProperty(r,"isInit",{get:function(){return this._inited},enumerable:!0,configurable:!0}),r.init=function(r){var a=e.Shader.registerVertShader("def_code",e.ShaderLib.code_vert),i=(e.Shader.registerFragShader("def_code",e.ShaderLib.code_frag),e.Shader.registerFragShader("def_code2",e.ShaderLib.code2_frag),e.Shader.registerFragShader("def_ui",e.ShaderLib.ui_frag)),o=e.Shader.registerVertShader("def_uifont",e.ShaderLib.uifont_vert),n=e.Shader.registerFragShader("def_uifont",e.ShaderLib.uifont_frag),s=e.Shader.registerVertShader("def_diffuse",e.ShaderLib.diffuse_vert),h=e.Shader.registerFragShader("def_diffuse",e.ShaderLib.diffuse_frag),l=e.Shader.registerVertShader("def_boneeff",e.ShaderLib.boneeff_vert),c=e.Shader.registerVertShader("def_diffuselightmap",e.ShaderLib.diffuselightmap_vert),u=e.Shader.registerFragShader("def_diffuselightmap",e.ShaderLib.diffuselightmap_frag),d=e.Shader.registerVertShader("def_postquad",e.ShaderLib.postquad_vert),p=e.Shader.registerFragShader("def_postquaddepth",e.ShaderLib.postquaddepth_frag),m=e.Shader.registerVertShader("def_postdepth",e.ShaderLib.postdepth_vert),f=e.Shader.registerFragShader("def_postdepth",e.ShaderLib.postdepth_frag),v=e.Shader.registerVertShader("def_line",e.ShaderLib.line_vert),_=e.Shader.registerFragShader("def_line",e.ShaderLib.line_frag),g=e.Shader.registerVertShader("def_materialcolor",e.ShaderLib.materialcolor_vert),y=e.Shader.registerFragShader("def_diffusetintcolor",e.ShaderLib.tintcolor_frag),w=e.Shader.registerVertShader("def_diffusevertcolor",e.ShaderLib.vertcolor_vert),x=e.Shader.registerFragShader("def_diffusevertcolor",e.ShaderLib.vertcolor_frag),b=e.Shader.registerVertShader("def_lambert",e.ShaderLib.lambert_vert),D=e.Shader.registerFragShader("def_lambert",e.ShaderLib.lambert_frag),T=e.Shader.registerVertShader("def_lambertnormal",e.ShaderLib.lambertnormal_vert),E=e.Shader.registerFragShader("def_lambertnormal",e.ShaderLib.lambertnormal_frag),P=new e.Shader("shader/lambert");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[];var M=new t.render.GlDrawPass(b,D);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Close),this.Lambert=P,e.AssetMap.register(P);var P=new e.Shader("shader/lambertnormal");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[];var M=new t.render.GlDrawPass(T,E);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Close),this.LambertNormal=P,e.AssetMap.register(P);var P=new e.Shader("shader/def");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[],P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var M=new t.render.GlDrawPass(s,h);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Close),e.AssetMap.register(P);var P=new e.Shader("transparent.shader.json");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[],P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var M=new t.render.GlDrawPass(s,h);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Blend),this.Transparent=P,e.AssetMap.register(P);var P=new e.Shader("transparent_additive.shader.json");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[],P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var M=new t.render.GlDrawPass(s,h);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Add),this.TransparentAdditive=P,e.AssetMap.register(P);var P=new e.Shader("transparent_bothside.shader.json");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[],P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var M=new t.render.GlDrawPass(s,h);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.ALL,M.setAlphaBlend(t.render.BlendModeEnum.Blend),this.TransparentBothSide=P,e.AssetMap.register(P);var P=new e.Shader("diffuse.shader.json");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var M=new t.render.GlDrawPass(s,h);P.passes.base=[],P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Close);var S=new t.render.GlDrawPass(l,h);P.passes.skin=[],P.passes.skin.push(S),S.state_ztest=!0,S.state_ztest_method=t.render.Webglkit.LEQUAL,S.state_zwrite=!0,S.state_showface=t.render.ShowFaceStateEnum.CCW,S.setAlphaBlend(t.render.BlendModeEnum.Close);var A=new t.render.GlDrawPass(c,u);P.passes.lightmap=[],P.passes.lightmap.push(A),A.state_ztest=!0,A.state_ztest_method=t.render.Webglkit.LEQUAL,A.state_zwrite=!0,A.state_showface=t.render.ShowFaceStateEnum.CCW,A.setAlphaBlend(t.render.BlendModeEnum.Close);var C=new t.render.GlDrawPass(d,p);P.passes.quad=[],P.passes.quad.push(C),C.state_ztest=!0,C.state_ztest_method=t.render.Webglkit.LEQUAL,C.state_zwrite=!0,C.state_showface=t.render.ShowFaceStateEnum.CCW,C.setAlphaBlend(t.render.BlendModeEnum.Close);var V=new t.render.GlDrawPass(m,f);P.passes.base_depth=[],P.passes.base_depth.push(V),V.state_ztest=!0,V.state_ztest_method=t.render.Webglkit.LEQUAL,V.state_zwrite=!0,V.state_showface=t.render.ShowFaceStateEnum.CCW,V.setAlphaBlend(t.render.BlendModeEnum.Close),this.Diffuse=P,e.AssetMap.register(P);
var P=new e.Shader("shader/diffuse_tintcolor");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[],P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1},P.defaultValue._TintColor={type:"Color",value:new t.math.Color(1,1,1,1)};var M=new t.render.GlDrawPass(s,y);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Close),this.DiffuseTintColor=P,e.AssetMap.register(P);var P=new e.Shader("shader/diffuse_vertcolor");P.defaultAsset=!0,P.layer=e.RenderLayerEnum.Common,P.passes.base=[],P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var M=new t.render.GlDrawPass(w,x);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.CCW,M.setAlphaBlend(t.render.BlendModeEnum.Close),this.DiffuseVertColor=P,e.AssetMap.register(P);var P=new e.Shader("diffuse_bothside.shader.json");P.layer=e.RenderLayerEnum.Common,P.defaultAsset=!0,P.defaultValue._MainTex={type:"Texture",defaultValue:e.AssetMap.find("grid")},P.defaultValue._MainTex_ST={type:"Texture",value:new t.math.Vector4(1,1,0,0)},P.defaultValue._AlphaCut={type:"Range",value:.1,min:0,max:1};var M=new t.render.GlDrawPass(s,h);P.passes.base=[],P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.ALL,M.setAlphaBlend(t.render.BlendModeEnum.Close);var S=new t.render.GlDrawPass(l,h);P.passes.skin=[],P.passes.skin.push(S),S.state_ztest=!0,S.state_ztest_method=t.render.Webglkit.LEQUAL,S.state_zwrite=!0,S.state_showface=t.render.ShowFaceStateEnum.CCW,S.setAlphaBlend(t.render.BlendModeEnum.Close);var A=new t.render.GlDrawPass(c,u);P.passes.lightmap=[],P.passes.lightmap.push(A),A.state_ztest=!0,A.state_ztest_method=t.render.Webglkit.LEQUAL,A.state_zwrite=!0,A.state_showface=t.render.ShowFaceStateEnum.CCW,A.setAlphaBlend(t.render.BlendModeEnum.Close);var C=new t.render.GlDrawPass(d,p);P.passes.quad=[],P.passes.quad.push(C),C.state_ztest=!0,C.state_ztest_method=t.render.Webglkit.LEQUAL,C.state_zwrite=!0,C.state_showface=t.render.ShowFaceStateEnum.CCW,C.setAlphaBlend(t.render.BlendModeEnum.Close);var V=new t.render.GlDrawPass(m,f);P.passes.base_depth=[],P.passes.base_depth.push(V),V.state_ztest=!0,V.state_ztest_method=t.render.Webglkit.LEQUAL,V.state_zwrite=!0,V.state_showface=t.render.ShowFaceStateEnum.CCW,V.setAlphaBlend(t.render.BlendModeEnum.Close),this.DiffuseBothSide=P,e.AssetMap.register(P);var P=new e.Shader("shader/defui");P.defaultAsset=!0,P.passes.base=[];var M=new t.render.GlDrawPass(a,i);P.passes.base.push(M),M.state_showface=t.render.ShowFaceStateEnum.CW,M.state_ztest=!1,M.state_zwrite=!1,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply);var S=new t.render.GlDrawPass(a,i);P.passes.base.push(S),S.state_showface=t.render.ShowFaceStateEnum.ALL,S.state_ztest=!0,S.state_zwrite=!1,S.state_ztest_method=t.render.Webglkit.LEQUAL,S.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply),this.UI=P,e.AssetMap.register(P);var P=new e.Shader("shader/defuifont");P.defaultAsset=!0,P.passes.base=[];var M=new t.render.GlDrawPass(o,n);P.passes.base.push(M),M.state_showface=t.render.ShowFaceStateEnum.CW,M.state_ztest=!1,M.state_zwrite=!1,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply);var S=new t.render.GlDrawPass(o,n);P.passes.base.push(S),S.state_showface=t.render.ShowFaceStateEnum.ALL,S.state_ztest=!0,S.state_zwrite=!1,S.state_ztest_method=t.render.Webglkit.LEQUAL,S.setAlphaBlend(t.render.BlendModeEnum.Blend_PreMultiply),this.UIFont=P,e.AssetMap.register(P);var P=new e.Shader("line.shader.json");P.layer=e.RenderLayerEnum.Common,P.defaultAsset=!0,P.passes.base=[];var M=new t.render.GlDrawPass(v,_);P.passes.base.push(M),M.state_ztest=!0,M.state_ztest_method=t.render.Webglkit.LEQUAL,M.state_zwrite=!0,M.state_showface=t.render.ShowFaceStateEnum.ALL,M.setAlphaBlend(t.render.BlendModeEnum.Close),this.Line=P,e.AssetMap.register(P);var P=new e.Shader("materialcolor.shader.json");P.layer=e.RenderLayerEnum.Common,P.defaultAsset=!0,P.passes.base=[];var M=new t.render.GlDrawPass(g,_);P.passes.base.push(M),M.state_ztest=!1,M.state_showface=t.render.ShowFaceStateEnum.ALL,M.setAlphaBlend(t.render.BlendModeEnum.Close),P.layer=e.RenderLayerEnum.Overlay,this.MaterialColor=P,e.AssetMap.register(P),this._inited=!0},r._inited=!1,r}();e.DefaultShaders=r,__reflect(r.prototype,"egret3d.framework.DefaultShaders")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){}return Object.defineProperty(r,"isInit",{get:function(){return this._inited},enumerable:!0,configurable:!0}),r.init=function(r){var a=new e.Texture("white");a.glTexture=t.render.GlTexture2D.staticTexture(r,"white"),a.defaultAsset=!0,this.White=a;var i=new e.Texture("gray");i.glTexture=t.render.GlTexture2D.staticTexture(r,"gray"),i.defaultAsset=!0,this.Gray=i;var o=new e.Texture("grid");o.glTexture=t.render.GlTexture2D.staticTexture(r,"grid"),o.defaultAsset=!0,this.Grid=o,e.AssetMap.register(this.White),e.AssetMap.register(this.Gray),e.AssetMap.register(this.Grid),this._inited=!0},r._inited=!1,r}();e.DefaultTextures=r,__reflect(r.prototype,"egret3d.framework.DefaultTextures")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e;!function(t){t.bone_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesBlendIndex4;\nattribute vec4 _glesBlendWeight4;\nattribute vec4 _glesMultiTexCoord0;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp mat4 glstate_matrix_bones[24];\nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;\nvoid main()                                     \n{                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = _glesVertex.xyz;  \n	\n    int i = int(_glesBlendIndex4.x);  \n    int i2 =int(_glesBlendIndex4.y);\n	int i3 =int(_glesBlendIndex4.z);\n	int i4 =int(_glesBlendIndex4.w);\n	\n    mat4 mat = glstate_matrix_bones[i]*_glesBlendWeight4.x \n			 + glstate_matrix_bones[i2]*_glesBlendWeight4.y \n			 + glstate_matrix_bones[i3]*_glesBlendWeight4.z \n			 + glstate_matrix_bones[i4]*_glesBlendWeight4.w;\n			 \n    gl_Position = (glstate_matrix_mvp * mat)* tmpvar_1;\n	xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;\n}",t.boneeff_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesBlendIndex4;\nattribute vec4 _glesBlendWeight4;\nattribute vec4 _glesMultiTexCoord0;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp vec4 glstate_vec4_bones[110];\nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;\nmat4 buildMat4(int index)\n{\n	vec4 quat = glstate_vec4_bones[index * 2 + 0];\n	vec4 translation = glstate_vec4_bones[index * 2 + 1];\n	float xy2 = 2.0 * quat.x * quat.y;\n	float xz2 = 2.0 * quat.x * quat.z;\n	float xw2 = 2.0 * quat.x * quat.w;\n	float yz2 = 2.0 * quat.y * quat.z;\n	float yw2 = 2.0 * quat.y * quat.w;\n	float zw2 = 2.0 * quat.z * quat.w;\n	float xx = quat.x * quat.x;\n	float yy = quat.y * quat.y;\n	float zz = quat.z * quat.z;\n	float ww = quat.w * quat.w;\n	mat4 matrix = mat4(\n	xx - yy - zz + ww, xy2 + zw2, xz2 - yw2, 0,\n	xy2 - zw2, -xx + yy - zz + ww, yz2 + xw2, 0,\n	xz2 + yw2, yz2 - xw2, -xx - yy + zz + ww, 0,\n	translation.x, translation.y, translation.z, 1);\n	return matrix;\n}\nhighp vec4 calcVertex(highp vec4 srcVertex,highp vec4 blendIndex,highp vec4 blendWeight)\n{\n	int i = int(blendIndex.x);  \n    int i2 =int(blendIndex.y);\n	int i3 =int(blendIndex.z);\n	int i4 =int(blendIndex.w);\n	\n    mat4 mat = buildMat4(i)*blendWeight.x \n			 + buildMat4(i2)*blendWeight.y \n			 + buildMat4(i3)*blendWeight.z \n			 + buildMat4(i4)*blendWeight.w;\n	return mat* srcVertex;\n}\nvoid main()\n{                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = calcVertex(_glesVertex,_glesBlendIndex4,_glesBlendWeight4).xyz;  \n			 \n    gl_Position = glstate_matrix_mvp *  tmpvar_1;\n	xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;  \n}",t.code2_frag="void main() {\n    gl_FragData[0] = vec4(1.0, 1.0, 1.0, 1.0);\n}",t.code_frag="uniform sampler2D _MainTex;                                                 \nvarying lowp vec4 xlv_COLOR;                                                 \nvarying highp vec2 xlv_TEXCOORD0;   \nvoid main() {\n    lowp vec4 col_1;    \n    mediump vec4 prev_2;\n    lowp vec4 tmpvar_3;\n    tmpvar_3 = (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));\n    prev_2 = tmpvar_3;\n    mediump vec4 tmpvar_4;\n    tmpvar_4 = mix(vec4(1.0, 1.0, 1.0, 1.0), prev_2, prev_2.wwww);\n    col_1 = tmpvar_4;\n    col_1.x =xlv_TEXCOORD0.x;\n    col_1.y =xlv_TEXCOORD0.y;\n    gl_FragData[0] = col_1;\n}",t.code_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesColor;             \nattribute vec4 _glesMultiTexCoord0;    \nuniform highp mat4 glstate_matrix_mvp; \nvarying lowp vec4 xlv_COLOR;           \nvarying highp vec2 xlv_TEXCOORD0;      \nvoid main() {                                          \n    highp vec4 tmpvar_1;                   \n    tmpvar_1.w = 1.0;                      \n    tmpvar_1.xyz = _glesVertex.xyz;        \n    xlv_COLOR = _glesColor;                \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",t.diffuse_frag="uniform sampler2D _MainTex;\nuniform lowp float _AlphaCut;\nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() {\n    lowp vec4 tmpvar_3 = texture2D(_MainTex, xlv_TEXCOORD0);\n    if(tmpvar_3.a < _AlphaCut)\n        discard;\n    gl_FragData[0] = tmpvar_3;\n}",t.diffuse_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesMultiTexCoord0;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp vec4 _MainTex_ST;  \nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() {\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;  \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",t.diffuselightmap_frag="uniform sampler2D _MainTex;\nuniform sampler2D _LightmapTex;\nuniform lowp float _AlphaCut;\nvarying highp vec2 xlv_TEXCOORD0;\nvarying highp vec2 xlv_TEXCOORD1;\nlowp vec3 decode_hdr(lowp vec4 data)\n{\n    highp float power =pow( 2.0 ,data.a * 255.0 - 128.0);\n    return data.rgb * power * 2.0 ;\n}\nvoid main() \n{\n    lowp vec4 outColor = texture2D(_MainTex, xlv_TEXCOORD0);\n    if(outColor.a < _AlphaCut)\n        discard;\n    lowp vec4 lightmap = texture2D(_LightmapTex, xlv_TEXCOORD1);\n    outColor.xyz *= decode_hdr(lightmap);\n    gl_FragData[0] = outColor;\n}",t.diffuselightmap_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesMultiTexCoord0;\nattribute vec4 _glesMultiTexCoord1;\nuniform highp mat4 glstate_matrix_mvp;\nuniform highp vec4 glstate_lightmapOffset;\nuniform lowp float glstate_lightmapUV;\nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;\nvarying highp vec2 xlv_TEXCOORD1;\nvoid main()\n{\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;  \n    highp vec2 beforelightUV = _glesMultiTexCoord1.xy;\n    if(glstate_lightmapUV == 0.0)\n    {\n        beforelightUV = _glesMultiTexCoord0.xy;\n    }\n    highp float u = beforelightUV.x * glstate_lightmapOffset.x + glstate_lightmapOffset.z;\n    highp float v = 1.0 - ((1.0 - beforelightUV.y) * glstate_lightmapOffset.y + glstate_lightmapOffset.w);\n    xlv_TEXCOORD1 = vec2(u,v);\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",t.lambert_frag="uniform sampler2D _MainTex;                                                 \nvarying lowp vec4 xlv_COLOR;                                                 \nvarying highp vec2 xlv_TEXCOORD0;   \nvoid main() \n{\n    lowp vec4 tmpvar_3= (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));\n    mediump vec4 tmpvar_4 = mix(vec4(1.0, 1.0, 1.0, 1.0), tmpvar_3, tmpvar_3.wwww);\n    gl_FragData[0] = tmpvar_4;\n}",t.lambert_vert="attribute vec3 _glesVertex;   \nattribute vec3 _glesNormal;   \nattribute vec4 _glesColor;                  \nattribute vec4 _glesMultiTexCoord0;        \nuniform highp mat4 glstate_matrix_mvp;      \nuniform highp mat4 glstate_matrix_model;\nuniform highp mat4 glstate_matrix_modelview;\nuniform highp vec4 glstate_vec4_lightposs[8];\nuniform highp vec4 glstate_vec4_lightdirs[8];\nuniform highp float glstate_float_spotangelcoss[8];\nuniform highp float glstate_lightcount;\nvarying lowp vec4 xlv_COLOR;                \nvarying highp vec2 xlv_TEXCOORD0;     \nhighp float calcDiffuse(highp vec3 N,highp vec3 worldpos,highp vec4 lightPos,highp vec4 lightDir,highp float cosspot)\n{\n    highp vec3 L = normalize(lightPos.xyz - worldpos); \n    highp vec3 L2 = -lightDir.xyz;\n    highp float dotSpot = dot(L,L2);\n    highp float diffuse =clamp(dot(N.xyz,L.xyz),0.0,1.0); \n    highp float diffuseD =clamp(dot(N.xyz,L2.xyz),0.0,1.0); \n    diffuse= mix(diffuse,diffuse*smoothstep(cosspot,1.0,dotSpot),lightDir.w);\n    diffuse= mix(diffuseD,diffuse,lightPos.w);\n    return diffuse;\n     \n}\nvoid main()                                     \n{                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = _glesVertex.xyz;    \n    highp mat3 normalmat = mat3(glstate_matrix_model);\n    highp vec3 N =normalize(normalmat*_glesNormal);\n    highp vec3 worldpos =(glstate_matrix_model * vec4(_glesVertex.xyz, 1.0)).xyz;\n    highp float diff=0.0;\n    for(int i=0;i<8;i++)\n    {\n        int c =int(glstate_lightcount);\n        if(i>=c)break;\n        diff += calcDiffuse(N,worldpos,glstate_vec4_lightposs[i],glstate_vec4_lightdirs[i],glstate_float_spotangelcoss[i]);\n    }\n    xlv_COLOR = vec4(diff,diff,diff,1.0);         \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;     \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);  \n}",t.lambertnormal_frag="\nuniform sampler2D _MainTex;  \nuniform sampler2D _NormalTex;\nuniform highp mat4 glstate_matrix_model;\nuniform highp vec4 glstate_vec4_lightposs[8];\nuniform highp vec4 glstate_vec4_lightdirs[8];\nuniform highp float glstate_float_spotangelcoss[8];\nuniform highp float glstate_lightcount;\nvarying lowp vec4 xlv_COLOR;     \nvarying highp vec3 xlv_Position;                                             \nvarying highp vec2 xlv_TEXCOORD0; \nvarying highp mat3 TBNmat;\nvarying highp vec3 worldpos; \nhighp float calcDiffuse(highp vec3 N,highp vec3 worldpos,highp vec4 lightPos,highp vec4 lightDir,highp float cosspot);\nvoid main() \n{\n	\n	highp mat3 TBN = TBNmat;\n    highp mat3 normalmat = mat3(glstate_matrix_model);\n	highp vec3 N = normalize(TBNmat[2]*normalmat);\n    highp float diff=0.0;\n    for(int i=0;i<8;i++)\n    {        \n        int c =int(glstate_lightcount);\n        if(i>=c)break;\n		highp vec4 lpos=glstate_vec4_lightposs[i];\n		highp vec4 ldir =glstate_vec4_lightdirs[i];\n		\n		highp vec3 normal;		normal =  texture2D(_NormalTex, xlv_TEXCOORD0).xyz *2.0 -1.0;\n        normal =normalize(normal);\n		normal =TBN*(normal);\n		\n        diff += calcDiffuse(normal,worldpos,lpos,ldir,glstate_float_spotangelcoss[i]);\n    }\n	lowp vec4 color = vec4(diff,diff,diff,1.0);       \n    lowp vec4 tmpvar_3;\n    tmpvar_3 = (color * texture2D(_MainTex, xlv_TEXCOORD0));\n    gl_FragData[0] = tmpvar_3;\n}\nhighp float calcDiffuse(highp vec3 N,highp vec3 worldpos,highp vec4 lightPos,highp vec4 lightDir,highp float cosspot)\n{\n    highp vec3 L = normalize(lightPos.xyz - worldpos); \n    highp vec3 L2 = -lightDir.xyz;\n    highp float dotSpot = dot(L,L2);\n    highp float diffuse =clamp(dot(N.xyz,L.xyz),0.0,1.0); \n    highp float diffuseD =clamp(dot(N.xyz,L2.xyz),0.0,1.0); \n    diffuse= mix(diffuse,diffuse*smoothstep(cosspot,1.0,dotSpot),lightDir.w);\n    diffuse= mix(diffuseD,diffuse,lightPos.w);\n    return diffuse;\n     \n}\n",t.lambertnormal_vert="\nattribute vec3 _glesVertex;\nattribute vec2 _glesMultiTexCoord0;\nattribute vec4 _glesColor;\nattribute vec3 _glesNormal;\nattribute vec3 _glesTangent;  \nuniform highp mat4 glstate_matrix_mvp;\nuniform highp mat4 glstate_matrix_model;\nuniform highp mat4 glstate_matrix_modelview;\nuniform highp vec4 glstate_eyepos;\nuniform highp vec4 glstate_vec4_lightposs[8];\nuniform highp vec4 glstate_vec4_lightdirs[8];\nuniform highp float glstate_float_spotangelcoss[8];\nuniform highp float glstate_lightcount;\nvarying highp vec4 xlv_COLOR;\nvarying highp vec3 xlv_Position;      \nvarying highp vec2 xlv_TEXCOORD0;\nvarying highp mat3 TBNmat;\nvarying highp vec3 worldpos;\nhighp mat3 calBTNMatrix(highp mat3 NormalMatToWorld,highp vec3 _normal,highp vec3 _tangent)\n{\n    highp vec3 normal=normalize(NormalMatToWorld*_normal);\n    highp vec3 tangent=normalize(NormalMatToWorld*_tangent);\n    highp vec3 binormal=cross(normal,tangent);\n  	return (mat3(tangent,binormal,normal));\n}\nvoid main()\n{\n    mat3 normalmat = mat3(glstate_matrix_model);\n   	TBNmat=calBTNMatrix(normalmat,_glesNormal,_glesTangent);\n    worldpos =(glstate_matrix_model * vec4(_glesVertex.xyz, 1.0)).xyz;\n	xlv_COLOR = _glesColor;\n	xlv_Position = _glesVertex.xyz;\n	xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;\n	gl_Position = (glstate_matrix_mvp * vec4(_glesVertex.xyz, 1.0));\n}\n",t.line_frag="varying lowp vec4 xlv_COLOR;\nvoid main() {\n    gl_FragData[0] = xlv_COLOR;\n}",t.line_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesColor;\nuniform highp mat4 glstate_matrix_mvp;\nvarying lowp vec4 xlv_COLOR;\nvoid main() {\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_COLOR = _glesColor;\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",t.materialcolor_vert="attribute vec4 _glesVertex;\nuniform vec4 _Color;\nuniform highp mat4 glstate_matrix_mvp;\nvarying lowp vec4 xlv_COLOR;\nvoid main() {\n    highp vec4 tmpvar_1;\n    tmpvar_1.w = 1.0;\n    tmpvar_1.xyz = _glesVertex.xyz;\n    xlv_COLOR = _Color;\n    gl_Position = (glstate_matrix_mvp * tmpvar_1);\n}",t.postdepth_frag="precision highp float;\nconst float PackUpscale = 256. / 255.; \nconst float UnpackDownscale = 255. / 256.; \nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) \n{\n    vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) \n{\n    return dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( const in float v ) \n{\n    vec2 r = vec2( fract( v * PackFactors.z ), v );\n	r.y -= r.x * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGToDepth( const in vec2 v ) \n{\n    return dot( v.xy, UnpackFactors.zw );\n}\nvec3 packDepthToRGB( const in float v ) \n{\n    vec3 r = vec3( fract( v * PackFactors.yz ), v );\n	r.yz -= r.xy * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGBToDepth( const in vec3 v ) \n{\n    return dot( v.xyz, UnpackFactors.yzw );\n}\nvoid main() \n{\n    float z = gl_FragCoord.z;    gl_FragColor=packDepthToRGBA(z);\n}",t.postdepth_vert="precision highp float;\nattribute vec4 _glesVertex;    \nuniform highp mat4 glstate_matrix_mvp;      \n       \nvoid main()                                     \n{        \n    gl_Position = (glstate_matrix_mvp * _glesVertex);  \n}",t.postquad_vert="attribute vec4 _glesVertex;\nattribute vec4 _glesMultiTexCoord0; \nuniform highp vec4 _MainTex_ST; \nvarying highp vec2 xlv_TEXCOORD0;   \nvoid main()                     \n{ \n    gl_Position = _glesVertex;\n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw; \n}   ",t.postquaddepth_frag="precision mediump float;\nvarying highp vec2 xlv_TEXCOORD0;       \nuniform sampler2D _DepthTex;   \nuniform sampler2D _MainTex;  \nconst float PackUpscale = 256. / 255.; \nconst float UnpackDownscale = 255. / 256.; \nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) \n{\n    vec4 r = vec4( fract( v * PackFactors ), v );\n	r.yzw -= r.xyz * ShiftRight8;\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) \n{\n    return dot( v, UnpackFactors );\n}\nfloat planeDistance(const in vec3 positionA, const in vec3 normalA, \n                    const in vec3 positionB, const in vec3 normalB) \n{\n  vec3 positionDelta = positionB-positionA;\n  float planeDistanceDelta = max(abs(dot(positionDelta, normalA)), abs(dot(positionDelta, normalB)));\n  return planeDistanceDelta;\n}\nvoid main()         \n{\n    lowp vec4 c1=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(0.001,0));\n    lowp vec4 c2=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(-0.001,0));\n    lowp vec4 c3=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(0,0.001));\n    lowp vec4 c4=texture2D(_DepthTex, xlv_TEXCOORD0+vec2(0,-0.001));\n    highp float z1 = unpackRGBAToDepth(c1);\n    highp float z2 = unpackRGBAToDepth(c2);\n    highp float z3 = unpackRGBAToDepth(c3);\n    highp float z4 = unpackRGBAToDepth(c4);\n    highp float d = clamp(  (abs(z2-z1)+abs(z4-z3))*10.0,0.0,1.0);\n    lowp vec4 c=texture2D(_MainTex, xlv_TEXCOORD0);\n    lowp float g = c.r*0.3+c.g*0.6+c.b*0.1;\n    gl_FragColor =mix(vec4(g,g,g,1.),vec4(1.0,1.0,0.0,1.0),d);}",t.tintcolor_frag="uniform sampler2D _MainTex;\nuniform lowp float _AlphaCut;\nuniform lowp vec4 _TintColor;\nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() \n{\n    lowp vec4 tmpvar_3 = _TintColor*texture2D(_MainTex, xlv_TEXCOORD0);\n    if(tmpvar_3.a < _AlphaCut)\n        discard;\n    gl_FragData[0] = tmpvar_3;\n}",t.transparentdiffuse_vert="",t.ui_frag="uniform sampler2D _MainTex;\nvarying lowp vec4 xlv_COLOR;\nvarying highp vec2 xlv_TEXCOORD0;\nvoid main() {\n    lowp vec4 tmpvar_3;\n    tmpvar_3 = (xlv_COLOR * texture2D(_MainTex, xlv_TEXCOORD0));\n    gl_FragData[0] = tmpvar_3;\n}",t.uifont_frag="precision mediump float;\nuniform sampler2D _MainTex;\nvarying lowp vec4 xlv_COLOR;\nvarying lowp vec4 xlv_COLOREx;\nvarying highp vec2 xlv_TEXCOORD0;  \nvoid main() {\n    float scale = 10.0;\n    float d = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.5) * scale;    float bd = (texture2D(_MainTex, xlv_TEXCOORD0).r - 0.34) * scale;\n    float c=xlv_COLOR.a * clamp ( d,0.0,1.0);\n    float bc=xlv_COLOREx.a * clamp ( bd,0.0,1.0);\n    bc =min(1.0-c,bc);\n    gl_FragData[0] =xlv_COLOR*c + xlv_COLOREx*bc;\n}",t.uifont_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesColor;                  \nattribute vec4 _glesColorEx;                  \nattribute vec4 _glesMultiTexCoord0;         \nuniform highp mat4 glstate_matrix_mvp;      \nvarying lowp vec4 xlv_COLOR;                \nvarying lowp vec4 xlv_COLOREx;                                                 \nvarying highp vec2 xlv_TEXCOORD0;           \nvoid main() {                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = _glesVertex.xyz;             \n    xlv_COLOR = _glesColor;                     \n    xlv_COLOREx = _glesColorEx;                     \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy;     \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);  \n}",t.vertcolor_frag="uniform sampler2D _MainTex;                                                 \nvarying lowp vec4 xlv_COLOR;                                                 \nvarying highp vec2 xlv_TEXCOORD0;   \nvoid main() \n{\n    lowp vec4 col_1;    \n    mediump vec4 prev_2;\n    lowp vec4 tmpvar_3;\n    tmpvar_3 = (texture2D(_MainTex, xlv_TEXCOORD0));\n    gl_FragData[0] = tmpvar_3;\n}",t.vertcolor_vert="attribute vec4 _glesVertex;   \nattribute vec4 _glesNormal;   \nattribute vec4 _glesColor;                  \nattribute vec4 _glesMultiTexCoord0;        \nuniform highp mat4 glstate_matrix_mvp;   \nvarying lowp vec4 xlv_COLOR;                \nvarying highp vec2 xlv_TEXCOORD0;   \nuniform highp vec4 _MainTex_ST;       \nvoid main()                                     \n{                                               \n    highp vec4 tmpvar_1;                        \n    tmpvar_1.w = 1.0;                           \n    tmpvar_1.xyz = _glesVertex.xyz;             \n    xlv_COLOR = _glesColor;                     \n    xlv_TEXCOORD0 = _glesMultiTexCoord0.xy * _MainTex_ST.xy + _MainTex_ST.zw;   \n    gl_Position = (glstate_matrix_mvp * tmpvar_1);  \n}\n"}(e=t.ShaderLib||(t.ShaderLib={}))}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){}return e.caclByteLength=function(){var e=0;return e+=t.math.caclStringByteLength(name),e+=1,e+=8},e}();e.SubClip=r,__reflect(r.prototype,"egret3d.framework.SubClip");var a=function(e){function a(t){return e.call(this,t,"animationClip")||this}return __extends(a,e),a.prototype.dispose=function(){this.bones.length=0,this.subclips.length=0,delete this.frames},a.prototype.caclByteLength=function(){var e=0;for(var a in this.bones)e+=t.math.caclStringByteLength(this.bones[a]);for(var a in this.frames)e+=this.frames[a].byteLength,e+=t.math.caclStringByteLength(a);return e+=r.caclByteLength()*this.subclips.length},a.prototype.Parse=function(e){var a=new t.io.BinReader(e);a.readStringAnsi();this.fps=a.readFloat(),this.loop=a.readBoolean(),this.boneCount=a.readInt(),this.bones=[];for(var o=0;o<this.boneCount;o++)this.bones.push(a.readStringAnsi());this.subclipCount=a.readInt(),this.subclips=[];for(var o=0;o<this.subclipCount;o++){var n=new r;n.name=a.readStringAnsi(),n.loop=a.readBoolean(),this.subclips.push(n)}this.frameCount=a.readInt(),this.frames={};for(var o=0;o<this.frameCount;o++){var s=a.readInt().toString(),h=a.readBoolean(),l=new Float32Array(7*this.boneCount+1);l[0]=h?1:0;for(var c=new i,u=0;u<this.boneCount;u++)c.load(a),l[7*u+1]=c.r.x,l[7*u+2]=c.r.y,l[7*u+3]=c.r.z,l[7*u+4]=c.r.w,l[7*u+5]=c.t.x,l[7*u+6]=c.t.y,l[7*u+7]=c.t.z;this.frames[s]=l}e=null},a=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],a)}(e.Asset);e.AnimationClip=a,__reflect(a.prototype,"egret3d.framework.AnimationClip");var i=function(){function e(){}return r=e,e.caclByteLength=function(){var t=28;return t},e.prototype.Clone=function(){var e=new r;return e.t=new t.math.Vector3,e.r=new t.math.Quaternion,t.math.vec3Clone(this.t,e.t),t.math.quatClone(this.r,e.r),e},e.prototype.load=function(e){var r,a,i,o;r=e.readSingle(),a=e.readSingle(),i=e.readSingle(),o=e.readSingle(),this.r=new t.math.Quaternion(r,a,i,o),r=e.readSingle(),a=e.readSingle(),i=e.readSingle(),this.t=new t.math.Vector3(r,a,i)},e.createDefault=function(){var e=new r;return e.r=new t.math.Quaternion(0,0,0,1),e.t=new t.math.Vector3(0,0,0),e},e.prototype.copyFrom=function(t){this.r.x=t.r.x,this.r.y=t.r.y,this.r.z=t.r.z,this.r.w=t.r.w,this.t.x=t.t.x,this.t.y=t.t.y,this.t.z=t.t.z},e.prototype.copyFromData=function(t,e){this.r.x=t[e+0],this.r.y=t[e+1],this.r.z=t[e+2],this.r.w=t[e+3],this.t.x=t[e+4],this.t.y=t[e+5],this.t.z=t[e+6]},e.prototype.invert=function(){t.math.quatInverse(this.r,this.r),t.math.quatTransformVector(this.r,this.t,this.t),this.t.x*=-1,this.t.y*=-1,this.t.z*=-1},e.prototype.lerpInWorld=function(t,e,a,i){var o=r.sMultiply(e,t),n=r.sMultiply(a,t),s=r.sLerp(o,n,i),h=t.Clone();h.invert(),r.sMultiply(s,h,this)},e.prototype.lerpInWorldWithData=function(t,e,a,i,o){var n=r.sMultiply(e,t),s=r.sMultiplyDataAndMatrix(a,i,t),h=r.sLerp(n,s,o),l=t.Clone();l.invert(),r.sMultiply(h,l,this)},e.sMultiply=function(e,a,i){void 0===i&&(i=null),null==i&&(i=r.createDefault());var o=t.math.Pool.new_vector3();t.math.vec3Clone(a.t,o);var n=t.math.Pool.new_vector3();return t.math.quatTransformVector(e.r,o,n),i.t.x=n.x+e.t.x,i.t.y=n.y+e.t.y,i.t.z=n.z+e.t.z,t.math.quatMultiply(e.r,a.r,i.r),t.math.Pool.delete_vector3(o),t.math.Pool.delete_vector3(n),i},e.sMultiplyDataAndMatrix=function(e,a,i,o){void 0===o&&(o=null),null==o&&(o=r.createDefault());var n=t.math.Pool.new_vector3();t.math.vec3Clone(i.t,n);var s=t.math.Pool.new_vector3();return t.math.quatTransformVectorDataAndQuat(e,a+0,n,s),o.t.x=s.x+e[a+4],o.t.y=s.y+e[a+5],o.t.z=s.z+e[a+6],t.math.quatMultiplyDataAndQuat(e,a+0,i.r,o.r),t.math.Pool.delete_vector3(n),t.math.Pool.delete_vector3(s),o},e.sLerp=function(e,a,i,o){return void 0===o&&(o=null),null==o&&(o=r.createDefault()),o.t.x=e.t.x*(1-i)+a.t.x*i,o.t.y=e.t.y*(1-i)+a.t.y*i,o.t.z=e.t.z*(1-i)+a.t.z*i,t.math.quatLerp(e.r,a.r,o.r,i),o},__decorate([t.reflect.Field("Vector3"),__metadata("design:type",t.math.Vector3)],e.prototype,"t",void 0),__decorate([t.reflect.Field("Quaternion"),__metadata("design:type",t.math.Quaternion)],e.prototype,"r",void 0),e=r=__decorate([t.reflect.SerializeType],e);var r}();e.PoseBoneMatrix=i,__reflect(i.prototype,"egret3d.framework.PoseBoneMatrix")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(e){function r(t){var r=e.call(this,t,"bundle_")||this;return r.files=[],r.packages=[],r.mapNamed={},r}return __extends(r,e),r.prototype.find=function(e){return t.AssetMap.find(e,this._name)},r.prototype.dispose=function(){},r.prototype.caclByteLength=function(){return 0},r.prototype.parse=function(t){for(var e=t.files,r=0;r<e.length;r++){var a=e[r],i=-1;void 0!=a.packes&&(i=a.packes),this.files.push({name:a.name,length:a.length,packes:i})}if(void 0!=t.packes)for(var i=t.packes,r=0;r<i.length;r++)this.packages.push(i[r])},r}(t.Asset);t.AssetBundle=e,__reflect(e.prototype,"egret3d.framework.AssetBundle")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(r){function a(t){var e=r.call(this,t,"atlas")||this;return e.sprites={},e}return __extends(a,r),a.prototype.dispose=function(){for(var t in this.sprites)this.sprites[t].unuse();this.texture.unuse(),delete this.sprites},a.prototype.caclByteLength=function(){var e=0;for(var r in this.sprites)e+=this.sprites[r].caclByteLength(),e+=t.math.caclStringByteLength(r);return e},Object.defineProperty(a.prototype,"texture",{get:function(){return this._texture},set:function(t){null!=this._texture&&this._texture.unuse(),this._texture=t,this._texture.use()},enumerable:!0,configurable:!0}),a.prototype.Parse=function(r){var a=JSON.parse(r),i=a.t;this.texturewidth=a.w,this.textureheight=a.h;var o=a.s;this.texture=e.AssetMap.find(i),null==this.texture&&console.log("atlas texture not found");for(var n in o){var s=o[n],h=s[0],l=new e.Sprite(this.getName()+"_"+h);this.texture&&(l.texture=this.texture),l.rect=new t.math.Rect(s[1],s[2],s[3],s[4]),l.border=new t.math.Border(0,0,0,0),l.atlas=this.getName(),this.sprites[h]=l}},a=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],a)}(e.Asset);e.Atlas=r,__reflect(r.prototype,"egret3d.framework.Atlas")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function t(){}return t.caclByteLength=function(){return 36},t}();e.Charinfo=r,__reflect(r.prototype,"egret3d.framework.Charinfo");var a=function(a){function i(t){return a.call(this,t,"font")||this
}return __extends(i,a),i.prototype.dispose=function(){this.texture&&this.texture.unuse(!0),delete this.cmap},i.prototype.caclByteLength=function(){var e=0;for(var a in this.cmap)e+=t.math.caclStringByteLength(a),e+=r.caclByteLength();return e},Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){null!=this._texture&&this._texture.unuse(),this._texture=t,this._texture.use()},enumerable:!0,configurable:!0}),i.prototype.Parse=function(t){var a=((new Date).valueOf(),JSON.parse(t)),i=a.font;this.fontname=i[0];var o=i[1];this.texture=e.AssetMap.find(o),this.pointSize=i[2],this.padding=i[3],this.lineHeight=i[4],this.baseline=i[5],this.atlasWidth=i[6],this.atlasHeight=i[7],this.cmap={};var n=a.map;for(var s in n){var h=new r;this.cmap[s]=h,h.x=(n[s][0]-.5)/this.atlasWidth,h.y=(n[s][1]-.5)/this.atlasHeight,h.w=(n[s][2]+1)/this.atlasWidth,h.h=(n[s][3]+1)/this.atlasHeight,h.xSize=n[s][2],h.ySize=n[s][3],h.xOffset=n[s][4],h.yOffset=n[s][5],h.xAddvance=n[s][6]}n=null,a=null;(new Date).valueOf()},i=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],i)}(e.Asset);e.Font=a,__reflect(a.prototype,"egret3d.framework.Font")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(t,e,r){void 0===r&&(r=null),this.type=t,this.value=e,this.defaultValue=r}return __decorate([t.reflect.Field("number"),t.reflect.UIStyle("UniformTypeEnum"),__metadata("design:type",Number)],e.prototype,"type",void 0),__decorate([t.reflect.Field("any"),__metadata("design:type",Object)],e.prototype,"value",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Number,Object,Object])],e)}();e.UniformData=r,__reflect(r.prototype,"egret3d.framework.UniformData");var a=function(a){function i(e){var r=a.call(this,e,"material")||this;return r.version=0,r._changeShaderMap={},r.mapUniform={},r.mapUniformTemp={},t.io.EnumMgr.enumMap.UniformTypeEnum=t.render.UniformTypeEnum,r}return __extends(i,a),o=i,i.prototype.dispose=function(){for(var e in this.mapUniform)switch(this.mapUniform[e].type){case t.render.UniformTypeEnum.Texture:null!=this.mapUniform[e]&&null!=this.mapUniform[e].value&&this.mapUniform[e].value.unuse(!0)}delete this.mapUniform,delete this.mapUniformTemp,this.version++},i.prototype.caclByteLength=function(){var e=0;this.shader&&(e+=this.shader.caclByteLength());for(var r in this.mapUniform){var a=this.mapUniform[r].type,i=this.mapUniform[r].value,o=this.mapUniform[r].defaultValue;switch(a){case t.render.UniformTypeEnum.Float:e+=4;break;case t.render.UniformTypeEnum.Floatv:e+=i.byteLength;break;case t.render.UniformTypeEnum.Float4:e+=16;break;case t.render.UniformTypeEnum.Float4v:e+=i.byteLength;break;case t.render.UniformTypeEnum.Float4x4:e+=64;break;case t.render.UniformTypeEnum.Float4x4v:e+=i.byteLength;break;case t.render.UniformTypeEnum.Texture:null!=i?e+=i.caclByteLength():null!=o&&(e+=o.caclByteLength())}}for(var r in this.mapUniformTemp){var a=this.mapUniformTemp[r].type,i=this.mapUniformTemp[r].value,o=this.mapUniformTemp[r].defaultValue;switch(a){case t.render.UniformTypeEnum.Float:e+=4;break;case t.render.UniformTypeEnum.Floatv:e+=i.byteLength;break;case t.render.UniformTypeEnum.Float4:e+=16;break;case t.render.UniformTypeEnum.Float4v:e+=i.byteLength;break;case t.render.UniformTypeEnum.Float4x4:e+=64;break;case t.render.UniformTypeEnum.Float4x4v:e+=i.byteLength;break;case t.render.UniformTypeEnum.Texture:null!=i?e+=i.caclByteLength():null!=o&&(e+=o.caclByteLength())}}return e},i.prototype.initUniformData=function(e){if(this.version++,null!=e)for(var a=0;a<e.length;a++){var i=e[a];for(var o in i.uniforms)if(!(o.indexOf("glstate_")>=0||o.indexOf("_LightmapTex")>=0)){var n=i.uniforms[o],s=this.shader.defaultValue[o];if(null==s){if(null==this.mapUniform[o])if(n==t.render.UniformTypeEnum.Float)this.mapUniform[o]=new r(n,null,0);else if(n==t.render.UniformTypeEnum.Floatv)this.mapUniform[o]=new r(n,null,new Float32Array(0));else if(n==t.render.UniformTypeEnum.Float4){var h=new t.math.Vector4;o.indexOf("_ST")>0&&(h.x=1,h.y=1),this.mapUniform[o]=new r(n,null,h)}else n==t.render.UniformTypeEnum.Float4v?this.mapUniform[o]=new r(n,null,new Float32Array(0)):n==t.render.UniformTypeEnum.Float4x4?this.mapUniform[o]=new r(n,null,new t.math.Matrix):n==t.render.UniformTypeEnum.Float4x4v?this.mapUniform[o]=new r(n,null,new Float32Array(0)):n==t.render.UniformTypeEnum.Texture&&(this.mapUniform[o]=new r(n,null))}else this.mapUniform[o]=new r(n,s.value,s.defaultValue)}}},i.prototype.setShader=function(t){this.shader=t,this.mapUniform={},this.initUniformData(this.shader.passes.base)},i.prototype.getShader=function(){return this.shader},i.prototype.changeShader=function(t){var e;if(void 0!=this._changeShaderMap[t.getName()])e=this._changeShaderMap[t.getName()].mapUniform;else{var r=this.clone();e=r.mapUniform,this._changeShaderMap[t.getName()]=r}this.setShader(t);for(var a in e)void 0!=this.mapUniform[a]&&(this.mapUniform[a]=e[a])},i.prototype.getLayer=function(){return this.shader.layer},i.prototype.getQueue=function(){return this.shader.queue},i.prototype.setFloat=function(e,a){void 0!=this.mapUniform[e]?this.mapUniform[e].value=a:this.mapUniformTemp[e]=new r(t.render.UniformTypeEnum.Float,a),this.version++},i.prototype.setFloatv=function(e,a){void 0!=this.mapUniform[e]?this.mapUniform[e].value=a:this.mapUniformTemp[e]=new r(t.render.UniformTypeEnum.Floatv,a),this.version++},i.prototype.setVector4=function(e,a){void 0!=this.mapUniform[e]?this.mapUniform[e].value=a:this.mapUniformTemp[e]=new r(t.render.UniformTypeEnum.Float4,a),this.version++},i.prototype.setVector4v=function(e,a){void 0!=this.mapUniform[e]?this.mapUniform[e].value=a:this.mapUniformTemp[e]=new r(t.render.UniformTypeEnum.Float4v,a),this.version++},i.prototype.setMatrix=function(e,a){void 0!=this.mapUniform[e]?this.mapUniform[e].value=a:this.mapUniformTemp[e]=new r(t.render.UniformTypeEnum.Float4x4,a),this.version++},i.prototype.setMatrixv=function(e,a){void 0!=this.mapUniform[e]?this.mapUniform[e].value=a:this.mapUniformTemp[e]=new r(t.render.UniformTypeEnum.Float4x4v,a),this.version++},i.prototype.setTexture=function(e,a){if(void 0!=this.mapUniform[e]){if(this.mapUniform[e].value&&this.mapUniform[e].value.unuse(),this.mapUniform[e].value=a,null!=a){a.use();var i=e+"_TexelSize",o=a.glTexture;void 0!=this.mapUniform[i]&&this.setVector4(i,new t.math.Vector4(1/o.width,1/o.height,o.width,o.height))}}else this.mapUniformTemp[e]=new r(t.render.UniformTypeEnum.Texture,a);this.version++},i.prototype.draw=function(e,r,a,i){void 0===i&&(i="base");var o=this.shader.passes[i+e.drawtype];if(void 0==o&&(o=this.shader.passes["base"+e.drawtype]),void 0!=o){for(var n=0;n<o.length;n++){var s=o[n],h=s.program,l=s.use(e.webgl);h.uploadUniforms(this,e,l),h.bindAttributes(r.glMesh,a.useVertexIndex,l),a.useVertexIndex<0?a.line?t.render.Webglkit.drawArrayLines(e.webgl,a.start,a.size):t.render.Webglkit.drawArrayTris(e.webgl,a.start,a.size):a.line?t.render.Webglkit.drawElementLines(e.webgl,a.start,a.size):t.render.Webglkit.drawElementTris(e.webgl,a.start,a.size)}this.mapUniformTemp={}}},i.prototype.Parse=function(r){var a=r.shader;this.setShader(e.AssetMap.find(a));var i=r.mapUniform;for(var o in i){var n=i[o],s=n.type;switch(s){case t.render.UniformTypeEnum.Texture:var h=n.value,l=e.AssetMap.find(h);void 0==l&&(l=e.DefaultTextures.Grid),this.setTexture(o,l);break;case t.render.UniformTypeEnum.Float:var c=n.value;this.setFloat(o,parseFloat(c));break;case t.render.UniformTypeEnum.Float4:var u=n.value;try{var d=u.match(e.RegexpUtil.vector4Regexp);if(null!=d){var p=new t.math.Vector4(parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),parseFloat(d[4]));this.setVector4(o,p)}}catch(m){console.log(m)}break;default:console.log("map uniform type in material json <"+n.type+"> out of range（0-2）!")}}},i.prototype.clone=function(){var e=new o(this.getName());e.setShader(this.shader);for(var r in this.mapUniform){var a=this.mapUniform[r],i=a.type;switch(i){case t.render.UniformTypeEnum.Texture:e.setTexture(r,a.value);break;case t.render.UniformTypeEnum.Float:e.setFloat(r,a.value);break;case t.render.UniformTypeEnum.Float4:e.setVector4(r,a.value)}}return e},__decorate([t.reflect.Field("Shader"),__metadata("design:type",e.Shader)],i.prototype,"shader",void 0),__decorate([t.reflect.Field("UniformDataDic"),__metadata("design:type",Object)],i.prototype,"mapUniform",void 0),i=o=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],i);var o}(e.Asset);e.Material=a,__reflect(a.prototype,"egret3d.framework.Material")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function t(){this.useVertexIndex=0,this.line=!1}return t}();e.SubMeshInfo=r,__reflect(r.prototype,"egret3d.framework.SubMeshInfo");var a=function(e){function a(t){var r=e.call(this,t,"mesh")||this;return r.submesh=[],r}return __extends(a,e),i=a,a.prototype.dispose=function(){this.glMesh.dispose(t.render.Webglkit.webgl),this.data=null,delete this.submesh},a.prototype.caclByteLength=function(){var t=0;return t+=this.glMesh.caclByteLength(),this.data&&(t+=this.data.caclByteLength()),t},a.prototype.Parse=function(e,a){var i=0,o=new t.render.MeshData,n=new t.io.BinReader(e);n.readStringAnsi();n.position=n.position+24;for(var s=n.readUInt32(),h=[];;){var l=n.readUInt8();if(255==l)break;if(1==l){void 0==o.pos&&(o.pos=[],i|=t.render.VertexFormatMask.Position);for(var c=0;s>c;c++){var u=new t.math.Vector3;u.x=n.readSingle(),u.y=n.readSingle(),u.z=n.readSingle(),o.pos.push(u)}}else if(2==l){void 0==o.color&&(o.color=[],i|=t.render.VertexFormatMask.Color);for(var c=0;s>c;c++){var d=new t.math.Color;d.a=n.readUInt8(),d.r=n.readUInt8(),d.g=n.readUInt8(),d.b=n.readUInt8(),o.color.push(d)}}else if(3==l){void 0==o.normal&&(o.normal=[],i|=t.render.VertexFormatMask.Normal);for(var c=0;s>c;c++){var p=new t.math.Vector3;p.x=n.readSingle(),p.y=n.readSingle(),p.z=n.readSingle(),o.normal.push(p)}}else if(4==l){void 0==o.uv&&(o.uv=[],i|=t.render.VertexFormatMask.UV0);for(var c=0;s>c;c++){var m=new t.math.Vector2;m.x=n.readSingle(),m.y=1-n.readSingle(),o.uv.push(m)}}else if(5==l){void 0==o.uv2&&(o.uv2=[],i|=t.render.VertexFormatMask.UV1);for(var c=0;s>c;c++){var m=new t.math.Vector2;m.x=n.readSingle(),m.y=1-n.readSingle(),o.uv2.push(m)}}else if(6==l)for(var c=0;s>c;c++)n.readSingle(),1-n.readSingle();else if(7==l){void 0==o.tangent&&(o.tangent=[],i|=t.render.VertexFormatMask.Tangent);for(var c=0;s>c;c++){var f=new t.math.Vector3,v=n.readSingle(),_=n.readSingle(),g=n.readSingle(),y=n.readSingle();f.x=v/y,f.y=_/y,f.z=g/y,o.tangent.push(f)}}else if(8==l)for(var c=0;s>c;c++)n.readSingle(),1-n.readSingle();else if(16==l)for(var w=n.readUInt8(),c=0;w>c;c++)h[10*c+0]=n.readSingle(),h[10*c+1]=n.readSingle(),h[10*c+2]=n.readSingle(),h[10*c+3]=n.readSingle(),h[10*c+4]=n.readSingle(),h[10*c+5]=n.readSingle(),h[10*c+6]=n.readSingle(),h[10*c+7]=n.readSingle(),h[10*c+8]=n.readSingle(),h[10*c+9]=n.readSingle();else{if(17!=l)throw"not write "+l;void 0==o.blendIndex&&(o.blendIndex=[],i|=t.render.VertexFormatMask.BlendIndex4),void 0==o.blendWeight&&(o.blendWeight=[],i|=t.render.VertexFormatMask.BlendWeight4);for(var c=0;s>c;c++){var x=new t.render.Number4;x.v0=n.readUInt32(),x.v1=n.readUInt32(),x.v2=n.readUInt32(),x.v3=n.readUInt32();var b=new t.render.Number4;b.v0=n.readSingle(),b.v1=n.readSingle(),b.v2=n.readSingle(),b.v3=n.readSingle(),o.blendIndex.push(x),o.blendWeight.push(b)}}}var D=n.readUInt8();o.trisindex=[],this.submesh=[];for(var c=0;D>c;c++){var T=new r,E=(n.readUInt32(),n.readUInt32());T.start=o.trisindex.length,T.size=E,T.matIndex=c,this.submesh.push(T);for(var P=0;E>P;P++){var M=n.readUInt32();o.trisindex.push(M)}}e=null,this.data=o,this.glMesh=new t.render.GlMesh;var S=this.data.genVertexDataArray(i),A=this.data.genIndexDataArray();this.glMesh.initBuffer(a,i,this.data.pos.length),this.glMesh.uploadVertexSubData(a,S),this.glMesh.addIndex(a,A.length),this.glMesh.uploadIndexSubData(a,0,A)},a.prototype.intersects=function(e,r){for(var a=null,i=0;i<this.submesh.length;i++){var o=this.submesh[i];if(o.line);else if(o.useVertexIndex<0);else{for(var n=t.math.Pool.new_vector3(),s=t.math.Pool.new_vector3(),h=t.math.Pool.new_vector3(),l=o.start;l<o.size;l+=3){var c=this.data.pos[this.data.trisindex[l]],u=this.data.pos[this.data.trisindex[l+1]],d=this.data.pos[this.data.trisindex[l+2]];t.math.matrixTransformVector3(c,r,n),t.math.matrixTransformVector3(u,r,s),t.math.matrixTransformVector3(d,r,h);var p=e.intersectsTriangle(n,s,h);if(p){if(p.distance<0)continue;if(!a||a.distance>p.distance){a=p,a.faceId=l/3,a.subMeshId=i;var m=t.math.Pool.new_vector3();t.math.vec3ScaleByNum(e.direction,p.distance,m),t.math.vec3Add(e.origin,m,a.hitposition)}}}t.math.Pool.delete_vector3(n),t.math.Pool.delete_vector3(s),t.math.Pool.delete_vector3(h)}}return a},a.prototype.clone=function(){var e=new i(this.getName()),a=this.glMesh.vertexFormat,o=new t.render.MeshData;if(void 0!=this.data.pos){o.pos=[];for(var n=0;n<this.data.pos.length;n++){var s=new t.math.Vector3;s.x=this.data.pos[n].x,s.y=this.data.pos[n].y,s.z=this.data.pos[n].z,o.pos.push(s)}}if(void 0!=this.data.color){o.color=[];for(var n=0;n<this.data.color.length;n++){var h=new t.math.Color;h.a=this.data.color[n].a,h.r=this.data.color[n].r,h.g=this.data.color[n].g,h.b=this.data.color[n].b,o.color.push(h)}}if(void 0!=this.data.normal){o.normal=[];for(var n=0;n<this.data.normal.length;n++){var l=new t.math.Vector3;l.x=this.data.normal[n].x,l.y=this.data.normal[n].y,l.z=this.data.normal[n].z,o.normal.push(l)}}if(void 0!=this.data.uv){o.uv=[];for(var n=0;n<this.data.uv.length;n++){var c=new t.math.Vector2;c.x=this.data.uv[n].x,c.y=this.data.uv[n].y,o.uv.push(c)}}if(void 0!=this.data.uv2){o.uv2=[];for(var n=0;n<this.data.uv2.length;n++){var c=new t.math.Vector2;c.x=this.data.uv2[n].x,c.y=this.data.uv2[n].y,o.uv2.push(c)}}if(void 0!=this.data.tangent){o.tangent=[];for(var n=0;n<this.data.tangent.length;n++){var u=new t.math.Vector3;u.x=this.data.tangent[n].x,u.y=this.data.tangent[n].y,u.z=this.data.tangent[n].z,o.tangent.push(u)}}if(void 0!=this.data.blendIndex){o.blendIndex=[];for(var n=0;n<this.data.blendIndex.length;n++){var d=new t.render.Number4;d.v0=this.data.blendIndex[n].v0,d.v1=this.data.blendIndex[n].v1,d.v2=this.data.blendIndex[n].v2,d.v3=this.data.blendIndex[n].v3,o.blendIndex.push(d)}}if(void 0!=this.data.blendWeight){o.blendWeight=[];for(var n=0;n<this.data.blendWeight.length;n++){var p=new t.render.Number4;p.v0=this.data.blendWeight[n].v0,p.v1=this.data.blendWeight[n].v1,p.v2=this.data.blendWeight[n].v2,p.v3=this.data.blendWeight[n].v3,o.blendWeight.push(p)}}e.submesh=[];for(var n=0;n<this.submesh.length;n++){var m=new r;m.start=this.submesh[n].start,m.size=this.submesh[n].size,m.matIndex=n,e.submesh.push(m)}o.trisindex=this.data.trisindex.slice(),e.data=o,e.glMesh=new t.render.GlMesh;var f=e.data.genVertexDataArray(a),v=e.data.genIndexDataArray(),_=t.render.Webglkit.webgl;return e.glMesh.initBuffer(_,a,this.data.pos.length),e.glMesh.uploadVertexSubData(_,f),e.glMesh.addIndex(_,v.length),e.glMesh.uploadIndexSubData(_,0,v),e},a=i=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],a);var i}(e.Asset);e.Mesh=a,__reflect(a.prototype,"egret3d.framework.Mesh")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.once=0]="once",t[t.loop=1]="loop",t[t.pingpong=2]="pingpong"}(r=e.pathtype||(e.pathtype={}));var a;!function(t){t[t.VertexPoint=0]="VertexPoint",t[t.ControlPoint=1]="ControlPoint"}(a||(a={}));var i=function(e){function i(t){var r=e.call(this,t,"path")||this;return r.paths=[],r.items=[],r.lines=[],r}return __extends(i,e),i.prototype.dispose=function(){this.paths.length=0},i.prototype.caclByteLength=function(){if(this.paths){var t=this.paths.length,e=12*t;return e}},i.prototype.Parse=function(e){var i=e.type;switch(i){case"once":this.type=r.once;break;case"loop":this.type=r.loop;break;case"pingpong":this.type=r.pingpong}this.instertPointcount=e.insertPointcount;var o=e.path;for(var n in o){var s={type:void 0,point:void 0},h=o[n],l=h.type;switch(l){case"VertexPoint":s.type=a.VertexPoint;break;case"ControlPoint":s.type=a.ControlPoint}var c=h.point,u=c.split(",");s.point=new t.math.Vector3(parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])),this.items.push(s)}this.getpaths(),this.items.length=0;for(var d=0;d<this.lines.length;d++)this.lines[d].length=0;this.lines.length=0},i.prototype.getpaths=function(){for(var t=new Array,e=0;e<this.items.length;e++){var i=this.items[e];0==e?(t.push(i.point),this.lines.push(t)):e==this.items.length-1?this.type==r.loop?i.type==a.VertexPoint?(t.push(i.point),t=new Array,t.push(i.point),t.push(this.items[0].point),this.lines.push(t)):(t.push(i.point),t.push(this.items[0].point)):t.push(i.point):i.type==a.VertexPoint?(t.push(i.point),t=new Array,t.push(i.point),this.lines.push(t)):t.push(i.point)}for(var o=this.lines.length,n=0,e=0;o>e;e++)if(e==o-1)for(var s=0;s<this.instertPointcount;s++){var h=s/(this.instertPointcount-1);this.paths[n]=this.getBezierPointAlongCurve(this.lines[e],h),n++}else for(var s=0;s<this.instertPointcount;s++){var h=s/this.instertPointcount;this.paths[n]=this.getBezierPointAlongCurve(this.lines[e],h),n++}},i.prototype.getBezierPointAlongCurve=function(e,r,a){void 0===a&&(a=!1);var i=e.length;if(e.length<2)return void console.log("need more than 2 point to calculate bezier!");if(2==i){var o=new t.math.Vector3;return this.vec3Lerp(e[0],e[1],r,o),a&&(e.length=0),o}for(var n=[],s=0;i-1>s;s++){var h=t.math.Pool.new_vector3();this.vec3Lerp(e[s],e[s+1],r,h),n[s]=h}return a&&(e.length=0),this.getBezierPointAlongCurve(n,r,!0)},i.prototype.vec3Lerp=function(e,r,a,i){t.math.vec3Subtract(r,e,i),t.math.vec3ScaleByNum(i,a,i),t.math.vec3Add(e,i,i)},i=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],i)}(e.Asset);e.Pathasset=i,__reflect(i.prototype,"egret3d.framework.Pathasset")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(r){function a(t){var e=r.call(this,t,"prefab")||this;return e.assetbundle=null,e}return __extends(a,r),a.prototype.dispose=function(){this.trans.dispose(),this.jsonstr=null},a.prototype.caclByteLength=function(){var t=0;return t},a.prototype.getCloneTrans=function(){return t.io.cloneObj(this.trans)},a.prototype.apply=function(t){this.trans=t},a.prototype.Parse=function(r){r=r.replace(/localRotate/g,"localRotation"),r=r.replace(/localTranslate/g,"localPosition"),this.jsonstr=r,this.trans=new e.Transform,t.io.deSerialize(JSON.parse(r),this.trans,this.assetbundle)},a=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],a)}(e.Asset);e.Prefab=r,__reflect(r.prototype,"egret3d.framework.Prefab")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(r){function a(t){var e=r.call(this,t,"rawscene")||this;return e.assetbundle=null,e}return __extends(a,r),a.prototype.caclByteLength=function(){var t=0;return t},a.prototype.Parse=function(r){r=r.replace(/localRotate/g,"localRotation"),r=r.replace(/localTranslate/g,"localPosition");var a=JSON.parse(r);this.rootNode=new e.Transform,this.rootNode.name=this.getName(),t.io.deSerialize(a.rootNode,this.rootNode,this.assetbundle),this.lightmaps=[];for(var i=a.lightmap,o=i.length,n=0;o>n;n++)if(null==i[n])this.lightmaps.push(null);else{var s=i[n].name,h=e.AssetMap.find(s,this.assetbundle);h.use(),this.lightmaps.push(h)}},a.prototype.getSceneRoot=function(){return t.io.cloneObj(this.rootNode)},a.prototype.useLightMap=function(t){t.lightmaps.length=0;for(var e=0;e<this.lightmaps.length;e++)t.lightmaps.push(this.lightmaps[e])},a.prototype.dispose=function(){this.rootNode&&this.rootNode.dispose();for(var t in this.lightmaps)this.lightmaps[t].unuse(!0)},a=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],a)}(e.Asset);e.Rawscene=r,__reflect(r.prototype,"egret3d.framework.Rawscene")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(e){var r={},a=e.split(";");for(var i in a){var o=a[i].split("\n");for(var n in o){var s=o[n],h=s.match(new RegExp("([_a-zA-Z0-9]+)|([/=;]+)","g"));if(null!=h&&h.length>=3&&"uniform"==h[0]){var l=h[1],c=h[2];switch(("highp"==l||"lowp"==l||"mediump"==l)&&(l=h[2],c=h[3]),l){case"sampler2D":r[c]=t.render.UniformTypeEnum.Texture;break;case"float":s.indexOf("[")>=0&&s.indexOf("]")>=0?r[c]=t.render.UniformTypeEnum.Floatv:r[c]=t.render.UniformTypeEnum.Float;break;case"vec4":s.indexOf("[")>=0&&s.indexOf("]")>=0?r[c]=t.render.UniformTypeEnum.Float4v:r[c]=t.render.UniformTypeEnum.Float4;break;case"mat4":s.indexOf("[")>=0&&s.indexOf("]")>=0?r[c]=t.render.UniformTypeEnum.Float4x4v:r[c]=t.render.UniformTypeEnum.Float4x4;break;default:throw new Error("uniform type:"+l+" not defined.")}}}}return r},a=function(a){function i(t){var r=a.call(this,t,"shader")||this;return r.passes={},r.defaultValue={},r.layer=e.RenderLayerEnum.Common,r.queue=0,r}return __extends(i,a),o=i,i.registerVertShader=function(t,e){var a={name:t,src:e,uniforms:r(e)};return this._vertShaderInfoMap[t]=a,a},i.registerFragShader=function(t,e){var a={name:t,src:e,uniforms:r(e)};return this._fragShaderInfoMap[t]=a,a},i.prototype.dispose=function(){},i.prototype.caclByteLength=function(){var t=0;return t},i.prototype.parse=function(t){if(this._parseProperties(t.properties),t.layer){var r=t.layer;"transparent"==r?this.layer=e.RenderLayerEnum.Transparent:"overlay"==r?this.layer=e.RenderLayerEnum.Overlay:"common"==r&&(this.layer=e.RenderLayerEnum.Common)}t.queue&&(this.queue=t.queue);var a=t.passes;this.passes={};for(var i in a){var o=a[i];if("base"==i||"lightmap"==i||"skin"==i||"quad"==i);else if(0!=i.indexOf("base_")&&0!=i.indexOf("lightmap_")&&0!=i.indexOf("skin_"))continue;this.passes[i]=[];for(var n=0;n<o.length;n++)this.passes[i].push(this._parsePass(o[n]))}if(void 0==this.passes.base)throw new Error("do not have base pass group.")},i.prototype._parseProperties=function(r){this.defaultValue={};for(var a in r){var i=r[a],o=i.match(e.RegexpUtil.floatRegexp);if(null==o&&(o=i.match(e.RegexpUtil.rangeRegexp)),null==o&&(o=i.match(e.RegexpUtil.vectorRegexp)),null==o&&(o=i.match(e.RegexpUtil.textureRegexp)),null==o)return void console.error(this.getName()+" property error! info:\n"+i);if(null!=o&&o.length>=4){var n=o[1],s=(o[2],o[3].toLowerCase());switch(s){case"float":this.defaultValue[n]={type:s,value:parseFloat(o[4])};break;case"range":this.defaultValue[n]={type:s,min:parseFloat(o[4]),max:parseFloat(o[5]),value:parseFloat(o[6])};break;case"vector":case"color":var h=new t.math.Vector4(parseFloat(o[4]),parseFloat(o[5]),parseFloat(o[6]),parseFloat(o[7]));this.defaultValue[n]={type:s,value:h};break;case"texture":this.defaultValue[n]={type:s,defaultValue:e.AssetMap.find(o[4])};break;default:alert(this.getName()+" property error! unknown type : "+s)}}}},i.prototype._parsePass=function(r){var a=o._vertShaderInfoMap[r.vs];a||console.error("vertex shader "+r.vs+" not found!");var i=o._fragShaderInfoMap[r.fs];i||console.error("fragment shader "+r.fs+" not found!");var n=new t.render.GlDrawPass(a,i);switch(r.showface){case"cw":n.state_showface=t.render.ShowFaceStateEnum.CW;break;case"ccw":n.state_showface=t.render.ShowFaceStateEnum.CCW;break;default:n.state_showface=t.render.ShowFaceStateEnum.ALL}var s=t.render.BlendModeEnum.Close;switch(r.zwrite){case"off":n.state_zwrite=!1;break;case"on":default:n.state_zwrite=!0}switch(n.state_ztest=!0,r.ztest){case"greater":n.state_ztest_method=t.render.Webglkit.GREATER;break;case"gequal":n.state_ztest_method=t.render.Webglkit.GEQUAL;break;case"less":n.state_ztest_method=t.render.Webglkit.LESS;break;case"equal":n.state_ztest_method=t.render.Webglkit.EQUAL;break;case"notequal":n.state_ztest_method=t.render.Webglkit.NOTEQUAL;break;case"always":case"off":n.state_ztest=!1;break;case"never":n.state_ztest_method=t.render.Webglkit.NEVER;break;case"lequal":default:n.state_ztest_method=t.render.Webglkit.LEQUAL}switch(r.blendmode){case"add":s=t.render.BlendModeEnum.Add;break;case"addpremult":s=t.render.BlendModeEnum.Add_PreMultiply;break;case"blend":s=t.render.BlendModeEnum.Blend;break;case"blendpremult":s=t.render.BlendModeEnum.Blend_PreMultiply}return n.setAlphaBlend(s),this.layer==e.RenderLayerEnum.Overlay&&(n.state_ztest=!0,n.state_zwrite=!0,n.state_ztest_method=t.render.Webglkit.ALWAYS),n},i._vertShaderInfoMap={},i._fragShaderInfoMap={},i=o=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],i);var o}(e.Asset);e.Shader=a,__reflect(a.prototype,"egret3d.framework.Shader")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(e){function r(t){return e.call(this,t,"sound")||this}return __extends(r,e),r.prototype.dispose=function(){this.buffer=null},r.prototype.caclByteLength=function(){return this.buffer?this.buffer.length:void 0},r=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],r)}(e.Asset);e.Sound=r,__reflect(r.prototype,"egret3d.framework.Sound")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(e){function r(t){return e.call(this,t,"sprite")||this}return __extends(r,e),r.prototype.dispose=function(){null!=this.texture&&this.texture.unuse(!0)},r.prototype.caclByteLength=function(){var t=0;return this._texture&&(t+=this._texture.caclByteLength()),t},Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(t){null!=this._texture&&this._texture.unuse(),this._texture=t,this._texture.use()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"urange",{get:function(){return null==this._urange&&(this._urange=new t.math.Vector2,this._urange.x=this.rect.x/this._texture.glTexture.width,this._urange.y=(this.rect.x+this.rect.w)/this._texture.glTexture.width),this._urange},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"vrange",{get:function(){return null==this._vrange&&(this._vrange=new t.math.Vector2,this._vrange.x=this.rect.y/this._texture.glTexture.height,this._vrange.y=(this.rect.y+this.rect.h)/this._texture.glTexture.height),this._vrange},enumerable:!0,configurable:!0}),r=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],r)}(e.Asset);e.Sprite=r,__reflect(r.prototype,"egret3d.framework.Sprite")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(e){function r(t){return e.call(this,t,"text")||this}return __extends(r,e),r.prototype.dispose=function(){null==this.content},r.prototype.caclByteLength=function(){return this.content?t.math.caclStringByteLength(this.content):void 0},r=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],r)}(e.Asset);e.Textasset=r,__reflect(r.prototype,"egret3d.framework.Textasset")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(e){function r(t){return e.call(this,t,"texture")||this}return __extends(r,e),r.prototype.dispose=function(){this.glTexture.dispose(t.render.Webglkit.webgl)},r.prototype.caclByteLength=function(){return this.glTexture?this.glTexture.caclByteLength():void 0},Object.defineProperty(r.prototype,"realName",{get:function(){return this._realName},set:function(t){this._realName=t},enumerable:!0,configurable:!0}),r=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[String])],r)}(e.Asset);e.Texture=r,__reflect(r.prototype,"egret3d.framework.Texture")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function e(){var t=window,e=t.AudioContext||t.webkitAudioContext||t.mozAudioContext||t.msAudioContext;e?(this._audioContext=new e,console.log("AudioContext inited --> "),console.log(this._audioContext)):console.warn("!Your browser does not support AudioContext")}return Object.defineProperty(e,"instance",{get:function(){return this._instance||(this._instance=new e),this._instance},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"audioContext",{get:function(){return this._audioContext},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSupported",{get:function(){return!!this._audioContext},enumerable:!0,configurable:!0}),e.prototype.active=function(){if(this.isSupported){var t=this._audioContext.createBuffer(1,1,22050),e=this._audioContext.createBufferSource();e.buffer=t,e.connect(this._audioContext.destination),e.start()}},e.prototype.decodeAudioData=function(t,e,r){this._audioContext.decodeAudioData(t,function(t){return e(t)},function(){return r()})},e.prototype.getAudioListener=function(){return this.audioListener||(this.audioListener=new t.WebAudioListener),this.audioListener},e}();t.WebAudio=e,__reflect(e.prototype,"egret3d.sound.WebAudio")}(e=t.sound||(t.sound={}))}(egret3d||(egret3d={}));var RES;!function(t){var e;!function(e){function r(t){for(var e=t.lastIndexOf("/"),r=t.substr(e+1),a=r.indexOf(".",0),i=null;a>=0;){if(i=r.substr(a),".vs.glsl"==i)return h.GLVertexShader;if(".assetbundle.json"==i)return h.Bundle;if(".fs.glsl"==i)return h.GLFragmentShader;if(".shader.json"==i)return h.Shader;if(".png"==i||".jpg"==i)return h.Texture;if(".pvr.bin"==i||".pvr"==i)return h.PVR;if(".imgdesc.json"==i)return h.TextureDesc;if(".mat.json"==i)return h.Material;if(".mesh.bin"==i)return h.Mesh;if(".aniclip.bin"==i)return h.Aniclip;if(".prefab.json"==i)return h.Prefab;if(".scene.json"==i)return h.Scene;if(".atlas.json"==i)return h.Atlas;if(".font.json"==i)return h.Font;if(".json"==i||".txt"==i||".effect.json"==i)return h.TextAsset;if(".packs.bin"==i)return h.PackBin;if(".packs.txt"==i)return h.PackTxt;if(".path.json"==i)return h.pathAsset;if(".mp3"==i||".ogg"==i)return h.Sound;a=r.indexOf(".",a+1)}return h.Unknown}function a(t){var e=t.lastIndexOf("/"),r=t.substr(e+1);return r}function i(e){return t.resourceRoot+e}function o(t){for(var e=[],a=[],i=[],o=[],n=[],s=[],l=[],c=[],u=[],d=[],p=[],m=[],f={},v=0;v<t.files.length;v++){var _=t.files[v],g=r(_.name),y=t.path+"/"+_.name;switch(-1!=_.packes&&(f[y]=_.packes),g){case h.GLFragmentShader:a.push(y);break;case h.GLVertexShader:e.push(y);break;case h.Shader:i.push(y);break;case h.Texture:n.push(y);break;case h.TextureDesc:s.push(y);break;case h.Mesh:o.push(y);break;case h.Material:l.push(y);break;case h.Aniclip:c.push(y);break;case h.Prefab:u.push(y);break;case h.Scene:d.push(y);break;case h.TextAsset:p.push(y);break;case h.PVR:m.push(y)}}for(var w=[],v=0;v<t.packages.length;v++){var x=t.packages[v],g=this.calcType(x),y=t.path+"/"+x;w.push({url:y,type:g})}for(var v=0;v<e.length;v++)w.push({url:e[v],type:h.GLVertexShader});for(var v=0;v<a.length;v++)w.push({url:a[v],type:h.GLFragmentShader});for(var v=0;v<i.length;v++)w.push({url:i[v],type:h.Shader});for(var v=0;v<n.length;v++)w.push({url:n[v],type:h.Texture});for(var v=0;v<s.length;v++)w.push({url:s[v],type:h.TextureDesc});for(var v=0;v<o.length;v++)w.push({url:o[v],type:h.Mesh});for(var v=0;v<l.length;v++)w.push({url:l[v],type:h.Material});for(var v=0;v<c.length;v++)w.push({url:c[v],type:h.Aniclip});for(var v=0;v<u.length;v++)w.push({url:u[v],type:h.Prefab});for(var v=0;v<d.length;v++)w.push({url:d[v],type:h.Scene});for(var v=0;v<p.length;v++)w.push({url:p[v],type:h.TextAsset});return w}function n(e,r){return __awaiter(this,void 0,void 0,function(){var a=this;return __generator(this,function(i){return[2,new Promise(function(i,o){var n=function(){var t=e.data?e.data:e.response;i(t)},s=function(){var e=new t.ResourceManagerError(1001,r.url);o(e)};e.addEventListener(egret.Event.COMPLETE,n,a),e.addEventListener(egret.IOErrorEvent.IO_ERROR,s,a)})]})})}function s(e,r){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,new Promise(function(a,i){var o=function(t){a(t)
},n=function(){var e=new t.ResourceManagerError(1001,r.url);i(e)};egret3d.sound.WebAudio.instance.decodeAudioData(e,o,n)})]})})}var h;!function(t){t[t.Unknown=0]="Unknown",t[t.Auto=1]="Auto",t[t.Bundle=2]="Bundle",t[t.CompressBundle=3]="CompressBundle",t[t.GLVertexShader=4]="GLVertexShader",t[t.GLFragmentShader=5]="GLFragmentShader",t[t.Shader=6]="Shader",t[t.Texture=7]="Texture",t[t.TextureDesc=8]="TextureDesc",t[t.Mesh=9]="Mesh",t[t.Prefab=10]="Prefab",t[t.Material=11]="Material",t[t.Aniclip=12]="Aniclip",t[t.Scene=13]="Scene",t[t.Atlas=14]="Atlas",t[t.Font=15]="Font",t[t.TextAsset=16]="TextAsset",t[t.PackBin=17]="PackBin",t[t.PackTxt=18]="PackTxt",t[t.pathAsset=19]="pathAsset",t[t.PVR=20]="PVR",t[t.Sound=21]="Sound"}(h=e.AssetTypeEnum||(e.AssetTypeEnum={})),e.BundleProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var n,s,l,c,u,d,p,m,f,v;return __generator(this,function(_){switch(_.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:n=_.sent(),s=egret3d.render.Webglkit.webgl,l=i(r.url),c=a(l),u=new egret3d.framework.AssetBundle(c),u.url=l,u.path=r.url.substring(0,r.url.lastIndexOf("/")),u.parse(JSON.parse(n)),egret3d.framework.AssetMap.registerBundle(c,u),d=o(u),p=0,_.label=2;case 2:return p<d.length?(m=t.host.resourceConfig.getResource(d[p].url),m?[4,e.load(m)]:[3,4]):[3,5];case 3:f=_.sent(),v=a(d[p].url),d[p].type!==h.GLVertexShader&&d[p].type!==h.GLFragmentShader&&(u.mapNamed[v]=f.getGUID(),(d[p].type==h.Prefab||d[p].type==h.Scene)&&(f.assetbundle=u.getName())),_.label=4;case 4:return p++,[3,2];case 5:return[2,u]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r,a;return __generator(this,function(i){r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregisterBundle(r.getName());for(a in r.mapNamed)r.find(a).dispose&&r.find(a).dispose();return[2]})})}},e.GLVertexShaderProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l;return __generator(this,function(c){switch(c.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=c.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),[2,egret3d.framework.Shader.registerVertShader(l,o)]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var t,r,o,n;return __generator(this,function(s){return t=egret3d.render.Webglkit.webgl,r=i(e.url),o=a(r),n=o.substring(0,o.indexOf(".")),[2]})})}},e.GLFragmentShaderProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l;return __generator(this,function(c){switch(c.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=c.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),[2,egret3d.framework.Shader.registerFragShader(l,o)]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var t,r,o,n;return __generator(this,function(s){return t=egret3d.render.Webglkit.webgl,r=i(e.url),o=a(r),n=o.substring(0,o.indexOf(".")),[2]})})}},e.ShaderProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Shader(h),c.parse(JSON.parse(o)),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.D3PVRProcessor={onLoadStart:function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})}},e.TextureDescProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,s,h,l,c,u,d,p,m,f,v,_,g,y,w,x,b,D,T;return __generator(this,function(E){switch(E.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=E.sent(),s=egret3d.render.Webglkit.webgl,h=i(r.url),l=a(h),c=l.substring(0,l.indexOf(".")),u=JSON.parse(o),d=u.name,p=u.filterMode,m=u.format,f=u.mipmap,v=u.wrap,d.indexOf("LightmapFar")>=0&&console.log(""),_=egret3d.render.TextureFormatEnum.RGBA,"RGB"==m?_=egret3d.render.TextureFormatEnum.RGB:"Gray"==m&&(_=egret3d.render.TextureFormatEnum.Gray),g=!0,p.indexOf("linear")<0&&(g=!1),y=!1,v.indexOf("Repeat")>=0&&(y=!0),w=h.replace(l,d),x=new egret.ImageLoader,x.load(w),[4,n(x,r)];case 2:return b=E.sent(),D=new egret3d.framework.Texture(l),D.realName=d,D.url=h,T=new egret3d.render.GlTexture2D(s,_),T.uploadImage(b.source,f,g,!0,y),D.glTexture=T,egret3d.framework.AssetMap.register(D),[2,D]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.TextureProcessor={onLoadStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var t,r,o,s,h,l,c,u,d;return __generator(this,function(p){switch(p.label){case 0:return t=egret3d.render.Webglkit.webgl,r=i(e.url),o=a(r),s=o.substring(0,o.indexOf(".")),h=new egret.ImageLoader,h.load(r),[4,n(h,e)];case 1:return l=p.sent(),c=new egret3d.framework.Texture(o),c.url=r,u=egret3d.render.TextureFormatEnum.RGBA,d=new egret3d.render.GlTexture2D(t,u),d.uploadImage(l.source,!0,!0,!0,!0),c.glTexture=d,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.MaterialProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Material(h),c.Parse(JSON.parse(o)),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.MeshProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.BinaryProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Mesh(h),c.Parse(o,n),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.AniclipProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.BinaryProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.AnimationClip(h),c.Parse(o),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.AtlasProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Atlas(h),c.Parse(o),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.PrefabProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Prefab(h),c.Parse(o),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.SceneProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Rawscene(h),c.Parse(o),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.D3FontProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Font(h),c.Parse(o),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.Sound3DProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,h,l,c,u,d;return __generator(this,function(p){switch(p.label){case 0:return[4,e.load(r,t.processor.BinaryProcessor)];case 1:return o=p.sent(),n=egret3d.render.Webglkit.webgl,h=i(r.url),l=a(h),c=l.substring(0,l.indexOf(".")),[4,s(o,r)];case 2:return u=p.sent(),d=new egret3d.framework.Sound(l),d.buffer=u,d.url=h,egret3d.framework.AssetMap.register(d),[2,d]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.TextAssetProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Textasset(h),c.content=o,c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},e.PathAssetProcessor={onLoadStart:function(e,r){return __awaiter(this,void 0,void 0,function(){var o,n,s,h,l,c;return __generator(this,function(u){switch(u.label){case 0:return[4,e.load(r,t.processor.TextProcessor)];case 1:return o=u.sent(),n=egret3d.render.Webglkit.webgl,s=i(r.url),h=a(s),l=h.substring(0,h.indexOf(".")),c=new egret3d.framework.Pathasset(h),c.Parse(JSON.parse(o)),c.url=s,egret3d.framework.AssetMap.register(c),[2,c]}})})},onRemoveStart:function(t,e){return __awaiter(this,void 0,void 0,function(){var r;return __generator(this,function(a){return r=t.get(e),r.dispose(),egret3d.framework.AssetMap.unregister(r),[2]})})}},t.processor.map("GLVertexShader",e.GLVertexShaderProcessor),t.processor.map("GLFragmentShader",e.GLFragmentShaderProcessor),t.processor.map("Shader",e.ShaderProcessor),t.processor.map("Bundle",e.BundleProcessor),t.processor.map("Texture",e.TextureProcessor),t.processor.map("TextureDesc",e.TextureDescProcessor),t.processor.map("PVR",e.D3PVRProcessor),t.processor.map("Material",e.MaterialProcessor),t.processor.map("Mesh",e.MeshProcessor),t.processor.map("Aniclip",e.AniclipProcessor),t.processor.map("Prefab",e.PrefabProcessor),t.processor.map("Scene",e.SceneProcessor),t.processor.map("Atlas",e.AtlasProcessor),t.processor.map("Font",e.D3FontProcessor),t.processor.map("TextAsset",e.TextAssetProcessor),t.processor.map("pathAsset",e.PathAssetProcessor),t.processor.map("Sound",e.Sound3DProcessor)}(e=t.processor||(t.processor={}))}(RES||(RES={}));var egret3d;!function(t){var e;!function(e){var r=function(r){function a(){var e=null!==r&&r.apply(this,arguments)||this;return e.position=new t.math.Vector3,e.velocity=new t.math.Vector3,e}return __extends(a,r),a.prototype._init=function(){var t=e.WebAudio.instance.audioContext;this.source=t.createBufferSource(),this.panner=t.createPanner(),this.gain=t.createGain(),this.source.connect(this.panner),this.panner.connect(this.gain),this.gain.connect(t.destination)},Object.defineProperty(a.prototype,"maxDistance",{get:function(){return this.panner.maxDistance},set:function(t){this.panner.maxDistance=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"minDistance",{get:function(){return this.panner.refDistance},set:function(t){this.panner.refDistance=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"rollOffFactor",{get:function(){return this.panner.rolloffFactor},set:function(t){this.panner.rolloffFactor=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"distanceModel",{get:function(){return this.panner.distanceModel},set:function(t){"linear"===t||"inverse"===t||"exponential"===t?this.panner.distanceModel=t:console.warn("distanceModel: "+t+" Is not a valid parameter")},enumerable:!0,configurable:!0}),a.prototype.setPosition=function(t,e,r){this.position.x=t,this.position.y=e,this.position.z=r,this.panner.setPosition(t,e,r)},a.prototype.getPosition=function(){return this.position},a.prototype.setVelocity=function(t,e,r){this.position.x=t,this.position.y=e,this.position.z=r,this.panner.setVelocity(t,e,r)},a.prototype.getVelocity=function(){return this.velocity},a}(e.WebAudioChannel2D);e.WebAudioChannel3D=r,__reflect(r.prototype,"egret3d.sound.WebAudioChannel3D")}(e=t.sound||(t.sound={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.position=new t.math.Vector3,this.velocity=new t.math.Vector3,this.orientation=new t.math.Matrix,this.listener=e.WebAudio.instance.audioContext.listener}return r.prototype.setPosition=function(t,e,r){this.position.x=t,this.position.y=e,this.position.z=r,this.listener.setPosition(t,e,r)},r.prototype.getPosition=function(){return this.position},r.prototype.setVelocity=function(t,e,r){this.velocity.x=t,this.velocity.y=e,this.velocity.z=r,this.listener.setVelocity(t,e,r)},r.prototype.getVelocity=function(){return this.velocity},r.prototype.setOrientation=function(e){t.math.matrixClone(e,this.orientation),this.listener.setOrientation(-e.rawData[8],-e.rawData[9],-e.rawData[10],e.rawData[4],e.rawData[5],e.rawData[6])},r.prototype.getOrientation=function(){return this.orientation},r}();e.WebAudioListener=r,__reflect(r.prototype,"egret3d.sound.WebAudioListener")}(e=t.sound||(t.sound={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){}return __decorate([t.reflect.Field("string"),__metadata("design:type",String)],e.prototype,"name",void 0),__decorate([t.reflect.Field("Vector3"),__metadata("design:type",t.math.Vector3)],e.prototype,"tposep",void 0),__decorate([t.reflect.Field("Quaternion"),__metadata("design:type",t.math.Quaternion)],e.prototype,"tposeq",void 0),e=__decorate([t.reflect.SerializeType],e)}();e.TPoseInfo=r,__reflect(r.prototype,"egret3d.framework.TPoseInfo");var a;!function(t){t[t.NormalPlay=0]="NormalPlay",t[t.FramePlay=1]="FramePlay",t[t.PingPang=2]="PingPang"}(a=e.PlayStyle||(e.PlayStyle={}));var i=function(){function r(){this._clipnameCount=0,this._clipnames=null,this.autoplay=!0,this.playIndex=0,this._playClip=null,this.tpose={},this.nowpose={},this.lerppose={},this.carelist={},this._playFrameid=0,this._playTimer=0,this.speed=1,this.crossdelta=0,this.crossspeed=0,this.beRevert=!1,this.playStyle=a.NormalPlay,this.percent=0,this.mix=!1,this.isCache=!1}return i=r,Object.defineProperty(r.prototype,"clipnames",{get:function(){if(null==this._clipnames||this._clipnameCount!=this.clips.length){this._clipnameCount=this.clips.length,this._clipnames={};for(var t in this.clips)this.clipnames[this.clips[t].getName()]=parseInt(t)}return this._clipnames},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"cacheKey",{get:function(){return this._playClip?this._playClip.getGUID()+"_"+this._playFrameid:this._playFrameid},enumerable:!0,configurable:!0}),r.prototype.init=function(){for(var t=0;t<this.bones.length;t++){var r=this.bones[t],a=r.name,i=new e.PoseBoneMatrix;i.r=r.tposeq,i.t=r.tposep,i.invert(),this.tpose[a]=i,this.nowpose[a]=this.startPos[t].Clone()}var o=this.gameObject.getComponentsInChildren("Asbone");for(var n in o)this.care(o[n].gameObject.transform);this.autoplay&&null!=this.clips&&this.clips.length>0&&this.playByIndex(this.playIndex)},r.prototype.start=function(){null!=this.bones&&this.init()},r.prototype.update=function(r){if(null!=this._playClip){this.checkFrameId(r),this.mix=!1,this.crossdelta>0&&(this.crossdelta-=r/this.speed*this.crossspeed,this.mix=!0);var a=!1;if(this.isCache&&!this.mix&&i.playerCaches[this.cacheKey]){if(a=!0,!this.carelist)return;var o=0;for(var n in this.carelist)o++;if(0==o)return}for(var s=0;s<this._playClip.boneCount;s++){var h=this._playClip.bones[s];if(!a||this.carelist[h]){var l=this._playClip.frames[this._playFrameid],c=7*s+1,u=this.nowpose[h],d=this.tpose[h];if(void 0!=u)if(this.mix){var p=this.lerppose[h];void 0!=p?u.lerpInWorldWithData(d,p,l,c,1-this.crossdelta):u.copyFromData(l,c)}else u.copyFromData(l,c);var m=this.carelist[h];if(void 0!=m){var f=e.PoseBoneMatrix.sMultiply(u,d),v=this.gameObject.transform,_=t.math.Pool.new_vector3(),g=t.math.Pool.new_quaternion();t.math.vec3Add(v.getPosition(),f.t,_),t.math.quatMultiply(f.r,v.getRotation(),g),v.setPosition(_),v.setRotation(g),t.math.Pool.delete_vector3(_),t.math.Pool.delete_quaternion(g)}}}a||(i.playerCaches[this.cacheKey]=this)}},r.prototype.playByIndex=function(t,e,r){return void 0===e&&(e=1),void 0===r&&(r=!1),this.playIndex=t,this.clips.length<=t?void console.error("animIndex out Array of clips"):(this.playAniamtion(t.toString(),e,r),void(this.crossdelta=0))},r.prototype.playCrossByIndex=function(t,e,r,a){return void 0===r&&(r=1),void 0===a&&(a=!1),this.playIndex=t,this.clips.length<=t?void console.error("animIndex out Array of clips"):(this.playAniamtion(t.toString(),r,a),this.crossspeed=1/e,void(this.crossdelta=1))},r.prototype.play=function(t,e,r){return void 0===e&&(e=1),void 0===r&&(r=!1),null==this.clipnames[t]?void console.error("animclip "+this.gameObject.transform.name+"  "+t+" is not exist"):void this.playByIndex(this.clipnames[t],e,r)},r.prototype.playCross=function(t,e,r,a){return void 0===r&&(r=1),void 0===a&&(a=!1),null==this.clipnames[t]?void console.error("animclip "+this.gameObject.transform.name+"  "+t+" is not exist"):void(0>=e?this.playByIndex(this.clipnames[t],r,a):this.playCrossByIndex(this.clipnames[t],e,r,a))},r.prototype.playAniamtion=function(t,e,r){if(void 0===e&&(e=1),void 0===r&&(r=!1),void 0!=this.clips[t]){this._playClip=this.clips[t],this._playTimer=0,this._playFrameid=0,this.speed=e,this.beRevert=r,this.playStyle=a.NormalPlay,this.speed=e,this.lerppose={};for(var i in this.nowpose){var o=this.nowpose[i];this.lerppose[i]=o.Clone()}}},r.prototype.stop=function(){this._playClip=null},r.prototype.isPlay=function(){return null!=this._playClip},r.prototype.isStop=function(){return null==this._playClip?!1:this.playStyle!=a.NormalPlay?!1:this._playClip.loop?!1:this._playFrameid==this._playClip.frameCount-1?!0:!1},r.prototype.remove=function(){this.clips.length=0,this.bones.length=0,this.startPos.length=0,delete this.tpose,delete this.nowpose,delete this.lerppose,delete this.carelist,delete this._clipnames},r.prototype.clone=function(){},r.prototype.addFinishedEventListener=function(t,e){this.finishCallBack=t,this.thisObject=e},r.prototype.checkFrameId=function(t){this.playStyle==a.NormalPlay?(this._playTimer+=t*this.speed,this._playFrameid=this._playClip.fps*this._playTimer|0,this._playClip.loop?this._playFrameid%=this._playClip.frameCount:this._playFrameid>this._playClip.frameCount-1&&(this._playFrameid=this._playClip.frameCount-1),this.beRevert&&(this._playFrameid=this._playClip.frameCount-this._playFrameid-1)):this.playStyle==a.FramePlay&&(this._playFrameid=this._playClip.frameCount*this.percent-1,this._playFrameid=Math.round(this._playFrameid)),this._playFrameid<0&&(this._playFrameid=0),this._playFrameid>this._playClip.frameCount-1&&(this._playFrameid=this._playClip.frameCount-1),this.isStop()&&this.finishCallBack&&(this.finishCallBack(this.thisObject),this.finishCallBack=null,this.thisObject=null)},r.prototype.fillPoseData=function(e,r,a){void 0===a&&(a=!0);var i=0;for(var o in r){var n=r[o].name,s=this.nowpose[n];if(void 0==s)a?(e[8*i+0]=0,e[8*i+1]=0,e[8*i+2]=0,e[8*i+3]=1,e[8*i+4]=0,e[8*i+5]=0,e[8*i+6]=0,e[8*i+7]=1):(e[16*i+0]=1,e[16*i+1]=0,e[16*i+2]=0,e[16*i+3]=0,e[16*i+4]=0,e[16*i+5]=1,e[16*i+6]=0,e[16*i+7]=0,e[16*i+8]=0,e[16*i+9]=0,e[16*i+10]=1,e[16*i+11]=0,e[16*i+12]=0,e[16*i+13]=0,e[16*i+14]=0,e[16*i+15]=1);else{var h=t.math.Pool.new_matrix();if(a)e[8*i+0]=s.r.x,e[8*i+1]=s.r.y,e[8*i+2]=s.r.z,e[8*i+3]=s.r.w,e[8*i+4]=s.t.x,e[8*i+5]=s.t.y,e[8*i+6]=s.t.z,e[8*i+7]=1;else{t.math.matrixMakeTransformRTS(s.t,t.math.Pool.vector3_one,s.r,h);for(var l=0;16>l;l++)e[16*i+l]=h.rawData[l]}}i++}},r.prototype.care=function(t){for(var e=t;;){if(void 0!=this.nowpose[e.name])return void(this.carelist[e.name]=e);e=e.parent}},r.playerCaches=[],__decorate([t.reflect.Field("AnimationClip[]"),__metadata("design:type",Array)],r.prototype,"clips",void 0),__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],r.prototype,"autoplay",void 0),__decorate([t.reflect.Field("TPoseInfo[]"),__metadata("design:type",Array)],r.prototype,"bones",void 0),__decorate([t.reflect.Field("PoseBoneMatrix[]"),__metadata("design:type",Array)],r.prototype,"startPos",void 0),r=i=__decorate([t.reflect.nodeComponent],r);var i}();e.AniPlayer=i,__reflect(i.prototype,"egret3d.framework.AniPlayer",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){}return e.prototype.start=function(){},e.prototype.update=function(t){},e.prototype.remove=function(){},e.prototype.clone=function(){},e=__decorate([t.reflect.nodeComponent],e)}();e.Asbone=r,__reflect(r.prototype,"egret3d.framework.Asbone",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){}return e.prototype.start=function(){},e.prototype.update=function(e){if(this.gameObject){var r=this.gameObject.transform.getPosition();t.sound.WebAudio.instance.getAudioListener().setPosition(r.x,r.y,r.z);var a=this.gameObject.transform.getWorldMatrix();t.sound.WebAudio.instance.getAudioListener().setOrientation(a)}},e.prototype.remove=function(){},e.prototype.clone=function(){},e=__decorate([t.reflect.nodeComponent],e)}();e.AudioListener=r,__reflect(r.prototype,"egret3d.framework.AudioListener",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){this._volume=1,this._loop=!1,this._playing=!1}return e.prototype.start=function(){},e.prototype.update=function(t){},e.prototype.remove=function(){},e.prototype.clone=function(){},Object.defineProperty(e.prototype,"sound",{set:function(e){this._channel&&this._playing&&(this._channel.stop(),this._channel.dispose(),this._sound.unuse()),t.sound.WebAudio.instance.isSupported&&(this._channel=new t.sound.WebAudioChannel2D,this._channel.buffer=e.buffer,this._sound=e,e.use())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._channel&&(this._channel.volume=t,this._volume=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._channel&&(this._channel.loop=t,this._loop=t)},enumerable:!0,configurable:!0}),e.prototype.play=function(t){this._channel&&(this._channel.start(t),this._playing=!0)},e.prototype.stop=function(){this._channel&&(this._channel.stop(),this._playing=!1)},e=__decorate([t.reflect.nodeComponent],e)}();e.AudioSource2D=r,__reflect(r.prototype,"egret3d.framework.AudioSource2D",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){this._volume=1,this._loop=!1,this._playing=!1}return e.prototype.start=function(){},e.prototype.update=function(t){if(this._channel&&this._playing&&this.gameObject){var e=this.gameObject.transform.getPosition();this._channel.setPosition(e.x,e.y,e.z)}},e.prototype.remove=function(){},e.prototype.clone=function(){},Object.defineProperty(e.prototype,"sound",{set:function(e){this._channel&&this._playing&&(this._channel.stop(),this._channel.dispose(),this._sound.unuse()),t.sound.WebAudio.instance.isSupported&&(this._channel=new t.sound.WebAudioChannel3D,this._channel.buffer=e.buffer,this._sound=e,e.use())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(t){this._channel&&(this._channel.volume=t,this._volume=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(t){this._channel&&(this._channel.loop=t,this._loop=t)},enumerable:!0,configurable:!0}),e.prototype.play=function(t){this._channel&&!this._playing&&(this._channel.start(t),this._playing=!0)},e.prototype.stop=function(){this._channel&&this._playing&&(this._channel.stop(),this._playing=!1)},Object.defineProperty(e.prototype,"maxDistance",{get:function(){return this._channel?this._channel.maxDistance:0},set:function(t){this._channel&&(this._channel.maxDistance=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minDistance",{get:function(){return this._channel?this._channel.minDistance:0},set:function(t){this._channel&&(this._channel.minDistance=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rollOffFactor",{get:function(){return this._channel?this._channel.rollOffFactor:0},set:function(t){this._channel&&(this._channel.rollOffFactor=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distanceModel",{get:function(){return this._channel?this._channel.distanceModel:""},set:function(t){this._channel&&(this._channel.distanceModel=t)},enumerable:!0,configurable:!0}),e.prototype.getVelocity=function(){return this._channel?this._channel.getVelocity():new t.math.Vector3},e.prototype.setVelocity=function(t,e,r){this._channel&&this._channel.setVelocity(t,e,r)},e=__decorate([t.reflect.nodeComponent],e)}();e.AudioSource3D=r,__reflect(r.prototype,"egret3d.framework.AudioSource3D",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this._colliderVisible=!1}return r.prototype.getBound=function(){return this.obb},Object.defineProperty(r.prototype,"matrix",{get:function(){return this.gameObject?this.gameObject.transform.getWorldMatrix():new t.math.Matrix},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.filter=this.gameObject.getComponent("MeshFilter"),this.build()},r.prototype.update=function(t){this.obb&&this.obb.update(this.matrix)},Object.defineProperty(r.prototype,"colliderVisible",{get:function(){return this._colliderVisible},set:function(t){this._colliderVisible=t,this.subTran&&(this.subTran.gameObject.visible=this._colliderVisible)},enumerable:!0,configurable:!0}),r.prototype.intersectsTransform=function(t){if(null==t.gameObject.collider)return!1;if(null==this.obb||null==t.gameObject.collider.getBound())return!1;var e=t.gameObject.collider.getBound();return this.obb.intersects(e)},r.prototype.build=function(){if(this.obb=new e.Obb,this.center&&this.size)this.obb.buildByCenterSize(this.center,this.size);else{var r=new t.math.Vector3,a=new t.math.Vector3;if(this.filter){var i=this.filter.getMeshOutput().data;t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,r),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,a);for(var o=0;o<i.pos.length;o++)t.math.vec3Max(i.pos[o],a,a),t.math.vec3Min(i.pos[o],r,r)}else r.x=-1,r.y=-1,r.z=-1,a.x=1,a.y=1,a.z=1;this.obb.buildByMaxMin(r,a)}this.buildMesh()},r.prototype.buildMesh=function(){this.subTran=new t.framework.Transform,this.subTran.gameObject.hideFlags=e.HideFlags.DontSave|e.HideFlags.HideInHierarchy,this.subTran.name="boxcollider";var r=this.subTran.gameObject.addComponent("MeshFilter");r.mesh=this.getColliderMesh();this.subTran.gameObject.addComponent("MeshRenderer");this.subTran.gameObject.visible=this._colliderVisible,this.gameObject.transform.addChild(this.subTran)},r.prototype.getColliderMesh=function(){var r=new e.Mesh;r.data=t.render.MeshData.genBoxByArray_Quad(this.obb.vectors);var a=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal,i=r.data.genVertexDataArray(a),o=r.data.genIndexDataArrayQuad2Line(),n=this.gameObject.getScene().webgl;r.glMesh=new t.render.GlMesh,r.glMesh.initBuffer(n,a,r.data.pos.length),r.glMesh.uploadVertexSubData(n,i),r.glMesh.addIndex(n,o.length),r.glMesh.uploadIndexSubData(n,0,o),r.submesh=[];var s=new e.SubMeshInfo;return s.matIndex=0,s.useVertexIndex=0,s.start=0,s.size=o.length,s.line=!0,r.submesh.push(s),r},r.prototype.remove=function(){this.subTran&&this.subTran.dispose(),this.obb&&this.obb.dispose()},r.prototype.clone=function(){},__decorate([t.reflect.Field("Vector3"),__metadata("design:type",t.math.Vector3)],r.prototype,"center",void 0),__decorate([t.reflect.Field("Vector3"),__metadata("design:type",t.math.Vector3)],r.prototype,"size",void 0),r=__decorate([t.reflect.nodeComponent,t.reflect.nodeBoxCollider],r)}();e.BoxCollider=r,__reflect(r.prototype,"egret3d.framework.BoxCollider",["egret3d.framework.INodeComponent","egret3d.framework.ICollider"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.Everything=16777215]="Everything",t[t.Nothing=1]="Nothing",t[t.Default=2]="Default",t[t.UI=4]="UI",t[t.UserLayer1=8]="UserLayer1",t[t.UserLayer2=16]="UserLayer2",t[t.UserLayer3=32]="UserLayer3",t[t.UserLayer4=64]="UserLayer4",t[t.UserLayer5=128]="UserLayer5",t[t.UserLayer6=240]="UserLayer6",t[t.UserLayer7=256]="UserLayer7",t[t.UserLayer8=512]="UserLayer8",t[t.UserLayer9=1024]="UserLayer9",t[t.UserLayer10=2048]="UserLayer10",t[t.UserLayer11=3840]="UserLayer11"}(r=e.CullingMask||(e.CullingMask={}));var a=function(){function e(){this.fov=.25*Math.PI,this.size=2,this.opvalue=1,this._near=.01,this._far=1e3,this.CullingMask=r.Default|r.UI,this.clearOption_Color=!0,this.clearOption_Depth=!0,this.backgroundColor=new t.math.Color(.5,.8,1,1),this.viewport=new t.math.Rect(0,0,1,1),this.renderTarget=null,this.order=0,this.overlays=[],this.matView=new t.math.Matrix,this.matProjP=new t.math.Matrix,this.matProjO=new t.math.Matrix,this.matProj=new t.math.Matrix,this.frameVecs=[new t.math.Vector3,new t.math.Vector3,new t.math.Vector3,new t.math.Vector3,new t.math.Vector3,new t.math.Vector3,new t.math.Vector3,new t.math.Vector3],this.postQueues=[]
}return Object.defineProperty(e.prototype,"near",{get:function(){return this._near},set:function(t){t>=this.far&&(t=this.far-1),.01>t&&(t=.01),this._near=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"far",{get:function(){return this._far},set:function(t){t<=this.near&&(t=this.near+1),t>=1e3&&(t=1e3),this._far=t},enumerable:!0,configurable:!0}),e.prototype.markDirty=function(){},e.prototype.start=function(){},e.prototype.update=function(t){for(var e=0;e<this.overlays.length;e++)this.overlays[e].init||(this.overlays[e].start(this),this.overlays[e].init=!0),this.overlays[e].update(t)},e.prototype.addOverLay=function(t){this.overlays.push(t)},e.prototype.addOverLayAt=function(t,e){this.overlays.splice(e,0,t)},e.prototype.getOverLays=function(){return this.overlays},e.prototype.removeOverLay=function(t){if(null!=this.overlays){var e=this.overlays.indexOf(t);e>=0&&this.overlays.splice(e,1)}},e.prototype.calcViewMatrix=function(e){var r=this.gameObject.transform.getWorldMatrix();t.math.matrixInverse(r,this.matView),t.math.matrixClone(this.matView,e)},e.prototype.calcProjectMatrix=function(e,r){this.opvalue>0&&t.math.matrixProject_PerspectiveLH(this.fov,e,this.near,this.far,this.matProjP),this.opvalue<1&&t.math.matrixProject_OrthoLH(this.size*e,this.size,this.near,this.far,this.matProjO),0==this.opvalue?t.math.matrixClone(this.matProjO,this.matProj):1==this.opvalue?t.math.matrixClone(this.matProjP,this.matProj):t.math.matrixLerp(this.matProjO,this.matProjP,this.opvalue,this.matProj),t.math.matrixClone(this.matProj,r)},e.prototype.calcViewPortPixel=function(t,e){var r,a;null==this.renderTarget?(r=t.width,a=t.height):(r=this.renderTarget.width,a=this.renderTarget.height),e.x=r*this.viewport.x,e.y=a*this.viewport.y,e.w=r*this.viewport.w,e.h=a*this.viewport.h},e.prototype.creatRayByScreen=function(e,r){var a=t.math.Pool.new_vector3();a.x=e.x,a.y=e.y,a.z=0;var i=t.math.Pool.new_vector3();i.x=e.x,i.y=e.y,i.z=1;var o=t.math.Pool.new_vector3(),n=t.math.Pool.new_vector3();this.calcWorldPosFromScreenPos(r,a,o),this.calcWorldPosFromScreenPos(r,i,n);var s=t.math.Pool.new_vector3();t.math.vec3Subtract(n,o,s),t.math.vec3Normalize(s,s);var h=new t.framework.Ray(o,s);return t.math.Pool.delete_vector3(a),t.math.Pool.delete_vector3(i),t.math.Pool.delete_vector3(o),t.math.Pool.delete_vector3(n),t.math.Pool.delete_vector3(s),h},e.prototype.calcWorldPosFromScreenPos=function(e,r,a){var i=new t.math.Rect;this.calcViewPortPixel(e,i);var o=new t.math.Vector2(r.x/i.w*2-1,1-r.y/i.h*2),n=new t.math.Matrix,s=new t.math.Matrix,h=i.w/i.h;this.calcViewMatrix(n),this.calcProjectMatrix(h,s);var l=new t.math.Matrix,c=new t.math.Matrix;t.math.matrixMultiply(s,n,l),t.math.matrixInverse(l,c);var u=new t.math.Vector3(o.x,o.y,r.z);t.math.matrixTransformVector3(u,c,a)},e.prototype.calcScreenPosFromWorldPos=function(e,r,a){var i=new t.math.Rect;this.calcViewPortPixel(e,i);var o=new t.math.Matrix,n=new t.math.Matrix,s=i.w/i.h;this.calcViewMatrix(o),this.calcProjectMatrix(s,n);var h=new t.math.Matrix;t.math.matrixMultiply(n,o,h);var l=t.math.Pool.new_vector3();t.math.matrixTransformVector3(r,h,l),a.x=(l.x+1)*i.w/2,a.y=(1-l.y)*i.h/2},e.prototype.calcCameraFrame=function(e){var r=new t.math.Rect;this.calcViewPortPixel(e,r);var a=this.frameVecs[0],i=this.frameVecs[1],o=this.frameVecs[2],n=this.frameVecs[3],s=this.frameVecs[4],h=this.frameVecs[5],l=this.frameVecs[6],c=this.frameVecs[7],u=this.near*Math.tan(.5*this.fov),d=r.w/r.h,p=u*d;t.math.vec3SetByFloat(-p,u,this.near,h),t.math.vec3SetByFloat(-p,-u,this.near,i),t.math.vec3SetByFloat(p,u,this.near,c),t.math.vec3SetByFloat(p,-u,this.near,n);var m=this.far*Math.tan(.5*this.fov),f=m*d;t.math.vec3SetByFloat(-f,m,this.far,s),t.math.vec3SetByFloat(-f,-m,this.far,a),t.math.vec3SetByFloat(f,m,this.far,l),t.math.vec3SetByFloat(f,-m,this.far,o);var v=this.gameObject.transform.getWorldMatrix();t.math.matrixTransformVector3(a,v,a),t.math.matrixTransformVector3(i,v,i),t.math.matrixTransformVector3(o,v,o),t.math.matrixTransformVector3(n,v,n),t.math.matrixTransformVector3(s,v,s),t.math.matrixTransformVector3(h,v,h),t.math.matrixTransformVector3(l,v,l),t.math.matrixTransformVector3(c,v,c)},e.prototype.getPosAtXPanelInViewCoordinateByScreenPos=function(e,r,a,i){var o=new t.math.Rect;this.calcViewPortPixel(r,o);var n=new t.math.Vector3;n.z=-this.near,n.x=e.x-.5*o.w,n.y=.5*o.h-e.y;var s=new t.math.Vector3;s.z=-this.far,s.x=this.far*n.x/this.near,s.y=this.far*n.y/this.near;var h=(n.z-a)/(n.z-s.z);i.x=n.x-(n.x-s.x)*h,i.y=n.y-(n.y-s.y)*h},e.prototype.testFrustumCulling=function(t,e){var r=e.aabb;return r.intersectPlane(this.frameVecs[0],this.frameVecs[1],this.frameVecs[5])&&r.intersectPlane(this.frameVecs[1],this.frameVecs[3],this.frameVecs[7])&&r.intersectPlane(this.frameVecs[3],this.frameVecs[2],this.frameVecs[6])&&r.intersectPlane(this.frameVecs[2],this.frameVecs[0],this.frameVecs[4])&&r.intersectPlane(this.frameVecs[5],this.frameVecs[7],this.frameVecs[6])&&r.intersectPlane(this.frameVecs[0],this.frameVecs[2],this.frameVecs[3])?!0:!1},e.prototype._targetAndViewport=function(e,r,a,i){var o,n;null==e?(o=r.app.width,n=r.app.height,t.render.GlRenderTarget.useNull(a.webgl)):(o=e.width,n=e.height,e.use(a.webgl)),a.webgl.viewport(o*this.viewport.x,n*this.viewport.y,o*this.viewport.w,n*this.viewport.h),a.webgl.depthRange(0,1),i||(this.clearOption_Color&&this.clearOption_Depth?(t.render.Webglkit.zWrite(!0),a.webgl.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),a.webgl.clearDepth(1),a.webgl.clear(a.webgl.COLOR_BUFFER_BIT|a.webgl.DEPTH_BUFFER_BIT)):this.clearOption_Depth?(t.render.Webglkit.zWrite(!0),a.webgl.clearDepth(1),a.webgl.clear(a.webgl.DEPTH_BUFFER_BIT)):this.clearOption_Color&&(a.webgl.clearColor(this.backgroundColor.r,this.backgroundColor.g,this.backgroundColor.b,this.backgroundColor.a),a.webgl.clear(a.webgl.COLOR_BUFFER_BIT)))},e.prototype._renderOnce=function(t,e,r){e.drawtype=r;for(var a=0;a<t.renderList.renderLayers.length;a++)for(var i=t.renderList.renderLayers[a],o=i.list,n=0;n<o.length;n++){var s=o[n].gameObject;(!o[n].frustumTest||this.testFrustumCulling(t,s.transform))&&s.visible&&this.CullingMask&o[n].renderLayer&&o[n].render(e,this)}},e.prototype.renderScene=function(e,r){for(var a=0;a<e.renderList.renderLayers.length;a++){var i=e.renderList.renderLayers[a],o=i.list;i.needSort&&o.length>1&&o.sort(function(e,a){if(e.queue!=a.queue)return e.queue-a.queue;var i=r.matrixView,o=t.math.Pool.new_vector3(),n=t.math.Pool.new_vector3();return t.math.matrixTransformVector3(e.gameObject.transform.getPosition(),i,o),t.math.matrixTransformVector3(a.gameObject.transform.getPosition(),i,n),o.z-n.z})}if(this.calcCameraFrame(e.app),0==this.postQueues.length)this._targetAndViewport(this.renderTarget,e,r,!1),this._renderOnce(e,r,"");else for(var a=0;a<this.postQueues.length;a++)this.postQueues[a].render(e,r,this);r.webgl.flush()},e.prototype.remove=function(){},e.prototype.clone=function(){},__decorate([t.reflect.UIStyle("rangeFloat",1,1e3,2),t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],e.prototype,"near",null),__decorate([t.reflect.UIStyle("rangeFloat",1,1e3,999),t.reflect.Field("number"),__metadata("design:type",Number),__metadata("design:paramtypes",[Number])],e.prototype,"far",null),__decorate([t.reflect.Field("IOverLay[]"),__metadata("design:type",Array)],e.prototype,"overlays",void 0),e=__decorate([t.reflect.nodeComponent,t.reflect.nodeCamera],e)}();e.Camera=a,__reflect(a.prototype,"egret3d.framework.Camera",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){this.renderTarget=null}return e.prototype.render=function(e,r,a){a._targetAndViewport(this.renderTarget,e,r,!0),t.render.Webglkit.zWrite(!0),r.webgl.clearColor(0,0,0,0),r.webgl.clearDepth(1),r.webgl.clear(r.webgl.COLOR_BUFFER_BIT|r.webgl.DEPTH_BUFFER_BIT),a._renderOnce(e,r,"_depth"),t.render.GlRenderTarget.useNull(r.webgl)},e}();e.CameraPostQueue_Depth=r,__reflect(r.prototype,"egret3d.framework.CameraPostQueue_Depth",["egret3d.framework.ICameraPostQueue"]);var a=function(){function r(){this.renderTarget=null,this.material=new e.Material}return r.prototype.render=function(e,r,a){a._targetAndViewport(this.renderTarget,e,r,!0),t.render.Webglkit.zWrite(!0),r.webgl.clearColor(0,.3,0,0),r.webgl.clearDepth(1),r.webgl.clear(r.webgl.COLOR_BUFFER_BIT|r.webgl.DEPTH_BUFFER_BIT);var i=t.framework.DefaultMeshes.Quad;r.drawtype="",this.material.draw(r,i,i.submesh[0],"quad")},r}();e.CameraPostQueue_Quad=a,__reflect(a.prototype,"egret3d.framework.CameraPostQueue_Quad",["egret3d.framework.ICameraPostQueue"]);var i=function(){function e(){this.renderTarget=null}return e.prototype.render=function(e,r,a){a._targetAndViewport(this.renderTarget,e,r,!1),a._renderOnce(e,r,""),t.render.GlRenderTarget.useNull(r.webgl)},e}();e.CameraPostQueue_Color=i,__reflect(i.prototype,"egret3d.framework.CameraPostQueue_Color",["egret3d.framework.ICameraPostQueue"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.frustumTest=!1,this.layer=e.RenderLayerEnum.Common,this.renderLayer=e.CullingMask.Default,this.queue=0,this.autoplay=!0,this.state=e.EffectPlayStateEnum.None,this.curFrameId=-1,this.frameId=0,this.playTimer=0,this.speed=1,this.parser=new t.framework.EffectParser,this.vf=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal|t.render.VertexFormatMask.Tangent|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,this.particleVF=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0,this.effectBatchers=[],this.matDataGroups=[]}return a=r,r.prototype.setEffect=function(t){this.data=this.parser.Parse(t)},r.prototype.setJsonData=function(t){this.jsonData=t,this.data=this.parser.Parse(this.jsonData.content)},Object.defineProperty(r.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalFrameCount",{get:function(){return this.data.life*a.fps},enumerable:!0,configurable:!0}),r.prototype.start=function(){this._data&&this.addElements()},r.prototype.update=function(t){null!=this.gameObject.getScene()&&void 0!=this.gameObject.getScene()&&(this.state==e.EffectPlayStateEnum.Play||this.state==e.EffectPlayStateEnum.Pause?(this.state==e.EffectPlayStateEnum.Play&&(this.playTimer+=t*this.speed),this.beLoop||this.playTimer>=this.data.life&&this.stop(),this._update(t)):this.state==e.EffectPlayStateEnum.BeReady&&(this.autoplay?this.play():this.gameObject.visible=!1))},r.prototype._update=function(t){if(this.checkFrameId()){for(var e in this.effectBatchers){var r=this.effectBatchers[e];for(var i in r.effectElements){var o=r.effectElements[i],n=this.curFrameId%o.loopFrame;if(o.active&&(o.actionActive=!1,this.mergeLerpAttribData(o.curAttrData,o.timelineFrame[n]),void 0!=o.actions)){o.actionActive=!0;for(var s in o.actions)o.actions[s].update(n)}o.update(),o.isActiveFrame(n)&&this.updateEffectBatcher(o.effectBatcher,o.curAttrData,o.data.initFrameData,o.startIndex)}}void 0!=this.particles&&(this.frameId=this.curFrameId%this.particles.loopFrame,this.particles.update(1/a.fps))}},r.prototype.mergeLerpAttribData=function(e,r){if(void 0!=r&&void 0!=e)for(var a in r.attrsData)if(void 0!=r.attrsData[a]&&void 0!=e[a]){var i=r.attrsData.getAttribute(a);if(null==i)continue;(i instanceof t.math.Vector3||i instanceof t.math.Vector2||"number"==typeof i)&&"renderModel"!=a&&(e[a]=i)}},r.prototype.updateEffectBatcher=function(e,r,a,i){var o=r.mesh;if(void 0==o&&(o=a.attrsData.mesh),void 0!=o){void 0==r.meshdataVbo&&(r.meshdataVbo=o.data.genVertexDataArray(this.vf));for(var n=o.data.pos.length,s=r.meshdataVbo,h=e.vertexSize,l=0;n>l;l++){var c=t.math.Pool.new_vector3();c.x=s[l*h+0],c.y=s[l*h+1],c.z=s[l*h+2],t.math.matrixTransformVector3(c,r.matrix,c),e.dataForVbo[(i+l)*h+0]=c.x,e.dataForVbo[(i+l)*h+1]=c.y,e.dataForVbo[(i+l)*h+2]=c.z,t.math.Pool.delete_vector3(c);var u=s[l*h+9],d=s[l*h+10],p=s[l*h+11],m=s[l*h+12];void 0!=r.color&&(u=r.color.x,d=r.color.y,p=r.color.z),void 0!=r.alpha&&(m=r.alpha),void 0!=r.colorRate&&(u*=r.colorRate,d*=r.colorRate,p*=r.colorRate,m*=r.colorRate),u=t.math.floatClamp(u,0,3),d=t.math.floatClamp(d,0,3),p=t.math.floatClamp(p,0,3),m=t.math.floatClamp(m,0,3),e.dataForVbo[15*(i+l)+9]=u,e.dataForVbo[15*(i+l)+10]=d,e.dataForVbo[15*(i+l)+11]=p,e.dataForVbo[15*(i+l)+12]=m,e.dataForVbo[(i+l)*h+13]=s[l*h+13]*r.tilling.x+r.uv.x,e.dataForVbo[(i+l)*h+14]=s[l*h+14]*r.tilling.y+r.uv.y}}},r.prototype.render=function(t,r){if(this.state==e.EffectPlayStateEnum.Play){t.updateModel(this.gameObject.transform);for(var a in this.effectBatchers){var i=this.effectBatchers[a],o=i.mesh;i.beBufferInited||(o.glMesh.initBuffer(t.webgl,this.vf,i.curTotalVertexCount),0==o.glMesh.ebos.length?o.glMesh.addIndex(t.webgl,i.dataForEbo.length):o.glMesh.resetEboSize(t.webgl,0,i.dataForEbo.length),o.glMesh.uploadIndexSubData(t.webgl,0,i.dataForEbo),o.submesh[0].size=i.dataForEbo.length,i.beBufferInited=!0),o.glMesh.uploadVertexSubData(t.webgl,i.dataForVbo),i.mat.draw(t,o,o.submesh[0],"base")}void 0!=this.particles&&this.particles.render(t,r)}},r.prototype.clone=function(){var t=new a;return t.data=this.data.clone(),t},r.prototype.play=function(t){void 0===t&&(t=1),this.speed=t,this.state=e.EffectPlayStateEnum.Play,this.gameObject.visible=!0},r.prototype.pause=function(){this.state=e.EffectPlayStateEnum.Pause},r.prototype.stop=function(){this.reset(),this.state=e.EffectPlayStateEnum.Stop},r.prototype.reset=function(t,r){void 0===t&&(t=!0),void 0===r&&(r=!0),this.state=e.EffectPlayStateEnum.BeReady,this.gameObject.visible=!1,this.playTimer=0,t&&this.resetSingleMesh(),r&&this.resetparticle()},r.prototype.resetSingleMesh=function(){for(var t in this.effectBatchers){var e=this.effectBatchers[t];for(var r in e.effectElements){var a=e.effectElements[r];a.setActive(!0),void 0!=a.data.initFrameData&&(a.curAttrData=a.data.initFrameData.attrsData.copyandinit())}}},r.prototype.resetparticle=function(){void 0!=this.particles&&this.particles.dispose();for(var t in this.data.elements){var r=this.data.elements[t];r.type==e.EffectElementTypeEnum.EmissionType&&(void 0==this.particles&&(this.particles=new e.Particles(this)),this.particles.addEmission(r))}},r.prototype.addElements=function(){for(var t in this.data.elements){var r=this.data.elements[t];r.type==e.EffectElementTypeEnum.EmissionType?(void 0==this.particles&&(this.particles=new e.Particles(this)),this.particles.addEmission(r)):r.type==e.EffectElementTypeEnum.SingleMeshType&&this.addInitFrame(r)}this.state=e.EffectPlayStateEnum.BeReady,this.beLoop=this.data.beLoop},r.prototype.addInitFrame=function(r){var a=this.gameObject.getScene();if(a){var i=new e.EffectElement(r,a);i.transform=this.gameObject.transform;var o=i.data.initFrameData;if(void 0!=o&&void 0!=o.attrsData&&void 0!=o.attrsData.mesh){var n=-1;if(null!=o.attrsData.mat)for(var s=0;s<this.matDataGroups.length;s++)if(e.EffectMatData.beEqual(this.matDataGroups[s],o.attrsData.mat)){n=s;break}var h=0,l=o.attrsData.mesh.data.pos.length,c=null;if(n>=0)c=this.effectBatchers[n],h=c.curTotalVertexCount,c.curTotalVertexCount+=l;else{c=new e.EffectBatcher(this.vf),c.curTotalVertexCount=l,c.mesh=new e.Mesh,c.mesh.data=new t.render.MeshData,c.mesh.glMesh=new t.render.GlMesh,c.mat=new e.Material,c.mesh.submesh=[];var u=new e.SubMeshInfo;u.matIndex=0,u.useVertexIndex=0,u.start=0,u.size=0,u.line=!1,c.mesh.submesh.push(u),h=0,n=0,null==o.attrsData.mat.shader?(c.mat.setShader(e.AssetMap.find("diffuse.shader.json")),console.error("特效 {0} shader为空",r.name)):c.mat.setShader(o.attrsData.mat.shader),void 0!=o.attrsData.mat.alphaCut&&c.mat.setFloat("_AlphaCut",o.attrsData.mat.alphaCut),null!=o.attrsData.mat.diffuseTexture&&c.mat.setTexture("_MainTex",o.attrsData.mat.diffuseTexture),this.effectBatchers.push(c),this.matDataGroups.push(o.attrsData.mat)}i.effectBatcher=c,i.startIndex=h,i.curAttrData=r.initFrameData.attrsData.copyandinit();var d=c.vertexSize,p=o.attrsData.mesh.data.genVertexDataArray(this.vf);i.update(),c.effectElements.push(i);for(var m=0;l>m;m++){var f=t.math.Pool.new_vector3();f.x=p[m*d+0],f.y=p[m*d+1],f.z=p[m*d+2],t.math.matrixTransformVector3(f,i.curAttrData.matrix,f),c.dataForVbo[(h+m)*d+0]=f.x,c.dataForVbo[(h+m)*d+1]=f.y,c.dataForVbo[(h+m)*d+2]=f.z,t.math.Pool.delete_vector3(f),c.dataForVbo[(h+m)*d+3]=p[m*d+3],c.dataForVbo[(h+m)*d+4]=p[m*d+4],c.dataForVbo[(h+m)*d+5]=p[m*d+5],c.dataForVbo[(h+m)*d+6]=p[m*d+6],c.dataForVbo[(h+m)*d+7]=p[m*d+7],c.dataForVbo[(h+m)*d+8]=p[m*d+8];var v=t.math.floatClamp(i.curAttrData.color.x,0,1),_=t.math.floatClamp(i.curAttrData.color.y,0,1),g=t.math.floatClamp(i.curAttrData.color.z,0,1),y=t.math.floatClamp(p[m*d+12]*i.curAttrData.alpha,0,1);c.dataForVbo[15*(h+m)+9]=v,c.dataForVbo[15*(h+m)+10]=_,c.dataForVbo[15*(h+m)+11]=g,c.dataForVbo[15*(h+m)+12]=y,c.dataForVbo[(h+m)*d+13]=p[m*d+13]*i.curAttrData.tilling.x,c.dataForVbo[(h+m)*d+14]=p[m*d+14]*i.curAttrData.tilling.y}var w=o.attrsData.mesh.data.genIndexDataArray(),x=c.indexStartIndex;c.indexStartIndex+=w.length;for(var b=0;b<w.length;b++)c.dataForEbo[x+b]=w[b]+h;this.effectBatchers[n].beBufferInited=!1}}},r.prototype.setFrameId=function(t){this.state==e.EffectPlayStateEnum.Pause&&t>=0&&t<this.totalFrameCount&&(this.curFrameId=t)},r.prototype.checkFrameId=function(){var t=a.fps*this.playTimer|0;return t!=this.curFrameId?(this.state==e.EffectPlayStateEnum.Play&&(this.curFrameId=t),!0):!1},r.prototype.remove=function(){this.state=e.EffectPlayStateEnum.Dispose,this.data.dispose();for(var t in this.effectBatchers)this.effectBatchers[t].dispose();this.particles&&this.particles.dispose()},Object.defineProperty(r.prototype,"leftLifeTime",{get:function(){return null!=this.data?this.data.life-this.playTimer:9999999999},enumerable:!0,configurable:!0}),r.fps=30,__decorate([t.reflect.Field("Textasset"),__metadata("design:type",e.Textasset)],r.prototype,"jsonData",void 0),r=a=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent,t.reflect.selfClone],r);var a}();e.EffectSystem=r,__reflect(r.prototype,"egret3d.framework.EffectSystem",["egret3d.framework.IRenderer","egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){this.speed=1,this.isactived=!1,this.loopCount=1,this.isloop=!1,this.datasafe=!1,this.folowindex=0,this.lookforward=!1,this.adjustDir=!1}return Object.defineProperty(e.prototype,"pathasset",{get:function(){return this._pathasset},set:function(t){this._pathasset&&this._pathasset.unuse(),this._pathasset=t,this._pathasset&&this._pathasset.use()},enumerable:!0,configurable:!0}),e.prototype.play=function(t){void 0===t&&(t=1),this.isactived=!0,this.loopCount=t},e.prototype.pause=function(){this.isactived=!1},e.prototype.stop=function(){this.isactived=!1,this.folowindex=0},e.prototype.replay=function(t){void 0===t&&(t=1),this.isactived=!0,this.folowindex=0,this.loopCount=t},e.prototype.setpathasset=function(t,e,r){return void 0===e&&(e=1),void 0===r&&(r=null),this.pathasset=t,null==t?void console.log(this.gameObject.getName().toString+":are you sure set the right pathasset（error：null）"):(this.paths=t.paths,null!=this.paths[0]&&(this.gameObject.transform.setLocalPosition(this.paths[0]),this.datasafe=!0),this.mystrans=this.gameObject.transform,this.speed=e,void(this.oncomplete=r))},e.prototype.start=function(){},e.prototype.update=function(t){this.isactived&&this.datasafe&&this.followmove(t)},e.prototype.followmove=function(e){var r=t.math.vec3Distance(this.mystrans.getLocalPosition(),this.paths[this.folowindex]);if(.01>r)if(this.folowindex<this.paths.length-1){var a=new t.math.Vector3;this.mystrans.setLocalPosition(this.paths[this.folowindex]),this.folowindex++,this.adjustDir=!0}else this.folowindex=0,this.isloop||(this.loopCount--,0==this.loopCount&&(this.isactived=!1,this.loopCount=1,this.oncomplete&&this.oncomplete()));else{var a=new t.math.Vector3;if(t.math.vec3Subtract(this.paths[this.folowindex],this.mystrans.getLocalPosition(),a),this.adjustDir){var i=this.paths[this.folowindex],o=this.mystrans.getLocalPosition(),n=t.math.Pool.new_quaternion();t.math.quatLookat(o,i,n),t.math.quatClone(n,this.mystrans.getLocalRotation()),t.math.Pool.delete_quaternion(n),this.adjustDir=!1}var s=this.speed*e;s>r&&(s=r);var h=s/r,l=new t.math.Vector3;t.math.vec3SLerp(this.mystrans.getLocalPosition(),this.paths[this.folowindex],h,l),this.mystrans.setLocalPosition(l)}},e.prototype.remove=function(){this._pathasset&&this._pathasset.unuse()},e.prototype.clone=function(){},e=__decorate([t.reflect.nodeComponent],e)}();e.Guidpath=r,__reflect(r.prototype,"egret3d.framework.Guidpath",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.Direction=0]="Direction",t[t.Point=1]="Point",t[t.Spot=2]="Spot"}(r=e.LightTypeEnum||(e.LightTypeEnum={}));var a=function(){function e(){this.isOpen=!1,this.spotAngelCos=.9}return e.prototype.start=function(){},e.prototype.update=function(t){},e.prototype.remove=function(){},e.prototype.clone=function(){},__decorate([t.reflect.Field("boolean"),__metadata("design:type",Boolean)],e.prototype,"isOpen",void 0),__decorate([t.reflect.Field("string"),__metadata("design:type",String)],e.prototype,"lightName",void 0),e=__decorate([t.reflect.nodeComponent,t.reflect.nodeLight],e)}();e.Light=a,__reflect(a.prototype,"egret3d.framework.Light",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this._colliderVisible=!1}return r.prototype.getBound=function(){return this.mesh},r.prototype.start=function(){var t=this.gameObject.getComponent("MeshFilter");null!=t&&(this.mesh=t.getMeshOutput(),this.buildMesh())},r.prototype.update=function(t){},Object.defineProperty(r.prototype,"colliderVisible",{get:function(){return this._colliderVisible},set:function(t){this._colliderVisible=t,this.subTran&&(this.subTran.gameObject.visible=this._colliderVisible)},enumerable:!0,configurable:!0}),r.prototype.intersectsTransform=function(t){return!1},r.prototype.buildMesh=function(){this.subTran=new t.framework.Transform,this.subTran.gameObject.hideFlags=e.HideFlags.DontSave|e.HideFlags.HideInHierarchy,this.subTran.name="meshcollider";var r=this.subTran.gameObject.addComponent("MeshFilter");r.mesh=this.getColliderMesh();this.subTran.gameObject.addComponent("MeshRenderer");this.subTran.gameObject.visible=this._colliderVisible,this.gameObject.transform.addChild(this.subTran)},r.prototype.getColliderMesh=function(){var r=new e.Mesh;r.data=this.mesh.data;var a=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Normal,i=r.data.genVertexDataArray(a),o=r.data.genIndexDataArrayTri2Line(),n=this.gameObject.getScene().webgl;r.glMesh=new t.render.GlMesh,r.glMesh.initBuffer(n,a,r.data.pos.length),r.glMesh.uploadVertexSubData(n,i),r.glMesh.addIndex(n,o.length),r.glMesh.uploadIndexSubData(n,0,o),r.submesh=[];var s=new e.SubMeshInfo;return s.matIndex=0,s.useVertexIndex=0,s.start=0,s.size=o.length,s.line=!0,r.submesh.push(s),r},r.prototype.remove=function(){this.subTran&&this.subTran.dispose()},r.prototype.clone=function(){},r=__decorate([t.reflect.nodeComponent,t.reflect.nodeMeshCollider],r)}();e.MeshCollider=r,__reflect(r.prototype,"egret3d.framework.MeshCollider",["egret3d.framework.INodeComponent","egret3d.framework.ICollider"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){}return r.prototype.start=function(){},r.prototype.update=function(t){},Object.defineProperty(r.prototype,"mesh",{get:function(){return this._mesh},set:function(t){null!=this._mesh&&this._mesh.unuse(),this._mesh=t,null!=this._mesh&&this._mesh.use()},enumerable:!0,configurable:!0}),r.prototype.getMeshOutput=function(){return this._mesh},r.prototype.remove=function(){this.mesh&&this.mesh.unuse(!0)},r.prototype.clone=function(){},__decorate([t.reflect.Field("Mesh"),t.reflect.UIStyle("WidgetDragSelect"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.Mesh])],r.prototype,"mesh",null),r=__decorate([t.reflect.nodeComponent],r)}();e.MeshFilter=r,__reflect(r.prototype,"egret3d.framework.MeshFilter",["egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.frustumTest=!1,this.layer=e.RenderLayerEnum.Common,this.renderLayer=e.CullingMask.Default,this._queue=0,this.issetq=!1,this.materials=[],this.lightmapIndex=-1,this.lightmapScaleOffset=new t.math.Vector4(1,1,0,0)}return Object.defineProperty(r.prototype,"queue",{get:function(){return this._queue},set:function(t){this._queue=t,this.issetq=!0},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.filter=this.gameObject.getComponent("MeshFilter"),this.refreshLayerAndQue()},r.prototype.refreshLayerAndQue=function(){(null==this.materials||0==this.materials.length)&&(this.materials=[],this.materials.push(new e.Material),this.materials[0].setShader(e.DefaultShaders.Diffuse)),this.layer=this.materials[0].getLayer(),this.issetq||(this._queue=this.materials[0].getQueue())},r.prototype.update=function(t){if(null!=this.materials&&this.materials.length>0){var e=this.materials[0];e&&(this.layer=e.getLayer(),this.issetq||(this._queue=e.getQueue()))}},r.prototype.render=function(e,r){if(e.updateModel(this.gameObject.transform),null!=this.filter){var a=this.filter.getMeshOutput();if(null!=a&&null!=a.submesh)for(var i=0;i<a.submesh.length;i++){var o=a.submesh[i],n=a.submesh[i].matIndex,s=this.materials[n],h="base";this.lightmapIndex>=0&&(h="lightmap",this.gameObject.transform.scene.lightmaps.length>this.lightmapIndex&&e.updateLightmap(this.gameObject.transform.scene.lightmaps[this.lightmapIndex],a.glMesh.vertexFormat&t.render.VertexFormatMask.UV1?1:0,this.lightmapScaleOffset)),null!=s&&s.draw(e,a,o,h)}}},r.prototype.remove=function(){this.materials.length=0},r.prototype.clone=function(){},__decorate([t.reflect.Field("Material[]"),__metadata("design:type",Array)],r.prototype,"materials",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],r.prototype,"lightmapIndex",void 0),__decorate([t.reflect.Field("Vector4"),__metadata("design:type",t.math.Vector4)],r.prototype,"lightmapScaleOffset",void 0),r=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],r)}();e.MeshRenderer=r,__reflect(r.prototype,"egret3d.framework.MeshRenderer",["egret3d.framework.IRenderer","egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.frustumTest=!1,this.layer=e.RenderLayerEnum.Common,this.renderLayer=e.CullingMask.Default,this._queue=0,this.issetq=!1,this.maxBoneCount=0,this._skintype=0,this._efficient=!0}return a=r,Object.defineProperty(r.prototype,"queue",{get:function(){return this._queue},set:function(t){this._queue=t,this.issetq=!0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"player",{get:function(){return null==this._player&&(this._player=this.gameObject.getComponentInParent("AniPlayer")),this._player},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"mesh",{get:function(){return this._mesh},set:function(t){null!=this._mesh&&this._mesh.unuse(),this._mesh=t,null!=this._mesh&&this._mesh.use()},enumerable:!0,configurable:!0}),r.prototype.start=function(){},r.prototype.getMatByIndex=function(e){var r=this.mesh.data;if(r.blendIndex[e].v0>=this.maxBoneCount||r.blendIndex[e].v1>=this.maxBoneCount||r.blendIndex[e].v2>=this.maxBoneCount||r.blendIndex[e].v3>=this.maxBoneCount)return null;var a=new t.math.Matrix;if(this._efficient){var i=t.math.Pool.new_vector4(),o=t.math.Pool.new_vector3();i.x=this._skeletonMatrixData[8*r.blendIndex[e].v0+0],i.y=this._skeletonMatrixData[8*r.blendIndex[e].v0+1],i.z=this._skeletonMatrixData[8*r.blendIndex[e].v0+2],i.w=this._skeletonMatrixData[8*r.blendIndex[e].v0+3],o.x=this._skeletonMatrixData[8*r.blendIndex[e].v0+4],o.y=this._skeletonMatrixData[8*r.blendIndex[e].v0+5],o.z=this._skeletonMatrixData[8*r.blendIndex[e].v0+6];var n=t.math.Pool.new_vector4(),s=t.math.Pool.new_vector3();n.x=this._skeletonMatrixData[8*r.blendIndex[e].v1+0],n.y=this._skeletonMatrixData[8*r.blendIndex[e].v1+1],n.z=this._skeletonMatrixData[8*r.blendIndex[e].v1+2],n.w=this._skeletonMatrixData[8*r.blendIndex[e].v1+3],s.x=this._skeletonMatrixData[8*r.blendIndex[e].v1+4],s.y=this._skeletonMatrixData[8*r.blendIndex[e].v1+5],s.z=this._skeletonMatrixData[8*r.blendIndex[e].v1+6];var h=t.math.Pool.new_vector4(),l=t.math.Pool.new_vector3();h.x=this._skeletonMatrixData[8*r.blendIndex[e].v2+0],h.y=this._skeletonMatrixData[8*r.blendIndex[e].v2+1],h.z=this._skeletonMatrixData[8*r.blendIndex[e].v2+2],h.w=this._skeletonMatrixData[8*r.blendIndex[e].v2+3],l.x=this._skeletonMatrixData[8*r.blendIndex[e].v2+4],l.y=this._skeletonMatrixData[8*r.blendIndex[e].v2+5],l.z=this._skeletonMatrixData[8*r.blendIndex[e].v2+6];var c=t.math.Pool.new_vector4(),u=t.math.Pool.new_vector3();c.x=this._skeletonMatrixData[8*r.blendIndex[e].v3+0],c.y=this._skeletonMatrixData[8*r.blendIndex[e].v3+1],c.z=this._skeletonMatrixData[8*r.blendIndex[e].v3+2],c.w=this._skeletonMatrixData[8*r.blendIndex[e].v3+3],u.x=this._skeletonMatrixData[8*r.blendIndex[e].v3+4],u.y=this._skeletonMatrixData[8*r.blendIndex[e].v3+5],u.z=this._skeletonMatrixData[8*r.blendIndex[e].v3+6];var d=t.math.Pool.new_matrix(),p=t.math.Pool.new_matrix(),m=t.math.Pool.new_matrix(),f=t.math.Pool.new_matrix();t.math.matrixMakeTransformRTS(o,t.math.Pool.vector3_one,i,d),t.math.matrixMakeTransformRTS(s,t.math.Pool.vector3_one,n,p),t.math.matrixMakeTransformRTS(l,t.math.Pool.vector3_one,h,m),t.math.matrixMakeTransformRTS(u,t.math.Pool.vector3_one,c,f),t.math.matrixScaleByNum(r.blendWeight[e].v0,d),t.math.matrixScaleByNum(r.blendWeight[e].v1,p),t.math.matrixScaleByNum(r.blendWeight[e].v2,m),t.math.matrixScaleByNum(r.blendWeight[e].v3,f),t.math.matrixAdd(d,p,a),t.math.matrixAdd(a,m,a),t.math.matrixAdd(a,f,a),t.math.Pool.delete_vector4(i),t.math.Pool.delete_vector4(n),t.math.Pool.delete_vector4(h),t.math.Pool.delete_vector4(c),t.math.Pool.delete_vector3(o),t.math.Pool.delete_vector3(s),t.math.Pool.delete_vector3(l),t.math.Pool.delete_vector3(u),t.math.Pool.delete_matrix(d),t.math.Pool.delete_matrix(p),t.math.Pool.delete_matrix(m),t.math.Pool.delete_matrix(f)}else{var d=t.math.Pool.new_matrix();d.rawData=this._skeletonMatrixData.slice(16*r.blendIndex[e].v0,16*r.blendIndex[e].v0+16);var p=t.math.Pool.new_matrix();p.rawData=this._skeletonMatrixData.slice(16*r.blendIndex[e].v1,16*r.blendIndex[e].v1+16);var m=t.math.Pool.new_matrix();m.rawData=this._skeletonMatrixData.slice(16*r.blendIndex[e].v2,16*r.blendIndex[e].v2+16);var f=t.math.Pool.new_matrix();f.rawData=this._skeletonMatrixData.slice(16*r.blendIndex[e].v3,16*r.blendIndex[e].v3+16),t.math.matrixScaleByNum(r.blendWeight[e].v0,d),t.math.matrixScaleByNum(r.blendWeight[e].v1,p),t.math.matrixScaleByNum(r.blendWeight[e].v2,m),t.math.matrixScaleByNum(r.blendWeight[e].v3,f),t.math.matrixAdd(d,p,a),t.math.matrixAdd(a,m,a),t.math.matrixAdd(a,f,a),t.math.Pool.delete_matrix(d),t.math.Pool.delete_matrix(p),t.math.Pool.delete_matrix(m),t.math.Pool.delete_matrix(f)}return a},r.prototype.intersects=function(e){for(var r=this.player.gameObject.transform.getWorldMatrix(),a=null,i=this.mesh.data,o=0;o<this.mesh.submesh.length;o++){for(var n=this.mesh.submesh[o],s=t.math.Pool.new_vector3(),h=t.math.Pool.new_vector3(),l=t.math.Pool.new_vector3(),c=n.start;c<n.size;c+=3){var u=i.trisindex[c],d=i.trisindex[c+1],p=i.trisindex[c+2],m=i.pos[u],f=i.pos[d],v=i.pos[p],_=this.getMatByIndex(u),g=this.getMatByIndex(d),y=this.getMatByIndex(p);
if(null!=_&&null!=g&&null!=y){var w=t.math.Pool.new_matrix();t.math.matrixMultiply(r,_,w);var x=t.math.Pool.new_matrix();t.math.matrixMultiply(r,g,x);var b=t.math.Pool.new_matrix();t.math.matrixMultiply(r,y,b),t.math.matrixTransformVector3(m,w,s),t.math.matrixTransformVector3(f,x,h),t.math.matrixTransformVector3(v,b,l);var D=e.intersectsTriangle(s,h,l);if(D){if(D.distance<0)continue;if(!a||a.distance>D.distance){a=D,a.faceId=c/3,a.subMeshId=o;var T=t.math.Pool.new_vector3();t.math.vec3ScaleByNum(e.direction,D.distance,T),t.math.vec3Add(e.origin,T,a.hitposition)}}}}t.math.Pool.delete_vector3(s),t.math.Pool.delete_vector3(h),t.math.Pool.delete_vector3(l)}return a},r.prototype.update=function(t){if(null==this._skeletonMatrixData&&(this._skintype=this.useBoneShader(this.materials[0]),1==this._skintype?(this.maxBoneCount=24,this._skeletonMatrixData=new Float32Array(16*this.maxBoneCount),this._efficient=!1):2==this._skintype&&(this.maxBoneCount=55,this._skeletonMatrixData=new Float32Array(8*this.maxBoneCount),this._efficient=!0)),null!=this.materials&&this.materials.length>0){var r=this.materials[0];r&&(this.layer=r.getLayer(),this.issetq||(this._queue=r.getQueue()))}if(null!=this.player){if(this.player.isCache&&!this.player.mix){var i=this.player.cacheKey+"_"+this.mesh.getGUID(),o=a.dataCaches[i];if(o)return void(this.cacheData=o);var n=e.AniPlayer.playerCaches[this.player.cacheKey];if(n)return o=new Float32Array(480),n.fillPoseData(o,this.bones,!0),a.dataCaches[i]=o,void(this.cacheData=o)}this.cacheData=null,null!=this._skeletonMatrixData&&this.player.fillPoseData(this._skeletonMatrixData,this.bones,this._efficient)}},r.prototype.render=function(t,e){null!=this.player&&t.updateModel(this.player.gameObject.transform);for(var r=0;r<this.materials.length;r++)null!=this.materials[r]&&(null!=this.cacheData&&this._skintype>0?t.updateBones(this.cacheData):null!=this._skeletonMatrixData&&this._skintype>0&&t.updateBones(this._skeletonMatrixData));if(null!=this._mesh&&null!=this._mesh&&null!=this._mesh.submesh)for(var a=0;a<this._mesh.submesh.length;a++){var i=this._mesh.submesh[a],o=this._mesh.submesh[a].matIndex,n=this.materials[o];null!=n&&n.draw(t,this._mesh,i,"skin")}},r.prototype.remove=function(){this.mesh&&this.mesh.unuse(!0),this.bones.length=0},r.prototype.clone=function(){},r.prototype.useBoneShader=function(t){var e=t.getShader().passes.skin;return null==e||0==e.length?0:e[0].uniforms.glstate_vec4_bones?2:e[0].uniforms.glstate_matrix_bones?1:0},r.dataCaches=[],__decorate([t.reflect.Field("Material[]"),__metadata("design:type",Array)],r.prototype,"materials",void 0),__decorate([t.reflect.Field("Mesh"),__metadata("design:type",Object),__metadata("design:paramtypes",[e.Mesh])],r.prototype,"mesh",null),__decorate([t.reflect.Field("Transform[]"),__metadata("design:type",Array)],r.prototype,"bones",void 0),__decorate([t.reflect.Field("Transform"),__metadata("design:type",e.Transform)],r.prototype,"rootBone",void 0),__decorate([t.reflect.Field("Vector3"),__metadata("design:type",t.math.Vector3)],r.prototype,"center",void 0),__decorate([t.reflect.Field("Vector3"),__metadata("design:type",t.math.Vector3)],r.prototype,"size",void 0),r=a=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],r);var a}();e.SkinnedMeshRenderer=r,__reflect(r.prototype,"egret3d.framework.SkinnedMeshRenderer",["egret3d.framework.IRenderer","egret3d.framework.INodeComponent"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(e,r){this.center=t.math.Pool.clone_vector3(e),this.srcradius=r,this.tempScale=new t.math.Vector3}return r.prototype.update=function(e){t.math.matrixGetTranslation(e,this.center),t.math.matrixGetScale(e,this.tempScale),this.tempScale.x<this.tempScale.y&&(this.tempScale.x=this.tempScale.y),this.tempScale.x<this.tempScale.z&&(this.tempScale.x=this.tempScale.z),this.radius=this.srcradius*this.tempScale.x},r.prototype.intersects=function(a){if(a instanceof r){var i=t.math.vec3Distance(this.center,a.center);return i>this.radius+a.radius?!1:!0}a instanceof e.Obb},r}();e.Spherestruct=r,__reflect(r.prototype,"egret3d.framework.Spherestruct");var a=function(){function a(){this._worldCenter=new t.math.Vector3,this._colliderVisible=!1}return Object.defineProperty(a.prototype,"worldCenter",{get:function(){return t.math.vec3Clone(this.center,this._worldCenter),t.math.matrixTransformVector3(this._worldCenter,this.gameObject.transform.getWorldMatrix(),this._worldCenter),this._worldCenter},enumerable:!0,configurable:!0}),a.prototype.getBound=function(){return this.spherestruct},Object.defineProperty(a.prototype,"matrix",{get:function(){return this.gameObject?this.gameObject.transform.getWorldMatrix():new t.math.Matrix},enumerable:!0,configurable:!0}),a.prototype.start=function(){this.filter=this.gameObject.getComponent("MeshFilter"),this.build()},a.prototype.update=function(t){this.spherestruct&&this.spherestruct.update(this.matrix)},Object.defineProperty(a.prototype,"colliderVisible",{get:function(){return this._colliderVisible},set:function(t){this._colliderVisible=t,this.subTran&&(this.subTran.gameObject.visible=this._colliderVisible)},enumerable:!0,configurable:!0}),a.prototype.intersectsTransform=function(t){if(null==t.gameObject.collider)return!1;if(null==this.spherestruct||null==t.gameObject.collider.getBound())return!1;var e=t.gameObject.collider.getBound();return this.spherestruct.intersects(e)},a.prototype.build=function(){this.center&&this.radius&&(this.spherestruct=new r(this.center,this.radius))},a.prototype.buildMesh=function(){this.subTran=new t.framework.Transform,this.subTran.gameObject.hideFlags=e.HideFlags.DontSave|e.HideFlags.HideInHierarchy,this.subTran.name="spherecollider";var r=this.subTran.gameObject.addComponent("MeshFilter");r.mesh=this.getColliderMesh();this.subTran.gameObject.addComponent("MeshRenderer");this.subTran.gameObject.visible=this._colliderVisible,this.gameObject.transform.addChild(this.subTran)},a.prototype.getColliderMesh=function(){var t=new e.Mesh;return t},a.prototype.remove=function(){this.subTran&&this.subTran.dispose()},a.prototype.clone=function(){},__decorate([t.reflect.Field("Vector3"),__metadata("design:type",t.math.Vector3)],a.prototype,"center",void 0),__decorate([t.reflect.Field("number"),__metadata("design:type",Number)],a.prototype,"radius",void 0),a=__decorate([t.reflect.nodeComponent,t.reflect.nodeSphereCollider],a)}();e.SphereCollider=a,__reflect(a.prototype,"egret3d.framework.SphereCollider",["egret3d.framework.INodeComponent","egret3d.framework.ICollider"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.frustumTest=!1,this.layer=e.RenderLayerEnum.Common,this.renderLayer=e.CullingMask.Default,this.queue=0,this._startWidth=1,this._endWidth=0,this.lifetime=.35,this.minStickDistance=.1,this.maxStickCout=12,this.nodes=[],this.interpolate=!1,this.interpNumber=3,this.interpPath=[],this.activeMaxpointlimit=!1,this.notRender=!1}return Object.defineProperty(r.prototype,"material",{get:function(){if(void 0!=this._material)return this._material;var r=new t.framework.Material;return r.setShader(e.DefaultShaders.Diffuse),this._material=r,this._material},set:function(t){this._material=t,this.layer=this._material.getLayer()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"startColor",{get:function(){return void 0==this._startColor&&(this._startColor=new t.math.Color(1,1,1,1)),this._startColor},set:function(t){this._startColor=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"endColor",{get:function(){return void 0==this._endColor&&(this._endColor=new t.math.Color(this.startColor.r,this.startColor.g,this.startColor.b,0)),this._endColor},set:function(t){this._endColor=t},enumerable:!0,configurable:!0}),r.prototype.setWidth=function(t,e){void 0===e&&(e=0),this._startWidth=t,this._endWidth=e},r.prototype.setMaxpointcontroll=function(t){void 0===t&&(t=!1),this.activeMaxpointlimit=t},r.prototype.start=function(){this.app=this.gameObject.getScene().app,this.webgl=t.render.Webglkit.webgl,this.mesh=new t.framework.Mesh,this.mesh.data=new t.render.MeshData,this.mesh.glMesh=new t.render.GlMesh,this.dataForVbo=new Float32Array(128),this.dataForEbo=new Uint16Array(128);var r=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0;this.mesh.glMesh.initBuffer(this.webgl,r,128,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.webgl,this.dataForEbo.length),this.mesh.submesh=[];var a=new e.SubMeshInfo;a.matIndex=0,a.useVertexIndex=0,a.start=0,a.size=this.dataForEbo.length,a.line=!1,this.mesh.submesh.push(a),this.interpolate?(this.maxStickCout*=this.interpNumber,this.targetPath=this.interpPath):this.targetPath=this.nodes},r.prototype.update=function(t){var e=this.app.getTotalTime();this.refreshTrailNode(e),this.updateTrailData(e)},r.prototype.remove=function(){},r.prototype.refreshTrailNode=function(e){for(;this.targetPath.length>0&&e>this.targetPath[this.targetPath.length-1].time+this.lifetime;)this.targetPath.pop();var r=new t.math.Vector3;t.math.vec3Clone(this.gameObject.transform.getPosition(),r);var i=this.targetPath.length;if(!(0!=i&&t.math.vec3Distance(r,this.targetPath[0].location)<this.minStickDistance)){var o=new t.math.Vector3;this.gameObject.transform.getUp(o);var n=new a(r,o,e);if(this.nodes.unshift(n),this.interpolate&&this.nodes.length>2){var s=new t.math.Vector3;if(t.math.vec3Subtract(this.nodes[2].location,this.nodes[0].location,s),t.math.vec3Normalize(s,s),this.nodes[1].handle=s,void 0==this.nodes[2].handle){var h=new t.math.Vector3;t.math.vec3Subtract(this.nodes[2].location,this.nodes[1].location,h),t.math.vec3Normalize(h,h),this.nodes[2].handle=h}for(var l=t.math.vec3Distance(this.nodes[2].location,this.nodes[1].location),c=0;c<this.interpNumber;c++){var u=(c+1)/(this.interpNumber+1),d=new t.math.Vector3,p=t.math.Pool.new_vector3(),m=t.math.Pool.new_vector3();m.x=-this.nodes[2].handle.x,m.y=-this.nodes[2].handle.y,m.z=-this.nodes[2].handle.z,t.math.vec3ScaleByNum(m,l/2,m),t.math.vec3Add(m,this.nodes[2].location,m),t.math.vec3ScaleByNum(this.nodes[1].handle,l/2,p),t.math.vec3Add(p,this.nodes[1].location,p),t.math.GetPointAlongCurve(this.nodes[2].location,m,this.nodes[1].location,p,(c+1)/(this.interpNumber+1),d);var f=new t.math.Vector3;t.math.vec3SLerp(this.nodes[1].updir,this.nodes[2].updir,u,f);var v=new a(d,f,e);this.interpPath.splice(1,0,v),t.math.Pool.delete_vector3(p),t.math.Pool.delete_vector3(m)}this.interpPath.unshift(n)}if(this.activeMaxpointlimit)for(;this.targetPath.length>this.maxStickCout;)this.targetPath.pop()}},r.prototype.updateTrailData=function(e){if(this.nodes.length<2)return void(this.notRender=!0);this.notRender=!1,this.checkBufferSize();for(var r=0;r<this.targetPath.length;r++){var a=this.targetPath[r],i=r/this.targetPath.length,o=(e-a.time)/this.lifetime,n=new t.math.Vector3;t.math.vec3Clone(a.updir,n);var s=this._startWidth+(this._endWidth-this._startWidth)*o;t.math.vec3ScaleByNum(n,s,n);var h=t.math.Pool.new_vector3();t.math.vec3Add(a.location,n,h),this.dataForVbo[2*r*9+0]=h.x,this.dataForVbo[2*r*9+1]=h.y,this.dataForVbo[2*r*9+2]=h.z;var l=t.math.Pool.new_color();t.math.colorLerp(this.startColor,this.endColor,o,l),this.dataForVbo[2*r*9+3]=l.r,this.dataForVbo[2*r*9+4]=l.g,this.dataForVbo[2*r*9+5]=l.b,this.dataForVbo[2*r*9+6]=l.a,this.dataForVbo[2*r*9+7]=i,this.dataForVbo[2*r*9+8]=1,this.dataForVbo[9*(2*r+1)+0]=a.location.x,this.dataForVbo[9*(2*r+1)+1]=a.location.y,this.dataForVbo[9*(2*r+1)+2]=a.location.z,this.dataForVbo[9*(2*r+1)+3]=l.r,this.dataForVbo[9*(2*r+1)+4]=l.g,this.dataForVbo[9*(2*r+1)+5]=l.b,this.dataForVbo[9*(2*r+1)+6]=l.a;var i=r/this.nodes.length;this.dataForVbo[9*(2*r+1)+7]=i,this.dataForVbo[9*(2*r+1)+8]=0,t.math.Pool.delete_vector3(h),t.math.Pool.delete_color(l)}for(var c=0;c<this.nodes.length-1;c++)this.dataForEbo[6*c+0]=2*c,this.dataForEbo[6*c+1]=2*(c+1),this.dataForEbo[6*c+2]=2*c+1,this.dataForEbo[6*c+3]=2*c+1,this.dataForEbo[6*c+4]=2*(c+1),this.dataForEbo[6*c+5]=2*(c+1)+1},r.prototype.checkBufferSize=function(){var t=this.targetPath.length;if(2*t*9>this.dataForVbo.length){var e=this.dataForVbo.length;this.mesh.glMesh.resetVboSize(this.webgl,2*e),this.dataForVbo=new Float32Array(2*e)}if(6*(t-1)>this.dataForEbo.length){var e=this.dataForEbo.length;this.mesh.glMesh.resetEboSize(this.webgl,0,2*e),this.dataForEbo=new Uint16Array(2*e)}},r.prototype.render=function(t,e){this.notRender||(t.updateModeTrail(),this.mesh.glMesh.uploadVertexSubData(t.webgl,this.dataForVbo),this.mesh.glMesh.uploadIndexSubData(t.webgl,0,this.dataForEbo),this.mesh.submesh[0].size=6*(this.targetPath.length-1),this.material.draw(t,this.mesh,this.mesh.submesh[0],"base"))},r.prototype.clone=function(){},r=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],r)}();e.TrailRender_recorde=r,__reflect(r.prototype,"egret3d.framework.TrailRender_recorde",["egret3d.framework.IRenderer","egret3d.framework.INodeComponent"]);var a=function(){function t(t,e,r){this.location=t,this.updir=e,this.time=r}return t}();e.TrailNode=a,__reflect(a.prototype,"egret3d.framework.TrailNode")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.frustumTest=!1,this.layer=e.RenderLayerEnum.Common,this.renderLayer=e.CullingMask.Default,this.queue=0,this.vertexcount=24,this.active=!1,this.reInit=!1,this.extenedOneSide=!0,this.speed=.5,this.width=1,this.lookAtCamera=!1}return r.prototype.start=function(){this.app=this.gameObject.getScene().app,this.webgl=t.render.Webglkit.webgl,this.initmesh()},r.prototype.update=function(e){if(this.active){this.reInit&&(this.intidata(),this.reInit=!1);var r=this.gameObject.transform.getPosition();if(this.lookAtCamera){this.camerapositon=this.app.getScene().mainCamera.gameObject.transform.getPosition();var a=t.math.Pool.new_vector3();t.math.vec3Subtract(this.camerapositon,this.sticks[0].location,a),t.math.vec3Normalize(a,a);var i=t.math.Pool.new_vector3();t.math.vec3Subtract(r,this.sticks[0].location,i),t.math.vec3Normalize(i,i),t.math.vec3Cross(a,i,this.sticks[0].updir),t.math.vec3ScaleByNum(this.sticks[0].updir,this.width,this.sticks[0].updir),t.math.Pool.delete_vector3(i)}t.math.vec3Clone(r,this.sticks[0].location);for(var o=this.sticks.length,n=1;o>n;n++)t.math.vec3SLerp(this.sticks[n].location,this.sticks[n-1].location,this.speed,this.sticks[n].location);if(this.lookAtCamera)for(var n=1;o>n;n++){var s=t.math.Pool.new_vector3();t.math.vec3Subtract(this.camerapositon,this.sticks[n].location,s),t.math.vec3Normalize(s,s);var h=t.math.Pool.new_vector3();t.math.vec3Subtract(this.sticks[n-1].location,this.sticks[n].location,h),t.math.vec3Normalize(h,h),t.math.vec3Cross(s,h,this.sticks[n].updir),t.math.vec3ScaleByNum(this.sticks[n].updir,this.width,this.sticks[n].updir),t.math.Pool.delete_vector3(s)}else{this.gameObject.transform.getUp(this.sticks[0].updir),t.math.vec3ScaleByNum(this.sticks[0].updir,this.width,this.sticks[0].updir);for(var n=1;o>n;n++)t.math.vec3SLerp(this.sticks[n].updir,this.sticks[n-1].updir,this.speed,this.sticks[n].updir)}this.updateTrailData()}},Object.defineProperty(r.prototype,"material",{get:function(){if(void 0!=this._material)return this._material;var r=new t.framework.Material;return r.setShader(e.DefaultShaders.Diffuse),this.material=r,this._material},set:function(t){this._material=t,this.layer=this.material.getLayer()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"color",{get:function(){return void 0==this._color&&(this._color=new t.math.Color(1,1,1,1)),this._color},set:function(t){this._color=t},enumerable:!0,configurable:!0}),r.prototype.setspeed=function(t){this.speed=t},r.prototype.setWidth=function(t){this.width=t},r.prototype.play=function(){this.reInit=!0,this.active=!0},r.prototype.stop=function(){this.active=!1},r.prototype.initmesh=function(){this.mesh=new t.framework.Mesh,this.mesh.data=new t.render.MeshData,this.mesh.glMesh=new t.render.GlMesh,this.dataForVbo=new Float32Array(9*this.vertexcount),this.dataForEbo=new Uint16Array(6*(this.vertexcount/2-1));var r=t.render.VertexFormatMask.Position|t.render.VertexFormatMask.Color|t.render.VertexFormatMask.UV0;this.mesh.glMesh.initBuffer(this.webgl,r,this.vertexcount,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.webgl,this.dataForEbo.length),this.mesh.submesh=[];var a=new e.SubMeshInfo;a.matIndex=0,a.useVertexIndex=0,a.start=0,a.size=this.dataForEbo.length,a.line=!1,this.mesh.submesh.push(a)},r.prototype.intidata=function(){this.sticks=[];for(var e=0;e<this.vertexcount/2;e++){var r=new a;this.sticks.push(r),r.location=new t.math.Vector3,t.math.vec3Clone(this.gameObject.transform.getPosition(),r.location),r.updir=new t.math.Vector3,this.gameObject.transform.getUp(r.updir),t.math.vec3ScaleByNum(r.updir,this.width,r.updir)}var i=this.vertexcount/2,o=t.math.Pool.new_vector3();this.gameObject.transform.getUp(o),t.math.vec3ScaleByNum(o,this.width,o);var n=t.math.Pool.new_vector3();t.math.vec3Clone(this.gameObject.transform.getPosition(),n);var s=t.math.Pool.new_vector3();t.math.vec3Add(n,o,s);var h=t.math.Pool.new_vector3();t.math.vec3Subtract(n,o,h);for(var e=0;i>e;e++)this.dataForVbo[2*e*9]=s.x,this.dataForVbo[2*e*9+1]=s.y,this.dataForVbo[2*e*9+2]=s.z,this.dataForVbo[2*e*9+3]=this.color.r,this.dataForVbo[2*e*9+4]=this.color.g,this.dataForVbo[2*e*9+5]=this.color.b,this.dataForVbo[2*e*9+6]=this.color.a,this.dataForVbo[2*e*9+7]=e/(i-1),this.dataForVbo[2*e*9+8]=0,this.dataForVbo[9*(2*e+1)]=h.x,this.dataForVbo[9*(2*e+1)+1]=h.y,this.dataForVbo[9*(2*e+1)+2]=h.z,this.dataForVbo[9*(2*e+1)+3]=this.color.r,this.dataForVbo[9*(2*e+1)+4]=this.color.g,this.dataForVbo[9*(2*e+1)+5]=this.color.b,this.dataForVbo[9*(2*e+1)+6]=this.color.a,this.dataForVbo[9*(2*e+1)+7]=e/(i-1),this.dataForVbo[9*(2*e+1)+8]=1;for(var l=0;i-1>l;l++)this.dataForEbo[6*l+0]=2*l,this.dataForEbo[6*l+1]=2*(l+1),this.dataForEbo[6*l+2]=2*l+1,this.dataForEbo[6*l+3]=2*l+1,this.dataForEbo[6*l+4]=2*(l+1),this.dataForEbo[6*l+5]=2*(l+1)+1;this.mesh.glMesh.uploadVertexSubData(this.webgl,this.dataForVbo),this.mesh.glMesh.uploadIndexSubData(this.webgl,0,this.dataForEbo),t.math.Pool.delete_vector3(o),t.math.Pool.delete_vector3(n),t.math.Pool.delete_vector3(s),t.math.Pool.delete_vector3(h)},r.prototype.updateTrailData=function(){var t=this.vertexcount/2;if(this.extenedOneSide)for(var e=0;t>e;e++){var r=this.sticks[e].location,a=this.sticks[e].updir;this.dataForVbo[2*e*9]=r.x,this.dataForVbo[2*e*9+1]=r.y,this.dataForVbo[2*e*9+2]=r.z,this.dataForVbo[9*(2*e+1)]=r.x+a.x,this.dataForVbo[9*(2*e+1)+1]=r.y+a.y,this.dataForVbo[9*(2*e+1)+2]=r.z+a.z}else for(var e=0;t>e;e++){var r=this.sticks[e].location,a=this.sticks[e].updir;this.dataForVbo[2*e*9]=r.x-a.x,this.dataForVbo[2*e*9+1]=r.y-a.y,this.dataForVbo[2*e*9+2]=r.z-a.z,this.dataForVbo[9*(2*e+1)]=r.x+a.x,this.dataForVbo[9*(2*e+1)+1]=r.y+a.y,this.dataForVbo[9*(2*e+1)+2]=r.z+a.z}},r.prototype.render=function(t,e){this.active&&(t.updateModeTrail(),this.mesh.glMesh.uploadVertexSubData(t.webgl,this.dataForVbo),this.material.draw(t,this.mesh,this.mesh.submesh[0],"base"))},r.prototype.clone=function(){},r.prototype.remove=function(){},r=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent],r)}();e.TrailRender=r,__reflect(r.prototype,"egret3d.framework.TrailRender",["egret3d.framework.IRenderer","egret3d.framework.INodeComponent"]);var a=function(){function t(){}return t}();__reflect(a.prototype,"TrailStick")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(e){this._touchPoint=new t.math.Vector2,this.keyboard=new t.input.KeyboardDevice(window),this.mouse=new t.input.MouseDevice(e.webgl.canvas),this.touch=new t.input.TouchDevice(e.webgl.canvas)}return e.prototype.update=function(t){this.keyboard.update(),this.mouse.update(),this.touch.update()},e.prototype.isPressed=function(){if(this.mouse.isPressed(0))return!0;var e=this.touch.getTouch(0);return!e||1!=this.touch.touchCount||e.phase!=t.input.TouchPhase.MOVED&&e.phase!=t.input.TouchPhase.STATIONARY?!1:!0},e.prototype.wasPressed=function(){if(this.mouse.wasPressed(0))return!0;var e=this.touch.getTouch(0);return e&&1==this.touch.touchCount&&e.phase==t.input.TouchPhase.BEGAN?!0:!1},e.prototype.wasReleased=function(){if(this.mouse.wasReleased(0))return!0;var e=this.touch.getTouch(0);return!e||1!=this.touch.touchCount||e.phase!=t.input.TouchPhase.ENDED&&e.phase!=t.input.TouchPhase.CANCELED?!1:!0},e.prototype.getTouchPoint=function(){var t=this.touch.getTouch(0);return t?(this._touchPoint.x=t.position.x,this._touchPoint.y=t.position.y):(this._touchPoint.x=this.mouse.position.x,this._touchPoint.y=this.mouse.position.y),this._touchPoint},e}();e.InputManager=r,__reflect(r.prototype,"egret3d.framework.InputManager")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e={TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,WIN:91},r=function(){function t(t,e){void 0===e&&(e={preventDefault:!1,stopPropagation:!1}),this._element=null,this._keymap={},this._lastmap={},this._keyDownHandler=this._handleKeyDown.bind(this),this._keyUpHandler=this._handleKeyUp.bind(this),this._keyPressHandler=this._handleKeyPress.bind(this),this._cacheKeyCodeMap={},this.attach(t),this.preventDefault=e.preventDefault,this.stopPropagation=e.stopPropagation}return t.prototype.attach=function(t){this._element&&this.detach(),this._element=t,this._element.addEventListener("keydown",this._keyDownHandler,!1),this._element.addEventListener("keypress",this._keyPressHandler,!1),this._element.addEventListener("keyup",this._keyUpHandler,!1)},t.prototype.detach=function(){this._element&&(this._element.removeEventListener("keydown",this._keyDownHandler,!1),this._element.removeEventListener("keypress",this._keyPressHandler,!1),this._element.removeEventListener("keyup",this._keyUpHandler,!1),this._element=null)},t.prototype._handleKeyDown=function(t){var e=t.keyCode||t.charCode,r=this._toKeyIdentifier(e);this._keymap[r]=!0,this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},t.prototype._handleKeyPress=function(t){var e=t.keyCode||t.charCode;this._toKeyIdentifier(e);this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},t.prototype._handleKeyUp=function(t){var e=t.keyCode||t.charCode,r=this._toKeyIdentifier(e);delete this._keymap[r],this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},t.prototype._toKeyIdentifier=function(t){var r;if("string"==typeof t){var a=t.toUpperCase();if(!this._cacheKeyCodeMap[t]){var i=e[a]||a.charCodeAt(0);this._cacheKeyCodeMap[a]=i}r=this._cacheKeyCodeMap[a]}else r=t;for(var o=r.toString(16).toUpperCase(),n=o.length,s=0;4-n>s;s++)o="0"+o;return"U+"+o},t.prototype.update=function(){var t;for(t in this._lastmap)delete this._lastmap[t];for(t in this._keymap)this._keymap.hasOwnProperty(t)&&(this._lastmap[t]=this._keymap[t])},t.prototype.isPressed=function(t){var e=this._toKeyIdentifier(t);return this._keymap[e]},t.prototype.wasPressed=function(t){var e=this._toKeyIdentifier(t);return this._keymap[e]&&!this._lastmap[e]},t.prototype.wasReleased=function(t){var e=this._toKeyIdentifier(t);return!this._keymap[e]&&this._lastmap[e]},t}();t.KeyboardDevice=r,__reflect(r.prototype,"egret3d.input.KeyboardDevice")}(e=t.input||(t.input={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(e){function r(r){var a=e.call(this)||this;return a._offsetX=0,a._offsetY=0,a._scaler=1,a.position=new t.math.Vector2,a.wheel=0,a._buttons=[!1,!1,!1],a._lastbuttons=[!1,!1,!1],a._element=null,a._upHandler=a._handleUp.bind(a),a._moveHandler=a._handleMove.bind(a),a._downHandler=a._handleDown.bind(a),a._wheelHandler=a._handleWheel.bind(a),a._contextMenuHandler=function(t){t.preventDefault()},a.attach(r),a}return __extends(r,e),r.prototype.updateOffsetAndScale=function(t,e,r){this._offsetX=t,this._offsetY=e,this._scaler=r},r.prototype.convertPosition=function(t,e){e.x=(t.clientX-this._offsetX)*this._scaler,e.y=(t.clientY-this._offsetY)*this._scaler},r.prototype.disableContextMenu=function(){this._element&&this._element.addEventListener("contextmenu",this._contextMenuHandler)},r.prototype.enableContextMenu=function(){this._element&&this._element.removeEventListener("contextmenu",this._contextMenuHandler)},r.prototype.attach=function(t){this._element&&this.detach(),this._element=t,this._element.addEventListener("mouseup",this._upHandler,!1),this._element.addEventListener("mousemove",this._moveHandler,!1),this._element.addEventListener("mousedown",this._downHandler,!1),this._element.addEventListener("mousewheel",this._wheelHandler,!1),this._element.addEventListener("DOMMouseScroll",this._wheelHandler,!1)},r.prototype.detach=function(){this._element&&(this._element.removeEventListener("mouseup",this._upHandler,!1),this._element.removeEventListener("mousemove",this._moveHandler,!1),this._element.removeEventListener("mousedown",this._downHandler,!1),this._element.removeEventListener("mousewheel",this._wheelHandler,!1),this._element.removeEventListener("DOMMouseScroll",this._wheelHandler,!1),this._element=null)},r.prototype.update=function(){this._lastbuttons[0]=this._buttons[0],this._lastbuttons[1]=this._buttons[1],this._lastbuttons[2]=this._buttons[2],this.wheel=0},r.prototype.isPressed=function(t){return this._buttons[t]},r.prototype.wasPressed=function(t){return this._buttons[t]&&!this._lastbuttons[t]},r.prototype.wasReleased=function(t){return!this._buttons[t]&&this._lastbuttons[t]},r.prototype._handleUp=function(t){this._buttons[t.button]=!1,this.convertPosition(t,this.position),this.dispatchEvent({type:"mouseup",x:this.position.x,y:this.position.y,identifier:t.button})},r.prototype._handleMove=function(t){this.convertPosition(t,this.position),this._buttons[t.button]&&this.dispatchEvent({type:"mousemove",x:this.position.x,y:this.position.y,identifier:t.button})},r.prototype._handleDown=function(t){this._buttons[t.button]=!0,this.convertPosition(t,this.position),this.dispatchEvent({type:"mousedown",x:this.position.x,y:this.position.y,identifier:t.button})},r.prototype._handleWheel=function(t){t.detail?this.wheel=-1*t.detail:t.wheelDelta?this.wheel=t.wheelDelta/120:this.wheel=0},r}(t.framework.EventDispatcher);e.MouseDevice=r,__reflect(r.prototype,"egret3d.input.MouseDevice")}(e=t.input||(t.input={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.BEGAN=0]="BEGAN",t[t.MOVED=1]="MOVED",t[t.STATIONARY=2]="STATIONARY",t[t.ENDED=3]="ENDED",t[t.CANCELED=4]="CANCELED"}(r=e.TouchPhase||(e.TouchPhase={}));var a=function(){function e(){this.altitudeAngle=Math.PI/2,this.azimuthAngle=0,this.deltaPosition=new t.math.Vector2,this.fingerId=0,this.maximumPossiblePressure=1,this.position=new t.math.Vector2,this.pressure=1,this.radius=new t.math.Vector2,this.type="Direct"}return e.prototype.set=function(e,a,i){this.altitudeAngle=e.rotationAngle,this.azimuthAngle=e.rotationAngle,a==r.BEGAN||a==r.STATIONARY?(this.deltaPosition.x=0,this.deltaPosition.y=0):(i.convertPosition(e,this.deltaPosition),t.math.vec2Subtract(this.deltaPosition,this.position,this.deltaPosition)),this.fingerId=e.identifier,this.phase=a,i.convertPosition(e,this.position),this.pressure=e.force,this.radius.x=e.radiusX,this.radius.y=e.radiusY},e.create=function(){return this._pointPool.pop()||new e},e.release=function(t){this._pointPool.push(t)},e._pointPool=[],e}();e.TouchPoint=a,__reflect(a.prototype,"egret3d.input.TouchPoint");var i=function(t){function e(e,r){void 0===r&&(r={preventDefault:!0,stopPropagation:!0});var a=t.call(this)||this;return a._offsetX=0,a._offsetY=0,a._scaler=1,a._touchesMap={},a._touches=[],a.touchCount=0,a._startHandler=a._handleTouchStart.bind(a),a._endHandler=a._handleTouchEnd.bind(a),a._moveHandler=a._handleTouchMove.bind(a),a._cancelHandler=a._handleTouchCancel.bind(a),a._element=null,a.attach(e),a.preventDefault=r.preventDefault,a.stopPropagation=r.stopPropagation,a}return __extends(e,t),e.prototype.updateOffsetAndScale=function(t,e,r){this._offsetX=t,this._offsetY=e,this._scaler=r},e.prototype.convertPosition=function(t,e){e.x=(t.clientX-this._offsetX)*this._scaler,e.y=(t.clientY-this._offsetY)*this._scaler},e.prototype.attach=function(t){this._element&&this.detach(),this._element=t,this._element.addEventListener("touchstart",this._startHandler,!1),this._element.addEventListener("touchend",this._endHandler,!1),this._element.addEventListener("touchmove",this._moveHandler,!1),this._element.addEventListener("touchcancel",this._cancelHandler,!1)},e.prototype.detach=function(){this._element&&(this._element.removeEventListener("touchstart",this._startHandler,!1),this._element.removeEventListener("touchend",this._endHandler,!1),this._element.removeEventListener("touchmove",this._moveHandler,!1),this._element.removeEventListener("touchcancel",this._cancelHandler,!1),this._element=null)},e.prototype.update=function(){for(var t in this._touchesMap){var e=this._touchesMap[t];if(e.phase===r.BEGAN&&(e.phase=r.STATIONARY),e.phase===r.MOVED&&(e.phase=r.STATIONARY),e.phase===r.ENDED||e.phase===r.CANCELED){delete this._touchesMap[t];var a=this._touches.indexOf(e);a>-1&&this._touches.splice(a,1),this.touchCount--}}},e.prototype.getTouch=function(t){return this._touches[t]},e.prototype._getTouch=function(t){var e=this._touchesMap[t];return e||(e=a.create(),this._touchesMap[t]=e,this._touches.push(e),this.touchCount++),e},e.prototype._handleTouchStart=function(t){1==t.isScroll||this._element.userTyping||t.preventDefault();for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e],i=a.identifier,o=this._getTouch(i);o.set(a,r.BEGAN,this),this.dispatchEvent({type:"touchstart",x:o.position.x,y:o.position.y,identifier:i})}this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},e.prototype._handleTouchEnd=function(t){for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e],i=a.identifier,o=this._getTouch(i);o.set(a,r.ENDED,this),this.dispatchEvent({type:"touchend",x:o.position.x,y:o.position.y,identifier:i})}this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},e.prototype._handleTouchMove=function(t){1==t.isScroll||this._element.userTyping||t.preventDefault();for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e],i=a.identifier,o=this._getTouch(i);o.set(a,r.MOVED,this),this.dispatchEvent({type:"touchmove",x:o.position.x,y:o.position.y,identifier:i})}this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},e.prototype._handleTouchCancel=function(t){for(var e=0;e<t.changedTouches.length;e++){var a=t.changedTouches[e],i=a.identifier,o=this._getTouch(i);o.set(a,r.CANCELED,this),this.dispatchEvent({type:"touchend",x:o.position.x,y:o.position.y,identifier:i})}this.preventDefault&&t.preventDefault(),this.stopPropagation&&t.stopPropagation()},e}(t.framework.EventDispatcher);e.TouchDevice=i,__reflect(i.prototype,"egret3d.input.TouchDevice")}(e=t.input||(t.input={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(t){void 0===t&&(t=65536),1024>t&&(t=1024),t>262144&&(t=262144),this._bufSize=t,this._buf=[],this._seekWritePos=0,this._seekWriteIndex=0,this._buf[0]=new Uint8Array(t),this._seekReadPos=0}return t.prototype.getLength=function(){return this._seekWriteIndex*this._bufSize+this._seekWritePos-this._seekReadPos},t.prototype.getBufLength=function(){return this._buf.length*this._bufSize},t.prototype.getBytesAvailable=function(){return this.getLength()},t.prototype.reset=function(){this._buf=[],this._seekWritePos=0,this._seekWriteIndex=0,this._buf[0]=new Uint8Array(this._bufSize),this._seekReadPos=0},t.prototype.dispose=function(){this._buf.splice(0),this._seekWritePos=0,this._seekWriteIndex=0,this._seekReadPos=0
},t.prototype.read=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=-1),0>r&&(r=t.length);for(var a=e;e+r>a;a++){if(this._seekReadPos>=this._seekWritePos&&0==this._seekWriteIndex)throw this.reset(),new Error("no data to read.");if(t[a]=this._buf[0][this._seekReadPos],this._seekReadPos++,this._seekReadPos>=this._bufSize){this._seekWriteIndex--,this._seekReadPos=0;var i=this._buf.shift();this._buf.push(i)}}},t.prototype.write=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=-1),0>r&&(r=t.length);for(var a=e;e+r>a;a++)this._buf[this._seekWriteIndex][this._seekWritePos]=t[a],this._seekWritePos++,this._seekWritePos>=this._bufSize&&(this._seekWriteIndex++,this._seekWritePos=0,this._buf.length<=this._seekWriteIndex&&this._buf.push(new Uint8Array(this._bufSize)))},t.prototype.getBuffer=function(){var t=0;t=this._seekWriteIndex>0?this._bufSize*(this._seekWriteIndex-1)+this._seekWritePos:this._seekWritePos;for(var e=new Uint8Array(t),r=0;r<this._seekWriteIndex-1;r++)e.set(this._buf[r],r*this._bufSize);for(var r=0;r<this._seekWritePos;r++)e[t-this._seekWritePos+r]=this._buf[this._seekWriteIndex][r];return e},t.prototype.getUint8Array=function(){return new Uint8Array(this.getBuffer())},t}();t.BinBuffer=e,__reflect(e.prototype,"egret3d.io.BinBuffer");var r=function(){function t(){}return t.getApplyFun=function(t){return Array.prototype.concat.apply([],t)},t.ULongToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0);var i=e%4294967296,o=e/4294967296|0;t.dataView.setUint32(0,i,!0),t.dataView.setUint32(4,o,!0);var n=new Uint8Array(t.dataView.buffer);if(null==r)r=new Uint8Array(t.dataView.buffer);else for(var s=0;8>s;s++)r[a+s]=n[s];return r},t.LongToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0);var i=e%4294967296,o=e/4294967296|0;t.dataView.setInt32(0,i,!0),t.dataView.setInt32(4,o,!0);var n=new Int8Array(t.dataView.buffer);if(null==r)r=new Int8Array(t.dataView.buffer);else for(var s=0;8>s;s++)r[a+s]=n[s];return r},t.Float64ToArray=function(e,r,a){if(void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setFloat64(0,e,!1),null==r)r=new Uint8Array(t.dataView.buffer);else for(var i=0;8>i;i++)r[a+i]=t.dataView.buffer[i];return r},t.Float32ToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setFloat32(0,e,!0);var i=new Uint8Array(t.dataView.buffer);if(null==r)r=t.getApplyFun(i).slice(0,4);else for(var o=0;4>o;o++)r[a+o]=i[o];return r},t.Int32ToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setInt32(0,e,!0);var i=new Uint8Array(t.dataView.buffer);if(null==r)r=t.getApplyFun(i).slice(0,4);else for(var o=0;4>o;o++)r[a+o]=i[o];return r},t.Int16ToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setInt16(0,e,!0);var i=new Uint8Array(t.dataView.buffer);if(null==r)r=t.getApplyFun(i).slice(0,2);else for(var o=0;2>o;o++)r[a+o]=i[o];return r},t.Int8ToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setInt8(0,e);var i=new Uint8Array(t.dataView.buffer);if(null==r)r=t.getApplyFun(i).slice(0,1);else for(var o=0;1>o;o++)r[a+o]=i[o];return r},t.Uint32toArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setInt32(0,e,!0);var i=new Uint8Array(t.dataView.buffer);if(null==r)r=t.getApplyFun(i).slice(0,4);else for(var o=0;4>o;o++)r[a+o]=i[o];return r},t.Uint16ToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setUint16(0,e,!0);var i=new Uint8Array(t.dataView.buffer);if(null==r)r=t.getApplyFun(i).slice(0,2);else for(var o=0;2>o;o++)r[a+o]=i[o];return r},t.Uint8ToArray=function(e,r,a){void 0===r&&(r=null),void 0===a&&(a=0),t.dataView.setUint8(0,e);var i=new Uint8Array(t.dataView.buffer);if(null==r)r=t.getApplyFun(i).slice(0,1);else for(var o=0;1>o;o++)r[a+o]=i[o];return r},t.StringToUtf8Array=function(t){for(var e=[],r=0;r<t.length;r++){var a=t.charAt(r),i=a.charCodeAt(0);if(i>65535)throw new Error("InvalidCharacterError");if(i>128)if(2047>i){var o=i>>>6|192,n=63&i|128;e.push(o,n)}else{var o=i>>>12|224,n=i>>>6&63|128,s=63&i|128;e.push(o,n,s)}else e.push(i)}return new Uint8Array(e)},t.ArrayToLong=function(e,r){void 0===r&&(r=0);for(var a=0;4>a;a++)t.dataView.setInt8(a,e[r+a]);for(var i=t.dataView.getInt32(0,!0),a=4;8>a;a++)t.dataView.setInt8(a,e[r+a]);var o=t.dataView.getInt32(4,!0);return i+=4294967296*o},t.ArrayToULong=function(e,r){void 0===r&&(r=0);for(var a=0;4>a;a++)t.dataView.setUint8(a,e[r+a]);for(var i=t.dataView.getUint32(0,!0),a=4;8>a;a++)t.dataView.setUint8(a,e[r+a]);var o=t.dataView.getUint32(4,!0);return i+=4294967296*o},t.ArrayToFloat64=function(e,r){void 0===r&&(r=0);for(var a=0;8>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getFloat64(0,!0)},t.ArrayToFloat32=function(e,r){void 0===r&&(r=0);for(var a=0;4>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getFloat32(0,!0)},t.ArrayToInt32=function(e,r){void 0===r&&(r=0);for(var a=0;4>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getInt32(0,!0)},t.ArrayToInt16=function(e,r){void 0===r&&(r=0);for(var a=0;2>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getInt16(0,!0)},t.ArrayToInt8=function(e,r){void 0===r&&(r=0);for(var a=0;1>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getInt8(0)},t.ArraytoUint32=function(e,r){void 0===r&&(r=0);for(var a=0;4>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getUint32(0,!0)},t.ArrayToUint16=function(e,r){void 0===r&&(r=0);for(var a=0;2>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getUint16(0,!0)},t.ArrayToUint8=function(e,r){void 0===r&&(r=0);for(var a=0;1>a;a++)t.dataView.setUint8(a,e[r+a]);return t.dataView.getUint8(0)},t.ArrayToString=function(t,e){void 0===e&&(e=0);for(var r=[],a=0;a<t.length;a++){var i=t[a];if(0==i)break;var o=0;if(i>224)o=(15&i)<<12,i=t[++a],o|=(63&i)<<6,i=t[++a],o|=63&i,r.push(String.fromCharCode(o));else if(i>192)o=(31&i)<<6,i=t[++a],o|=(63&i)<<6,r.push(String.fromCharCode(o));else{if(i>128)throw new Error("InvalidCharacterError");r.push(String.fromCharCode(t[a]))}}return r.join("")},t.dataView=new DataView(new ArrayBuffer(8),0,8),t}();t.Converter=r,__reflect(r.prototype,"egret3d.io.Converter");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.readSingle=function(){var t=new Uint8Array(4);return this.read(t),r.ArrayToFloat32(t)},e.prototype.readLong=function(){var t=new Uint8Array(8);return this.read(t),r.ArrayToLong(t)},e.prototype.readULong=function(){var t=new Uint8Array(8);return this.read(t),r.ArrayToULong(t)},e.prototype.readDouble=function(){var t=new Uint8Array(8);return this.read(t),r.ArrayToFloat64(t)},e.prototype.readInt8=function(){var t=new Uint8Array(1);return this.read(t),r.ArrayToInt8(t)},e.prototype.readUInt8=function(){var t=new Uint8Array(1);return this.read(t),r.ArrayToUint8(t)},e.prototype.readInt16=function(){var t=new Uint8Array(2);return this.read(t),r.ArrayToInt16(t)},e.prototype.readUInt16=function(){var t=new Uint8Array(2);return this.read(t),r.ArrayToUint16(t)},e.prototype.readInt32=function(){var t=new Uint8Array(4);return this.read(t),r.ArrayToInt32(t)},e.prototype.readUInt32=function(){var t=new Uint8Array(4);return this.read(t),r.ArraytoUint32(t)},e.prototype.readBoolean=function(){return this.readUInt8()>0},e.prototype.readByte=function(){return this.readUInt8()},e.prototype.readUnsignedShort=function(){return this.readUInt16()},e.prototype.readUnsignedInt=function(){return this.readUInt32()},e.prototype.readFloat=function(){return this.readSingle()},e.prototype.readSymbolByte=function(){return this.readInt8()},e.prototype.readShort=function(){return this.readInt16()},e.prototype.readInt=function(){return this.readInt32()},e.prototype.readBytes=function(t){var e=new Uint8Array(t);return this.read(e),e},e.prototype.readStringUtf8=function(){var t=this.readInt8(),e=new Uint8Array(t);return this.read(e),r.ArrayToString(e)},e.prototype.readStringUtf8FixLength=function(t){var e=new Uint8Array(t);return this.read(e),r.ArrayToString(e)},e.prototype.readUTFBytes=function(t){var e=new Uint8Array(t);return this.read(e),r.ArrayToString(e)},e.prototype.readStringAnsi=function(){for(var t=this.readUInt8(),e="",r=0;t>r;r++)e+=String.fromCharCode(this.readByte());return e},Object.defineProperty(e.prototype,"length",{get:function(){return this.getLength()},enumerable:!0,configurable:!0}),e.prototype.writeInt8=function(t){this.write(r.Int8ToArray(t))},e.prototype.writeUInt8=function(t){this.write(r.Uint8ToArray(t))},e.prototype.writeInt16=function(t){this.write(r.Int16ToArray(t))},e.prototype.writeUInt16=function(t){this.write(r.Uint16ToArray(t))},e.prototype.writeInt32=function(t){this.write(r.Int32ToArray(t))},e.prototype.writeUInt32=function(t){this.write(r.Uint32toArray(t))},e.prototype.writeSingle=function(t){this.write(r.Float32ToArray(t))},e.prototype.writeLong=function(t){this.write(r.LongToArray(t))},e.prototype.writeULong=function(t){this.write(r.ULongToArray(t))},e.prototype.writeDouble=function(t){this.write(r.Float64ToArray(t))},e.prototype.writeStringAnsi=function(t){var e=t.length;this.writeUInt8(e);for(var r=0;e>r;r++)this.writeUInt8(t.charCodeAt(r))},e.prototype.writeStringUtf8=function(t){var e=r.StringToUtf8Array(t);this.writeUInt8(e.length),this.write(e)},e.prototype.writeStringUtf8DataOnly=function(t){var e=r.StringToUtf8Array(t);this.write(e)},e.prototype.writeByte=function(t){this.write(r.Uint8ToArray(t))},e.prototype.writeBytes=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=-1),this.write(t,e,r)},e.prototype.writeUint8Array=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=-1),this.write(t,e,r)},e.prototype.writeUnsignedShort=function(t){this.write(r.Uint16ToArray(t))},e.prototype.writeUnsignedInt=function(t){this.write(r.Uint32toArray(t))},e.prototype.writeFloat=function(t){this.write(r.Float32ToArray(t))},e.prototype.writeUTFBytes=function(t){this.write(r.StringToUtf8Array(t))},e.prototype.writeSymbolByte=function(t){this.write(r.Int8ToArray(t))},e.prototype.writeShort=function(t){this.write(r.Int16ToArray(t))},e.prototype.writeInt=function(t){this.write(r.Int32ToArray(t))},e}(e);t.BinTool=a,__reflect(a.prototype,"egret3d.io.BinTool")}(e=t.io||(t.io={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){function r(t,r){return void 0===r&&(r=void 0),e.ReferenceInfo.oldmap={},r=n(t,r),e.ReferenceInfo.oldmap[t.insId.getInsID()]=r,a(t,r),r}function a(e,r){var a,o=t.framework.HideFlags.None;if(e.__gdmeta__&&e.__gdmeta__["class"]&&(a=t.reflect.getClassName(e)),"Transform"==a?o=e.gameObject.hideFlags:"Transform2D"==a&&(o=e.hideFlags),o&t.framework.HideFlags.DontSaveInBuild||o&t.framework.HideFlags.DontSaveInEditor||o&t.framework.HideFlags.HideInHierarchy)return null;for(var n in e.__gdmeta__){var s=e.__gdmeta__[n];if(null!=s.custom&&(null!=s.custom.SerializeField||null!=s.custom.nodecomp||null!=s.custom["2dcomp"])){var h=s.custom.valueType;if(null!=h)switch(h){case"number":case"string":case"boolean":break;default:i(e,r,n)}}}return r}function i(t,e,r){if(t[r])if(t[r].__gdmeta__)o(t,e,r);else if(t.__gdmeta__[r]&&t.__gdmeta__[r].custom&&t.__gdmeta__[r].custom.valueType)for(var a in t[r]){var i=t[r][a];if(i&&i.__gdmeta__){var n=i.__gdmeta__;n["class"]&&"UniformData"==n["class"].typename&&3==i.type||o(t[r],e[r],a,t,e,r)}}}function o(t,r,i,o,n,s){void 0===o&&(o=null),void 0===n&&(n=null),void 0===s&&(s="");var h=t[i].__gdmeta__;if(h["class"]&&h["class"].custom&&(h["class"].custom.SerializeType||h["class"].custom.nodecomp||h["class"].custom["2dcomp"])){var l=t instanceof Array,c=h["class"].typename;if(e.isAsset(c));else{var u=!1,d=-1,p=void 0;(l&&o.__gdmeta__&&o.__gdmeta__["class"]&&o.__gdmeta__["class"].custom&&(o.__gdmeta__["class"].custom.nodecomp||o.__gdmeta__["class"].custom["2dcomp"])||!l&&t.__gdmeta__&&t.__gdmeta__["class"]&&t.__gdmeta__["class"].custom&&(t.__gdmeta__["class"].custom.nodecomp||t.__gdmeta__["class"].custom["2dcomp"]))&&(h["class"].custom.nodecomp?(d=t[i].gameObject.transform.insId.getInsID(),u=!0,p=e.ReferenceInfo.oldmap[d].gameObject.getComponent(c)):h["class"].custom["2dcomp"]?(d=t[i].transform.insId.getInsID(),u=!0,p=e.ReferenceInfo.oldmap[d].getComponent(c)):("Transform"==c||"Transform2D"==c)&&(d=t[i].insId.getInsID(),u=!0,p=e.ReferenceInfo.oldmap[d])),u?l?r.push(p):r[i]=p:a(t[i],r[i])}}}function n(r,a){void 0===a&&(a=void 0);var i,o=t.framework.HideFlags.None;if(r.__gdmeta__&&r.__gdmeta__["class"]&&(i=t.reflect.getClassName(r)),"Transform"==i?o=r.gameObject.hideFlags:"Transform2D"==i&&(o=r.hideFlags),o&t.framework.HideFlags.DontSaveInBuild||o&t.framework.HideFlags.DontSaveInEditor||o&t.framework.HideFlags.HideInHierarchy)return null;if(void 0==a){var n=-1;a=t.reflect.createInstance(r,null),r.__gdmeta__["class"].custom.nodecomp?n=r.gameObject.transform.insId.getInsID():r.__gdmeta__["class"].custom["2dcomp"]?n=r.transform.insId.getInsID():("Transform"==r.__gdmeta__["class"].typename||"Transform2D"==r.__gdmeta__["class"].typename)&&(n=r.insId.getInsID(),e.ReferenceInfo.oldmap[n]=a)}for(var h in r.__gdmeta__){var l=r.__gdmeta__[h];if(null!=l.custom&&(null!=l.custom.SerializeField||null!=l.custom.nodecomp||null!=l.custom["2dcomp"])){var c=l.custom.valueType;if(null!=c)switch(c){case"number":case"string":case"boolean":a[h]=r[h];break;default:s(r,a,h)}}}return a}function s(t,e,r){if(t[r])if(t[r].__gdmeta__)h(t,e,r);else if(t.__gdmeta__[r]&&t.__gdmeta__[r].custom&&t.__gdmeta__[r].custom.valueType){var a=t[r]instanceof Array;a?e[r]=[]:e[r]={};for(var i in t[r]){var o=t[r][i];if(o&&o.__gdmeta__){var n=o.__gdmeta__;n["class"]&&"UniformData"==n["class"].typename&&3==o.type||h(t[r],e[r],i,t,e,r)}else if(!t[r].__gdmeta__){var s=typeof o;switch(s){case"number":case"string":case"boolean":a?e[r].push(o):e[r][i]=o}}}}}function h(r,a,i,o,s,h){void 0===o&&(o=null),void 0===s&&(s=null),void 0===h&&(h="");var l=r[i].__gdmeta__;if(l["class"]&&l["class"].custom&&(l["class"].custom.SerializeType||l["class"].custom.nodecomp||l["class"].custom["2dcomp"])){var c=r instanceof Array,u=l["class"].typename;if(e.isAsset(u)){r[i].defaultAsset;c?a.push(r[i]):a[i]=r[i]}else{var d=!1;if((c&&o.__gdmeta__&&o.__gdmeta__["class"]&&o.__gdmeta__["class"].custom&&(o.__gdmeta__["class"].custom.nodecomp||o.__gdmeta__["class"].custom["2dcomp"])||!c&&r.__gdmeta__&&r.__gdmeta__["class"]&&r.__gdmeta__["class"].custom&&(r.__gdmeta__["class"].custom.nodecomp||r.__gdmeta__["class"].custom["2dcomp"]))&&(l["class"].custom.nodecomp||l["class"].custom["2dcomp"]||"Transform"==u||"Transform2D"==u)&&(d=!0),d);else{var p=void 0;p=l["class"].custom.selfclone?r[i].clone():n(r[i],a[i]),null!=p&&(c?"NodeComponent"==u&&"components"==h&&"GameObject"==t.reflect.getClassName(o)?s.addComponentDirect(p.comp):"Transform"==u&&"children"==h&&"Transform"==t.reflect.getClassName(o)?s.addChild(p):"C2DComponent"==u&&"components"==h&&"Transform2D"==t.reflect.getClassName(o)?s.addComponentDirect(p.comp):"Transform2D"==u&&"children"==h&&"Transform2D"==t.reflect.getClassName(o)?s.addChild(p):a.push(p):a[i]=p)}}}}e.cloneObj=r}(e=t.io||(t.io={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t){var e=new Uint8Array(r(t)),a=new Blob([e]);return a}function r(t){for(var e=[],r=0;r<t.length;r++){var a=t.charAt(r),i=a.charCodeAt(0);if(i>65535)throw new Error("InvalidCharacterError");if(i>128)if(2047>i){var o=i>>>6|192,n=63&i|128;e.push(o,n)}else{var o=i>>>12|224,n=i>>>6&63|128,s=63&i|128;e.push(o,n,s)}else e.push(i)}return e}t.stringToBlob=e,t.stringToUtf8Array=r}(e=t.io||(t.io={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){function r(t){var e=JSON.stringify(a(t,!1));return e}function a(e,r,a){void 0===a&&(a=void 0);var o,n=t.framework.HideFlags.None;if(e.__gdmeta__&&e.__gdmeta__["class"]&&(o=t.reflect.getClassName(e)),"Transform"==o?n=e.gameObject.hideFlags:"Transform2D"==o&&(n=e.hideFlags),n&t.framework.HideFlags.HideInInspector)return null;void 0==a&&(a={});for(var s in e.__gdmeta__)if("children"!=s){var h=e.__gdmeta__[s];if(null!=h.custom&&(null!=h.custom.SerializeField||null!=h.custom.nodecomp||null!=h.custom["2dcomp"])){var l=h.custom.valueType;if(null!=l)switch(l){case"number":case"string":case"boolean":var c=new b(e[s],l);h.custom.FieldUIStyle&&(c.UIStyle=h.custom.FieldUIStyle),h.custom.defvalue&&(c.defvalue=h.custom.defvalue),h.custom.min&&(c.min=h.custom.min),h.custom.max&&(c.max=h.custom.max),a[s]=c;break;default:i(e,a,s,r)}}}return a}function i(t,e,r,a){if(t[r]){if(t[r].__gdmeta__)o(t,e,r,a);else if(t.__gdmeta__[r]&&t.__gdmeta__[r].custom&&t.__gdmeta__[r].custom.valueType){var i=t[r]instanceof Array;i?e[r]=new b([],t.__gdmeta__[r].custom.valueType):e[r]=new b({},t.__gdmeta__[r].custom.valueType);for(var n in t[r])if(t[r][n].__gdmeta__){var s=t[r][n].__gdmeta__;s["class"]&&"UniformData"==s["class"].typename&&3==t[r][n].type||o(t[r],e[r].value,n,a,t)}else if(!t[r].__gdmeta__){var h=typeof t[r][n];switch(h){case"number":case"string":case"boolean":var l=new b(t[r][n],h);i?e[r].value.push(l):e[r].value[n]=l}}}}else{var c=t instanceof Array;if(t.__gdmeta__[r]&&t.__gdmeta__&&t.__gdmeta__[r]&&t.__gdmeta__[r].custom){var u=t.__gdmeta__[r].custom,l=new b(null,u.valueType);u.FieldUIStyle&&(l.UIStyle=u.FieldUIStyle),u.defvalue&&(l.defvalue=u),u.min&&(l.min=u.min),u.max&&(l.max=u.max),c?e.push(l):e[r]=l}}}function o(t,e,r,i,o){void 0===o&&(o=null);var n=t[r].__gdmeta__;if(n["class"]&&n["class"].custom&&(n["class"].custom.SerializeType||n["class"].custom.nodecomp||n["class"].custom["2dcomp"])){var s=t instanceof Array,h=n["class"].typename;if(y(h)){var l=t[r].defaultAsset,c=t[r].getName();if(null!=c){l&&(c="SystemDefaultAsset-"+c);var u=new b(c,h);s?e.push(u):e[r]=u}}else{var d=!1,p=-1;if(s&&o.__gdmeta__&&o.__gdmeta__["class"]&&o.__gdmeta__["class"].custom&&(o.__gdmeta__["class"].custom.nodecomp||o.__gdmeta__["class"].custom["2dcomp"])||!s&&t.__gdmeta__&&t.__gdmeta__["class"]&&t.__gdmeta__["class"].custom&&(t.__gdmeta__["class"].custom.nodecomp||t.__gdmeta__["class"].custom["2dcomp"]))if(i=!0,n["class"].custom.nodecomp)p=t[r].gameObject.transform.insId.getInsID(),d=!0;else if(n["class"].custom["2dcomp"])p=t[r].transform.insId.getInsID(),d=!0;else if("Transform"==h||"Transform2D"==h)p=t[r].insId.getInsID(),d=!0;else if(!D.isRegType(h))return;if(d){var u=new b(p,h,"reference");if(t.__gdmeta__&&t.__gdmeta__[r]&&t.__gdmeta__[r].custom&&t.__gdmeta__[r].custom.FieldUIStyle){var m=t.__gdmeta__[r].custom;u.UIStyle=t.__gdmeta__[r].custom.FieldUIStyle,m.defvalue&&(u.defvalue=m),m.min&&(u.min=m.min),m.max&&(u.max=m.max)}s?e.push(u):e[r]=u}else{if(!D.isRegType(h)&&i)return;var f=a(t[r],i,e[r]);if(null!=f){var u=new b(f,h);if(t.__gdmeta__&&t.__gdmeta__[r]&&t.__gdmeta__[r].custom&&t.__gdmeta__[r].custom.FieldUIStyle){var m=t.__gdmeta__[r].custom;u.UIStyle=m.FieldUIStyle,m.defvalue&&(u.defvalue=m),m.min&&(u.min=m.min),m.max&&(u.max=m.max)}s?e.push(u):e[r]=u}}}}}function n(t){return JSON.stringify(s(t,null))}function s(e,r){void 0===r&&(r=void 0);var a,i=t.framework.HideFlags.None;if(e.__gdmeta__&&e.__gdmeta__["class"]&&(a=t.reflect.getClassName(e)),"Transform"==a?i=e.gameObject.hideFlags:"Transform2D"==a&&(i=e.hideFlags),i&t.framework.HideFlags.DontSaveInBuild||i&t.framework.HideFlags.DontSaveInEditor||i&t.framework.HideFlags.HideInHierarchy)return null;void 0==r&&(r=new x({},a),void 0!=e.insId&&(r.insid=e.insId.getInsID()));for(var o in e.__gdmeta__){var n=e.__gdmeta__[o];if(null!=n.custom&&(null!=n.custom.SerializeField||null!=n.custom.nodecomp||null!=n.custom["2dcomp"])){var s=n.custom.valueType;if(null!=s)switch(s){case"number":case"string":case"boolean":var l=new x(e[o],s);r.value[o]=l;break;default:h(e,r.value,o)}}}return r}function h(t,e,r){if(t[r])if(t[r].__gdmeta__)l(t,e,r,null);else if(t.__gdmeta__[r]&&t.__gdmeta__[r].custom&&t.__gdmeta__[r].custom.valueType){var a=t[r]instanceof Array;a?e[r]=new x([],t.__gdmeta__[r].custom.valueType):e[r]=new x({},t.__gdmeta__[r].custom.valueType);for(var i in t[r])if(t[r][i].__gdmeta__){var o=t[r][i].__gdmeta__;o["class"]&&"UniformData"==o["class"].typename&&3==t[r][i].type||l(t[r],e[r].value,i,t)}else if(!t[r].__gdmeta__){var n=typeof t[r][i];switch(n){case"number":case"string":case"boolean":var s=new x(t[r][i],n);a?e[r].value.push(s):e[r].value[i]=s}}}}function l(t,e,r,a){void 0===a&&(a=null);var i=t[r].__gdmeta__;if(i["class"]&&i["class"].custom&&(i["class"].custom.SerializeType||i["class"].custom.nodecomp||i["class"].custom["2dcomp"])){var o=t instanceof Array,n=i["class"].typename;if(g(n)){var h=t[r].defaultAsset,l=t[r].getName();null!=l&&(h?l="SystemDefaultAsset-"+l:w.GetAssetUrl(t[r]),o?e.push(new x(l,n)):e[r]=new x(l,n))}else{var c=!1,u=-1;if((o&&a.__gdmeta__&&a.__gdmeta__["class"]&&a.__gdmeta__["class"].custom&&(a.__gdmeta__["class"].custom.nodecomp||a.__gdmeta__["class"].custom["2dcomp"])||!o&&t.__gdmeta__&&t.__gdmeta__["class"]&&t.__gdmeta__["class"].custom&&(t.__gdmeta__["class"].custom.nodecomp||t.__gdmeta__["class"].custom["2dcomp"]))&&(i["class"].custom.nodecomp?(u=t[r].gameObject.transform.insId.getInsID(),c=!0):i["class"].custom["2dcomp"]?(u=t[r].transform.insId.getInsID(),c=!0):("Transform"==n||"Transform2D"==n)&&(u=t[r].insId.getInsID(),c=!0)),c)o?e.push(new x(u,n,"reference")):e[r]=new x(u,n,"reference");else{var d=s(t[r],e[r]);null!=d&&(o?e.push(d):e[r]=d)}}}}function c(t,e,r){void 0===r&&(r=null),D.oldmap={},m(t.value,e,r),D.oldmap[t.insid]=e,u(t.value,e)}function u(t,e){for(var r in e.__gdmeta__){var a=e.__gdmeta__[r];if(null!=a.custom&&(null!=a.custom.SerializeField||null!=a.custom.nodecomp||null!=a.custom["2dcomp"])){var i=a.custom.valueType;if(null!=i)switch(i){case"number":case"string":case"boolean":break;default:d(t,e,r)}}}}function d(t,e,r){if(t[r]){var a=t[r].type;if(_(a)){var i=t[r].value instanceof Array;e[r]||(i?e[r]=[]:e[r]={});var o=null;if(e.__gdmeta__[r].custom.valueType!=t[r].type)throw new Error("de serialize fail，type not match："+e.__gdmeta__[r].custom.valueType+" as "+t[r].type);o=t[r].value;for(var n in o){var s=o[n].type;switch(s){case"number":case"string":case"boolean":break;default:p(t[r].value,e[r],n)}}}else p(t,e,r)}}function p(e,r,a){var i=r instanceof Array,o=e[a].type;if(g(o));else if("reference"==e[a].parse){var n=D.oldmap[e[a].value];"Transform"==o||"Transform2D"==o||(n instanceof t.framework.Transform2D?n=n.getComponent(o):n instanceof t.framework.Transform&&(n=n.gameObject.getComponent(o))),i?r.push(n):r[a]=n}else u(e[a].value,r[a])}function m(t,e,r){if(void 0===r&&(r=null),void 0==e)throw new Error("need a instanceObj");for(var a in e.__gdmeta__){var i=e.__gdmeta__[a];if(null!=i.custom&&(null!=i.custom.SerializeField||null!=i.custom.nodecomp||null!=i.custom["2dcomp"])){var o=i.custom.valueType;if(null!=o)switch(o){case"number":case"string":case"boolean":if(void 0==t[a]||o!=t[a].type)continue;e[a]=t[a].value;break;default:f(t,e,a,r)}}}}function f(e,r,a,i){if(void 0===i&&(i=null),e[a]){var o=e[a].type;if(_(o)){var n=e[a].value instanceof Array;r[a]||(n?r[a]=[]:r[a]={});var s=null;if(r.__gdmeta__[a].custom.valueType!=e[a].type)throw new Error("de serialize fail，type not match："+r.__gdmeta__[a].custom.valueType+" as "+e[a].type);s=e[a].value;for(var h in s){var l=s[h].type;switch(l){case"number":case"string":case"boolean":if(l!=e[a][h].type)throw new Error("de serialize fail，type not match："+l+" as "+e[a].type);n?r[a].push(e[a][h].value):r[a][h]=e[a][h].value;break;default:if("NodeComponent"==l&&"components"==a&&"GameObject"==t.reflect.getClassName(r)){var c=[];v(e[a].value,c,h,i),r.addComponentDirect(c[0].comp)}else if("Transform"==l&&"children"==a&&"Transform"==t.reflect.getClassName(r)){var u=[];v(e[a].value,u,h,i),r.addChild(u[0])}else if("C2DComponent"==l&&"components"==a&&"Transform2D"==t.reflect.getClassName(r)){var c=[];v(e[a].value,c,h,i),r.addComponentDirect(c[0].comp)}else if("Transform2D"==l&&"children"==a&&"Transform2D"==t.reflect.getClassName(r)){var d=[];v(e[a].value,d,h,i),r.addChild(d[0])}else v(e[a].value,r[a],h,i)}}}else v(e,r,a,i)}}function v(e,r,a,i){void 0===i&&(i=null);var o=r instanceof Array,n=e[a].type;if(g(n)){var s=e[a].value,h=void 0;s.indexOf("SystemDefaultAsset-")>=0?(s=s.replace("SystemDefaultAsset-",""),"Mesh"==n?h=t.framework.AssetMap.find(s):"Texture"==n&&(h=t.framework.AssetMap.find(s))):h=t.framework.AssetMap.find(s,i),r instanceof Array?r.push(h):r[a]=h}else if("reference"==e[a].parse);else{var l=void 0;"GameObject"==n&&"gameObject"==a&&"Transform"==t.reflect.getClassName(r)?l=r.gameObject:"Transform2D"==n&&"rootNode"==a&&"Canvas"==t.reflect.getClassName(r)?(l=t.reflect.createInstance(document.__gdmeta__[n],null),r.rootNode=l,l.canvas=r):(l=t.reflect.createInstance(document.__gdmeta__[n],null),o?r.push(l):r[a]=l),m(e[a].value,l,i),D.oldmap[e[a].insid]=l}}function _(t){return t.indexOf("[]")>0||t.indexOf("array")>=0||t.indexOf("dic")>=0?!0:!1}function g(t){return"Mesh"==t||"Texture"==t||"Shader"==t||"Material"==t||"AnimationClip"==t||"Atlas"==t||"Font"==t||"Prefab"==t||"Sprite"==t||"Textasset"==t?!0:!1}function y(t){return"Prefab"==t?!0:void 0}var w=function(){function e(){}return e.GetAssetUrl=function(r){if(r){var a=r.url;if(a&&(e.resoursePaths.push(a),r instanceof t.framework.Material)){var i=r.mapUniform;if(!i)return;for(var o in i)if(i[o]&&i[o].type==t.render.UniformTypeEnum.Texture){var n=i[o].value;n&&(a=n.url,a&&(e.resoursePaths.push(a),a.indexOf(".imgdesc.json")<0||n.realName&&(a=a.replace(n.getName(),n.realName),e.resoursePaths.push(a))))}}}},e.resoursePaths=[],e}();e.SerializeDependent=w,__reflect(w.prototype,"egret3d.io.SerializeDependent"),e.SerializeForInspector=r,e.Serialize=n,e.serializeObj=s,e.deSerialize=c,e.isAsset=g,e.isAssetInspector=y;var x=function(){function t(t,e,r){void 0===r&&(r="direct"),this.value=t,this.type=e,g(e)&&(r="nameonly"),this.parse=r}return t}();__reflect(x.prototype,"ValueInfo");var b=function(){function t(t,e,r){void 0===r&&(r="direct"),this.value=t,this.type=e,y(e)&&(r="nameonly"),this.parse=r}return t}();__reflect(b.prototype,"InspectorValueInfo");var D=function(){function t(){}return t.regDefaultType=function(){t.regType("Vector3"),t.regType("Vector4"),t.regType("Color"),t.regType("Quaternion"),t.regType("Material"),t.regType("GameObject"),t.regType("Transform2D"),t.regType("Shader"),t.regType("Atlas"),t.regType("Font"),t.regType("Sprite"),t.regType("Texture"),t.regType("Mesh"),t.regType("Animationclip"),t.regType("ConstText"),t.regType("UniformData")},t.regType=function(e){t.regtypelist.push(e)},t.isRegType=function(t){return this.regtypelist.indexOf(t)>=0},t.oldmap={},t.regtypelist=[],t}();e.ReferenceInfo=D,__reflect(D.prototype,"egret3d.io.ReferenceInfo");var T=function(){function t(){}return t.enumMap={},t}();e.EnumMgr=T,__reflect(T.prototype,"egret3d.io.EnumMgr")}(e=t.io||(t.io={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(t,e){void 0===e&&(e=0),this._seek=e,this._data=new DataView(t,e)}return t.prototype.seek=function(t){this._seek=t},t.prototype.peek=function(){return this._seek},t.prototype.length=function(){return this._data.byteLength},t.prototype.canread=function(){return this._data.byteLength-this._seek},t.prototype.readStringAnsi=function(){var t=this._data.getUint8(this._seek);this._seek++;for(var e="",r=0;t>r;r++)e+=String.fromCharCode(this._data.getUint8(this._seek)),this._seek++;return e},t.utf8ArrayToString=function(t){for(var e=[],r=0;r<t.length;r++){var a=t[r];if(0==a)break;var i=0;if(a>224)i=(15&a)<<12,a=t[++r],i|=(63&a)<<6,a=t[++r],i|=63&a,e.push(String.fromCharCode(i));else if(a>192)i=(31&a)<<6,a=t[++r],i|=(63&a)<<6,e.push(String.fromCharCode(i));else{if(a>128)throw new Error("InvalidCharacterError");e.push(String.fromCharCode(t[r]))}}return e.join("")},t.prototype.readStringUtf8=function(){var e=this._data.getInt8(this._seek);this._seek++;var r=new Uint8Array(e);return this.readUint8Array(r),t.utf8ArrayToString(r)},t.prototype.readStringUtf8FixLength=function(e){var r=new Uint8Array(e);return this.readUint8Array(r),t.utf8ArrayToString(r)},t.prototype.readSingle=function(){var t=this._data.getFloat32(this._seek,!0);return this._seek+=4,t},t.prototype.readDouble=function(){var t=this._data.getFloat64(this._seek,!0);return this._seek+=8,t},t.prototype.readInt8=function(){var t=this._data.getInt8(this._seek);return this._seek+=1,t},t.prototype.readUInt8=function(){var t=this._data.getUint8(this._seek);return this._seek+=1,t},t.prototype.readInt16=function(){var t=this._data.getInt16(this._seek,!0);return this._seek+=2,t},t.prototype.readUInt16=function(){var t=this._data.getUint16(this._seek,!0);return this._seek+=2,t},t.prototype.readInt32=function(){var t=this._data.getInt32(this._seek,!0);return this._seek+=4,t},t.prototype.readUInt32=function(){var t=this._data.getUint32(this._seek,!0);return this._seek+=4,t},t.prototype.readUint8Array=function(t,e,r){void 0===t&&(t=null),void 0===e&&(e=0),void 0===r&&(r=-1),0>r&&(r=t.length);for(var a=0;r>a;a++)t[a]=this._data.getUint8(this._seek),this._seek++;return t},t.prototype.readUint8ArrayByOffset=function(t,e,r){void 0===r&&(r=0),0>r&&(r=t.length);for(var a=0;r>a;a++)t[a]=this._data.getUint8(e),e++;return t},Object.defineProperty(t.prototype,"position",{get:function(){return this.peek()},set:function(t){this.seek(t)},enumerable:!0,configurable:!0}),t.prototype.readBoolean=function(){return this.readUInt8()>0},t.prototype.readByte=function(){return this.readUInt8()},t.prototype.readBytes=function(t,e,r){return void 0===t&&(t=null),void 0===e&&(e=0),void 0===r&&(r=-1),this.readUint8Array(t,e,r)},t.prototype.readUnsignedShort=function(){return this.readUInt16()},t.prototype.readUnsignedInt=function(){return this.readUInt32()},t.prototype.readFloat=function(){return this.readSingle()},t.prototype.readUTFBytes=function(e){var r=new Uint8Array(e);return t.utf8ArrayToString(this.readUint8Array(r))},t.prototype.readSymbolByte=function(){return this.readInt8()},t.prototype.readShort=function(){return this.readInt16()},t.prototype.readInt=function(){return this.readInt32()},t}();t.BinReader=e,__reflect(e.prototype,"egret3d.io.BinReader");var r=function(){function t(){var t=new ArrayBuffer(1024);this._length=0,this._buf=new Uint8Array(t),this._data=new DataView(this._buf.buffer),this._seek=0}return t.prototype.sureData=function(t){for(var e=this._buf.byteLength;e<this._length+t;)e+=1024;if(e!=this._buf.byteLength){for(var r=new Uint8Array(e),a=0;a<this._length;a++)r[a]=this._buf[a];this._buf=r,this._data=new DataView(this._buf.buffer)}this._length+=t},t.prototype.getLength=function(){return length},t.prototype.getBuffer=function(){return this._buf.buffer.slice(0,this._length)},t.prototype.seek=function(t){this._seek=t},t.prototype.peek=function(){return this._seek},t.prototype.writeInt8=function(t){this.sureData(1),this._data.setInt8(this._seek,t),this._seek++},t.prototype.writeUInt8=function(t){this.sureData(1),this._data.setUint8(this._seek,t),this._seek++},t.prototype.writeInt16=function(t){this.sureData(2),this._data.setInt16(this._seek,t,!0),this._seek+=2},t.prototype.writeUInt16=function(t){this.sureData(2),this._data.setUint16(this._seek,t,!0),this._seek+=2},t.prototype.writeInt32=function(t){this.sureData(4),this._data.setInt32(this._seek,t,!0),this._seek+=4},t.prototype.writeUInt32=function(t){this.sureData(4),this._data.setUint32(this._seek,t,!0),this._seek+=4},t.prototype.writeSingle=function(t){this.sureData(4),this._data.setFloat32(this._seek,t,!0),this._seek+=4},t.prototype.writeDouble=function(t){this.sureData(8),this._data.setFloat64(this._seek,t,!0),this._seek+=8},t.prototype.writeStringAnsi=function(t){var e=t.length;this.sureData(e+1),this._data.setUint8(this._seek,e),this._seek++;for(var r=0;e>r;r++)this._data.setUint8(this._seek,t.charCodeAt(r)),this._seek++},t.prototype.writeStringUtf8=function(e){var r=t.stringToUtf8Array(e);this.writeUInt8(r.length),this.writeUint8Array(r)},t.stringToUtf8Array=function(t){for(var e=[],r=0;r<t.length;r++){var a=t.charAt(r),i=a.charCodeAt(0);if(i>65535)throw new Error("InvalidCharacterError");if(i>128)if(2047>i){var o=i>>>6|192,n=63&i|128;e.push(o,n)}else{var o=i>>>12|224,n=i>>>6&63|128,s=63&i|128;
e.push(o,n,s)}else e.push(i)}return e},t.prototype.writeStringUtf8DataOnly=function(e){var r=t.stringToUtf8Array(e);this.writeUint8Array(r)},t.prototype.writeUint8Array=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=-1),0>r&&(r=t.length),this.sureData(r);for(var a=e;e+r>a;a++)this._data.setUint8(this._seek,t[a]),this._seek++},Object.defineProperty(t.prototype,"length",{get:function(){return this._seek},enumerable:!0,configurable:!0}),t.prototype.writeByte=function(t){this.writeUInt8(t)},t.prototype.writeBytes=function(t,e,r){void 0===e&&(e=0),void 0===r&&(r=0),this.writeUint8Array(t,e,r)},t.prototype.writeUnsignedShort=function(t){this.writeUInt16(t)},t.prototype.writeUnsignedInt=function(t){this.writeUInt32(t)},t.prototype.writeFloat=function(t){this.writeSingle(t)},t.prototype.writeUTFBytes=function(e){var r=t.stringToUtf8Array(e);this.writeUint8Array(r)},t.prototype.writeSymbolByte=function(t){this.writeInt8(t)},t.prototype.writeShort=function(t){this.writeInt16(t)},t.prototype.writeInt=function(t){this.writeInt32(t)},t}();t.BinWriter=r,__reflect(r.prototype,"egret3d.io.BinWriter")}(e=t.io||(t.io={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t){t.r=1,t.g=1,t.b=1,t.a=1}function r(t){t.r=0,t.g=0,t.b=0,t.a=1}function a(t){t.r=.5,t.g=.5,t.b=.5,t.a=1}function i(t,e,r){r.r=t.r*e.r,r.g=t.g*e.g,r.b=t.b*e.b,r.a=t.a*e.a}function o(t,e,r){r.r=t.r*e,r.g=t.g*e,r.b=t.b*e,r.a=t.a*e}function n(t,e){e.a=t.a,e.r=t.r,e.g=t.g,e.b=t.b}function s(t,e,r,a){a.a=r*(e.a-t.a)+t.a,a.r=r*(e.r-t.r)+t.r,a.g=r*(e.g-t.g)+t.g,a.b=r*(e.b-t.b)+t.b,a.a=Math.floor(a.a),a.r=Math.floor(a.r),a.g=Math.floor(a.g),a.b=Math.floor(a.b)}t.colorSet_White=e,t.colorSet_Black=r,t.colorSet_Gray=a,t.colorMultiply=i,t.scaleToRef=o,t.colorClone=n,t.colorLerp=s}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t,e,r,a,i){var o=t.x,n=t.y,s=t.z,h=e.x,l=e.y,c=e.z,u=r.x,d=r.y,p=r.z,m=a.x,f=a.y,v=a.z,_=u*o+d*n+p*s;if(0===_)i=null;else{var g=((h-m)*o+(l-f)*n+(c-v)*s)/_;i.x=m+u*g,i.y=f+d*g,i.z=v+p*g}}function r(t,e,r,i,o){return a(o,t,e)*a(o,i,r)<=0&&a(o,i,t)*a(o,r,e)<=0?!0:!1}function a(t,e,r){return(t.x-r.x)*(e.y-r.y)-(e.x-r.x)*(t.y-r.y)}t.calPlaneLineIntersectPoint=e,t.isContain=r,t.Multiply=a}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){function r(t,e){e.x=t.rawData[12],e.y=t.rawData[13],e.z=t.rawData[14]}function a(t,e){e.rawData[1]=t.rawData[4],e.rawData[2]=t.rawData[8],e.rawData[3]=t.rawData[12],e.rawData[4]=t.rawData[1],e.rawData[6]=t.rawData[9],e.rawData[7]=t.rawData[13],e.rawData[8]=t.rawData[2],e.rawData[9]=t.rawData[6],e.rawData[11]=t.rawData[14],e.rawData[12]=t.rawData[3],e.rawData[13]=t.rawData[7],e.rawData[14]=t.rawData[11]}function i(t,r,a,i){i.x=t.rawData[12],i.y=t.rawData[13],i.z=t.rawData[14];var o=e.sign(t.rawData[0]*t.rawData[1]*t.rawData[2]*t.rawData[3])<0?-1:1,s=e.sign(t.rawData[4]*t.rawData[5]*t.rawData[6]*t.rawData[7])<0?-1:1,h=e.sign(t.rawData[8]*t.rawData[9]*t.rawData[10]*t.rawData[11])<0?-1:1;if(r.x=o*Math.sqrt(t.rawData[0]*t.rawData[0]+t.rawData[1]*t.rawData[1]+t.rawData[2]*t.rawData[2]),r.y=s*Math.sqrt(t.rawData[4]*t.rawData[4]+t.rawData[5]*t.rawData[5]+t.rawData[6]*t.rawData[6]),r.z=h*Math.sqrt(t.rawData[8]*t.rawData[8]+t.rawData[9]*t.rawData[9]+t.rawData[10]*t.rawData[10]),0===r.x||0===r.y||0===r.z)return a.x=0,a.y=0,a.z=0,a.w=1,!1;var l=e.Pool.new_matrix();return l.rawData[0]=t.rawData[0]/r.x,l.rawData[1]=t.rawData[1]/r.x,l.rawData[2]=t.rawData[2]/r.x,l.rawData[3]=0,l.rawData[4]=t.rawData[4]/r.y,l.rawData[5]=t.rawData[5]/r.y,l.rawData[6]=t.rawData[6]/r.y,l.rawData[7]=0,l.rawData[8]=t.rawData[8]/r.z,l.rawData[9]=t.rawData[9]/r.z,l.rawData[10]=t.rawData[10]/r.z,l.rawData[11]=0,n(l,a),!0}function o(t,r,a,i){i.x=t.rawData[4],i.y=t.rawData[5];var o=e.sign(t.rawData[0]*t.rawData[1])<0?-1:1,n=e.sign(t.rawData[2]*t.rawData[3])<0?-1:1;if(r.x=o*Math.sqrt(t.rawData[0]*t.rawData[0]+t.rawData[1]*t.rawData[1]),r.y=n*Math.sqrt(t.rawData[2]*t.rawData[2]+t.rawData[3]*t.rawData[3]),0===r.x||0===r.y)return a.v=0,!1;var s=t.rawData[0]/r.x,h=t.rawData[1]/r.x,l=Math.asin(s);Math.acos(h);return a.v=l,!0}function n(t,e){var r,a=t.rawData,i=a[0],o=a[4],n=a[8],s=a[1],h=a[5],l=a[9],c=a[2],u=a[6],d=a[10],p=i+h+d;p>0?(r=.5/Math.sqrt(p+1),e.w=.25/r,e.x=(u-l)*r,e.y=(n-c)*r,e.z=(s-o)*r):i>h&&i>d?(r=2*Math.sqrt(1+i-h-d),e.w=(u-l)/r,e.x=.25*r,e.y=(o+s)/r,e.z=(n+c)/r):h>d?(r=2*Math.sqrt(1+h-i-d),e.w=(n-c)/r,e.x=(o+s)/r,e.y=.25*r,e.z=(l+u)/r):(r=2*Math.sqrt(1+d-i-h),e.w=(s-o)/r,e.x=(n+c)/r,e.y=(l+u)/r,e.z=.25*r)}function s(t,e){for(var r=0;16>r;r++)e.rawData[r]=t.rawData[r]}function h(t,e){for(var r=0;16>r;r++)e.rawData[r]=t.rawData[r]}function l(t){t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=0,t.rawData[4]=0,t.rawData[5]=1,t.rawData[6]=0,t.rawData[7]=0,t.rawData[8]=0,t.rawData[9]=0,t.rawData[10]=1,t.rawData[11]=0,t.rawData[12]=0,t.rawData[13]=0,t.rawData[14]=0,t.rawData[15]=1}function c(t){t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=1,t.rawData[4]=0,t.rawData[5]=0}function u(t,e){var r=t.rawData[0],a=t.rawData[1],i=t.rawData[2],o=t.rawData[3],n=t.rawData[4],s=t.rawData[5],h=t.rawData[6],l=t.rawData[7],c=t.rawData[8],u=t.rawData[9],d=t.rawData[10],p=t.rawData[11],m=t.rawData[12],f=t.rawData[13],v=t.rawData[14],_=t.rawData[15],g=d*_-p*v,y=u*_-p*f,w=u*v-d*f,x=c*_-p*m,b=c*v-d*m,D=c*f-u*m,T=s*g-h*y+l*w,E=-(n*g-h*x+l*b),P=n*y-s*x+l*D,M=-(n*w-s*b+h*D),S=1/(r*T+a*E+i*P+o*M),A=h*_-l*v,C=s*_-l*f,V=s*v-h*f,R=n*_-l*m,k=n*v-h*m,F=n*f-s*m,L=h*p-l*d,I=s*p-l*u,z=s*d-h*u,U=n*p-l*c,N=n*d-h*c,O=n*u-s*c;e.rawData[0]=T*S,e.rawData[4]=E*S,e.rawData[8]=P*S,e.rawData[12]=M*S,e.rawData[1]=-(a*g-i*y+o*w)*S,e.rawData[5]=(r*g-i*x+o*b)*S,e.rawData[9]=-(r*y-a*x+o*D)*S,e.rawData[13]=(r*w-a*b+i*D)*S,e.rawData[2]=(a*A-i*C+o*V)*S,e.rawData[6]=-(r*A-i*R+o*k)*S,e.rawData[10]=(r*C-a*R+o*F)*S,e.rawData[14]=-(r*V-a*k+i*F)*S,e.rawData[3]=-(a*L-i*I+o*z)*S,e.rawData[7]=(r*L-i*U+o*N)*S,e.rawData[11]=-(r*I-a*U+o*O)*S,e.rawData[15]=(r*z-a*N+i*O)*S}function d(t,e){var r=t.rawData[0],a=t.rawData[1],i=t.rawData[2],o=t.rawData[3],n=t.rawData[4],s=t.rawData[5],h=-(i*-s-o*-n),l=1/(r*o+a*-i);e.rawData[0]=o*l,e.rawData[2]=-i*l,e.rawData[4]=h*l,e.rawData[1]=-a*l,e.rawData[3]=r*l,e.rawData[5]=(r*-s-a*-n)*l}function p(r,a,i,o){var n=t.math.Pool.new_matrix();g(a.x,a.y,a.z,n);var s=t.math.Pool.new_matrix();e.quatToMatrix(i,s),T(s,n,o),o.rawData[12]=r.x,o.rawData[13]=r.y,o.rawData[14]=r.z,o.rawData[15]=1,t.math.Pool.delete_matrix(n),t.math.Pool.delete_matrix(s)}function m(e,r,a,i){var o=t.math.Pool.new_matrix3x2();x(r.x,r.y,o);var n=t.math.Pool.new_matrix3x2();D(a,n),E(n,o,i),i.rawData[4]=e.x,i.rawData[5]=e.y,t.math.Pool.delete_matrix3x2(o),t.math.Pool.delete_matrix3x2(n)}function f(t,e,r,a){a.rawData[0]=1,a.rawData[1]=0,a.rawData[2]=0,a.rawData[3]=0,a.rawData[4]=0,a.rawData[5]=1,a.rawData[6]=0,a.rawData[7]=0,a.rawData[8]=0,a.rawData[9]=0,a.rawData[10]=1,a.rawData[11]=0,a.rawData[12]=t,a.rawData[13]=e,a.rawData[14]=r,a.rawData[15]=1}function v(t,e,r){r.rawData[0]=1,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=1,r.rawData[4]=t,r.rawData[5]=e}function _(t,e){e.x=t.rawData[0],e.y=t.rawData[5],e.z=t.rawData[10]}function g(t,e,r,a){a.rawData[0]=t,a.rawData[1]=0,a.rawData[2]=0,a.rawData[3]=0,a.rawData[4]=0,a.rawData[5]=e,a.rawData[6]=0,a.rawData[7]=0,a.rawData[8]=0,a.rawData[9]=0,a.rawData[10]=r,a.rawData[11]=0,a.rawData[12]=0,a.rawData[13]=0,a.rawData[14]=0,a.rawData[15]=1}function y(t,e,r){r.x=e.x*t.rawData[0]+e.y*t.rawData[2]+t.rawData[4],r.y=e.x*t.rawData[1]+e.y*t.rawData[3]+t.rawData[5]}function w(t,e,r){r.x=e.x*t.rawData[0]+e.y*t.rawData[2],r.y=e.x*t.rawData[1]+e.y*t.rawData[3]}function x(t,e,r){r.rawData[0]=t,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=e,r.rawData[4]=0,r.rawData[5]=0}function b(t,e,r){var a=t.x,i=t.y,o=t.z,n=Math.sqrt(a*a+i*i+o*o);if(n){1!==n&&(n=1/n,a*=n,i*=n,o*=n);var s=Math.sin(e),h=Math.cos(e),l=1-h,c=a*a*l+h,u=i*a*l+o*s,d=o*a*l-i*s,p=a*i*l-o*s,m=i*i*l+h,f=o*i*l+a*s,v=a*o*l+i*s,_=i*o*l-a*s,g=o*o*l+h;r.rawData[0]=c,r.rawData[1]=u,r.rawData[2]=d,r.rawData[3]=0,r.rawData[4]=p,r.rawData[5]=m,r.rawData[6]=f,r.rawData[7]=0,r.rawData[8]=v,r.rawData[9]=_,r.rawData[10]=g,r.rawData[11]=0,r.rawData[12]=0,r.rawData[13]=0,r.rawData[14]=0,r.rawData[15]=1}}function D(t,e){var r=Math.sin(t),a=Math.cos(t);e.rawData[0]=a,e.rawData[1]=r,e.rawData[2]=-r,e.rawData[3]=a,e.rawData[4]=0,e.rawData[5]=0}function T(t,e,r){var a=t.rawData[0],i=t.rawData[1],o=t.rawData[2],n=t.rawData[3],s=t.rawData[4],h=t.rawData[5],l=t.rawData[6],c=t.rawData[7],u=t.rawData[8],d=t.rawData[9],p=t.rawData[10],m=t.rawData[11],f=t.rawData[12],v=t.rawData[13],_=t.rawData[14],g=t.rawData[15],y=e.rawData[0],w=e.rawData[1],x=e.rawData[2],b=e.rawData[3];r.rawData[0]=y*a+w*s+x*u+b*f,r.rawData[1]=y*i+w*h+x*d+b*v,r.rawData[2]=y*o+w*l+x*p+b*_,r.rawData[3]=y*n+w*c+x*m+b*g,y=e.rawData[4],w=e.rawData[5],x=e.rawData[6],b=e.rawData[7],r.rawData[4]=y*a+w*s+x*u+b*f,r.rawData[5]=y*i+w*h+x*d+b*v,r.rawData[6]=y*o+w*l+x*p+b*_,r.rawData[7]=y*n+w*c+x*m+b*g,y=e.rawData[8],w=e.rawData[9],x=e.rawData[10],b=e.rawData[11],r.rawData[8]=y*a+w*s+x*u+b*f,r.rawData[9]=y*i+w*h+x*d+b*v,r.rawData[10]=y*o+w*l+x*p+b*_,r.rawData[11]=y*n+w*c+x*m+b*g,y=e.rawData[12],w=e.rawData[13],x=e.rawData[14],b=e.rawData[15],r.rawData[12]=y*a+w*s+x*u+b*f,r.rawData[13]=y*i+w*h+x*d+b*v,r.rawData[14]=y*o+w*l+x*p+b*_,r.rawData[15]=y*n+w*c+x*m+b*g}function E(t,e,r){var a=t.rawData[0],i=t.rawData[1],o=t.rawData[2],n=t.rawData[3],s=t.rawData[4],h=t.rawData[5],l=e.rawData[0],c=e.rawData[1],u=0;r.rawData[0]=l*a+c*o+u*s,r.rawData[1]=l*i+c*n+u*h,l=e.rawData[2],c=e.rawData[3],u=0,r.rawData[2]=l*a+c*o+u*s,r.rawData[3]=l*i+c*n+u*h,l=e.rawData[4],c=e.rawData[5],u=1,r.rawData[4]=l*a+c*o+u*s,r.rawData[5]=l*i+c*n+u*h}function P(t,e,r,a,i){var o=1/Math.tan(.5*t);i.rawData[0]=o/e,i.rawData[1]=i.rawData[2]=i.rawData[3]=0,i.rawData[4]=i.rawData[6]=i.rawData[7]=0,i.rawData[5]=o,i.rawData[8]=i.rawData[9]=0,i.rawData[10]=-a/(r-a),i.rawData[11]=1,i.rawData[12]=i.rawData[13]=i.rawData[15]=0,i.rawData[14]=r*a/(r-a)}function M(t,e,r,a,i){var o=2/t,n=2/e,s=1/(a-r),h=r/(r-a);i.rawData[0]=o,i.rawData[1]=0,i.rawData[2]=0,i.rawData[3]=0,i.rawData[4]=0,i.rawData[5]=n,i.rawData[6]=0,i.rawData[7]=0,i.rawData[8]=0,i.rawData[9]=0,i.rawData[10]=s,i.rawData[11]=0,i.rawData[12]=0,i.rawData[13]=0,i.rawData[14]=h,i.rawData[15]=1}function S(t,r,a){var i=new e.Vector3(-t.x,-t.y,-t.z);e.vec3Normalize(i,i);var o=new e.Vector3;e.vec3Clone(r,o),e.vec3Normalize(o,o);var n=new e.Vector3;e.vec3Cross(o,i,n),e.vec3SqrLength(n),0==e.vec3SqrLength(n)?n.x=1:e.vec3Normalize(n,n);var s=new e.Vector3;e.vec3Cross(i,n,s),e.vec3Normalize(s,s),a.rawData[0]=n.x,a.rawData[1]=s.x,a.rawData[2]=i.x,a.rawData[3]=0,a.rawData[4]=n.y,a.rawData[5]=s.y,a.rawData[6]=i.y,a.rawData[7]=0,a.rawData[8]=n.z,a.rawData[9]=s.z,a.rawData[10]=i.z,a.rawData[11]=0,a.rawData[12]=0,a.rawData[13]=0,a.rawData[14]=0,a.rawData[15]=1}function A(t,r,a,i){var o=new e.Vector3(r.x,r.y,r.z);e.vec3Normalize(o,o);var n=new e.Vector3;e.vec3Clone(a,n),e.vec3Normalize(n,n);var s=new e.Vector3;e.vec3Cross(n,o,s),e.vec3SqrLength(s),0==e.vec3SqrLength(s)?s.x=1:e.vec3Normalize(s,s);var h=new e.Vector3;e.vec3Cross(o,s,h),e.vec3Normalize(h,h);var l=-e.vec3Dot(s,t),c=-e.vec3Dot(h,t),u=-e.vec3Dot(o,t);i.rawData[0]=s.x,i.rawData[1]=h.x,i.rawData[2]=o.x,i.rawData[3]=0,i.rawData[4]=s.y,i.rawData[5]=h.y,i.rawData[6]=o.y,i.rawData[7]=0,i.rawData[8]=s.z,i.rawData[9]=h.z,i.rawData[10]=o.z,i.rawData[11]=0,i.rawData[12]=l,i.rawData[13]=c,i.rawData[14]=u,i.rawData[15]=1}function C(t,e,r,a){for(var i=0;16>i;i++)a.rawData[i]=t.rawData[i]*(1-r)+e.rawData[i]*r}function V(t,e,r){var a=t.x*e.rawData[0]+t.y*e.rawData[4]+t.z*e.rawData[8]+e.rawData[12],i=t.x*e.rawData[1]+t.y*e.rawData[5]+t.z*e.rawData[9]+e.rawData[13],o=t.x*e.rawData[2]+t.y*e.rawData[6]+t.z*e.rawData[10]+e.rawData[14],n=t.x*e.rawData[3]+t.y*e.rawData[7]+t.z*e.rawData[11]+e.rawData[15];r.x=a/n,r.y=i/n,r.z=o/n}function R(t,e,r){var a=t.x*e.rawData[0]+t.y*e.rawData[4]+t.z*e.rawData[8],i=t.x*e.rawData[1]+t.y*e.rawData[5]+t.z*e.rawData[9],o=t.x*e.rawData[2]+t.y*e.rawData[6]+t.z*e.rawData[10];r.x=a,r.y=i,r.z=o}function k(t,e,r){r.x=t.rawData[e],r.y=t.rawData[e+1],r.z=t.rawData[e+2]}function F(t){t.rawData[0]=1,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=0,t.rawData[4]=0,t.rawData[5]=1,t.rawData[6]=0,t.rawData[7]=0,t.rawData[8]=0,t.rawData[9]=0,t.rawData[10]=1,t.rawData[11]=0,t.rawData[12]=0,t.rawData[13]=0,t.rawData[14]=0,t.rawData[15]=1}function L(t){t.rawData[0]=0,t.rawData[1]=0,t.rawData[2]=0,t.rawData[3]=0,t.rawData[4]=0,t.rawData[5]=0,t.rawData[6]=0,t.rawData[7]=0,t.rawData[8]=0,t.rawData[9]=0,t.rawData[10]=0,t.rawData[11]=0,t.rawData[12]=0,t.rawData[13]=0,t.rawData[14]=0,t.rawData[15]=1}function I(t,e){e.rawData[0]*=t,e.rawData[1]*=t,e.rawData[2]*=t,e.rawData[3]*=t,e.rawData[4]*=t,e.rawData[5]*=t,e.rawData[6]*=t,e.rawData[7]*=t,e.rawData[8]*=t,e.rawData[9]*=t,e.rawData[10]*=t,e.rawData[11]*=t,e.rawData[12]*=t,e.rawData[13]*=t,e.rawData[14]*=t,e.rawData[15]*=t}function z(t,e,r){r.rawData[0]=t.rawData[0]+e.rawData[0],r.rawData[1]=t.rawData[1]+e.rawData[1],r.rawData[2]=t.rawData[2]+e.rawData[2],r.rawData[3]=t.rawData[3]+e.rawData[3],r.rawData[4]=t.rawData[4]+e.rawData[4],r.rawData[5]=t.rawData[5]+e.rawData[5],r.rawData[6]=t.rawData[6]+e.rawData[6],r.rawData[7]=t.rawData[7]+e.rawData[7],r.rawData[8]=t.rawData[8]+e.rawData[8],r.rawData[9]=t.rawData[9]+e.rawData[9],r.rawData[10]=t.rawData[10]+e.rawData[10],r.rawData[11]=t.rawData[11]+e.rawData[11],r.rawData[12]=t.rawData[12]+e.rawData[12],r.rawData[13]=t.rawData[13]+e.rawData[13],r.rawData[14]=t.rawData[14]+e.rawData[14],r.rawData[15]=t.rawData[15]+e.rawData[15]}e.matrixGetTranslation=r,e.matrixTranspose=a,e.matrixDecompose=i;var U=function(){function t(){}return t}();e.Angelref=U,__reflect(U.prototype,"egret3d.math.Angelref"),e.matrix3x2Decompose=o,e.matrix2Quaternion=n,e.matrixClone=s,e.matrix3x2Clone=h,e.matrixMakeIdentity=l,e.matrix3x2MakeIdentity=c,e.matrixInverse=u,e.matrix3x2Inverse=d,e.matrixMakeTransformRTS=p,e.matrix3x2MakeTransformRTS=m,e.matrixMakeTranslate=f,e.matrix3x2MakeTranslate=v,e.matrixGetScale=_,e.matrixMakeScale=g,e.matrix3x2TransformVector2=y,e.matrix3x2TransformNormal=w,e.matrix3x2MakeScale=x,e.matrixMakeRotateAxisAngle=b,e.matrix3x2MakeRotate=D,e.matrixMultiply=T,e.matrix3x2Multiply=E,e.matrixProject_PerspectiveLH=P,e.matrixProject_OrthoLH=M,e.matrixLookatLH=S,e.matrixViewLookatLH=A,e.matrixLerp=C,e.matrixTransformVector3=V,e.matrixTransformNormal=R,e.matrixGetVector3ByOffset=k,e.matrixReset=F,e.matrixZero=L,e.matrixScaleByNum=I,e.matrixAdd=z}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){function r(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=1),e>t?e:t>r?r:t}function a(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1}function i(t){return t.shiftKey?t.keyCode-32:t.keyCode}function o(t,e,r){return t*(1-r)+e*r}function n(){return l.x_axis}function s(){return l.y_axis}function h(){return l.z_axis}e.floatClamp=r,e.sign=a,e.getKeyCodeByAscii=i,e.numberLerp=o,e.x_AXIS=n,e.y_AXIS=s,e.z_AXIS=h;var l=function(){function e(){}return e.x_axis=new t.math.Vector3(1,0,0),e.y_axis=new t.math.Vector3(0,1,0),e.z_axis=new t.math.Vector3(0,0,1),e}();e.CommonStatic=l,__reflect(l.prototype,"egret3d.math.CommonStatic")}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){function r(t,e){var r=1/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);e.x*=r,e.y*=r,e.z*=r,e.w*=r}function a(t,e,r){var a,i,o,n,s=e.x,h=e.y,l=e.z;n=-t.x*s-t.y*h-t.z*l,a=t.w*s+t.y*l-t.z*h,i=t.w*h-t.x*l+t.z*s,o=t.w*l+t.x*h-t.y*s,r.x=-n*t.x+a*t.w-i*t.z+o*t.y,r.y=-n*t.y+a*t.z+i*t.w-o*t.x,r.z=-n*t.z-a*t.y+i*t.x+o*t.w}function i(t,e,r,a){var i,o,n,s,h=r.x,l=r.y,c=r.z,u=t[e],d=t[e+1],p=t[e+2],m=t[e+3];s=-u*h-d*l-p*c,i=m*h+d*c-p*l,o=m*l-u*c+p*h,n=m*c+u*l-d*h,a.x=-s*u+i*m-o*p+n*d,a.y=-s*d+i*p+o*m-n*u,a.z=-s*p-i*d+o*u+n*m}function o(t){return Math.sqrt(t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z)}function n(t,e){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w}function s(t,e){var r=2*t.x*t.y,a=2*t.x*t.z,i=2*t.x*t.w,o=2*t.y*t.z,n=2*t.y*t.w,s=2*t.z*t.w,h=t.x*t.x,l=t.y*t.y,c=t.z*t.z,u=t.w*t.w;e.rawData[0]=h-l-c+u,e.rawData[4]=r-s,e.rawData[8]=a+n,e.rawData[12]=0,e.rawData[1]=r+s,e.rawData[5]=-h+l-c+u,e.rawData[9]=o-i,e.rawData[13]=0,e.rawData[2]=a-n,e.rawData[6]=o+i,e.rawData[10]=-h-l+c+u,e.rawData[14]=0,e.rawData[3]=0,e.rawData[7]=0,e.rawData[11]=0,e.rawData[15]=1}function h(t,e){var r=t.w*t.w+t.x*t.x+t.y*t.y+t.z*t.z;if(r>0){var a=1/r;e.w=t.w*a,e.x=-t.x*a,e.y=-t.y*a,e.z=-t.z*a}}function l(t,e,r,a){var i=.5*r,o=.5*e,n=.5*t,s=Math.sin(i),h=Math.cos(i),l=Math.sin(o),c=Math.cos(o),u=Math.sin(n),d=Math.cos(n);a.x=d*l*h+u*c*s,a.y=u*c*h-d*l*s,a.z=d*c*s-u*l*h,a.w=d*c*h+u*l*s}function c(t,r,a){var i=t.w,o=t.x,n=t.y,s=t.z,h=r.w,l=r.x,c=r.y,u=r.z;a.w=i*h-o*l-n*c-s*u,a.x=i*l+o*h+n*u-s*c,a.y=i*c-o*u+n*h+s*l,a.z=i*u+o*c-n*l+s*h,e.quatNormalize(a,a)}function u(t,r,a,i){var o=t[r+3],n=t[r+0],s=t[r+1],h=t[r+2],l=a.w,c=a.x,u=a.y,d=a.z;i.w=o*l-n*c-s*u-h*d,i.x=o*c+n*l+s*d-h*u,i.y=o*u-n*d+s*l+h*c,i.z=o*d+n*u-s*c+h*l,e.quatNormalize(i,i)}function d(t,e,r){var a=t.x,i=t.y,o=t.z;r.w=-e.x*a-e.y*i-e.z*o,r.x=e.w*a+e.y*o-e.z*i,r.y=e.w*i-e.x*o+e.z*a,r.z=e.w*o+e.x*i-e.y*a}function p(t,e,r,a){var i=t.w,o=t.x,n=t.y,s=t.z,h=e.w,l=e.x,c=e.y,u=e.z;0>i*h+o*l+n*c+s*u&&(h=-h,l=-l,c=-c,u=-u),r.w=i+a*(h-i),r.x=o+a*(l-o),r.y=n+a*(c-n),r.z=s+a*(u-s);var d=1/Math.sqrt(r.w*r.w+r.x*r.x+r.y*r.y+r.z*r.z);r.w*=d,r.x*=d,r.y*=d,r.z*=d}function m(t,r,a){r*=Math.PI/180;var i=.5*r,o=Math.sin(i);a.w=Math.cos(i),a.x=t.x*o,a.y=t.y*o,a.z=t.z*o,e.quatNormalize(a,a)}function f(t,e){var r=t.x*t.x+t.y*t.y+t.z*t.z,a=0;return r>0?(a=2*Math.acos(t.w),r=1/Math.sqrt(r),e.x=t.x*r,e.y=t.y*r,e.z=t.z*r):(a=0,e.x=1,e.y=0,e.z=0),a/=Math.PI/180}function v(t,r,a,i){t*=Math.PI/180,r*=Math.PI/180,a*=Math.PI/180;var o=.5*t,n=.5*r,s=.5*a,h=Math.cos(o),l=Math.sin(o),c=Math.cos(n),u=Math.sin(n),d=Math.cos(s),p=Math.sin(s);i.w=h*c*d+l*u*p,i.x=l*c*d+h*u*p,i.y=h*u*d-l*c*p,i.z=h*c*p-l*u*d,e.quatNormalize(i,i)}function _(t,r){var a=2*(t.w*t.x-t.y*t.z);a=e.floatClamp(a,-1,1),r.x=Math.asin(a),r.y=Math.atan2(2*(t.w*t.y+t.z*t.x),1-2*(t.y*t.y+t.x*t.x)),r.z=Math.atan2(2*(t.w*t.z+t.y*t.x),1-2*(t.x*t.x+t.z*t.z)),r.x/=Math.PI/180,r.y/=Math.PI/180,r.z/=Math.PI/180}function g(t){t.x=0,t.y=0,t.z=0,t.w=1}function y(t,r,a){var i=new e.Vector3;e.vec3Subtract(r,t,i),e.vec3Normalize(i,i);var o=new e.Vector3(i.x,0,i.z);e.vec3Normalize(o,o);var n=Math.acos(o.z);o.x<0&&(n=-n);var s=new e.Vector3(i.x,0,i.z),h=e.vec3Length(s);h>.9999999999&&(h=1),-.999999999>h&&(h=-1);var c=Math.acos(h);i.y>0&&(c=-c),l(n,c,0,a),e.quatNormalize(a,a)}function w(r,a,i,o){void 0===o&&(o=t.math.Pool.vector3_up);var n=t.math.Pool.new_vector3();e.vec3Subtract(a,r,n),e.vec3Normalize(n,n);var s=t.math.vec3Dot(t.math.Pool.vector3_forward,n);s=t.math.floatClamp(s,-1,1);var h=180*Math.acos(s)/Math.PI;if(.01>h)return i.x=0,i.y=0,i.z=0,void(i.w=1);if(h>179.9)return void t.math.quatFromAxisAngle(o,180,i);var l=t.math.Pool.new_vector3();t.math.vec3Cross(t.math.Pool.vector3_forward,n,l),t.math.vec3Normalize(l,l),t.math.quatFromAxisAngle(l,h,i)}function x(t,r,a){var i=new e.Vector3;e.vec3Subtract(r,t,i),e.vec3Normalize(i,i);var o=new e.Vector3(i.x,0,i.z);e.vec3Normalize(o,o);var n=Math.acos(o.z);o.x<0&&(n=-n),l(n,0,0,a),e.quatNormalize(a,a)}function b(t,e){var r,a,i,o,n,s,h,l,c,u,d,p,m,f,v,_=t.rawData;r=_[0],a=_[1],i=_[2],o=_[4],n=_[5],s=_[6],h=_[8],l=_[9],c=_[10],m=1/Math.sqrt(r*r+a*a+i*i),f=1/Math.sqrt(o*o+n*n+s*s),v=1/Math.sqrt(h*h+l*l+c*c),r*=m,a*=m,i*=m,o*=f,n*=f,s*=f,h*=v,l*=v,c*=v,u=r+n+c,u>=0?(d=Math.sqrt(u+1),e.w=.5*d,d=.5/d,e.x=(s-l)*d,e.y=(h-i)*d,e.z=(a-o)*d):r>n?r>c?(p=r-(n+c)+1,p=Math.sqrt(p),e.x=.5*p,p=.5/p,e.w=(s-l)*p,e.y=(a+o)*p,e.z=(i+h)*p):(p=c-(r+n)+1,p=Math.sqrt(p),e.z=.5*p,p=.5/p,e.w=(a-o)*p,e.x=(h+i)*p,e.y=(l+s)*p):n>c?(p=n-(c+r)+1,p=Math.sqrt(p),e.y=.5*p,p=.5/p,e.w=(h-i)*p,e.z=(s+l)*p,e.x=(o+a)*p):(p=c-(r+n)+1,p=Math.sqrt(p),e.z=.5*p,p=.5/p,e.w=(a-o)*p,e.x=(h+i)*p,e.y=(l+s)*p)}function D(t,r){var a,i,o,n,s,h,l,c,u=T;e.matrixGetScale(t,u),n=u.x,s=u.y,h=u.z,l=this.data,i=Math.asin(-l[2]/n),c=.5*Math.PI,c>i?i>-c?(a=Math.atan2(l[6]/s,l[10]/h),o=Math.atan2(l[1]/n,l[0]/n)):(o=0,a=-Math.atan2(l[4]/s,l[5]/s)):(o=0,a=Math.atan2(l[4]/s,l[5]/s)),r.x=180*a/Math.PI,r.y=180*i/Math.PI,r.z=180*o/Math.PI}e.quatNormalize=r,e.quatTransformVector=a,e.quatTransformVectorDataAndQuat=i,e.quatMagnitude=o,e.quatClone=n,e.quatToMatrix=s,e.quatInverse=h,e.quatFromYawPitchRoll=l,e.quatMultiply=c,e.quatMultiplyDataAndQuat=u,e.quatMultiplyVector=d,e.quatLerp=p,e.quatFromAxisAngle=m,e.quatToAxisAngle=f,e.quatFromEulerAngles=v,e.quatToEulerAngles=_,e.quatReset=g,e.quatLookat=y,e.quat2Lookat=w,e.quatYAxis=x,e.setQuatFromMat4=b;var T=new e.Vector3;e.setEulerAnglesFromMat4=D}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t){t.x=0,t.y=0,t.w=1,t.h=1}function r(t){t.x=0,t.y=0,t.w=0,t.h=0}function a(t,e){return!(t.x!=e.x||t.y!=e.y||t.w!=e.w||t.h!=e.h)}function i(t,e,r){return t<r.x||t>r.x+r.w||e<r.y||e>r.y+r.h?!1:!0}t.rectSet_One=e,t.rectSet_Zero=r,t.rectEqul=a,t.rectInner=i}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t){for(var e=0,r=0;r<t.length;r++){var a=t.charCodeAt(r);e+=127>=a?1:2047>=a?2:65535>=a?3:4}return e}t.caclStringByteLength=e}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){function r(t,e,r,a){var i=1/e,o=1/t,n=i*(r%e),s=o*Math.floor(r/e);a.x=i,a.y=o,a.z=n,a.w=s}function a(e,r,a,i,o,n,s){void 0===s&&(s=.3);var h=1-o,l=Math.pow(h,3),c=Math.pow(h,2),u=1-s,d=t.math.Pool.new_vector3();t.math.vec3ScaleByNum(e,l*u,d);var p=t.math.Pool.new_vector3();t.math.vec3ScaleByNum(r,3*c*o*s,p);var m=t.math.Pool.new_vector3();t.math.vec3ScaleByNum(i,3*h*Math.pow(o,2)*s,m);var f=t.math.Pool.new_vector3();t.math.vec3ScaleByNum(a,Math.pow(o,3)*u,f);var v=t.math.Pool.new_vector3();t.math.vec3Add(d,p,v),t.math.vec3Add(v,m,v),t.math.vec3Add(v,f,v),t.math.vec3ScaleByNum(v,1/(l*u+3*c*o*s+3*h*Math.pow(o,2)*s+Math.pow(o,3)*u),n),t.math.Pool.delete_vector3(d),t.math.Pool.delete_vector3(p),t.math.Pool.delete_vector3(m),t.math.Pool.delete_vector3(f),t.math.Pool.delete_vector3(v)}e.spriteAnimation=r,e.GetPointAlongCurve=a}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t,e,r){r.x=t.x-e.x,r.y=t.y-e.y}function r(t,e,r){r.x=t.x+e.x,r.y=t.y+e.y}function a(t,e){e.x=t.x,e.y=t.y}function i(r,a){var i=t.Pool.new_vector2();e(r,a,i);var o=Math.sqrt(i.x*i.x+i.y*i.y);return t.Pool.delete_vector2(i),o}function o(t,e,r){r.x=t.x*e,r.y=t.y*e}function n(t,e){e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w}function s(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function h(t,e,r,a){a.x=t.x*(1-r)+e.x*r,a.y=t.y*(1-r)+e.y*r}function l(t,e){var r=s(t);r>Number.MIN_VALUE?(e.x=t.x/r,e.y=t.y/r):(e.x=0,e.y=0)}function c(t,e){return t.x*e.x+t.y*e.y}function u(t,e,r){return void 0===r&&(r=1e-5),Math.abs(t.x-e.x)>r?!1:Math.abs(t.y-e.y)>r?!1:!0}t.vec2Subtract=e,t.vec2Add=r,t.vec2Clone=a,t.vec2Distance=i,t.vec2ScaleByNum=o,t.vec4Clone=n,t.vec2Length=s,t.vec2SLerp=h,t.vec2Normalize=l,t.vec2Multiply=c,t.vec2Equal=u}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t,e){e.x=t.x,e.y=t.y,e.z=t.z}function r(t){t=this.x+","+this.y+","+this.z}function a(t,e,r){r.x=t.x+e.x,r.y=t.y+e.y,r.z=t.z+e.z}function i(t,e,r){r.x=t.x-e.x,r.y=t.y-e.y,r.z=t.z-e.z}function o(t,e){e.x=-t.x,e.y=-t.y,e.z=-t.z}function n(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)}function s(t){return t.x*t.x+t.y*t.y+t.z*t.z}function h(t){t.x=t.y=t.z=1}function l(t){t.x=t.y=0,t.z=1}function c(t){t.x=t.y=0,t.z=-1}function u(t){t.x=t.z=0,t.y=1}function d(t){t.x=t.z=0,t.y=-1}function p(t){t.x=-1,t.y=t.z=0}function m(t){t.x=1,t.y=t.z=0}function f(t,e){var r=n(t);r>Number.MIN_VALUE?(e.x=t.x/r,e.y=t.y/r,e.z=t.z/r):(e.x=0,e.y=0,e.z=0)}function v(t,e,r){r.x=t.x*e.x,r.y=t.y*e.y,r.z=t.z*e.z}function _(t,e,r){r.x=t.x*e,r.y=t.y*e,r.z=t.z*e}function g(t,e,r){r.x=t.x*e.x,r.y=t.y*e.y,r.z=t.z*e.z}function y(t,e,r){r.x=t.y*e.z-t.z*e.y,r.y=t.z*e.x-t.x*e.z,r.z=t.x*e.y-t.y*e.x}function w(t,e,r){var i=0;i=x(e,t),_(r,-2*i,r),a(r,t,r)}function x(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}function b(t,e,r){var a=0;if(a=x(e,e),a<Number.MIN_VALUE)r.x=r.y=r.z=0;else{var i=0;i=x(t,e),_(e,i/a,r)}}function D(t,e,r){b(t,e,r),i(t,r,r)}function T(t,e,r){b(e,t,r),i(e,r,r)}function E(e,r){var a=t.Pool.new_vector3(),i=t.Pool.new_vector3();f(e,a),f(r,i);var o=x(a,i);return o=t.floatClamp(o,-1,1),o=57.29578*Math.acos(o),t.Pool.delete_vector3(a),t.Pool.delete_vector3(a),o}function P(e,r){var a=t.Pool.new_vector3();i(e,r,a);var o=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);return t.Pool.delete_vector3(a),o}function M(t,e,r){var a=0;a=s(t),a>e*e&&(f(t,r),_(r,e,r)),r=t}function S(t,e,r){r.x=Math.min(t.x,e.x),r.y=Math.min(t.y,e.y),r.z=Math.min(t.z,e.z)}function A(t,e,r){r.x=Math.max(t.x,e.x),r.y=Math.max(t.y,e.y),r.z=Math.max(t.z,e.z)}function C(e,r){f(e,e),f(r,r);var a=x(e,r);return a=t.floatClamp(a,-1,1),a=Math.acos(a)}function V(t){t.x=0,t.y=0,t.z=0}function R(t,e,r,a){a.x=t.x*(1-r)+e.x*r,a.y=t.y*(1-r)+e.y*r,a.z=t.z*(1-r)+e.z*r}function k(t,e,r,a){a.x=t,a.y=e,a.z=r}function F(t,e,r){r.x=I(t.x,e),r.y=I(t.y,e),r.z=I(t.z,e)}function L(t,e,r){r.x=I(t.x,e),r.y=I(t.y,e),r.z=I(t.z,e),r.w=I(t.w,e)}function I(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r}function z(t,e,r){return void 0===r&&(r=1e-5),Math.abs(t.x-e.x)>r?!1:Math.abs(t.y-e.y)>r?!1:Math.abs(t.z-e.z)>r?!1:!0}t.vec3Clone=e,t.vec3ToString=r,t.vec3Add=a,t.vec3Subtract=i,t.vec3Minus=o,t.vec3Length=n,t.vec3SqrLength=s,t.vec3Set_One=h,t.vec3Set_Forward=l,t.vec3Set_Back=c,t.vec3Set_Up=u,t.vec3Set_Down=d,t.vec3Set_Left=p,t.vec3Set_Right=m,t.vec3Normalize=f,t.vec3ScaleByVec3=v,t.vec3ScaleByNum=_,t.vec3Product=g,t.vec3Cross=y,t.vec3Reflect=w,t.vec3Dot=x,t.vec3Project=b,t.vec3ProjectOnPlane=D,t.vec3Exclude=T,t.vec3Angle=E,t.vec3Distance=P,t.vec3ClampLength=M,t.vec3Min=S,t.vec3Max=A,t.vec3AngleBetween=C,t.vec3Reset=V,t.vec3SLerp=R,t.vec3SetByFloat=k,t.vec3Format=F,t.quaternionFormat=L,t.floatFormat=I,t.vec3Equal=z}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function t(){this.beLoop=!1,this.elements=[]}return t.prototype.clone=function(){var e=new t;e.life=this.life,e.beLoop=this.beLoop;for(var r in this.elements)e.elements[r]=this.elements[r].clone();return e},t.prototype.dispose=function(){for(var t in this.elements)this.elements[t].dispose();this.elements.length=0},t}();e.EffectSystemData=r,__reflect(r.prototype,"egret3d.framework.EffectSystemData");var a=function(){function r(t,e){this.scene=e,this.startIndex=0,this.actionActive=!1,this.loopFrame=Number.MAX_VALUE,this.active=!0,this.data=t,this.name=this.data.name,this.timelineFrame={},this.initActions(),this.recordElementLerpAttributes()}return r.prototype.recordElementLerpAttributes=function(){if(void 0!=this.data.timelineFrame)for(var t in this.data.timelineFrame){var e=this.data.timelineFrame[t];if(-1!=e.frameIndex)if(void 0!=e.lerpDatas&&0!=e.lerpDatas.length)this.recordLerpValues(e);else if(void 0!=e.attrsData){void 0==this.timelineFrame[e.frameIndex]&&(this.timelineFrame[e.frameIndex]=new n,this.timelineFrame[e.frameIndex].attrsData=new o,this.timelineFrame[e.frameIndex].frameIndex=e.frameIndex);for(var r in e.attrsData)this.timelineFrame[e.frameIndex].attrsData.setLerpAttribute(r,e.attrsData.getAttribute(r))}}},r.prototype.recordLerpValues=function(t){for(var e in t.lerpDatas)if(t.lerpDatas[e].type==p.Linear)for(var r in t.lerpDatas[e].attrsList){var a=t.lerpDatas[e].attrsList[r];this.recordLerp(t,t.lerpDatas[e],a)}},r.prototype.recordLerp=function(e,r,a){var i=r.fromFrame,s=r.toFrame.getValue(),h=r.attrsData.getAttribute(a);void 0==e.attrsData[a]&&e.attrsData.initAttribute(a);for(var l=e.attrsData.getAttribute(a),c=i+1;s>=c;c++){var u=void 0;l instanceof t.math.Vector3?(u=new t.math.Vector3,t.math.vec3SLerp(l,h,(c-i)/(s-i),u)):l instanceof t.math.Vector2?(u=new t.math.Vector2,t.math.vec2SLerp(l,h,(c-i)/(s-i),u)):"number"==typeof l&&(u=t.math.numberLerp(l,h,(c-i)/(s-i)));var d=this.timelineFrame[c];void 0==d&&(d=new n,d.attrsData=new o,d.frameIndex=c,this.timelineFrame[c]=d),d.attrsData.setLerpAttribute(a,u)}},r.prototype.initActions=function(){this.actions=[];var t;for(var r in this.data.actionData){var a=this.data.actionData[r];switch(a.actionType){case"linear":t=new e.LinearAction;break;case"destroy":t=new e.DestroyAction;break;case"loop":t=new e.LoopAction;break;case"destroy":t=new e.DestroyAction;break;case"rotation":t=new e.RotationAction;break;case"breath":t=new e.BreathAction;break;case"uvroll":t=new e.UVRollAction;break;case"uvsprite":t=new e.UVSpriteAnimationAction;break;case"rosepath":t=new e.RoseCurveAction;break;case"trail":t=new e.TrailAction}t.init(this.scene,a.startFrame,a.endFrame,a.params,this),this.actions.push(t)}},r.prototype.update=function(){void 0!=this.curAttrData&&null!=this.curAttrData&&(this.active?(void 0!=this.curAttrData.euler&&t.math.quatFromEulerAngles(this.curAttrData.euler.x,this.curAttrData.euler.y,this.curAttrData.euler.z,this.curAttrData.rotationByEuler),this.updateElementRotation(),t.math.matrixMakeTransformRTS(this.curAttrData.pos,this.curAttrData.scale,this.curAttrData.localRotation,this.curAttrData.matrix)):this.curAttrData.resetMatrix())},r.prototype.updateElementRotation=function(){var r=this.scene,a=r.mainCamera.gameObject.transform,i=t.math.Pool.new_quaternion(),o=t.math.Pool.new_quaternion();if(this.curAttrData.renderModel!=m.None){var n=t.math.Pool.new_quaternion(),s=t.math.Pool.new_vector3(),h=t.math.Pool.new_vector3();if(t.math.vec3Clone(this.curAttrData.pos,h),void 0!=this.transform&&t.math.matrixTransformVector3(h,this.transform.getWorldMatrix(),s),this.curAttrData.renderModel==m.BillBoard)t.math.quatLookat(s,a.getPosition(),i);else if(this.curAttrData.renderModel==m.HorizontalBillBoard)i.x=-.5,i.y=.5,i.z=.5,i.w=.5;else if(this.curAttrData.renderModel==m.VerticalBillBoard){var l=t.math.Pool.new_vector3();t.math.vec3Clone(a.getPosition(),l),l.y=s.y,t.math.quatLookat(s,l,i),t.math.Pool.delete_vector3(l)}else{if(this.curAttrData.renderModel==m.StretchedBillBoard){t.math.quatMultiply(i,this.curAttrData.rotationByEuler,this.curAttrData.localRotation),t.math.quatLookat(s,a.getPosition(),i);var c=new t.math.Quaternion;t.math.quatClone(this.transform.getRotation(),n),t.math.quatInverse(n,n),t.math.quatMultiply(n,i,c);var u=t.math.Pool.new_quaternion();t.math.quatInverse(this.curAttrData.localRotation,u),t.math.quatMultiply(u,c,c);var d=t.math.Pool.new_vector3();return t.math.quatToEulerAngles(c,d),t.math.quatFromEulerAngles(0,d.y,0,c),t.math.quatMultiply(this.curAttrData.localRotation,c,this.curAttrData.localRotation),t.math.Pool.delete_quaternion(u),t.math.Pool.delete_vector3(d),void t.math.Pool.delete_quaternion(c)}this.curAttrData.renderModel==m.Mesh&&e.EffectUtil.quatLookatZ(s,a.getPosition(),i)}t.math.quatMultiply(i,this.curAttrData.rotationByEuler,i),t.math.quatClone(this.transform.gameObject.transform.getRotation(),n),t.math.quatInverse(n,n),t.math.quatMultiply(n,i,this.curAttrData.localRotation),t.math.Pool.delete_vector3(h),t.math.Pool.delete_vector3(s),t.math.Pool.delete_quaternion(n)}else t.math.quatMultiply(i,this.curAttrData.rotationByEuler,this.curAttrData.localRotation);t.math.Pool.delete_quaternion(o),t.math.Pool.delete_quaternion(i)},r.prototype.isActiveFrame=function(t){return void 0!=this.timelineFrame[t]?!0:void 0!=this.curAttrData&&this.curAttrData.renderModel!=m.None?!0:this.actionActive},r.prototype.setActive=function(t){this.active!=t&&(this.active=t,this.active||this.curAttrData.resetMatrix())},r.prototype.dispose=function(){this.data.dispose(),this.curAttrData=null,this.actions.length=0,delete this.timelineFrame},r}();e.EffectElement=a,__reflect(a.prototype,"egret3d.framework.EffectElement");var i=function(){function t(){}return t.prototype.clone=function(){var e=new t;
e.name=this.name,e.type=this.type,e.ref=this.ref,e.beloop=this.beloop,e.actionData=[],e.timelineFrame=[],this.initFrameData&&(e.initFrameData=this.initFrameData.clone()),this.emissionData&&(e.emissionData=this.emissionData.clone());for(var r in this.timelineFrame)this.timelineFrame[r]&&(e.timelineFrame[r]=this.timelineFrame[r].clone());for(var r in this.actionData)this.actionData[r]&&(e.actionData[r]=this.actionData[r].clone());return e},t.prototype.dispose=function(){this.actionData&&(this.actionData.length=0),this.initFrameData&&this.initFrameData.dispose();for(var t in this.timelineFrame)this.timelineFrame[t].dispose();delete this.timelineFrame},t}();e.EffectElementData=i,__reflect(i.prototype,"egret3d.framework.EffectElementData");var o=function(){function e(){this.renderModel=m.None,this.matrix=new t.math.Matrix,this.rotationByEuler=new t.math.Quaternion,this.localRotation=new t.math.Quaternion}return e.prototype.setLerpAttribute=function(t,e){switch(t){case"pos":this.pos=e;break;case"scale":this.scale=e;break;case"euler":this.euler=e;break;case"alpha":this.alpha=e;break;case"uv":this.uv=e;break;case"color":this.color=e;break;case"tilling":}},e.prototype.getAttribute=function(e){switch(e){case"pos":return t.math.Pool.clone_vector3(this.pos);case"scale":return t.math.Pool.clone_vector3(this.scale);case"euler":return t.math.Pool.clone_vector3(this.euler);case"alpha":return this.alpha;case"color":return t.math.Pool.clone_vector3(this.color);case"tilling":return t.math.Pool.clone_vector2(this.tilling);case"uv":return t.math.Pool.clone_vector2(this.uv);case"mat":return this.mat.clone();case"renderModel":return this.renderModel;case"rotationByEuler":return t.math.Pool.clone_quaternion(this.rotationByEuler);case"localRotation":return t.math.Pool.clone_quaternion(this.localRotation);case"matrix":return t.math.Pool.clone_matrix(this.matrix);case"colorRate":return this.colorRate}},e.prototype.initAttribute=function(e){switch(e){case"pos":this.pos=new t.math.Vector3(0,0,0);break;case"scale":this.scale=new t.math.Vector3(1,1,1);break;case"euler":this.euler=new t.math.Vector3(0,0,0);break;case"alpha":this.alpha=0;break;case"color":this.color=new t.math.Vector3(0,0,0);break;case"uv":this.uv=new t.math.Vector2(0,0);break;case"tilling":this.tilling=new t.math.Vector2(1,1);break;case"colorRate":this.colorRate=1;break;default:console.log("不支持的属性："+e)}},e.prototype.resetMatrix=function(){t.math.matrixZero(this.matrix)},e.prototype.copyandinit=function(){var r=new e;return void 0!=this.pos?r.pos=t.math.Pool.clone_vector3(this.pos):r.initAttribute("pos"),void 0!=this.euler?r.euler=t.math.Pool.clone_vector3(this.euler):r.initAttribute("euler"),void 0!=this.color?r.color=t.math.Pool.clone_vector3(this.color):r.initAttribute("color"),void 0!=this.scale?r.scale=t.math.Pool.clone_vector3(this.scale):r.initAttribute("scale"),void 0!=this.uv?r.uv=t.math.Pool.clone_vector2(this.uv):r.initAttribute("uv"),void 0!=this.tilling?r.tilling=t.math.Pool.clone_vector2(this.tilling):r.initAttribute("tilling"),void 0!=this.colorRate?r.colorRate=this.colorRate:r.initAttribute("colorRate"),void 0!=this.mat&&(r.mat=this.mat.clone()),void 0!=this.rotationByEuler&&(r.rotationByEuler=t.math.Pool.clone_quaternion(this.rotationByEuler)),void 0!=this.localRotation&&(r.localRotation=t.math.Pool.clone_quaternion(this.localRotation)),void 0!=this.meshdataVbo&&(r.meshdataVbo=this.meshdataVbo),r.alpha=this.alpha,r.renderModel=this.renderModel,r.mesh=this.mesh,r},e.prototype.clone=function(){var r=new e;return void 0!=this.pos&&(r.pos=t.math.Pool.clone_vector3(this.pos)),void 0!=this.euler&&(r.euler=t.math.Pool.clone_vector3(this.euler)),void 0!=this.color&&(r.color=t.math.Pool.clone_vector3(this.color)),void 0!=this.scale&&(r.scale=t.math.Pool.clone_vector3(this.scale)),void 0!=this.tilling&&(r.tilling=t.math.Pool.clone_vector2(this.tilling)),void 0!=this.colorRate&&(r.colorRate=this.colorRate),void 0!=this.uv&&(r.uv=t.math.Pool.clone_vector2(this.uv)),void 0!=this.mat&&(r.mat=this.mat.clone()),void 0!=this.rotationByEuler&&(r.rotationByEuler=t.math.Pool.clone_quaternion(this.rotationByEuler)),void 0!=this.localRotation&&(r.localRotation=t.math.Pool.clone_quaternion(this.localRotation)),void 0!=this.meshdataVbo&&(r.meshdataVbo=this.meshdataVbo),r.alpha=this.alpha,r.renderModel=this.renderModel,r.mesh=this.mesh,r},e}();e.EffectAttrsData=o,__reflect(o.prototype,"egret3d.framework.EffectAttrsData");var n=function(){function t(){}return t.prototype.clone=function(){var e=new t;e.frameIndex=this.frameIndex,e.attrsData=this.attrsData.clone(),e.lerpDatas=[];for(var r in this.lerpDatas)e.lerpDatas[r]=this.lerpDatas[r].clone();return e},t.prototype.dispose=function(){this.attrsData=null,this.lerpDatas&&(this.lerpDatas.length=0)},t}();e.EffectFrameData=n,__reflect(n.prototype,"egret3d.framework.EffectFrameData");var s=function(){function t(){this.attrsList=[]}return t.prototype.clone=function(){var e=new t;e.type=this.type,e.fromFrame=this.fromFrame,e.toFrame=this.toFrame,e.attrsData=this.attrsData.clone();for(var r in this.attrsList)e.attrsList[r]=this.attrsList[r];return e},t}();e.EffectLerpData=s,__reflect(s.prototype,"egret3d.framework.EffectLerpData");var h=function(){function t(){}return t.prototype.clone=function(){var e=new t;e.actionType=this.actionType,e.startFrame=this.startFrame,e.endFrame=this.endFrame,e.params=[];for(var r in this.params)e.params[r]=this.params[r];return e},t}();e.EffectActionData=h,__reflect(h.prototype,"egret3d.framework.EffectActionData");var l=function(){function t(){}return t.beEqual=function(t,e){return t.alphaCut==e.alphaCut&&t.diffuseTexture==e.diffuseTexture&&t.shader==e.shader},t.prototype.clone=function(){var e=new t;return e.shader=this.shader,e.diffuseTexture=this.diffuseTexture,e.alphaCut=this.alphaCut,e},t}();e.EffectMatData=l,__reflect(l.prototype,"egret3d.framework.EffectMatData");var c=function(){function e(e){this.beBufferInited=!1,this.effectElements=[],this._totalVertexCount=0,this._indexStartIndex=0,this._vbosize=0,this.vertexSize=0,this.vertexSize=t.render.MeshData.calcByteSize(e)/4}return Object.defineProperty(e.prototype,"curTotalVertexCount",{get:function(){return this._totalVertexCount},set:function(t){this._totalVertexCount=t,this.resizeVboSize(this._totalVertexCount*this.vertexSize)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"indexStartIndex",{get:function(){return this._indexStartIndex},set:function(t){if(this._indexStartIndex=t,null!=this.dataForEbo){var e=new Uint16Array(this._indexStartIndex);e.set(this.dataForEbo,0),this.dataForEbo=e}else this.dataForEbo=new Uint16Array(this._indexStartIndex)},enumerable:!0,configurable:!0}),e.prototype.resizeVboSize=function(t){if(!(this._vbosize>t))if(this._vbosize=t,null!=this.dataForVbo){var e=new Float32Array(this._vbosize);e.set(this.dataForVbo,0),this.dataForVbo=e}else this.dataForVbo=new Float32Array(this._vbosize)},e.prototype.dispose=function(){this.mesh.dispose(),this.mat.dispose(),this.dataForVbo=null,this.dataForEbo=null;for(var t in this.effectElements)this.effectElements[t].dispose()},e}();e.EffectBatcher=c,__reflect(c.prototype,"egret3d.framework.EffectBatcher");var u;!function(t){t[t.None=0]="None",t[t.BeReady=1]="BeReady",t[t.Play=2]="Play",t[t.Pause=3]="Pause",t[t.Stop=4]="Stop",t[t.Dispose=5]="Dispose"}(u=e.EffectPlayStateEnum||(e.EffectPlayStateEnum={}));var d;!function(t){t[t.SingleMeshType=0]="SingleMeshType",t[t.EmissionType=1]="EmissionType",t[t.MultiMeshType=2]="MultiMeshType"}(d=e.EffectElementTypeEnum||(e.EffectElementTypeEnum={}));var p;!function(t){t[t.Linear=0]="Linear"}(p=e.EffectLerpTypeEnum||(e.EffectLerpTypeEnum={}));var m;!function(t){t[t.None=0]="None",t[t.BillBoard=1]="BillBoard",t[t.StretchedBillBoard=2]="StretchedBillBoard",t[t.HorizontalBillBoard=3]="HorizontalBillBoard",t[t.VerticalBillBoard=4]="VerticalBillBoard",t[t.Mesh=5]="Mesh"}(m=e.RenderModel||(e.RenderModel={}))}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e;!function(t){t[t.burst=0]="burst",t[t["continue"]=1]="continue"}(e=t.ParticleEmissionType||(t.ParticleEmissionType={}));var r=function(){function t(){this.type=e.burst}return t}();t.EmissionData=r,__reflect(r.prototype,"egret3d.framework.EmissionData")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.beLoop=!1,this.paricleLoop=!1,this.singleMeshLoop=!1,this.renderModel=e.RenderModel.None,this.particleStartData=new t.framework.ParticleStartData}return r.prototype.getVboData=function(t){return void 0==this.dataForVbo&&(this.dataForVbo=this.mesh.data.genVertexDataArray(t)),this.dataForVbo},r.prototype.clone=function(){var e=new r;return void 0!=this.emissionType&&(e.emissionType=this.emissionType),void 0!=this.rootpos&&(e.rootpos=t.math.Pool.clone_vector3(this.rootpos)),void 0!=this.rootRotAngle&&(e.rootRotAngle=t.math.Pool.clone_vector3(this.rootRotAngle)),void 0!=this.rootScale&&(e.rootScale=t.math.Pool.clone_vector3(this.rootScale)),void 0!=this.maxEmissionCount&&(e.maxEmissionCount=this.maxEmissionCount),void 0!=this.emissionCount&&(e.emissionCount=this.emissionCount),void 0!=this.time&&(e.time=this.time),void 0!=this.pos&&(e.pos=this.pos.clone()),e.beLoop=this.beLoop,void 0!=this.simulationSpeed&&(e.simulationSpeed=this.simulationSpeed.clone()),void 0!=this.moveSpeed&&(e.moveSpeed=this.moveSpeed.clone()),void 0!=this.gravity&&(e.gravity=this.gravity),void 0!=this.euler&&(e.euler=this.euler.clone()),void 0!=this.eulerNodes&&(e.eulerNodes=this.cloneParticleNodeArray(this.eulerNodes)),void 0!=this.eulerSpeed&&(e.eulerSpeed=this.eulerSpeed.clone()),void 0!=this.scale&&(e.scale=this.scale.clone()),void 0!=this.scaleNodes&&(e.scaleNodes=this.cloneParticleNodeNumberArray(this.scaleNodes)),void 0!=this.scaleSpeed&&(e.scaleSpeed=this.scaleSpeed.clone()),void 0!=this.color&&(e.color=this.color.clone()),void 0!=this.colorRate&&(e.colorRate=this.colorRate),void 0!=this.colorNodes&&(e.colorNodes=this.cloneParticleNodeArray(this.colorNodes)),void 0!=this.colorSpeed&&(e.colorSpeed=this.colorSpeed.clone()),void 0!=this.simulationSpeed&&(e.simulationSpeed=this.simulationSpeed.clone()),void 0!=this.alpha&&(e.alpha=this.alpha.clone()),void 0!=this.alphaNodes&&(e.alphaNodes=this.cloneParticleNodeNumberArray(this.alphaNodes)),void 0!=this.alphaSpeed&&(e.alphaSpeed=this.alphaSpeed.clone()),void 0!=this.uv&&(e.uv=this.uv.clone()),void 0!=this.uvType&&(e.uvType=this.uvType),void 0!=this.uvRoll&&(e.uvRoll=this.uvRoll.clone()),void 0!=this.uvSprite&&(e.uvSprite=this.uvSprite.clone()),void 0!=this.mat&&(e.mat=this.mat.clone()),void 0!=this.life&&(e.life=this.life.clone()),void 0!=this.renderModel&&(e.renderModel=this.renderModel),void 0!=this.mesh&&(e.mesh=this.mesh),void 0!=this.dataForVbo&&(e.dataForVbo=this.dataForVbo),void 0!=this.particleStartData&&(e.particleStartData=this.particleStartData.clone()),e},r.prototype.getworldRotation=function(){},r.prototype.cloneParticleNodeArray=function(t){var e=new Array;for(var r in t)e.push(t[r].clone());return e},r.prototype.cloneParticleNodeNumberArray=function(t){var e=new Array;for(var r in t)e.push(t[r].clone());return e},r}();e.Emission=r,__reflect(r.prototype,"egret3d.framework.Emission");var a=function(){function t(){}return t.prototype.clone=function(){var e=new t;return e.row=this.row,e.column=this.column,e.totalCount=this.totalCount,e},t}();e.UVSprite=a,__reflect(a.prototype,"egret3d.framework.UVSprite");var i=function(){function t(){}return t.prototype.clone=function(){var e=new t;if(void 0!=this.uvSpeed&&(e.uvSpeed=this.uvSpeed),void 0!=this.uvSpeedNodes){var r=new Array;for(var a in this.uvSpeedNodes)r.push(this.uvSpeedNodes[a].clone());e.uvSpeedNodes=r}return e},t}();e.UVRoll=i,__reflect(i.prototype,"egret3d.framework.UVRoll");var o;!function(t){t[t.NONE=0]="NONE",t[t.UVRoll=1]="UVRoll",t[t.UVSprite=2]="UVSprite"}(o=e.UVTypeEnum||(e.UVTypeEnum={}))}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.x=new e.ValueData,this.y=new e.ValueData,this.z=new e.ValueData}return r.prototype.getValue=function(){return new t.math.Vector3(this.x.getValue(),this.y.getValue(),this.z.getValue())},r.prototype.getValueRandom=function(){return new t.math.Vector3(this.x.getValueRandom(),this.y.getValueRandom(),this.z.getValueRandom())},r.prototype.clone=function(){var t=new r;return void 0!=this.x&&(t.x=this.x.clone()),void 0!=this.y&&(t.y=this.y.clone()),void 0!=this.z&&(t.z=this.z.clone()),void 0!=this.key&&(t.key=this.key),t},r}();e.ParticleNode=r,__reflect(r.prototype,"egret3d.framework.ParticleNode");var a=function(){function t(){this.alpha=new e.ValueData}return t.prototype.getValue=function(){return this.alpha.getValue()},t}();e.AlphaNode=a,__reflect(a.prototype,"egret3d.framework.AlphaNode");var i=function(){function r(){this.u=new e.ValueData,this.v=new e.ValueData}return r.prototype.getValue=function(){return new t.math.Vector2(this.u.getValue(),this.v.getValue())},r.prototype.getValueRandom=function(){return new t.math.Vector2(this.u.getValueRandom(),this.v.getValueRandom())},r.prototype.clone=function(){var t=new r;return t.u=this.u.clone(),t.v=this.v.clone(),void 0!=this.key&&(t.key=this.key),t},r}();e.UVSpeedNode=i,__reflect(i.prototype,"egret3d.framework.UVSpeedNode");var o=function(){function r(){this.x=new e.ValueData,this.y=new e.ValueData}return r.prototype.getValue=function(){return new t.math.Vector2(this.x.getValue(),this.y.getValue())},r.prototype.getValueRandom=function(){return new t.math.Vector2(this.x.getValueRandom(),this.y.getValueRandom())},r.prototype.clone=function(){var t=new r;return t.x=this.x.clone(),t.y=this.y.clone(),void 0!=this.key&&(t.key=this.key),t},r}();e.ParticleNodeVec2=o,__reflect(o.prototype,"egret3d.framework.ParticleNodeVec2");var n=function(){function t(){this.num=new e.ValueData}return t.prototype.getValue=function(){return this.num.getValue()},t.prototype.getValueRandom=function(){return this.num.getValueRandom()},t.prototype.clone=function(){var e=new t;return e.num=this.num.clone(),void 0!=this.key&&(e.key=this.key),e},t}();e.ParticleNodeNumber=n,__reflect(n.prototype,"egret3d.framework.ParticleNodeNumber")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.NORMAL=0]="NORMAL",t[t.BOX=1]="BOX",t[t.SPHERE=2]="SPHERE",t[t.HEMISPHERE=3]="HEMISPHERE",t[t.CONE=4]="CONE",t[t.EDGE=5]="EDGE",t[t.CIRCLE=6]="CIRCLE"}(r=e.ParticleSystemShape||(e.ParticleSystemShape={}));var a=function(){function a(){this.shapeType=r.NORMAL,this._position=new t.math.Vector3(0,0,0),this._direction=new t.math.Vector3(0,1,0),this._width=0,this._height=0,this.depth=0,this._radius=0,this._angle=0,this.emitFrom=i.base}return Object.defineProperty(a.prototype,"position",{get:function(){return this._position},set:function(e){t.math.vec3Clone(e,this._position)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"direction",{get:function(){return this._direction},set:function(e){t.math.vec3Clone(e,this._direction)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"angle",{get:function(){return this._angle},set:function(t){this._angle=t},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"randomDirection",{get:function(){switch(this.shapeType){case r.BOX:return this.boxDirection;case r.SPHERE:return this.sphereDirection;case r.HEMISPHERE:return this.hemisphereDirection;case r.CONE:return this.coneDirection;case r.CIRCLE:return this.circleDirection;case r.EDGE:return this.edgeDirection;default:return this.direction}},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"boxDirection",{get:function(){return this.position.x=e.ValueData.RandomRange(-this.width/2,this.width/2),this.position.y=e.ValueData.RandomRange(-this.height/2,this.height/2),this.position.z=e.ValueData.RandomRange(-this.depth/2,this.depth/2),t.math.vec3Normalize(this.position,this.direction),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"sphereDirection",{get:function(){var e=Math.random()*Math.PI*2,r=Math.random()*Math.PI,a=Math.random()*this.radius;return this.direction.x=Math.sin(r)*Math.cos(e),this.direction.y=Math.cos(r),this.direction.z=Math.sin(r)*Math.sin(e),t.math.vec3ScaleByNum(this.direction,a,this.position),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"hemisphereDirection",{get:function(){var e=Math.random()*Math.PI*2,r=Math.random()*Math.PI*.5,a=Math.random()*this.radius;return this.direction.x=Math.sin(r)*Math.cos(e),this.direction.y=Math.cos(r),this.direction.z=Math.sin(r)*Math.sin(e),t.math.vec3ScaleByNum(this.direction,a,this.position),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"coneDirection",{get:function(){var e=Math.random()*Math.PI*2,r=Math.random()*this.height,a=r*Math.tan(this.angle*Math.PI/180)+this.radius,o=Math.random()*a,n=t.math.Pool.new_vector3();return n.x=this.radius*Math.cos(e),n.y=0,n.z=this.radius*Math.sin(e),this.emitFrom==i.base?t.math.vec3Clone(n,this.position):this.emitFrom==i.volume&&(this.position.x=o*Math.cos(e),this.position.z=o*Math.sin(e),this.position.y=r),this.direction.x=Math.cos(e)*Math.sin(this.angle*Math.PI/180),this.direction.z=Math.sin(e)*Math.sin(this.angle*Math.PI/180),this.direction.y=Math.cos(this.angle*Math.PI/180),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"circleDirection",{get:function(){var r=this.angle*(Math.PI/180),a=e.ValueData.RandomRange(-r/2,r/2),i=e.ValueData.RandomRange(0,this.radius);this.direction.x=i*Math.cos(a),this.direction.z=i*Math.sin(a),this.direction.y=0;var o=t.math.vec3Length(this.direction);return t.math.vec3Normalize(this.direction,this.direction),e.EffectUtil.RotateVector3(this.direction,this.direction,this.direction),this.getposition(this.direction,o),this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"edgeDirection",{get:function(){var r=new t.math.Vector3(0,0,0);r.y+=e.ValueData.RandomRange(-this.radius/2,this.radius/2);t.math.vec3Length(r);return e.EffectUtil.RotateVector3(r,this.direction,r),t.math.vec3Clone(this.direction,this.direction),this.getposition(r,length),this.direction},enumerable:!0,configurable:!0}),a.prototype.getposition=function(e,r){t.math.vec3ScaleByNum(e,r,e),this.position.x=e.x,this.position.y=e.y,this.position.z=e.z},a.prototype.clone=function(){var e=new a;return e.shapeType=this.shapeType,e._position=new t.math.Vector3,t.math.vec3Clone(this._position,e._position),e._direction=new t.math.Vector3,t.math.vec3Clone(this._direction,e._direction),e._width=this._width,e._height=this._height,e.depth=this.depth,e._radius=this._radius,e._angle=this._angle,e.position=new t.math.Vector3,t.math.vec3Clone(this.position,e.position),e.direction=new t.math.Vector3,t.math.vec3Clone(this.direction,e.direction),e},a}();e.ParticleStartData=a,__reflect(a.prototype,"egret3d.framework.ParticleStartData");var i;!function(t){t[t.base=0]="base",t[t.volume=1]="volume"}(i=e.emitfromenum||(e.emitfromenum={}))}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){this.isRandom=!0,this._value=0,this._valueLimitMin=0,this._valueLimitMax=0,this.beInited=!1}return Object.defineProperty(t.prototype,"value",{set:function(t){this._value=t,this.isRandom=!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueLimitMin",{set:function(t){this._valueLimitMin=t,this.isRandom=!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueLimitMax",{set:function(t){this._valueLimitMax=t,this.isRandom=!0},enumerable:!0,configurable:!0}),t.prototype.clone=function(){var e=new t;return e.isRandom=this.isRandom,e._value=this._value,e._valueLimitMin=this._valueLimitMin,e._valueLimitMax=this._valueLimitMax,e},t.prototype.getValue=function(){return this.isRandom&&(this.beInited||(this._value=t.RandomRange(this._valueLimitMin,this._valueLimitMax),this.beInited=!0)),this._value},t.prototype.getValueRandom=function(){return this.isRandom&&(this._value=t.RandomRange(this._valueLimitMin,this._valueLimitMax)),this._value},t.RandomRange=function(t,e,r){return void 0===r&&(r=!1),r?Math.floor(Math.random()*(e-t+1)+t):Math.random()*(e-t)+t},t}();t.ValueData=e,__reflect(e.prototype,"egret3d.framework.ValueData")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(t,e){this._beizerPoints=t,this._bezierPointNum=e}return Object.defineProperty(e.prototype,"beizerPoints",{get:function(){return this._beizerPoints},set:function(t){this._beizerPoints=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bezierPointNum",{get:function(){return this._bezierPointNum},set:function(t){this._bezierPointNum=t},enumerable:!0,configurable:!0}),e.CreateLinearBezier=function(r,a,i){i=i>2?i:3;var o=new Array,n=function(t,e,r){var a=(1-t)*e+t*r;return a};o.push(r);for(var s=1;i>=s;s++)o.push(new t.math.Vector3(n(s/i,r.x,a.x),n(s/i,r.y,r.y),n(s/i,r.z,r.z)));return new e(o,i)},e.GetLerpBezier=function(t){for(var r=new Array,a=0;a<t.length;a++)r.push(t[a].getValue());return new e(r,t.length)},e.CreateQuadraticBezier=function(r,a,i,o){o=o>2?o:3;for(var n=new Array,s=function(t,e,r,a){var i=(1-t)*(1-t)*e+2*t*(1-t)*r+t*t*a;return i},h=1;o>=h;h++)n.push(new t.math.Vector3(s(h/o,r.x,a.x,i.x),s(h/o,r.y,a.y,i.y),s(h/o,r.z,a.z,i.z)));return new e(n,o)},e.CreateCubicBezier=function(r,a,i,o,n){n=n>3?n:4;for(var s=new Array,h=function(t,e,r,a,i){var o=(1-t)*(1-t)*(1-t)*e+3*t*(1-t)*(1-t)*r+3*t*t*(1-t)*a+t*t*t*i;return o},l=1;n>=l;l++)s.push(new t.math.Vector3(h(l/n,r.x,a.x,i.x,o.x),h(l/n,r.y,a.y,i.y,o.y),h(l/n,r.z,a.z,i.z,o.z)));return new e(s,n)},e.prototype.getPoints=function(){return this._beizerPoints},e}();e.Curve3=r,__reflect(r.prototype,"egret3d.framework.Curve3")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function t(){}return t.prototype.init=function(t,r,a,i,o){if(this.startFrame=r,this.endFrame=a,this.params=i,this.elements=o,void 0!=this.params)switch(this.attriname=this.params.name,this.attriname){case"pos":case"scale":case"euler":case"color":this.attrival=e.EffectUtil.parseEffectVec3(this.params.value);break;case"uv":this.attrival=e.EffectUtil.parseEffectUVSpeed(this.params.value);break;case"alpha":this.attrival=this.params.value}},t.prototype.update=function(t){if(!(this.startFrame>t||this.endFrame<t)){var e=this.elements.curAttrData;switch(this.attriname){case"pos":e.pos.x=e.pos.x+this.attrival.x.getValue(),e.pos.y=e.pos.y+this.attrival.y.getValue(),e.pos.z=e.pos.z+this.attrival.z.getValue();break;case"scale":e.scale.x=e.scale.x+this.attrival.x.getValue(),e.scale.y=e.scale.y+this.attrival.y.getValue(),e.scale.z=e.scale.z+this.attrival.z.getValue();break;case"euler":e.euler.x=e.euler.x+this.attrival.x.getValue(),e.euler.y=e.euler.y+this.attrival.y.getValue(),e.euler.z=e.euler.z+this.attrival.z.getValue();break;case"color":e.color.x=e.color.x+this.attrival.x.getValue(),e.color.y=e.color.y+this.attrival.y.getValue(),e.color.z=e.color.z+this.attrival.z.getValue();break;case"uv":e.uv.x=e.uv.x+this.attrival.u.getValue(),e.uv.y=e.uv.y+this.attrival.v.getValue();break;case"alpha":e.alpha=e.alpha+this.attrival}}},t}();e.LinearAction=r,__reflect(r.prototype,"egret3d.framework.LinearAction",["egret3d.framework.IEffectAction"]);var a=function(){function t(){}return t.prototype.init=function(t,e,r,a,i){this.startFrame=e,this.endFrame=r,this.params=a,this.elements=i},t.prototype.update=function(t){t>=this.startFrame&&this.elements.setActive(!1)},t}();e.DestroyAction=a,__reflect(a.prototype,"egret3d.framework.DestroyAction",["egret3d.framework.IEffectAction"]);var i=function(){function t(){}return t.prototype.init=function(t,e,r,a,i){this.startFrame=e,this.endFrame=r,this.params=a,this.elements=i},t.prototype.update=function(t){t==this.startFrame&&(this.elements.loopFrame=this.startFrame+1,this.elements.curAttrData=this.elements.data.initFrameData.attrsData.copyandinit())},t}();e.LoopAction=i,__reflect(i.prototype,"egret3d.framework.LoopAction",["egret3d.framework.IEffectAction"]);var o=function(){function t(){this.speedu=0,this.speedv=0,this.startu=0,this.startv=0}return t.prototype.init=function(t,e,r,a,i){this.startFrame=e,this.endFrame=r,this.params=a,this.elements=i,void 0!=this.params.speedu&&(this.speedu=this.params.speedu),void 0!=this.params.speedv&&(this.speedv=this.params.speedv),void 0!=this.params.startu&&(this.startu=this.params.startu),void 0!=this.params.startv&&(this.startv=this.params.startv)},t.prototype.update=function(t){if(!(this.startFrame>t||this.endFrame<t)){if(this.startFrame==t)return this.elements.curAttrData.uv.x=this.startu,void(this.elements.curAttrData.uv.y=this.startv);this.elements.curAttrData.uv.x+=this.speedu,this.elements.curAttrData.uv.y+=this.speedv}},t}();e.UVRollAction=o,__reflect(o.prototype,"egret3d.framework.UVRollAction",["egret3d.framework.IEffectAction"]);var n=function(){function t(){this.fps=30,this.row=1,this.colum=1,this.frameInternal=1,this.spriteIndex=0}return t.prototype.init=function(t,r,a,i,o){this.startFrame=r,this.endFrame=a,this.params=i,this.elements=o,void 0!=this.params.fps&&(this.fps=this.params.fps,this.frameInternal=e.EffectSystem.fps/this.fps),void 0!=this.params.row&&(this.row=this.params.row),void 0!=this.params.colum&&(this.colum=this.params.colum)},t.prototype.update=function(t){this.startFrame>t||this.endFrame<t||(t-this.startFrame)%this.frameInternal==0&&(this.spriteIndex=(t-this.startFrame)/this.frameInternal,this.spriteIndex%=this.colum*this.row,this.elements.curAttrData.uv.x=this.spriteIndex%this.colum/this.colum,this.elements.curAttrData.uv.y=Math.floor(this.spriteIndex/this.colum)/this.row,this.elements.curAttrData.tilling.x=1/this.colum,this.elements.curAttrData.tilling.y=1/this.row)},t}();e.UVSpriteAnimationAction=n,__reflect(n.prototype,"egret3d.framework.UVSpriteAnimationAction",["egret3d.framework.IEffectAction"]);var s=function(){function t(){}return t.prototype.init=function(t,r,a,i,o){this.startFrame=r,this.endFrame=a,this.params=i,this.elements=o,void 0!=this.params.velocity&&(this.velocity=e.EffectUtil.parseEffectVec3(this.params.velocity)),this.frameInternal=1/e.EffectSystem.fps},t.prototype.update=function(t){this.elements.curAttrData.euler.z=this.elements.curAttrData.euler.z+this.velocity.z.getValue()*this.frameInternal,this.elements.curAttrData.renderModel==e.RenderModel.None&&(this.elements.curAttrData.euler.x=this.elements.curAttrData.euler.x+this.velocity.x.getValue()*this.frameInternal,this.elements.curAttrData.euler.y=this.elements.curAttrData.euler.y+this.velocity.y.getValue()*this.frameInternal)},t}();e.RotationAction=s,__reflect(s.prototype,"egret3d.framework.RotationAction",["egret3d.framework.IEffectAction"]);var h=function(){function r(){}return r.prototype.init=function(t,r,a,i,o){this.startFrame=r,this.endFrame=a,this.params=i,this.elements=o,void 0!=this.params.radius&&(this.radius=this.params.radius),void 0!=this.params.level&&(this.level=this.params.radius),void 0!=this.params.speed&&(this.speed=this.params.speed),void 0!=this.params.polar&&(this.polar=e.EffectUtil.parseEffectVec3(this.params.polar)),this.frameInternal=1/e.EffectSystem.fps},r.prototype.update=function(e){var r=t.math.Pool.new_vector3();t.math.vec3Clone(this.elements.data.initFrameData.attrsData.pos,r);var a=this.radius,i=this.polar.x.getValue(),o=this.polar.y.getValue(),n=(this.polar.z.getValue(),e*this.speed);this.elements.curAttrData.pos.x=r.x+a*Math.cos(3*n+i)*Math.cos(n),this.elements.curAttrData.pos.z=r.z+a*Math.cos(3*n+i)*Math.sin(n),this.elements.curAttrData.pos.y=r.y+o*Math.cos(e*this.speed);var s=e*this.speed+.001,h=t.math.Pool.new_vector3();h.x=r.x+a*Math.cos(3*s+i)*Math.cos(s),h.z=r.z+a*Math.cos(3*s+i)*Math.sin(s),h.y=r.y+o*Math.cos(e*this.speed);var l=t.math.Pool.new_quaternion();t.math.quatLookat(this.elements.curAttrData.pos,h,l),t.math.quatToEulerAngles(l,this.elements.curAttrData.euler),t.math.Pool.delete_vector3(h),t.math.Pool.delete_quaternion(l),t.math.Pool.delete_vector3(r)},r}();e.RoseCurveAction=h,__reflect(h.prototype,"egret3d.framework.RoseCurveAction",["egret3d.framework.IEffectAction"]);var l=function(){function r(){this.offsetTransalte=new t.math.Vector3}return r.prototype.init=function(r,a,i,o,n){this.startFrame=a,this.endFrame=i,this.params=o,this.elements=n,void 0!=this.params.pos&&(this.position=e.EffectUtil.parseEffectVec3(this.params.pos)),this.offsetTransalte.x=this.position.x.getValue(),this.offsetTransalte.y=this.position.y.getValue(),this.offsetTransalte.z=this.position.z.getValue(),void 0!=this.params.eular&&(this.eular=e.EffectUtil.parseEffectVec3(this.params.eular)),void 0!=this.params.color&&(this.color=e.EffectUtil.parseEffectVec3(this.params.color)),void 0!=this.params.width&&(this.width=this.params.width),void 0!=this.params.speed&&(this.speed=this.params.speed),void 0!=this.params.speed&&(this.speed=this.params.speed),void 0!=this.params.alpha&&(this.alpha=this.params.alpha);var s=new t.framework.Material,h=new t.framework.Shader,l=new t.framework.Texture;h=void 0!=this.params.shader?e.AssetMap.find(this.params.shader):e.DefaultShaders.Diffuse,s.setShader(h),void 0!=this.params.diffuseTexture&&(l=e.AssetMap.find(this.params.diffuseTexture)),s.setTexture("_MainTex",l),this.frameInternal=1/e.EffectSystem.fps,this.transform=new t.framework.Transform,r.addChild(this.transform);var c=this.elements.data.initFrameData.attrsData.clone(),u=t.math.Pool.new_vector3();t.math.vec3Clone(c.pos,u),void 0!=this.elements.transform&&t.math.matrixTransformVector3(u,this.elements.transform.getWorldMatrix(),u),this.transform.setLocalPosition(u),t.math.Pool.delete_vector3(u);var d=new t.framework.Transform;this.transform.addChild(d);var p=this.eular.x.getValue(),m=this.eular.y.getValue(),f=this.eular.z.getValue();this.startRotation=new t.math.Quaternion,t.math.quatFromEulerAngles(p,m,f,this.startRotation);var v=new t.math.Quaternion;t.math.quatMultiply(this.startRotation,c.localRotation,v),this.transform.setLocalRotation(v);var _=d.gameObject.addComponent("TrailRender");_.color=new t.math.Color(this.color.x.getValue(),this.color.y.getValue(),this.color.z.getValue(),this.alpha),_.setspeed(this.speed),_.setWidth(this.width),_.material=s},r.prototype.update=function(e){var r=t.math.Pool.new_vector3();t.math.vec3Clone(this.elements.curAttrData.pos,r),void 0!=this.elements.transform&&t.math.matrixTransformVector3(r,this.elements.transform.getWorldMatrix(),r),t.math.vec3Add(r,this.offsetTransalte,r),this.transform.setLocalPosition(r),t.math.Pool.delete_vector3(r);var a=t.math.Pool.new_quaternion();t.math.quatMultiply(this.startRotation,this.elements.curAttrData.localRotation,a),this.transform.setLocalRotation(a),t.math.Pool.delete_quaternion(a)},r}();e.TrailAction=l,__reflect(l.prototype,"egret3d.framework.TrailAction",["egret3d.framework.IEffectAction"]);var c=function(){function r(){}return r.prototype.init=function(t,r,a,i,o){if(this.startFrame=r,this.endFrame=a,this.params=i,this.elements=o,void 0!=this.params)switch(this.attriname=this.params.name,this.loopframe=this.params.loopframe,this.halfloopframe=this.loopframe/2,this.curTargetFrame=this.startFrame+this.halfloopframe,this.attriname){case"pos":case"scale":case"euler":case"color":this.startvalue=e.EffectUtil.parseEffectVec3(this.params.startvalue).getValue(),this.targetvalue=e.EffectUtil.parseEffectVec3(this.params.targetvalue).getValue();
break;case"uv":this.startvalue=e.EffectUtil.parseEffectUVSpeed(this.params.startvalue).getValue(),this.targetvalue=e.EffectUtil.parseEffectUVSpeed(this.params.targetvalue).getValue();break;case"alpha":this.startvalue=this.params.startvalue,this.targetvalue=this.params.targetvalue}},r.prototype.update=function(t){if(!(this.startFrame>t)){t>=this.curTargetFrame&&(this.swap(),this.curTargetFrame+=this.halfloopframe);var e=this.elements.curAttrData;switch(this.attriname){case"pos":e.pos=this.getLerpValue(t);break;case"scale":e.scale=this.getLerpValue(t);break;case"euler":e.euler=this.getLerpValue(t);break;case"color":e.color=this.getLerpValue(t);break;case"uv":e.uv=this.getLerpValue(t);break;case"alpha":e.alpha=this.getLerpValue(t)}}},r.prototype.swap=function(){var e;this.startvalue instanceof t.math.Vector3?(e=t.math.Pool.clone_vector3(this.startvalue),this.startvalue=t.math.Pool.clone_vector3(this.targetvalue),this.targetvalue=e):this.startvalue instanceof t.math.Vector2?(e=t.math.Pool.clone_vector2(this.startvalue),this.startvalue=t.math.Pool.clone_vector2(this.targetvalue),this.targetvalue=e):(e=this.startvalue,this.startvalue=this.targetvalue,this.targetvalue=e)},r.prototype.getLerpValue=function(e){var r,a=(e-this.startFrame)%this.halfloopframe;return this.startvalue instanceof t.math.Vector3?(r=new t.math.Vector3,t.math.vec3SLerp(this.startvalue,this.targetvalue,a/this.halfloopframe,r)):this.startvalue instanceof t.math.Vector2?(r=new t.math.Vector2,t.math.vec2SLerp(this.startvalue,this.targetvalue,a/this.halfloopframe,r)):r=t.math.numberLerp(this.startvalue,this.targetvalue,a/this.halfloopframe),r},r}();e.BreathAction=c,__reflect(c.prototype,"egret3d.framework.BreathAction",["egret3d.framework.IEffectAction"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){}return r.prototype.Parse=function(t){if(null==t)return null;var r=new e.EffectSystemData,a=JSON.parse(t);if(void 0!=a.life&&(r.life=a.life),void 0!=a.beloop&&(r.beLoop=a.beloop),void 0!=a.elements){r.elements=[];var i=a.elements;for(var o in i){var n=new e.EffectElementData;r.elements.push(n);var s=i[o];if(void 0!=s.name&&(n.name=s.name),void 0!=s.ref&&(n.ref=s.ref),void 0!=s.beloop&&(n.beloop=s.beloop),void 0!=s.type)switch(s.type){case"singlemesh":n.type=e.EffectElementTypeEnum.SingleMeshType;break;case"emission":n.type=e.EffectElementTypeEnum.EmissionType}switch(n.type){case e.EffectElementTypeEnum.SingleMeshType:this._parseSingleMeshTypeData(s,n);break;case e.EffectElementTypeEnum.EmissionType:this._parseEmissionTypeData(s,n)}}}return r},r.prototype._parseSingleMeshTypeData=function(t,r){if(void 0!=t.timeline){r.timelineFrame={},r.actionData=[];var a=t.timeline;for(var i in a){var o=a[i];if(void 0!=o.frame){var n=new e.EffectFrameData;if(n.frameIndex=o.frame,r.timelineFrame[n.frameIndex]=n,n.attrsData=new e.EffectAttrsData,void 0!=o.attrs){var s=o.attrs;for(var h in s){var l=this._parseToObjData(h,s[h]);"mat"==h?n.attrsData.mat=l:"pos"==h?n.attrsData.pos=l.getValue():"scale"==h?n.attrsData.scale=l.getValue():"euler"==h?n.attrsData.euler=l.getValue():"mesh"==h?n.attrsData.mesh=l:"color"==h?n.attrsData.color=l.getValue():"alpha"==h?n.attrsData.alpha=l.getValue():"tilling"==h?n.attrsData.tilling=l.getValue():"billboard"==h?n.attrsData.renderModel=l:"colorRate"==h&&(n.attrsData.colorRate=l)}}if(-1==n.frameIndex&&(r.initFrameData=n),void 0!=o.lerp){n.lerpDatas=[];for(var c in o.lerp){var u=new e.EffectLerpData;u.fromFrame=n.frameIndex,n.lerpDatas.push(u);var d=o.lerp[c];if(void 0!=d.type)switch(d.type){case"linear":u.type=e.EffectLerpTypeEnum.Linear}if(void 0!=d.to&&(u.toFrame=this._parseToValueData(d.to)),void 0!=d.attribute){u.attrsData=new e.EffectAttrsData;var p=d.attribute;for(var h in p){u.attrsList.push(h);var l=this._parseToObjData(h,p[h]);"pos"==h?u.attrsData.pos=l.getValue():"scale"==h?u.attrsData.scale=l.getValue():"euler"==h?u.attrsData.euler=l.getValue():"color"==h?u.attrsData.color=l.getValue():"alpha"==h?u.attrsData.alpha=l.getValue():console.error("未支持的插值属性："+h)}}}}if(void 0!=o.actions){var m=o.actions;for(var f in m){var v=new e.EffectActionData,_=m[f];v.actionType=_.action,v.startFrame=n.frameIndex,void 0!=_.end?v.endFrame=_.end:v.endFrame=-1,void 0!=_.param&&(v.params=_.param),r.actionData.push(v)}}}else console.error("必须要配一个关键帧的索引")}}},r.prototype._parseEmissionTypeData=function(r,a){if(void 0!=r.timeline&&void 0!=r.timeline.attrs){var i=r.timeline.attrs,o=new e.Emission;if(a.emissionData=o,void 0!=i.emissionType){switch(i.emissionType){case"burst":o.emissionType=e.ParticleEmissionType.burst;break;case"continue":o.emissionType=e.ParticleEmissionType["continue"]}if(void 0!=i.maxcount&&(o.maxEmissionCount=i.maxcount),void 0!=i.emissioncount&&(o.emissionCount=i.emissioncount),void 0!=i.time&&(o.time=i.time),void 0!=i.mesh&&(o.mesh=this._parseToObjData("mesh",i.mesh)),void 0!=i.mat&&(o.mat=this._parseToObjData("mat",i.mat)),void 0!=i.rootpos?o.rootpos=e.EffectUtil.parseVector3(i.rootpos):o.rootpos=new t.math.Vector3,void 0!=i.rootRotAngle?o.rootRotAngle=e.EffectUtil.parseVector3(i.rootRotAngle):o.rootRotAngle=new t.math.Vector3,i.rootscale?o.rootScale=e.EffectUtil.parseVector3(i.rootscale):o.rootScale=new t.math.Vector3(1,1,1),void 0!=i.moveSpeed&&(o.moveSpeed=this._parseToObjData("moveSpeed",i.moveSpeed)),void 0!=i.gravity&&(o.gravity=i.gravity),void 0!=i.euler&&(o.euler=this._parseToObjData("euler",i.euler)),void 0!=i.eulerSpeed&&(o.eulerSpeed=this._parseToObjData("eulerSpeed",i.eulerSpeed)),void 0!=i.eulerNodes){o.eulerNodes=[],void 0!=o.euler&&(o.eulerNodes.push(o.euler),o.euler.key=0);for(var n in i.eulerNodes){var s=e.EffectUtil.parseEffectVec3(i.eulerNodes[n]);o.eulerNodes.push(s)}}if(void 0!=i.scale&&(o.scale=this._parseToObjData("scale",i.scale)),void 0!=i.scaleSpeed&&(o.scaleSpeed=this._parseToObjData("scaleSpeed",i.scaleSpeed)),void 0!=i.scaleNodes){o.scaleNodes=[];var h=new e.ParticleNodeNumber;h.num.value=1,h.key=0,o.scaleNodes.push(h);for(var n in i.scaleNodes){var s=e.EffectUtil.parseEffectNumNode(i.scaleNodes[n]);o.scaleNodes.push(s)}}if(void 0!=i.simulationSpeed&&(o.simulationSpeed=this._parseToObjData("simulationSpeed",i.simulationSpeed)),void 0!=i.alpha&&(o.alpha=this._parseToObjData("alpha",i.alpha)),void 0!=i.alphaSpeed&&(o.alphaSpeed=this._parseToObjData("alphaSpeed",i.alphaSpeed)),void 0!=i.alphaNodes){o.alphaNodes=[],void 0!=o.alpha&&(o.alphaNodes.push(o.alpha),o.alpha.key=0);for(var n in i.alphaNodes){var s=new e.ParticleNodeNumber,l=i.alphaNodes[n];null!=l.key&&(s.key=l.key);var c=l.alpha;null!=c&&(c instanceof Array?(s.num.valueLimitMin=c[0],s.num.valueLimitMax=c[1]):s.num.value=c),o.alphaNodes.push(s)}}if(void 0!=i.color&&(o.color=this._parseToObjData("color",i.color)),void 0!=i.colorRate&&(o.colorRate=i.colorRate),void 0!=i.colorSpeed&&(o.colorSpeed=this._parseToObjData("colorSpeed",i.colorSpeed)),void 0!=i.colorNodes){o.colorNodes=[],void 0!=o.color&&(o.colorNodes.push(o.color),o.color.key=0);for(var n in i.colorNodes){var s=e.EffectUtil.parseEffectVec3(i.colorNodes[n]);o.colorNodes.push(s)}}if(void 0!=i.uv&&(o.uv=e.EffectUtil.parseEffectVec2(i.uv)),void 0!=i.uvtype)switch(i.uvtype){case"uvroll":o.uvType=e.UVTypeEnum.UVRoll,void 0!=i.uvroll&&(o.uvRoll=new e.UVRoll,o.uvRoll.uvSpeed=e.EffectUtil.parseEffectUVSpeed(i.uvroll));break;case"uvsprite":var u=i.uvsprite;o.uvType=e.UVTypeEnum.UVSprite,o.uvSprite=new e.UVSprite,void 0!=u.row&&(o.uvSprite.row=u.row),void 0!=u.colum&&(o.uvSprite.column=u.colum),void 0!=u.count&&(o.uvSprite.totalCount=u.count);break;default:o.uvType=e.UVTypeEnum.NONE}else o.uvType=e.UVTypeEnum.NONE;void 0!=i.billboard&&(o.renderModel=this._parseToObjData("billboard",i.billboard)),void 0!=i.life&&(o.life=e.EffectUtil.parseEffectValueData(i.life)),void 0!=i.startpos&&this._parseEmissionShape(i.startpos,a)}}},r.prototype._parseEmissionShape=function(e,r){var a=r.emissionData.particleStartData;switch(e.type){case"normal":a.shapeType=t.framework.ParticleSystemShape.NORMAL;break;case"box":a.shapeType=t.framework.ParticleSystemShape.BOX;break;case"sphere":a.shapeType=t.framework.ParticleSystemShape.SPHERE;break;case"hemisphere":a.shapeType=t.framework.ParticleSystemShape.HEMISPHERE;break;case"cone":a.shapeType=t.framework.ParticleSystemShape.CONE;break;case"circle":a.shapeType=t.framework.ParticleSystemShape.CIRCLE;break;case"edge":a.shapeType=t.framework.ParticleSystemShape.EDGE;break;default:a.shapeType=t.framework.ParticleSystemShape.NORMAL}if(void 0!=e.width&&(a.width=e.width),void 0!=e.height&&(a.height=e.height),void 0!=e.depth&&(a.depth=e.depth),void 0!=e.angle&&(a.angle=e.angle),void 0!=e.radius&&(a.radius=e.radius),void 0!=e.direction){var i=e.direction;a.direction.x=i.x,a.direction.y=i.y,a.direction.z=i.z}},r.prototype._parseToObjData=function(t,r){switch(t){case"pos":case"scale":case"euler":case"color":case"moveSpeed":case"eulerSpeed":case"scaleSpeed":case"colorSpeed":return e.EffectUtil.parseEffectVec3(r);case"":return e.EffectUtil.parseEffectVec2(r);case"alphaSpeed":case"alpha":case"simulationSpeed":return e.EffectUtil.parseEffectNum(r);case"tilling":return e.EffectUtil.parseEffectVec2(r);case"mat":var a=new e.EffectMatData;return void 0!=r&&(void 0!=r.shader?a.shader=e.AssetMap.find(r.shader):a.shader=e.DefaultShaders.Diffuse,void 0!=r.diffuseTexture&&(a.diffuseTexture=e.AssetMap.find(r.diffuseTexture)),void 0!=r.alphaCut&&(a.alphaCut=r.alphaCut)),a;case"emmision":var i=new e.EmissionData;return void 0!=r.type&&(i.type=r.type),void 0!=r.time&&(i.time=r.time),void 0!=r.count&&(i.count=r.count),i;case"billboard":var o=e.RenderModel.Mesh;return o="billboard"==r?e.RenderModel.BillBoard:"horizontal"==r?e.RenderModel.HorizontalBillBoard:"stretched"==r?e.RenderModel.StretchedBillBoard:"vertical"==r?e.RenderModel.VerticalBillBoard:"mesh"==r?e.RenderModel.Mesh:e.RenderModel.None;case"mesh":;return r.toString().indexOf(".mesh.bin")>=0?e.AssetMap.find(r):e.AssetMap.find(r);default:return r}},r.prototype._parseToParticleNode=function(t){t=e.StringUtil.replaceAll(t," ","");var r=t.match(e.RegexpUtil.vector3FloatOrRangeRegexp);if(void 0!=r){for(var a=new e.ParticleNode,i=1;i<r.length;i++)1==i?a.x=this._parseToValueData(r[i]):2==i?a.y=this._parseToValueData(r[i]):3==i&&(a.z=this._parseToValueData(r[i]));return a}return null},r.prototype._parseToValueData=function(t){var r=new e.ValueData,a=this._parseToNumberArray(t);return null!=a&&(a.length>1?(r.valueLimitMin=a[0],r.valueLimitMax=a[1],r.isRandom=!0):(r.value=a[0],r.isRandom=!1)),r},r.prototype._parseToNumberArray=function(t){t=e.StringUtil.trimAll(t),t=e.StringUtil.replaceAll(t,"\\[",""),t=e.StringUtil.replaceAll(t,"\\]","");for(var r=t.split(","),a=[],i=0;i<r.length;i++)a.push(parseInt(r[i]));return a},r}();e.EffectParser=r,__reflect(r.prototype,"egret3d.framework.EffectParser")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){}return r.lookatbyXAxis=function(e,r,a,i,o,n){var s=t.math.Pool.new_vector3();t.math.vec3Subtract(o,e,s),t.math.vec3Normalize(s,s);var h=t.math.Pool.new_vector3();t.math.vec3Cross(s,r,h),t.math.vec3Normalize(h,h);var l=t.math.vec3Dot(a,h);l=180*Math.acos(l)/Math.PI;var c=t.math.vec3Dot(i,h);c=180*Math.acos(c)/Math.PI,c>90&&(l=-l),t.math.quatFromAxisAngle(t.math.Pool.vector3_right,l,n),t.math.Pool.delete_vector3(s),t.math.Pool.delete_vector3(h)},r.RandomRange=function(t,e,r){return void 0===r&&(r=!1),r?Math.floor(Math.random()*(e-t+1)+t):Math.random()*(e-t)+t},r.vecMuliNum=function(e,r){var a=new t.math.Vector3(e.x*r,e.y*r,e.z*r);return a},r.parseVector3=function(e){var r=new t.math.Vector3;return r.x=e.x,r.y=e.y,r.z=e.z,r},r.parseEffectVec3=function(t){var r=new e.ParticleNode;for(var a in t)t[a]instanceof Array?(r[a].valueLimitMin=t[a][0],r[a].valueLimitMax=t[a][1],r[a].isRandom=!0):"key"==a?r[a]=t[a]:(r[a].value=t[a],r[a].isRandom=!1);return r},r.parseEffectVec2=function(t){var r=new e.ParticleNodeVec2;for(var a in t)t[a]instanceof Array?(r[a].valueLimitMin=t[a][0],r[a].valueLimitMax=t[a][1],r[a].isRandom=!0):"key"==a?r[a]=t[a]:(r[a].value=t[a],r[a].isRandom=!1);return r},r.parseEffectNum=function(t){var r=new e.ParticleNodeNumber;return t instanceof Array?(r.num.valueLimitMin=t[0],r.num.valueLimitMax=t[1],r.num.isRandom=!0):(r.num.value=t,r.num.isRandom=!1),r},r.parseEffectNumNode=function(t){var r=new e.ParticleNodeNumber;for(var a in t)t[a]instanceof Array?(r[a].valueLimitMin=t[a][0],r[a].valueLimitMax=t[a][1]):"key"==a?r[a]=t[a]:r.num.value=t[a];return r},r.parseEffectValueData=function(t){var r=new e.ValueData;return t instanceof Array?(r.valueLimitMin=t[0],r.valueLimitMax=t[1],r.isRandom=!0):(r.value=t,r.isRandom=!1),r},r.parseEffectUVSpeed=function(t){var r=new e.UVSpeedNode;for(var a in t)r[a].value=t[a];return r},r.lookat=function(e,r,a,i){void 0===i&&(i=t.math.Pool.vector3_up);var o=new t.math.Vector3;t.math.vec3Subtract(r,e,o),t.math.vec3Normalize(o,o);var n=new t.math.Vector3(o.x,0,o.z);t.math.vec3Normalize(n,n);var s=Math.acos(n.z)/Math.PI*180;n.x<0&&(s=-s),t.math.quatFromAxisAngle(i,s,a);var h=t.math.Pool.new_vector3();t.math.vec3Cross(i,o,h),t.math.vec3Normalize(h,h);var l=new t.math.Vector3(o.x,0,o.z),c=t.math.vec3Length(l),u=Math.acos(c)/Math.PI*180;o.y<0&&(u=-u);var d=t.math.Pool.new_quaternion();t.math.quatFromAxisAngle(h,u,d)},r.RotateVector3=function(e,r,a){t.math.vec3Normalize(e,e),t.math.vec3Normalize(r,r);var i=new t.math.Vector3(0,0,1),o=t.math.Pool.new_vector3();t.math.vec3Cross(i,r,o),t.math.vec3Normalize(o,o),0==o.x&&0==o.y&&0==o.z&&(o.x=1,o.y=0,o.z=0);var n=t.math.vec3Dot(i,r),s=180*Math.acos(n)/Math.PI;0>n&&(s=-s);var h=t.math.Pool.new_quaternion();t.math.quatFromAxisAngle(o,s,h),t.math.quatTransformVector(h,e,a),t.math.Pool.delete_vector3(o),t.math.Pool.delete_quaternion(h)},r.bindAxisBillboard=function(e,r){t.math.vec3Normalize(e,e);var a=t.math.Pool.vector3_up,i=t.math.Pool.new_vector3();t.math.vec3Cross(a,e,i),t.math.vec3Normalize(i,i),0==i.x&&0==i.y&&0==i.z&&(i.x=1,i.y=0,i.z=0);var o=t.math.vec3Dot(a,e),n=180*Math.acos(o)/Math.PI;0>o&&(n=-n),t.math.quatFromAxisAngle(i,n,r)},r.lookatVerticalBillboard=function(e,r,a,i){void 0===i&&(i=t.math.Pool.vector3_up);var o=new t.math.Vector3;t.math.vec3Subtract(r,e,o),t.math.vec3Normalize(o,o);var n=new t.math.Vector3(o.x,0,o.z);t.math.vec3Normalize(n,n);var s=Math.acos(n.z)/Math.PI*180;n.x<0&&(s=-s),t.math.quatFromAxisAngle(i,s,a)},r.quatLookatZ=function(e,r,a,i){void 0===i&&(i=t.math.Pool.vector3_forward);var o=new t.math.Vector3;t.math.vec3Subtract(r,e,o),t.math.vec3Normalize(o,o);var n=new t.math.Vector3(-o.x,o.y,0);t.math.vec3Normalize(n,n);var s=Math.acos(n.y)/Math.PI*180;n.x<0&&(s=-s),t.math.quatFromAxisAngle(i,s,a)},r.quatLookatX=function(e,r,a,i){void 0===i&&(i=t.math.Pool.vector3_right);var o=t.math.Pool.new_vector3();t.math.vec3Subtract(r,e,o),t.math.vec3Normalize(o,o);var n=new t.math.Vector3(0,-o.y,o.z);t.math.vec3Normalize(n,n);var s=Math.acos(n.z)/Math.PI*180;n.y<0&&(s=-s),t.math.quatFromAxisAngle(i,s,a)},r}();e.EffectUtil=r,__reflect(r.prototype,"egret3d.framework.EffectUtil")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(r,a,i){this.particles=[],this.vertexSize=0,this.formate=0,this.curVerCount=0,this.curIndexCount=0,this.webgl=i.webgl,this.gameObject=a.gameObject,this.effectSys=a,this.emissionElement=i,this.data=r,this.formate=a.particleVF,this.vertexSize=t.render.MeshData.calcByteSize(this.formate)/4,this.initMesh(),this.mat=new e.Material,null==this.data.mat.shader?this.mat.setShader(e.AssetMap.find("diffuse.shader.json")):this.mat.setShader(this.data.mat.shader),void 0!=this.data.mat.alphaCut&&this.mat.setFloat("_AlphaCut",this.data.mat.alphaCut),null!=this.data.mat.diffuseTexture&&this.mat.setTexture("_MainTex",this.data.mat.diffuseTexture)}return r.prototype.initMesh=function(){this.mesh=new e.Mesh,this.mesh.data=new t.render.MeshData,this.mesh.glMesh=new t.render.GlMesh,this.mesh.submesh=[];var r=new e.SubMeshInfo;r.matIndex=0,r.useVertexIndex=0,r.start=0,r.size=0,r.line=!1,this.mesh.submesh.push(r),this.dataForVbo=new Float32Array(128),this.dataForEbo=new Uint16Array(128),this.mesh.glMesh.initBuffer(this.webgl,this.effectSys.particleVF,128,t.render.MeshTypeEnum.Dynamic),this.mesh.glMesh.addIndex(this.webgl,this.dataForEbo.length)},r.prototype.addParticle=function(){this.refreshBuffer();var t=new e.Particle(this);t.uploadData(this.dataForVbo);for(var r=0;r<t.dataForEbo.length;r++)this.dataForEbo[this.curIndexCount+r]=t.dataForEbo[r]+this.curVerCount;this.particles.push(t),this.curVerCount+=this.emissionElement.perVertexCount,this.curIndexCount+=this.emissionElement.perIndexxCount,this.mesh.glMesh.uploadIndexSubData(this.webgl,0,this.dataForEbo),this.mesh.submesh[0].size=this.curIndexCount},r.prototype.refreshBuffer=function(){var t=this.curVerCount+this.emissionElement.perVertexCount,e=this.curIndexCount+this.emissionElement.perIndexxCount;if(t*this.vertexSize>this.dataForVbo.length){var r=this.dataForVbo.length;this.mesh.glMesh.resetVboSize(this.webgl,2*r);var a=new Float32Array(2*r);a.set(this.dataForVbo,0),this.dataForVbo=a}if(e>this.dataForEbo.length){var i=this.dataForEbo.length;this.mesh.glMesh.resetEboSize(this.webgl,0,2*i);var o=new Uint16Array(2*i);o.set(this.dataForEbo,0),this.dataForEbo=o}},r.prototype.update=function(t){for(var e in this.particles)this.particles[e].update(t),this.particles[e].uploadData(this.dataForVbo)},r.prototype.render=function(t,e){var r=this.mesh;r.glMesh.uploadVertexSubData(t.webgl,this.dataForVbo),this.mat.draw(t,r,r.submesh[0],"base")},r.prototype.dispose=function(){this.dataForVbo=null,this.dataForEbo=null,this.mesh.dispose(),this.mat.dispose();for(var t in this.particles)this.particles[t].dispose()},r}();e.EmissionBatcher=r,__reflect(r.prototype,"egret3d.framework.EmissionBatcher")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(r){this.renderModel=e.RenderModel.Mesh,this.localMatrix=new t.math.Matrix,this.startScale=new t.math.Vector3,this.startRotation=new t.math.Quaternion,this.rotationByShape=new t.math.Quaternion,this.rotationByEuler=new t.math.Quaternion,this.localRotation=new t.math.Quaternion,this.tilling=new t.math.Vector2(1,1),this.speedDir=new t.math.Vector3(0,0,0),this.actived=!0,this.matToBatcher=new t.math.Matrix,this.matToworld=new t.math.Matrix,this.tex_ST=new t.math.Vector4(1,1,0,0),this.gameObject=r.effectSys.gameObject,this.emisson=r.emissionElement,this.batcher=r,this.format=r.formate,this.data=r.data.clone(),this.vertexSize=t.render.MeshData.calcByteSize(this.format)/4,this.vertexStartIndex=r.curVerCount,this.vertexCount=this.emisson.perVertexCount,this.dataForVbo=new Float32Array(this.vertexCount*this.vertexSize),this.dataForEbo=this.data.mesh.data.genIndexDataArray(),this.dataForVbo.set(this.data.mesh.data.genVertexDataArray(this.format),0),this.sourceVbo=this.data.getVboData(this.format),this.initByData()}return r.prototype.uploadData=function(t){t.set(this.dataForVbo,this.vertexStartIndex*this.vertexSize)},r.prototype.initByData=function(){this.totalLife=this.data.life.getValueRandom(),this.renderModel=this.data.renderModel,this.curLife=0,this.startFrameId=this.batcher.effectSys.frameId;var r=this.data.particleStartData.randomDirection;this.speedDir=t.math.Pool.clone_vector3(r);var a=this.data.particleStartData.position;if(this.localTranslate=t.math.Pool.clone_vector3(a),this.simulationSpeed=void 0!=this.data.simulationSpeed?this.data.simulationSpeed.getValue():0,void 0==this.data.euler?this.euler=new t.math.Vector3(0,0,0):this.euler=this.data.euler.getValueRandom(),void 0==this.data.scale?this.localScale=new t.math.Vector3(1,1,1):this.localScale=this.data.scale.getValueRandom(),void 0==this.data.color?this.color=new t.math.Vector3(0,0,0):this.color=this.data.color.getValueRandom(),void 0==this.data.alpha?this.alpha=1:this.alpha=this.data.alpha.getValueRandom(),void 0==this.data.uv?this.uv=new t.math.Vector2:this.uv=this.data.uv.getValueRandom(),void 0!=this.data.moveSpeed?this.movespeed=this.data.moveSpeed.getValue():this.movespeed=new t.math.Vector3,void 0==this.data.colorRate?this.colorRate=this.data.colorRate:this.colorRate=1,t.math.vec3Clone(this.localScale,this.startScale),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.rotationByEuler),(this.renderModel==e.RenderModel.None||this.renderModel==e.RenderModel.StretchedBillBoard)&&this.data.particleStartData.shapeType!=e.ParticleSystemShape.NORMAL){var i=t.math.Pool.vector3_zero;t.math.quatLookat(i,r,this.rotationByShape);var o=t.math.Pool.new_quaternion();t.math.quatFromEulerAngles(90,0,90,o),t.math.quatMultiply(this.rotationByShape,o,this.rotationByShape),t.math.quatClone(this.rotationByShape,this.localRotation),t.math.Pool.delete_quaternion(o)}},r.prototype.update=function(e){if(this.actived){if(this.curLife+=e,this.curLife>=this.totalLife)return t.math.matrixZero(this.matToBatcher),this._updateVBO(),this.emisson.deadParticles.push(this),this.curLife=0,void(this.actived=!1);this._updatePos(e),this._updateScale(e),this._updateEuler(e),this._updateRotation(e),this._updateLocalMatrix(e),this._updateColor(e),this._updateAlpha(e),this._updateUV(e),this._updateVBO()}},r.prototype._updateLocalMatrix=function(e){t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotation,this.localMatrix),t.math.matrixMultiply(this.emisson.matToBatcher,this.localMatrix,this.matToBatcher)},r.prototype._updateRotation=function(t){this._updateElementRotation()},r.prototype._updateElementRotation=function(){var r=this.gameObject.getScene();if(r){var a=r.mainCamera,i=a.gameObject.transform,o=t.math.Pool.new_vector3(),n=t.math.Pool.new_quaternion(),s=t.math.Pool.new_vector3(),h=t.math.Pool.new_quaternion();if(t.math.vec3Clone(this.localTranslate,o),t.math.matrixTransformVector3(o,this.emisson.getmatrixToWorld(),s),this.renderModel!=e.RenderModel.Mesh){if(this.renderModel==e.RenderModel.BillBoard)t.math.quatLookat(s,i.getPosition(),n);else if(this.renderModel==e.RenderModel.HorizontalBillBoard)n.x=-.5,n.y=.5,n.z=.5,n.w=.5;else if(this.renderModel==e.RenderModel.VerticalBillBoard){var l=t.math.Pool.new_vector3();t.math.vec3Clone(i.getPosition(),l),l.y=s.y,t.math.quatLookat(s,l,n),t.math.Pool.delete_vector3(l)}else if(this.renderModel==e.RenderModel.StretchedBillBoard){t.math.matrixMakeTransformRTS(this.localTranslate,this.localScale,this.localRotation,this.localMatrix),t.math.matrixMultiply(this.emisson.getmatrixToWorld(),this.localMatrix,this.matToworld);var c=t.math.Pool.new_vector3(),u=t.math.Pool.new_vector3(),d=t.math.Pool.new_vector3();return t.math.matrixTransformNormal(t.math.Pool.vector3_right,this.matToworld,c),t.math.vec3Normalize(c,c),t.math.matrixTransformNormal(t.math.Pool.vector3_up,this.matToworld,u),t.math.vec3Normalize(u,u),t.math.matrixTransformNormal(t.math.Pool.vector3_forward,this.matToworld,d),t.math.vec3Normalize(d,d),e.EffectUtil.lookatbyXAxis(s,c,u,d,i.getPosition(),n),t.math.quatMultiply(this.localRotation,n,this.localRotation),t.math.Pool.delete_quaternion(n),t.math.Pool.delete_vector3(o),t.math.Pool.delete_quaternion(h),t.math.Pool.delete_vector3(c),t.math.Pool.delete_vector3(u),void t.math.Pool.delete_vector3(d)}t.math.quatClone(this.emisson.getWorldRotation(),h),t.math.quatInverse(h,h),t.math.quatMultiply(h,n,this.localRotation),t.math.quatMultiply(this.localRotation,this.rotationByEuler,this.localRotation)}else t.math.quatClone(this.rotationByEuler,this.localRotation);t.math.Pool.delete_vector3(o),t.math.Pool.delete_quaternion(n),t.math.Pool.delete_vector3(s),t.math.Pool.delete_quaternion(h)}},r.prototype._updatePos=function(r){void 0!=this.data.moveSpeed&&(this.localTranslate.x+=this.movespeed.x*r,this.localTranslate.y+=this.movespeed.y*r,this.localTranslate.z+=this.movespeed.z*r);var a=e.EffectUtil.vecMuliNum(this.speedDir,this.simulationSpeed);t.math.vec3Add(this.localTranslate,a,this.localTranslate)},r.prototype._updateEuler=function(e){return void 0!=this.data.eulerNodes&&void 0!=this.data.eulerSpeed?void console.error("eulerNodes & eulerSpeed exist at the same time！"):void(void 0!=this.data.eulerNodes?(this._updateNode(this.data.eulerNodes,this.totalLife,this.euler),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.rotationByEuler)):void 0!=this.data.eulerSpeed&&(void 0!=this.data.eulerSpeed.x&&(this.euler.x+=this.data.eulerSpeed.x.getValue()*e),void 0!=this.data.eulerSpeed.y&&(this.euler.y+=this.data.eulerSpeed.y.getValue()*e),void 0!=this.data.eulerSpeed.z&&(this.euler.z+=this.data.eulerSpeed.z.getValue()*e),t.math.quatFromEulerAngles(this.euler.x,this.euler.y,this.euler.z,this.rotationByEuler)))},r.prototype._updateScale=function(t){return void 0!=this.data.scaleNodes&&void 0!=this.data.scaleSpeed?void console.error("eulerNodes & eulerSpeed exist at the same time！"):void(void 0!=this.data.scaleNodes?this._updateNode(this.data.scaleNodes,this.totalLife,this.localScale,a.scale):void 0!=this.data.scaleSpeed&&(void 0!=this.data.scaleSpeed.x&&(this.localScale.x+=this.data.scaleSpeed.x.getValue()*t),void 0!=this.data.scaleSpeed.y&&(this.localScale.y+=this.data.scaleSpeed.y.getValue()*t),void 0!=this.data.scaleSpeed.z&&(this.localScale.z+=this.data.scaleSpeed.z.getValue()*t)))},r.prototype._updateColor=function(t){return void 0!=this.data.colorNodes&&void 0!=this.data.colorSpeed?void console.error("colorNodes & colorSpeed exist at the same time！"):void(void 0!=this.data.colorNodes?this._updateNode(this.data.colorNodes,this.totalLife,this.color):void 0!=this.data.colorSpeed&&(void 0!=this.data.colorSpeed.x&&(this.color.x+=this.data.colorSpeed.x.getValue()*t),void 0!=this.data.colorSpeed.y&&(this.color.y+=this.data.colorSpeed.y.getValue()*t),void 0!=this.data.colorSpeed.z&&(this.color.z+=this.data.colorSpeed.z.getValue()*t)))},r.prototype._updateNode=function(r,i,o,n){void 0===n&&(n=a.none);var s=0,h=0;if(void 0!=r){for(var l=0;l<r.length;l++)if(l+1<r.length){if(r[l].key*i<=this.curLife&&r[l+1].key*i>=this.curLife){this.tempStartNode=r[l],this.tempEndNode=r[l+1],s++,h=(this.tempEndNode.key-this.tempStartNode.key)*i;break}}else this.curLife<r[l].key*i&&(this.tempStartNode=r[l-1],this.tempEndNode=r[l],h=(this.tempEndNode.key-this.tempStartNode.key)*i);if(this.tempStartNode instanceof e.ParticleNode)h>0&&t.math.vec3SLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/h,o);else if(this.tempStartNode instanceof e.ParticleNodeNumber){if(h>0)if(n==a.alpha)this.alpha=t.math.numberLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/h);else if(n=a.scale){var c=t.math.numberLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/h);t.math.vec3ScaleByNum(this.startScale,c,o)}}else this.tempStartNode instanceof e.UVSpeedNode&&h>0&&t.math.vec2SLerp(this.tempStartNode.getValue(),this.tempEndNode.getValue(),(this.curLife-this.tempStartNode.key*i)/h,o)}},r.prototype._updateAlpha=function(t){return void 0!=this.data.alphaNodes&&void 0!=this.data.alphaSpeed?void console.error("alphaNodes & alphaSpeed exist at the same time！"):void(void 0!=this.data.alphaNodes?this._updateNode(this.data.alphaNodes,this.totalLife,this.alpha,a.alpha):void 0!=this.data.alphaSpeed&&(this.alpha+=this.data.alphaSpeed.getValue()*t))},r.prototype._updateUV=function(r){if(void 0==this.uv&&(this.uv=new t.math.Vector2),this.data.uvType==e.UVTypeEnum.NONE)this.uv=this.data.uv.getValue();else if(this.data.uvType==e.UVTypeEnum.UVRoll){if(void 0!=this.data.uvRoll){if(void 0!=this.data.uvRoll.uvSpeedNodes&&void 0!=this.data.uvRoll.uvSpeed)return void console.error("uvSpeedNodes & uvSpeed exist at the same time！");void 0!=this.data.uvRoll.uvSpeedNodes?this._updateNode(this.data.uvRoll.uvSpeedNodes,this.totalLife,this.uv):void 0!=this.data.uvRoll.uvSpeed&&(void 0!=this.data.uvRoll.uvSpeed.u&&(this.tex_ST.z+=this.data.uvRoll.uvSpeed.u.getValue()*r),void 0!=this.data.uvRoll.uvSpeed.v&&(this.tex_ST.w+=this.data.uvRoll.uvSpeed.v.getValue()*r))}}else if(this.data.uvType==e.UVTypeEnum.UVSprite&&void 0!=this.data.uvSprite){var a=Math.floor(this.curLife/this.totalLife*this.data.uvSprite.totalCount);t.math.spriteAnimation(this.data.uvSprite.row,this.data.uvSprite.column,a,this.tex_ST)}},r.prototype._updateVBO=function(){for(var e=this.vertexSize,r=0;r<this.vertexCount;r++){var a=t.math.Pool.new_vector3();a.x=this.sourceVbo[r*e+0],a.y=this.sourceVbo[r*e+1],a.z=this.sourceVbo[r*e+2],t.math.matrixTransformVector3(a,this.matToBatcher,a),this.dataForVbo[r*e+0]=a.x,this.dataForVbo[r*e+1]=a.y,this.dataForVbo[r*e+2]=a.z,t.math.Pool.delete_vector3(a);var i=t.math.floatClamp(this.sourceVbo[r*e+3],0,1),o=t.math.floatClamp(this.sourceVbo[r*e+4],0,1),n=t.math.floatClamp(this.sourceVbo[r*e+5],0,1),s=t.math.floatClamp(this.sourceVbo[r*e+6],0,1);void 0!=this.color&&(i=this.color.x,o=this.color.y,n=this.color.z),void 0!=this.alpha&&(s=this.alpha),void 0!=this.colorRate&&(i*=this.colorRate,o*=this.colorRate,n*=this.colorRate,s*=this.colorRate),i=t.math.floatClamp(i,0,3),o=t.math.floatClamp(i,0,3),n=t.math.floatClamp(i,0,3),s=t.math.floatClamp(i,0,3),this.dataForVbo[r*this.vertexSize+3]=i,this.dataForVbo[r*this.vertexSize+4]=o,this.dataForVbo[r*this.vertexSize+5]=n,this.dataForVbo[r*this.vertexSize+6]=s,this.dataForVbo[r*e+7]=this.sourceVbo[r*e+7]*this.tex_ST.x+this.tex_ST.z,this.dataForVbo[r*e+8]=this.sourceVbo[r*e+8]*this.tex_ST.y+this.tex_ST.w}},r.prototype.dispose=function(){this.dataForVbo=null,this.dataForEbo=null,this.startRotation=null,this.localRotation=null,this.rotationByEuler=null,this.rotationByShape=null,this.tilling=null,this.localMatrix=null,this.localTranslate=null,this.euler=null,this.localScale=null,this.colorRate=1,this.color=null,this.uv=null},r}();e.Particle=r,__reflect(r.prototype,"egret3d.framework.Particle");var a;!function(t){t[t.none=0]="none",t[t.alpha=1]="alpha",t[t.scale=2]="scale"}(a=e.nodeType||(e.nodeType={}))}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function t(t){this.emissionElements=[],this.loopFrame=Number.MAX_VALUE,this.effectSys=t,this.vf=t.particleVF}return t.prototype.addEmission=function(t){var e=new a(t,this.effectSys);this.emissionElements.push(e)},t.prototype.update=function(t){for(var e in this.emissionElements)this.emissionElements[e].update(t)},t.prototype.render=function(t,e){for(var r in this.emissionElements)this.emissionElements[r].render(t,e)},t.prototype.dispose=function(){for(var t in this.emissionElements)this.emissionElements[t].dispose();this.emissionElements.length=0},t}();e.Particles=r,__reflect(r.prototype,"egret3d.framework.Particles");var a=function(){function r(r,a){switch(this.beloop=!1,this.active=!0,this.isover=!1,this.maxVertexCount=2048,this.localtranslate=new t.math.Vector3,this.localScale=new t.math.Vector3(1,1,1),this.localrotate=new t.math.Quaternion,this.eluerAngle=new t.math.Quaternion,this.worldRotation=new t.math.Quaternion,this.matToBatcher=new t.math.Matrix,this.matToWorld=new t.math.Matrix,this.webgl=t.render.Webglkit.webgl,this.effectSys=a,this.vf=a.particleVF,this.gameObject=a.gameObject,this.emission=r.emissionData,this.emission.emissionType){case e.ParticleEmissionType.burst:break;case e.ParticleEmissionType["continue"]:this._continueSpaceTime=this.emission.time/this.emission.emissionCount}this.curTime=0,this.numcount=0,this.beloop=r.beloop,this.emissionBatchers=[],this.deadParticles=[],this.addBatcher(),this.perVertexCount=this.emission.mesh.data.pos.length,this.perIndexxCount=this.emission.mesh.data.trisindex.length,t.math.vec3Clone(this.emission.rootpos,this.localtranslate),t.math.vec3Clone(this.emission.rootRotAngle,this.eluerAngle),t.math.vec3Clone(this.emission.rootScale,this.localScale),t.math.quatFromEulerAngles(this.eluerAngle.x,this.eluerAngle.y,this.eluerAngle.z,this.localrotate),t.math.matrixMakeTransformRTS(this.localtranslate,this.localScale,this.localrotate,this.matToBatcher)
}return r.prototype.getWorldRotation=function(){var e=this.gameObject.transform.getRotation();return t.math.quatMultiply(e,this.localrotate,this.worldRotation),this.worldRotation},r.prototype.getmatrixToWorld=function(){var e=this.gameObject.transform.getWorldMatrix();return t.math.matrixMultiply(e,this.matToBatcher,this.matToWorld),this.matToWorld},r.prototype.update=function(t){this.curTime+=t,this.updateEmission(t),this.updateBatcher(t)},r.prototype.updateBatcher=function(t){for(var e in this.emissionBatchers)this.emissionBatchers[e].update(t)},r.prototype.updateEmission=function(t){this.isover||(this.emission.emissionType==e.ParticleEmissionType["continue"]?(0==this.numcount&&(this.addParticle(),this.numcount++),this.curTime>this._continueSpaceTime&&(this.numcount<this.emission.emissionCount?(this.addParticle(),this.curTime=0,this.numcount++):this.beloop?(this.curTime=0,this.numcount=0,this.isover=!1):this.isover=!0)):this.emission.emissionType==e.ParticleEmissionType.burst&&this.curTime>this.emission.time&&(this.addParticle(this.emission.emissionCount),this.beloop?(this.curTime=0,this.isover=!1):this.isover=!0))},r.prototype.addParticle=function(t){void 0===t&&(t=1);for(var e=0;t>e;e++)if(this.deadParticles.length>0){var r=this.deadParticles.pop();r.initByData(),r.actived=!0}else{var a=this.curbatcher.curVerCount+this.perVertexCount;a<=this.maxVertexCount?this.curbatcher.addParticle():(this.addBatcher(),this.curbatcher.addParticle())}},r.prototype.addBatcher=function(){var t=new e.EmissionBatcher(this.emission,this.effectSys,this);this.emissionBatchers.push(t),this.curbatcher=t},r.prototype.render=function(t,e){for(var r in this.emissionBatchers)this.emissionBatchers[r].render(t,e)},r.prototype.dispose=function(){for(var t in this.emissionBatchers)this.emissionBatchers[t].dispose();this.emissionBatchers.length=0},r.prototype.isOver=function(){return this.isover},r}();e.EmissionElement=a,__reflect(a.prototype,"egret3d.framework.EmissionElement")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.layer=0,this.hideFlags=e.HideFlags.None,this.components=[],this.componentsInit=[],this.rendererDirty=!1,this._visible=!0}return r.prototype.getScene=function(){return this.transform.scene},Object.defineProperty(r.prototype,"visibleInScene",{get:function(){for(var t=this;t.visible&&t.transform.parent;)t=t.transform.parent.gameObject;return t.visible},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visible",{get:function(){return this._visible},set:function(t){t!=this._visible&&(this._visible=t)},enumerable:!0,configurable:!0}),r.prototype.getName=function(){return this.transform.name},r.prototype.init=function(){if(this.componentsInit.length>0){for(var t=0;t<this.componentsInit.length;t++)this.componentsInit[t].comp.start(),this.componentsInit[t].init=!0;this.componentsInit.length=0}},r.prototype.update=function(t){if(0!=this.components.length)for(var e=0;e<this.components.length;e++)this.components[e].comp.update(t)},r.prototype.addComponentDirect=function(r){if(this.transform.markHaveComponent(),null!=r.gameObject)throw new Error("try to add a component which has added to another game object!");r.gameObject=this;var a=!0;if("1"==t.reflect.getClassTag(r.__proto__,"renderer")||"1"==t.reflect.getClassTag(r.__proto__,"effectbatcher"))if(null==this.renderer){this.renderer=r;var i=this.getScene();i&&i.renderList.addRenderer(this.renderer)}else console.warn("cannot add more than one render component"),a=!1;if("1"==t.reflect.getClassTag(r.__proto__,"camera")&&(null==this.camera?this.camera=r:(console.warn("cannot add more than one camera component"),a=!1)),"1"==t.reflect.getClassTag(r.__proto__,"light")&&(null==this.light?this.light=r:(console.warn("cannot add more than one light component"),a=!1)),("1"==t.reflect.getClassTag(r.__proto__,"boxcollider")||"1"==t.reflect.getClassTag(r.__proto__,"spherecollider")||"1"==t.reflect.getClassTag(r.__proto__,"meshcollider")||"1"==t.reflect.getClassTag(r.__proto__,"canvasRenderer"))&&(null==this.collider?this.collider=r:(console.warn("cannot add more than one collider component"),a=!1)),a){var o=new e.NodeComponent(r,!1);this.components.push(o),this.componentsInit.push(o),"1"==t.reflect.getClassTag(r.__proto__,"camera"),"1"==t.reflect.getClassTag(r.__proto__,"canvasRenderer")}return r},r.prototype.getComponent=function(e){for(var r=0;r<this.components.length;r++){var a=t.reflect.getClassName(this.components[r].comp.__proto__);if(a==e)return this.components[r].comp}return null},r.prototype.getComponents=function(){for(var t=[],e=0;e<this.components.length;e++)t.push(this.components[e].comp);return t},r.prototype.getComponentsInChildren=function(t){var e=[];return this._getComponentsInChildren(t,this,e),e},r.prototype._getComponentsInChildren=function(e,r,a){for(var i=0;i<r.components.length;i++){var o=t.reflect.getClassName(r.components[i].comp.__proto__);o==e&&a.push(r.components[i].comp)}if(void 0!=r.transform.children)for(var i=0;i<r.transform.children.length;i++){var n=r.transform.children[i].gameObject;this._getComponentsInChildren(e,n,a)}},r.prototype.getComponentInParent=function(t){for(var e=null,r=this.transform.parent;null==e&&null!=r;)e=r.gameObject.getComponent(t),r=r.parent;return e},r.prototype.addComponent=function(e){for(var r in this.components){var a=this.components[r].comp.constructor.name;if(a==e)throw new Error("try to add a "+e+" component but already has one!")}var i=t.reflect.getPrototype(e),o=t.reflect.createInstance(i,{nodecomp:"1"});return this.addComponentDirect(o)},r.prototype.removeComponent=function(t){for(var e=0;e<this.components.length;e++)if(this.components[e].comp==t){this.components[e].init&&this.components[e].comp.remove(),this._removeComponentReference(this.components[e].comp),this.components.splice(e,1);break}},r.prototype._removeComponentReference=function(e){if("1"==t.reflect.getClassTag(e.__proto__,"renderer")){var r=this.getScene();r&&this.renderer&&r.renderList.removeRenderer(this.renderer),this.renderer=null}"1"==t.reflect.getClassTag(e.__proto__,"camera")&&(this.camera=null),"1"==t.reflect.getClassTag(e.__proto__,"light")&&(this.light=null),("1"==t.reflect.getClassTag(e.__proto__,"boxcollider")||"1"==t.reflect.getClassTag(e.__proto__,"meshcollider")||"1"==t.reflect.getClassTag(e.__proto__,"canvasRenderer"))&&(this.collider=null)},r.prototype.removeComponentByTypeName=function(e){for(var r=0;r<this.components.length;r++)if(t.reflect.getClassName(this.components[r].comp)==e){this.components[r].init&&this.components[r].comp.remove(),this._removeComponentReference(this.components[r].comp),this.components.splice(r,1);break}},r.prototype.removeAllComponents=function(){for(var t=0;t<this.components.length;t++)this.components[t].comp.remove(),this._removeComponentReference(this.components[t].comp);this.components.length=0},r.prototype.dispose=function(){this.removeAllComponents()},__decorate([t.reflect.Field("number"),t.reflect.UIStyle("enum"),__metadata("design:type",Number)],r.prototype,"layer",void 0),__decorate([t.reflect.Field("NodeComponent[]"),__metadata("design:type",Array)],r.prototype,"components",void 0),r=__decorate([t.reflect.SerializeType],r)}();e.GameObject=r,__reflect(r.prototype,"egret3d.framework.GameObject")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e;!function(t){t[t.None=0]="None",t[t.HideInHierarchy=1]="HideInHierarchy",t[t.HideInInspector=2]="HideInInspector",t[t.DontSaveInEditor=4]="DontSaveInEditor",t[t.NotEditable=8]="NotEditable",t[t.DontSaveInBuild=16]="DontSaveInBuild",t[t.DontUnloadUnusedAsset=32]="DontUnloadUnusedAsset",t[t.DontSave=52]="DontSave",t[t.HideAndDontSave=61]="HideAndDontSave"}(e=t.HideFlags||(t.HideFlags={}))}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e;!function(t){t[t.Common=0]="Common",t[t.Transparent=1]="Transparent",t[t.UI=2]="UI",t[t.Overlay=3]="Overlay"}(e=t.RenderLayerEnum||(t.RenderLayerEnum={}))}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(t,e){void 0===e&&(e=!1),this.init=e,this.comp=t}return __decorate([t.reflect.Field("INodeComponent"),__metadata("design:type",Object)],e.prototype,"comp",void 0),e=__decorate([t.reflect.SerializeType,__metadata("design:paramtypes",[Object,Boolean])],e)}();e.NodeComponent=r,__reflect(r.prototype,"egret3d.framework.NodeComponent")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(e){this.version=0,this.viewPortPixel=new t.math.Rect(0,0,0,0),this.eyePos=new t.math.Vector4,this.matrixView=new t.math.Matrix,this.matrixProject=new t.math.Matrix,this.matrixModel=new t.math.Matrix,this.matrixModelViewProject=new t.math.Matrix,this.matrixModelView=new t.math.Matrix,this.matrixViewProject=new t.math.Matrix,this.floatTimer=0,this.intLightCount=0,this.vec4LightPos=new Float32Array(32),this.vec4LightDir=new Float32Array(32),this.floatLightSpotAngleCos=new Float32Array(8),this.lightmap=null,this.lightmapUV=1,this.lightmapOffset=new t.math.Vector4(1,1,0,0),this.webgl=e}return r.prototype.updateLightmap=function(t,e,r){this.lightmap=t,this.lightmapUV=e,this.lightmapOffset=r,this.version++},r.prototype.updateCamera=function(e,r){r.calcViewPortPixel(e,this.viewPortPixel);var a=this.viewPortPixel.w/this.viewPortPixel.h;r.calcViewMatrix(this.matrixView),r.calcProjectMatrix(a,this.matrixProject),t.math.matrixMultiply(this.matrixProject,this.matrixView,this.matrixViewProject),this.floatTimer=e.getTotalTime();var i=r.gameObject.transform.getPosition();this.eyePos.x=i.x,this.eyePos.y=i.y,this.eyePos.z=i.z,this.version++},r.prototype.updateLights=function(r){this.intLightCount=r.length;for(var a=t.math.Pool.new_vector3(),i=0;i<r.length;i++){var o=r[i].gameObject.transform.getPosition();this.vec4LightPos[4*i+0]=o.x,this.vec4LightPos[4*i+1]=o.y,this.vec4LightPos[4*i+2]=o.z,this.vec4LightPos[4*i+3]=r[i].type==e.LightTypeEnum.Direction?0:1,r[i].gameObject.transform.getForward(a),this.vec4LightDir[4*i+0]=a.x,this.vec4LightDir[4*i+1]=a.y,this.vec4LightDir[4*i+2]=a.z,this.vec4LightDir[4*i+3]=r[i].type==e.LightTypeEnum.Point?0:1,this.floatLightSpotAngleCos[i]=r[i].spotAngelCos}t.math.Pool.delete_vector3(a),this.version++},r.prototype.updateOverlay=function(){t.math.matrixMakeIdentity(this.matrixModelViewProject),this.version++},r.prototype.updateModel=function(e){t.math.matrixClone(e.getWorldMatrix(),this.matrixModel),t.math.matrixMultiply(this.matrixView,this.matrixModel,this.matrixModelView),t.math.matrixMultiply(this.matrixViewProject,this.matrixModel,this.matrixModelViewProject),this.version++},r.prototype.updateModeTrail=function(){t.math.matrixClone(this.matrixView,this.matrixModelView),t.math.matrixClone(this.matrixViewProject,this.matrixModelViewProject),this.version++},r.prototype.updateBones=function(t){this.boneData=t,this.version++},r}();e.RenderContext=r,__reflect(r.prototype,"egret3d.framework.RenderContext")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(t){void 0===t&&(t=!1),this.needSort=!1,this.list=[],this.needSort=t}return t}();t.RenderLayer=e,__reflect(e.prototype,"egret3d.framework.RenderLayer");var r=function(){function r(){this.renderLayers=[];var t=new e,r=new e(!0),a=new e(!0),i=new e(!0);this.renderLayers.push(t),this.renderLayers.push(r),this.renderLayers.push(a),this.renderLayers.push(i)}return r.prototype.clear=function(){for(var t=0;t<this.renderLayers.length;t++)this.renderLayers[t].list.length=0},r.prototype.addRenderer=function(e){var r;e.layer==t.RenderLayerEnum.Common?r=this.renderLayers[0].list:e.layer==t.RenderLayerEnum.Transparent?r=this.renderLayers[1].list:e.layer==t.RenderLayerEnum.UI?r=this.renderLayers[2].list:e.layer==t.RenderLayerEnum.Overlay&&(r=this.renderLayers[3].list),r.push(e)},r.prototype.removeRenderer=function(e){var r;e.layer==t.RenderLayerEnum.Common?r=this.renderLayers[0].list:e.layer==t.RenderLayerEnum.Transparent?r=this.renderLayers[1].list:e.layer==t.RenderLayerEnum.UI?r=this.renderLayers[2].list:e.layer==t.RenderLayerEnum.Overlay&&(r=this.renderLayers[3].list);for(var a=0;a<r.length;a++)r[a]==e&&r.splice(a,1)},r}();t.RenderList=r,__reflect(r.prototype,"egret3d.framework.RenderList")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function e(e){this.renderCameras=[],this._mainCamera=null,this.renderContext=[],this.renderLights=[],this.lightmaps=[],this.app=e,this.webgl=e.webgl,this.rootNode=new t.Transform,this.rootNode._scene=this,this.renderList=new t.RenderList}return Object.defineProperty(e.prototype,"mainCamera",{get:function(){return null==this._mainCamera&&(this._mainCamera=this.renderCameras[0]),this._mainCamera},set:function(t){for(var e in this.renderCameras)this.renderCameras[e]==t&&(this._mainCamera=t)},enumerable:!0,configurable:!0}),e.prototype.update=function(t){this.renderCameras.length=0,this.renderLights.length=0,this.updateGameObject(this.rootNode,t,!this.app.bePlay),this.renderCameras.length>1&&this.renderCameras.sort(function(t,e){return t.order-e.order});for(var e=!1,r=0;r<this.renderCameras.length;r++)e=this._renderCamera(r)||e;e||(this.webgl.clearColor(0,0,0,1),this.webgl.clearDepth(1),this.webgl.clear(this.webgl.COLOR_BUFFER_BIT|this.webgl.DEPTH_BUFFER_BIT))},e.prototype._renderScene=function(t,e){e.updateCamera(this.app,t),e.updateLights(this.renderLights),t.renderScene(this,e)},e.prototype._renderOverLay=function(e,r){for(var a=e.getOverLays(),i=0;i<a.length;i++)e.CullingMask&t.CullingMask.UI&&a[i].render(r,e)},e.prototype._renderCamera=function(t){var e=this.renderCameras[t],r=this.renderContext[t],a=e.gameObject.transform.name.toLowerCase(),i=!1;return this.app.bePlay&&a.indexOf("editor")<0?(this._renderScene(e,r),i=!0,this._renderOverLay(e,r)):!this.app.bePlay&&a.indexOf("editor")>=0&&(this._renderScene(e,r),i=!0,this.app.be2dstate&&this._renderOverLay(e,r)),!this.app.bePlay&&this.app.be2dstate&&t==this.app.curcameraindex&&this._renderOverLay(e,r),i},e.prototype.updateGameObject=function(t,e,r){if(void 0===r&&(r=!1),t.hasComponent||t.hasComponentChild){if(t.gameObject.init(),t.gameObject.components.length>0){if(r){var a=t.gameObject.renderer;null!=a&&a.update(e);var i=t.gameObject.camera;null!=i&&i.update(e)}else t.gameObject.update(e);this.collectCameraAndLight(t)}if(null!=t.children)for(var o=0;o<t.children.length;o++)this.updateGameObject(t.children[o],e,r)}},e.prototype.collectCameraAndLight=function(e){var r=e.gameObject.camera;for(null!=r&&this.renderCameras.push(r);this.renderContext.length<this.renderCameras.length;)this.renderContext.push(new t.RenderContext(this.webgl));var a=e.gameObject.light;null!=a&&this.renderLights.push(a)},e.prototype.addChild=function(t){this.rootNode.addChild(t)},e.prototype.removeChild=function(t){this.rootNode.removeChild(t)},e.prototype.getChildren=function(){return this.rootNode.children},e.prototype.getChildCount=function(){return null==this.rootNode.children?0:this.rootNode.children.length},e.prototype.getChild=function(t){return this.rootNode.children[t]},e.prototype.getChildByName=function(t){var e=this.rootNode.find(t);return e},e.prototype.getRoot=function(){return this.rootNode},e.prototype.pickAll=function(t,e){void 0===e&&(e=!1);var r=this.doPick(t,!0,e);return null==r?null:r},e.prototype.pick=function(t,e){void 0===e&&(e=!1);var r=this.doPick(t,!1,e);return null==r?null:r},e.prototype.doPick=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=!1);var a=new Array;if(r?this.pickMesh(t,this.getRoot(),a):this.pickCollider(t,this.getRoot(),a),0==a.length)return null;if(e)return a;for(var i=0,o=1;o<a.length;o++)a[o].distance<a[i].distance&&(i=o);return a[i]},e.prototype.pickMesh=function(t,e,r){if(null!=e.gameObject){if(!e.gameObject.visible)return;var a=e.gameObject.getComponent("MeshFilter");if(null!=a){var i=a.getMeshOutput(),o=i.intersects(t,e.getWorldMatrix());o&&(r.push(o),o.pickedtran=e)}else{var n=e.gameObject.getComponent("SkinnedMeshRenderer");if(null!=n){var o=n.intersects(t);o&&(r.push(o),o.pickedtran=e)}}}if(null!=e.children)for(var s=0;s<e.children.length;s++)this.pickMesh(t,e.children[s],r)},e.prototype.pickCollider=function(t,e,r){if(null!=e.gameObject){if(!e.gameObject.visible)return;if(null!=e.gameObject.collider){var a=t.intersectCollider(e);a&&(r.push(a),a.pickedtran=e)}}if(null!=e.children)for(var i=0;i<e.children.length;i++)this.pickCollider(t,e.children[i],r)},e}();t.Scene=e,__reflect(e.prototype,"egret3d.framework.Scene")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=new t.math.Vector3,a=new t.math.Vector3,i=new t.math.Vector3,o=new t.math.Vector3,n=new t.math.Vector3,s=function(){function e(e,r){this.minimum=new t.math.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.maximum=new t.math.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._dirtyCenter=!0,this._dirtyRadius=!0,this.srcmin=new t.math.Vector3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.srcmax=new t.math.Vector3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this._center=new t.math.Vector3,e&&(t.math.vec3Clone(e,this.srcmin),t.math.vec3Clone(e,this.minimum)),r&&(t.math.vec3Clone(r,this.srcmax),t.math.vec3Clone(r,this.maximum))}return e.prototype.update=function(e){t.math.matrixGetTranslation(e,r),t.math.matrixGetTranslation(e,a),e.rawData[0]>0?(r.x+=e.rawData[0]*this.srcmin.x,a.x+=e.rawData[0]*this.srcmax.x):(r.x+=e.rawData[0]*this.srcmax.x,a.x+=e.rawData[0]*this.srcmin.x),e.rawData[1]>0?(r.y+=e.rawData[1]*this.srcmin.y,a.y+=e.rawData[1]*this.srcmax.y):(r.y+=e.rawData[1]*this.srcmax.y,a.y+=e.rawData[1]*this.srcmin.y),e.rawData[2]>0?(r.z+=e.rawData[2]*this.srcmin.z,a.z+=e.rawData[2]*this.srcmax.z):(r.z+=e.rawData[2]*this.srcmax.z,a.z+=e.rawData[2]*this.srcmin.z),e.rawData[4]>0?(r.x+=e.rawData[4]*this.srcmin.x,a.x+=e.rawData[4]*this.srcmax.x):(r.x+=e.rawData[4]*this.srcmax.x,a.x+=e.rawData[4]*this.srcmin.x),e.rawData[5]>0?(r.y+=e.rawData[5]*this.srcmin.y,a.y+=e.rawData[5]*this.srcmax.y):(r.y+=e.rawData[5]*this.srcmax.y,a.y+=e.rawData[5]*this.srcmin.y),e.rawData[6]>0?(r.z+=e.rawData[6]*this.srcmin.z,a.z+=e.rawData[6]*this.srcmax.z):(r.z+=e.rawData[6]*this.srcmax.z,a.z+=e.rawData[6]*this.srcmin.z),e.rawData[8]>0?(r.x+=e.rawData[8]*this.srcmin.x,a.x+=e.rawData[8]*this.srcmax.x):(r.x+=e.rawData[8]*this.srcmax.x,a.x+=e.rawData[8]*this.srcmin.x),e.rawData[9]>0?(r.y+=e.rawData[9]*this.srcmin.y,a.y+=e.rawData[9]*this.srcmax.y):(r.y+=e.rawData[9]*this.srcmax.y,a.y+=e.rawData[9]*this.srcmin.y),e.rawData[10]>0?(r.z+=e.rawData[10]*this.srcmin.z,a.z+=e.rawData[10]*this.srcmax.z):(r.z+=e.rawData[10]*this.srcmax.z,a.z+=e.rawData[10]*this.srcmin.z),t.math.vec3Clone(r,this.minimum),t.math.vec3Clone(a,this.maximum),this._dirtyCenter=!0,this._dirtyRadius=!0},e.prototype.addVector3=function(e){t.math.vec3Max(this.maximum,e,this.maximum),t.math.vec3Min(this.minimum,e,this.minimum),this._dirtyCenter=!0,this._dirtyRadius=!0},e.prototype.containsVector3=function(t){return t.x>this.minimum.x&&t.x<this.maximum.x&&t.y>this.minimum.y&&t.x<this.maximum.y&&t.z>this.minimum.z&&t.z<this.maximum.z},e.prototype.intersectAABB=function(t){return this.minimum.x>t.maximum.x?!1:this.maximum.x<t.minimum.x?!1:this.minimum.x>t.maximum.x?!1:this.maximum.x<t.minimum.x?!1:this.minimum.x>t.maximum.x?!1:this.maximum.x<t.minimum.x?!1:!0},e.prototype.intersectPlane=function(e,s,h){var l=r,c=a,u=i,d=o,p=n,m=this.center;t.math.vec3Subtract(s,e,l),t.math.vec3Subtract(h,s,c),t.math.vec3Cross(l,c,u),t.math.calPlaneLineIntersectPoint(u,e,u,m,d),t.math.vec3Subtract(d,m,p);var f=t.math.vec3Dot(u,p);if(0>=f)return!0;var v=t.math.vec3Distance(m,d);return v<this.radius?!0:!1},e.prototype.addAABB=function(e){null!=e&&(t.math.vec3Max(this.maximum,e.maximum,this.maximum),t.math.vec3Min(this.minimum,e.minimum,this.minimum),this._dirtyCenter=!0,this._dirtyRadius=!0)},Object.defineProperty(e.prototype,"center",{get:function(){return this._dirtyCenter&&(t.math.vec3Add(this.maximum,this.minimum,this._center),t.math.vec3ScaleByNum(this._center,.5,this._center),this._dirtyCenter=!1),this._center},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._dirtyRadius&&(t.math.vec3Subtract(this.maximum,this.minimum,r),t.math.vec3ScaleByNum(r,.5,r),this._dirtyRadius=!1),t.math.vec3Length(r)},enumerable:!0,configurable:!0}),e.prototype.clear=function(){t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.minimum),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.maximum),this._dirtyCenter=!0,this._dirtyRadius=!0},e.prototype.clone=function(){var e=new t.framework.Aabb(this.minimum,this.maximum);return e},e.prototype.copy=function(e){return t.math.vec3Clone(e.minimum,this.minimum),t.math.vec3Clone(e.maximum,this.maximum),this._dirtyCenter=!0,this._dirtyRadius=!0,this},e.prototype.getVec3=function(e){e[0]=t.math.Pool.clone_vector3(this.minimum),e[1]=t.math.Pool.clone_vector3(this.minimum),e[1].z=this.maximum.z,e[2]=t.math.Pool.clone_vector3(this.minimum),e[2].x=this.maximum.x,e[3]=t.math.Pool.clone_vector3(this.maximum),e[3].y=this.minimum.y,e[4]=t.math.Pool.clone_vector3(this.minimum),e[4].y=this.maximum.y,e[5]=t.math.Pool.clone_vector3(this.maximum),e[5].x=this.minimum.x,e[6]=t.math.Pool.clone_vector3(this.maximum),e[6].z=this.minimum.z,e[7]=t.math.Pool.clone_vector3(this.maximum)},e}();e.Aabb=s,__reflect(s.prototype,"egret3d.framework.Aabb")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){this.vectors=new Array}return e.prototype.buildByMaxMin=function(e,r){this.vectors[0]=t.math.Pool.clone_vector3(e),this.vectors[1]=t.math.Pool.clone_vector3(e),this.vectors[1].z=r.z,this.vectors[2]=t.math.Pool.clone_vector3(e),this.vectors[2].x=r.x,this.vectors[3]=t.math.Pool.clone_vector3(r),this.vectors[3].y=e.y,this.vectors[4]=t.math.Pool.clone_vector3(e),this.vectors[4].y=r.y,this.vectors[5]=t.math.Pool.clone_vector3(r),this.vectors[5].x=e.x,this.vectors[6]=t.math.Pool.clone_vector3(r),this.vectors[6].z=e.z,this.vectors[7]=t.math.Pool.clone_vector3(r),this.center=new t.math.Vector3,t.math.vec3Add(r,e,this.center),t.math.vec3ScaleByNum(this.center,.5,this.center),this.halfsize=new t.math.Vector3,t.math.vec3Subtract(r,e,this.halfsize),t.math.vec3ScaleByNum(this.halfsize,.5,this.halfsize),this.directions=[new t.math.Vector3,new t.math.Vector3,new t.math.Vector3]},e.prototype.buildByCenterSize=function(e,r){this.center=t.math.Pool.clone_vector3(e),this.halfsize=t.math.Pool.clone_vector3(r),t.math.vec3ScaleByNum(this.halfsize,.5,this.halfsize);var a=this.halfsize.x,i=this.halfsize.y,o=this.halfsize.z,n=this.center.x,s=this.center.y,h=this.center.z;this.vectors[0]=new t.math.Vector3(n-a,s-i,h-o),this.vectors[1]=new t.math.Vector3(n-a,s-i,h+o),this.vectors[2]=new t.math.Vector3(n+a,s-i,h-o),this.vectors[3]=new t.math.Vector3(n+a,s-i,h+o),this.vectors[4]=new t.math.Vector3(n-a,s+i,h-o),this.vectors[5]=new t.math.Vector3(n-a,s+i,h+o),this.vectors[6]=new t.math.Vector3(n+a,s+i,h-o),this.vectors[7]=new t.math.Vector3(n+a,s+i,h+o),this.directions=[new t.math.Vector3,new t.math.Vector3,new t.math.Vector3]},e.prototype.update=function(e){t.math.matrixGetTranslation(e,this.center),t.math.matrixGetVector3ByOffset(e,0,this.directions[0]),t.math.matrixGetVector3ByOffset(e,4,this.directions[1]),t.math.matrixGetVector3ByOffset(e,8,this.directions[2])},e.prototype.caclWorldVecs=function(e,r){for(var a=0;a<this.vectors.length;a++)e[a]=new t.math.Vector3,t.math.matrixTransformVector3(this.vectors[a],r,e[a])},e.prototype.intersects=function(e){if(null==e)return!1;var r=this,a=e;if(!this.axisOverlap(r.directions[0],r,a))return!1;if(!this.axisOverlap(r.directions[1],r,a))return!1;if(!this.axisOverlap(r.directions[2],r,a))return!1;if(!this.axisOverlap(a.directions[0],r,a))return!1;if(!this.axisOverlap(a.directions[1],r,a))return!1;if(!this.axisOverlap(a.directions[2],r,a))return!1;var i=t.math.Pool.new_vector3();return t.math.vec3Cross(r.directions[0],a.directions[0],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[0],a.directions[1],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[0],a.directions[2],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[1],a.directions[0],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[1],a.directions[1],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[1],a.directions[2],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[2],a.directions[0],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[2],a.directions[1],i),this.axisOverlap(i,r,a)?(t.math.vec3Cross(r.directions[2],a.directions[2],i),this.axisOverlap(i,r,a)?!0:!1):!1):!1):!1):!1):!1):!1):!1):!1},e.prototype.computeBoxExtents=function(e,r){var a=t.math.vec3Dot(r.center,e),i=Math.abs(t.math.vec3Dot(r.directions[0],e))*r.halfsize.x,o=Math.abs(t.math.vec3Dot(r.directions[1],e))*r.halfsize.y,n=Math.abs(t.math.vec3Dot(r.directions[2],e))*r.halfsize.z,s=i+o+n,h=t.math.Pool.new_vector3();return h.x=a-s,h.y=a+s,h},e.prototype.axisOverlap=function(t,e,r){var a=this.computeBoxExtents(t,e),i=this.computeBoxExtents(t,r);return this.extentsOverlap(a.x,a.y,i.x,i.y)},e.prototype.extentsOverlap=function(t,e,r,a){return!(t>a||r>e)},e.prototype.clone=function(){var r=new e;r.center=t.math.Pool.clone_vector3(this.center),r.halfsize=this.halfsize;for(var a in this.directions)r.directions[a]=t.math.Pool.clone_vector3(this.directions[a]);return r},e.prototype.dispose=function(){this.vectors.length=0,this.directions.length=0},e}();e.Obb=r,__reflect(r.prototype,"egret3d.framework.Obb")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(e,r,a){this.hitposition=new t.math.Vector3,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshId=0,this.distance=a,this.bu=e,this.bv=r}return e}();e.Pickinfo=r,__reflect(r.prototype,"egret3d.framework.Pickinfo")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(e,r){this.origin=t.math.Pool.clone_vector3(e),this.direction=t.math.Pool.clone_vector3(r)}return r.prototype.intersectAABB=function(t){return this.intersectBoxMinMax(t.minimum,t.maximum)},r.prototype.intersectPlaneTransform=function(e){var r=null,a=e.getPosition(),i=t.math.Pool.new_vector3();e.getForward(i);var o=this.intersectPlane(a,i);return o&&(r=new t.framework.Pickinfo(0,0,0),r.hitposition=o,r.distance=t.math.vec3Distance(r.hitposition,this.origin)),t.math.Pool.delete_vector3(i),r},r.prototype.intersectPlane=function(e,r){var a=r.x,i=r.y,o=r.z,n=e.x,s=e.y,h=e.z,l=this.direction.x,c=this.direction.y,u=this.direction.z,d=this.origin.x,p=this.origin.y,m=this.origin.z,f=l*a+c*i+u*o;if(0===f)return null;var v=((n-d)*a+(s-p)*i+(h-m)*o)/f;return new t.math.Vector3(d+l*v,p+c*v,m+u*v)},r.prototype.intersectCollider=function(r){var a=r.gameObject.collider,i=null;if(a instanceof e.BoxCollider){var o=a.getBound();if(!o)return null;var n=[];o.caclWorldVecs(n,a.gameObject.transform.getWorldMatrix());for(var s=t.render.MeshData.genBoxByArray(n),h=0;h<s.pos.length;h+=3){var l=s.pos[s.trisindex[h]],c=s.pos[s.trisindex[h+1]],u=s.pos[s.trisindex[h+2]],d=this.intersectsTriangle(l,c,u);if(d){if(d.distance<0)continue;if(!i||i.distance>d.distance){i=d;var p=t.math.Pool.new_vector3();t.math.vec3ScaleByNum(this.direction,d.distance,p),t.math.vec3Add(this.origin,p,i.hitposition),t.math.Pool.delete_vector3(p)}}}}else if(a instanceof e.MeshCollider){var m=a.getBound();null!=m&&(i=m.intersects(this,r.getWorldMatrix()))}else a instanceof e.CanvasRenderer&&(i=this.intersectPlaneTransform(r));return i},r.prototype.intersectBoxMinMax=function(t,e){var r,a,i,o,n=0,s=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<t.x||this.origin.x>e.x)return!1}else if(r=1/this.direction.x,a=(t.x-this.origin.x)*r,i=(e.x-this.origin.x)*r,i===-(1/0)&&(i=1/0),a>i&&(o=a,a=i,i=o),n=Math.max(a,n),s=Math.min(i,s),n>s)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<t.y||this.origin.y>e.y)return!1}else if(r=1/this.direction.y,a=(t.y-this.origin.y)*r,i=(e.y-this.origin.y)*r,i===-(1/0)&&(i=1/0),a>i&&(o=a,a=i,i=o),n=Math.max(a,n),s=Math.min(i,s),n>s)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<t.z||this.origin.z>e.z)return!1}else if(r=1/this.direction.z,a=(t.z-this.origin.z)*r,i=(e.z-this.origin.z)*r,i===-(1/0)&&(i=1/0),a>i&&(o=a,a=i,i=o),n=Math.max(a,n),s=Math.min(i,s),n>s)return!1;return!0},r.prototype.intersectsSphere=function(e,r){var a=t.math.Pool.new_vector3();t.math.vec3Subtract(e,this.origin,a);var i=t.math.vec3Dot(this.direction,a);if(0>i)return!1;var o=t.math.vec3SqrLength(a);t.math.Pool.delete_vector3(a);var n=r*r;if(n>o)return!0;var s=n-(o-i*i);return 0>s?!1:!0},r.prototype.intersectsTriangle=function(r,a,i){var o=t.math.Pool.new_vector3(),n=t.math.Pool.new_vector3(),s=t.math.Pool.new_vector3(),h=t.math.Pool.new_vector3(),l=t.math.Pool.new_vector3();t.math.vec3Subtract(a,r,o),t.math.vec3Subtract(i,r,n),t.math.vec3Cross(this.direction,n,s);var c=t.math.vec3Dot(o,s);if(0===c)return null;var u=1/c;t.math.vec3Subtract(this.origin,r,h);var d=t.math.vec3Dot(h,s)*u;if(0>d||d>1)return null;t.math.vec3Cross(h,o,l);var p=t.math.vec3Dot(this.direction,l)*u;if(0>p||d+p>1)return null;var m=t.math.vec3Dot(n,l)*u;return t.math.Pool.delete_vector3(o),t.math.Pool.delete_vector3(n),t.math.Pool.delete_vector3(s),t.math.Pool.delete_vector3(h),t.math.Pool.delete_vector3(l),new e.Pickinfo(d,p,m)},r}();e.Ray=r,__reflect(r.prototype,"egret3d.framework.Ray")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){this._id=t.idAll++}return t.prototype.getInsID=function(){return this._id},t.idAll=1,t}();t.InsID=e,__reflect(e.prototype,"egret3d.framework.InsID")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=new t.math.Vector3,a=(new t.math.Vector3,new t.math.Matrix),i=new t.math.Quaternion,o=new t.math.Quaternion,n=new t.math.Vector3,s=new t.math.Quaternion,h=new t.math.Vector3(0,1,0),l=new t.math.Vector3(1,0,0),c=new t.math.Vector3(0,0,1),u=function(){function u(){this.insId=new e.InsID,this.name="NoName",this.children=[],this._beDispose=!1,this._dirtyAABB=!0,this._dirtyLocal=!0,this.localMatrix=new t.math.Matrix,this._dirtyWorld=!0,this.worldMatrix=new t.math.Matrix,this.localPosition=new t.math.Vector3,this.localScale=new t.math.Vector3(1,1,1),this.localRotation=new t.math.Quaternion,this.localEulerAngles=new t.math.Vector3,this.position=new t.math.Vector3,this.scale=new t.math.Vector3(1,1,1),this.rotation=new t.math.Quaternion,this.eulerAngles=new t.math.Vector3,this.hasComponent=!1,this.hasComponentChild=!1}return d=u,Object.defineProperty(u.prototype,"gameObject",{get:function(){return null==this._gameObject&&(this._gameObject=new e.GameObject,this._gameObject.transform=this),this._gameObject},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"scene",{get:function(){return this._scene},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),u.prototype.$setScene=function(t){var e=this.gameObject.renderer;null==t?this._scene&&e&&this._scene.renderList.removeRenderer(e):e&&t.renderList.addRenderer(e),this._scene=t;for(var r=this.children.length;r--;)this.children[r].$setScene(t)},u.prototype.addChild=function(t){null!=t._parent&&t._parent.removeChild(t),this.children.push(t),t._parent=this,t.$setScene(this._scene),t._dirtify(),(t.hasComponent||t.hasComponentChild)&&this.markHaveComponent()
},u.prototype.addChildAt=function(t,e){0>e||(null!=t._parent&&t._parent.removeChild(t),this.children.splice(e,0,t),t._parent=this,t.$setScene(this._scene),t._dirtify(),(t.hasComponent||t.hasComponentChild)&&this.markHaveComponent())},u.prototype.removeAllChild=function(){for(;this.children.length>0;)this.removeChild(this.children[0])},u.prototype.removeChild=function(t){if(t._parent==this){var e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),t._parent=null,t.$setScene(null),t._dirtify())}},u.prototype.find=function(t){if(this.name==t)return this;for(var e in this.children){var r=this.children[e].find(t);if(null!=r)return r}return null},u.prototype.checkImpactTran=function(t){return null==this.gameObject.collider?!1:this.gameObject.collider.intersectsTransform(t)},u.prototype.checkImpact=function(){var t=new Array;return this._doImpact(this.scene.getRoot(),t),t},u.prototype._doImpact=function(t,e){if(t!=this){null!=t.gameObject&&null!=t.gameObject.collider&&this.checkImpactTran(t)&&e.push(t);for(var r=0;r<t.children.length;r++)this._doImpact(t.children[r],e)}},u.prototype.clone=function(){return t.io.cloneObj(this)},Object.defineProperty(u.prototype,"beDispose",{get:function(){return this._beDispose},enumerable:!0,configurable:!0}),u.prototype.dispose=function(){if(!this._beDispose){for(var t in this.children)this.children[t].dispose();this.removeAllChild(),this._gameObject.dispose(),this._beDispose=!0}},Object.defineProperty(u.prototype,"aabb",{get:function(){return this._aabb||(this._aabb=this._buildAABB()),this._dirtyAABB&&(this._aabb.update(this.getWorldMatrix()),this._dirtyAABB=!1),this._aabb},enumerable:!0,configurable:!0}),u.prototype._buildAABB=function(){var r=new t.math.Vector3,a=new t.math.Vector3,i=this.gameObject.getComponent("MeshFilter");if(null!=i&&null!=i.mesh){var o=i.mesh.data;t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,r),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,a);for(var n=0;n<o.pos.length;n++)t.math.vec3Max(o.pos[n],a,a),t.math.vec3Min(o.pos[n],r,r)}else{var s=this.gameObject.getComponent("SkinnedMeshRenderer");if(null!=s){var h=s.mesh.data;t.math.vec3SetByFloat(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,r),t.math.vec3SetByFloat(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,a);for(var n=0;n<h.pos.length;n++)t.math.vec3Max(h.pos[n],a,a),t.math.vec3Min(h.pos[n],r,r)}else r.x=-1,r.y=-1,r.z=-1,a.x=1,a.y=1,a.z=1}var l=new e.Aabb(r,a);return l},u.prototype.getLocalMatrix=function(){return this._dirtyLocal&&(t.math.matrixMakeTransformRTS(this.localPosition,this.localScale,this.localRotation,this.localMatrix),this._dirtyLocal=!1),this.localMatrix},u.prototype.getWorldMatrix=function(){return this._dirtyLocal||this._dirtyWorld?(this._parent&&this._parent.getWorldMatrix(),this._sync(),this.worldMatrix):this.worldMatrix},u.prototype._sync=function(){this._dirtyLocal&&(t.math.matrixMakeTransformRTS(this.localPosition,this.localScale,this.localRotation,this.localMatrix),this._dirtyLocal=!1),this._dirtyWorld&&(this._parent?t.math.matrixMultiply(this._parent.worldMatrix,this.localMatrix,this.worldMatrix):t.math.matrixClone(this.localMatrix,this.worldMatrix),this._dirtyWorld=!1)},u.prototype._dirtify=function(t){if(void 0===t&&(t=!1),!(!t||t&&this._dirtyLocal)||!this._dirtyWorld){if(t&&(this._dirtyLocal=!0),!this._dirtyWorld){this._dirtyWorld=!0;for(var e=this.children.length;e--;)this.children[e]._dirtyWorld||this.children[e]._dirtify()}this._dirtyAABB=!0}},u.prototype.getLocalPosition=function(){return this.localPosition},u.prototype.setLocalPosition=function(e,r,a){e instanceof t.math.Vector3?t.math.vec3Clone(e,this.localPosition):(this.localPosition.x=e,this.localPosition.y=r||0,this.localPosition.z=a||0),this._dirtyLocal||this._dirtify(!0)},u.prototype.getLocalScale=function(){return this.localScale},u.prototype.setLocalScale=function(e,r,a){e instanceof t.math.Vector3?t.math.vec3Clone(e,this.localScale):(this.localScale.x=e,this.localScale.y=r||1,this.localScale.z=a||1),this._dirtyLocal||this._dirtify(!0)},u.prototype.getLocalRotation=function(){return this.localRotation},u.prototype.setLocalRotation=function(e,r,a,i){e instanceof t.math.Quaternion?t.math.vec3Clone(e,this.localRotation):(this.localRotation.x=e,this.localRotation.y=r||0,this.localRotation.z=a||0,this.localRotation.w=i||1),this._dirtyLocal||this._dirtify(!0)},u.prototype.getLocalEulerAngles=function(){return t.math.quatToEulerAngles(this.localRotation,this.localEulerAngles),this.localEulerAngles},u.prototype.setLocalEulerAngles=function(e,r,a){e instanceof t.math.Vector3?t.math.quatFromEulerAngles(e.x,e.y,e.z,this.localRotation):t.math.quatFromEulerAngles(e,r,a,this.localRotation),this._dirtyLocal||this._dirtify(!0)},u.prototype.getPosition=function(){return t.math.matrixGetTranslation(this.getWorldMatrix(),this.position),this.position},u.prototype.setPosition=function(e,i,o){e instanceof t.math.Vector3?t.math.vec3Clone(e,r):(r.x=e,r.y=i||0,r.z=o||0),this._parent?(t.math.matrixInverse(this._parent.getWorldMatrix(),a),t.math.matrixTransformNormal(r,a,this.localPosition)):t.math.vec3Clone(r,this.localPosition),this._dirtyLocal||this._dirtify(!0)},u.prototype.getScale=function(){return t.math.matrixGetScale(this.getWorldMatrix(),this.scale),this.scale},u.prototype.setScale=function(e,i,o){e instanceof t.math.Vector3?t.math.vec3Clone(e,r):(r.x=e,r.y=i||1,r.z=o||1),this._parent?(t.math.matrixInverse(this._parent.getWorldMatrix(),a),t.math.matrixTransformVector3(r,a,this.localScale)):t.math.vec3Clone(r,this.localScale),this._dirtyLocal||this._dirtify(!0)},u.prototype.getRotation=function(){return t.math.setQuatFromMat4(this.getWorldMatrix(),this.rotation),this.rotation},u.prototype.setRotation=function(e,r,a,n){if(e instanceof t.math.Quaternion?t.math.quatClone(e,i):(i.x=e,i.y=r||0,i.z=a||0,i.w=n||1),this._parent){var s=this._parent.getRotation();t.math.quatInverse(s,o),t.math.quatMultiply(o,i,this.localRotation)}else t.math.quatClone(i,this.localRotation);this._dirtyLocal||this._dirtify(!0)},u.prototype.getEulerAngles=function(){return t.math.setEulerAnglesFromMat4(this.getWorldMatrix(),this.eulerAngles),this.eulerAngles},u.prototype.setEulerAngles=function(e,r,a){if(e instanceof t.math.Vector3?t.math.quatFromEulerAngles(e.x,e.y,e.z,i):t.math.quatFromEulerAngles(e,r||0,a||0,i),this._parent){var n=this._parent.getRotation();t.math.quatInverse(n,o),t.math.quatMultiply(o,i,this.localRotation)}else t.math.quatClone(i,this.localRotation);this._dirtyLocal||this._dirtify(!0)},u.prototype.lookAt=function(e){e instanceof d?t.math.vec3Clone(e.getPosition(),n):t.math.vec3Clone(e,n),t.math.quatLookat(this.getPosition(),n,s),this.setRotation(s)},u.prototype.getForward=function(e){t.math.matrixTransformNormal(c,this.getWorldMatrix(),e),t.math.vec3Normalize(e,e)},u.prototype.getRight=function(e){t.math.matrixTransformNormal(l,this.getWorldMatrix(),e),t.math.vec3Normalize(e,e)},u.prototype.getUp=function(e){t.math.matrixTransformNormal(h,this.getWorldMatrix(),e),t.math.vec3Normalize(e,e)},u.prototype.markHaveComponent=function(){this.hasComponent=!0;for(var t=this.parent;null!=t;)t.hasComponentChild=!0,t=t.parent},__decorate([t.reflect.Field("string"),__metadata("design:type",String)],u.prototype,"name",void 0),__decorate([t.reflect.Field("GameObject"),__metadata("design:type",Object),__metadata("design:paramtypes",[])],u.prototype,"gameObject",null),__decorate([t.reflect.Field("Transform[]"),__metadata("design:type",Array)],u.prototype,"children",void 0),__decorate([t.reflect.Field("Vector3",new t.math.Vector3(0,0,0)),__metadata("design:type",t.math.Vector3)],u.prototype,"localPosition",void 0),__decorate([t.reflect.Field("vector3",new t.math.Vector3(1,1,1)),__metadata("design:type",t.math.Vector3)],u.prototype,"localScale",void 0),__decorate([t.reflect.Field("Quaternion"),__metadata("design:type",t.math.Quaternion)],u.prototype,"localRotation",void 0),u=d=__decorate([t.reflect.SerializeType],u);var d}();e.Transform=u,__reflect(u.prototype,"egret3d.framework.Transform")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(egret3d){var framework;!function(framework){var EnumUtil=function(){function EnumUtil(){}return EnumUtil.getEnumObjByType=function(enumType){var index=enumType.indexOf("egret3d.framework.");return 0==index&&(enumType=enumType.substr(15)),eval("{result:"+enumType+"}")},EnumUtil}();framework.EnumUtil=EnumUtil,__reflect(EnumUtil.prototype,"egret3d.framework.EnumUtil")}(framework=egret3d.framework||(egret3d.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.KEY_A=65,t.KEY_D=68,t.KEY_E=69,t.KEY_Q=81,t.KEY_R=82,t.KEY_S=83,t.KEY_W=87,t}();t.NumberUtil=e,__reflect(e.prototype,"egret3d.framework.NumberUtil")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.textureRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*'(.+)'[ ]*\{[ ]*([a-zA-Z]*)[ ]*([a-zA-Z]*)[ ]*\}/,t.vectorRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)/,t.floatRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\)[ ]*=[ ]*([0-9.-]+)/,t.rangeRegexp=/([_0-9a-zA-Z]+)[ ]*\([ ]*'(.+)'[ ]*,[ ]*([0-9a-zA-Z]+)[ ]*\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)[ ]*\)[ ]*=[ ]*([0-9.-]+)/,t.vector4Regexp=/\([ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*,[ ]*([0-9.-]+)[ ]*\)/,t.vector3FloatOrRangeRegexp=/([0-9.-]+|\[[0-9.-]+,[0-9.-]+\]),([0-9.-]+|\[[0-9.-]+,[0-9.-]+\]),([0-9.-]+|\[[0-9.-]+,[0-9.-]+\])/,t}();t.RegexpUtil=e,__reflect(e.prototype,"egret3d.framework.RegexpUtil")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function t(){}return t.replaceAll=function(t,e,r){return t.replace(new RegExp(e,"gm"),r)},t.trimAll=function(t){t+="";var e=t.replace(/(^\s+)|(\s+$)/g,"");return e=e.replace(/\s/g,"")},t.firstCharToLowerCase=function(t){var e=t.substr(0,1).toLowerCase(),r=t.substr(1);return e+r},t.COMPONENT_CAMERA="Camera",t.COMPONENT_BOXCOLLIDER="BoxCollider",t.COMPONENT_LIGHT="Light",t.COMPONENT_MESHFILTER="MeshFilter",t.COMPONENT_MESHRENDER="MeshRenderer",t.COMPONENT_EFFECTSYSTEM="EffectSystem",t.COMPONENT_SKINMESHRENDER="SkinnedMeshRenderer",t.COMPONENT_CAMERACONTROLLER="CameraController",t.COMPONENT_CANVASRENDER="CanvasRenderer",t.COMPONENT_LABEL="Label",t.COMPONENT_IMAGE="Image2D",t.COMPONENT_RAWIMAGE="RawImage2D",t.COMPONENT_BUTTON="button",t.UIStyle_RangeFloat="rangeFloat",t.UIStyle_Enum="enum",t.RESOURCES_MESH_CUBE="cube",t}();t.StringUtil=e,__reflect(e.prototype,"egret3d.framework.StringUtil")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.Sphere=0]="Sphere",t[t.Capsule=1]="Capsule",t[t.Cylinder=2]="Cylinder",t[t.Cube=3]="Cube",t[t.Plane=4]="Plane",t[t.Quad=5]="Quad",t[t.Pyramid=6]="Pyramid"}(r=e.PrimitiveType||(e.PrimitiveType={}));var a;!function(t){t[t.RawImage2D=0]="RawImage2D",t[t.Image2D=1]="Image2D",t[t.Label=2]="Label",t[t.Button=3]="Button"}(a=e.Primitive2DType||(e.Primitive2DType={}));var i=function(){function i(){}return i.CreatePrimitive=function(t,a){var i=r[t],o=new e.Transform;o.name=i;var n=o.gameObject.addComponent("MeshFilter"),s=e.AssetMap.find(i.toLowerCase());n.mesh=s;var h=o.gameObject.addComponent("MeshRenderer");return h.materials=[],h.materials.push(new e.Material),h.materials[0].setShader(e.DefaultShaders.Diffuse),o},i.Create2DPrimitive=function(t,r){var o=a[t],n=e.StringUtil.firstCharToLowerCase(o),s=new e.Transform2D;s.name=o;var h=s.addComponent(n);switch(s.pivot.x=0,s.pivot.y=0,t){case a.RawImage2D:i.create2D_rawImage(h,r);break;case a.Image2D:i.create2D_image2D(h,r);break;case a.Label:i.create2D_label(h,r);break;case a.Button:i.create2D_button(h,r)}return s},i.create2D_rawImage=function(t,r){t.transform.width=100,t.transform.height=100,t.image=e.DefaultTextures.White},i.create2D_image2D=function(t,r){t.transform.width=100,t.transform.height=100,t.setTexture(e.DefaultTextures.White)},i.create2D_label=function(e,r){e.transform.width=150,e.transform.height=50,e.text="label",e.fontsize=25,e.color=new t.math.Color(1,0,0,1)},i.create2D_button=function(r,a){r.transform.width=150,r.transform.height=50;var i=r.transform.addComponent("Image2D");i.setTexture(e.DefaultTextures.White),i.imageType=t.framework.ImageType.Sliced,r.targetImage=i,r.transition=t.framework.TransitionType.ColorTint;var o=new t.framework.Transform2D;o.name="label",o.width=150,o.height=50,o.pivot.x=0,o.pivot.y=0,o.localTranslate.y=-10;var n=o.addComponent("Label");n.text="button",n.fontsize=25,n.color=new t.math.Color(1,0,0,1),r.transform.addChild(o)},i}();e.TransformUtil=i,__reflect(i.prototype,"egret3d.framework.TransformUtil")}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function e(){}return e.collect_all=function(){e.collect_vector4(),e.collect_vector3(),e.collect_vector2(),e.collect_matrix(),e.collect_quaternion(),e.collect_color()},Object.defineProperty(e,"vector4_one",{get:function(){return null==e._vector4_one&&(e._vector4_one=new t.Vector4(1,1,1,1)),e._vector4_one},enumerable:!0,configurable:!0}),e.new_vector4=function(){return e.unused_vector4.length>0?e.unused_vector4.pop():new t.Vector4},e.clone_vector4=function(r){if(e.unused_vector4.length>0){var a=e.unused_vector4.pop();return a.x=r.x,a.y=r.y,a.z=r.z,a.w=r.w,a}return new t.Vector4(r.x,r.y,r.z)},e.delete_vector4=function(r){null!=r&&(r instanceof t.Vector4?(r.x=r.y=r.z=0,r.w=1,e.unused_vector4.push(r)):console.error("this is not a vector4 type!"))},e.collect_vector4=function(){e.unused_vector4.length=0},Object.defineProperty(e,"color_one",{get:function(){return null==e._color_one&&(e._color_one=new t.Color(1,1,1,1)),e._color_one},enumerable:!0,configurable:!0}),e.new_color=function(){return e.unused_color.length>0?e.unused_color.pop():new t.Color},e.delete_color=function(r){null!=r&&(r instanceof t.Color?(r.r=r.g=r.b=0,r.a=1,e.unused_color.push(r)):console.error("this is not a color type!"))},e.collect_color=function(){e.unused_color.length=0},Object.defineProperty(e,"vector3_up",{get:function(){return null==e._vector3_up&&(e._vector3_up=new t.Vector3(0,1,0)),e._vector3_up},enumerable:!0,configurable:!0}),Object.defineProperty(e,"vector3_right",{get:function(){return null==e._vector3_right&&(e._vector3_right=new t.Vector3(1,0,0)),e._vector3_right},enumerable:!0,configurable:!0}),Object.defineProperty(e,"vector3_forward",{get:function(){return null==e._vector3_forward&&(e._vector3_forward=new t.Vector3(0,0,1)),e._vector3_forward},enumerable:!0,configurable:!0}),Object.defineProperty(e,"vector3_zero",{get:function(){return null==e._vector3_zero&&(e._vector3_zero=new t.Vector3(0,0,0)),e._vector3_zero},enumerable:!0,configurable:!0}),Object.defineProperty(e,"vector3_one",{get:function(){return null==e._vector3_one&&(e._vector3_one=new t.Vector3(1,1,1)),e._vector3_one},enumerable:!0,configurable:!0}),e.new_vector3=function(){if(e.unused_vector3.length>0){var r=e.unused_vector3.pop();return r}return new t.Vector3},e.clone_vector3=function(r){if(e.unused_vector3.length>0){var a=e.unused_vector3.pop();return a.x=r.x,a.y=r.y,a.z=r.z,a}return new t.Vector3(r.x,r.y,r.z)},e.delete_vector3=function(r){null!=r&&(r instanceof t.Vector3?(r.x=r.y=r.z=0,e.unused_vector3.push(r)):console.error("this is not a vector3 type!"))},e.collect_vector3=function(){e.unused_vector3.length=0},Object.defineProperty(e,"vector2_up",{get:function(){return null==e._vector2_up&&(e._vector2_up=new t.Vector2(0,1)),e._vector2_up},enumerable:!0,configurable:!0}),Object.defineProperty(e,"vector2_right",{get:function(){return null==e._vector2_right&&(e._vector2_right=new t.Vector2(1,0)),e._vector2_right},enumerable:!0,configurable:!0}),e.new_vector2=function(){return e.unused_vector2.length>0?e.unused_vector2.pop():new t.Vector2},e.clone_vector2=function(r){if(e.unused_vector2.length>0){var a=e.unused_vector2.pop();return a.x=r.x,a.y=r.y,a}return new t.Vector2(r.x,r.y)},e.delete_vector2=function(r){null!=r&&(r instanceof t.Vector2?(r.x=r.y=0,e.unused_vector2.push(r)):console.error("this is not a vector2 type!"))},e.delete_vector2Array=function(t){for(var r=0;r<t.length;r++)void 0!=t[r]&&(t[r].x=t[r].y=0,e.unused_vector2.push(t[r]));t.length=0},e.collect_vector2=function(){e.unused_vector2.length=0},e.new_matrix3x2=function(){return e.unused_matrix3x2.length>0?e.unused_matrix3x2.pop():new t.Matrix3x2},e.clone_matrix3x2=function(t){for(var r=e.new_matrix(),a=0;6>a;a++)r.rawData[a]=t.rawData[a];return r},e.delete_matrix3x2=function(r){null!=r&&(r instanceof t.Matrix3x2?(r.rawData[0]=1,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=0,r.rawData[4]=1,r.rawData[5]=0,e.unused_matrix3x2.push(r)):console.error("this is not a Matrix3x2 type!"))},e.collect_matrix3x2=function(){e.unused_matrix3x2.length=0},e.new_matrix=function(){return e.unused_matrix.length>0?e.unused_matrix.pop():new t.Matrix},e.clone_matrix=function(t){for(var r=e.new_matrix(),a=0;16>a;a++)r.rawData[a]=t.rawData[a];return r},e.delete_matrix=function(r){null!=r&&(r instanceof t.Matrix?(r.rawData[0]=1,r.rawData[1]=0,r.rawData[2]=0,r.rawData[3]=0,r.rawData[4]=0,r.rawData[5]=1,r.rawData[6]=0,r.rawData[7]=0,r.rawData[8]=0,r.rawData[9]=0,r.rawData[10]=1,r.rawData[11]=0,r.rawData[12]=0,r.rawData[13]=0,r.rawData[14]=0,r.rawData[15]=1,e.unused_matrix.push(r)):console.error("this is not a Matrix type!"))},e.collect_matrix=function(){e.unused_matrix.length=0},e.new_quaternion=function(){return e.unused_quaternion.length>0?e.unused_quaternion.pop():new t.Quaternion},e.clone_quaternion=function(r){if(e.unused_quaternion.length>0){var a=e.unused_quaternion.pop();return a.x=r.x,a.y=r.y,a.z=r.z,a.w=r.w,a}return new t.Quaternion(r.x,r.y,r.z,r.w)},e.delete_quaternion=function(r){null!=r&&(r instanceof t.Quaternion?(r.x=r.y=r.z=0,r.w=1,e.unused_quaternion.push(r)):console.error("this is not a quaternion type!"))},e.collect_quaternion=function(){e.unused_quaternion.length=0},e.unused_vector4=[],e.unused_color=[],e.unused_vector3=[],e.unused_vector2=[],e.unused_matrix3x2=[],e.unused_matrix=[],e.unused_quaternion=[],e}();t.Pool=e,__reflect(e.prototype,"egret3d.math.Pool")}(e=t.math||(t.math={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t,e){for(var r=["","MOZ_","OP_","WEBKIT_"],a=0;a<r.length;++a){var i=r[a]+e,o=t.getExtension(i);if(o)return o}return null}var r=function(){function t(){}return t.prototype.initialize=function(t){this.standardDerivatives=e(t,"OES_standard_derivatives"),this.pvrtcExtension=e(t,"WEBGL_compressed_texture_pvrtc")},t}();t.Caps=r,__reflect(r.prototype,"egret3d.render.Caps");var a=function(){function e(){}return e.SetMaxVertexAttribArray=function(t,r){for(var a=r;a<e._maxVertexAttribArray;a++)t.disableVertexAttribArray(a);e._maxVertexAttribArray=r},e.activeTexture=function(t){this._activeTextureIndex!=t&&(this.webgl.activeTexture(e._texNumber[t]),this._activeTextureIndex=t)},e.showFace=function(e){if(this._showFace!=e){var r=this.webgl;e==t.ShowFaceStateEnum.ALL?r.disable(r.CULL_FACE):(e==t.ShowFaceStateEnum.CCW?r.frontFace(r.CCW):r.frontFace(r.CW),r.cullFace(r.BACK),r.enable(r.CULL_FACE)),this._showFace=e}},e.zWrite=function(t){this._zWrite!==t&&(this.webgl.depthMask(t),this._zWrite=t)},e.zTest=function(t){if(this._zTest!==t){var e=this.webgl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._zTest=t}},e.zTestMethod=function(t){this._zTestMethod!==t&&(this.webgl.depthFunc(t),this._zTestMethod=t)},e.blend=function(t,e,r,a,i,o){var n=this.webgl;this._blend!==t&&(t?n.enable(n.BLEND):n.disable(n.BLEND),this._blend=t),t&&(n.blendEquation(e),n.blendFuncSeparate(r,a,i,o))},e.useProgram=function(t){return this._program!=t?(this._program=t,this.webgl.useProgram(t),!0):!1},e.drawArrayTris=function(e,r,a){t.DrawInfo.ins.triCount+=a/3,t.DrawInfo.ins.renderCount++,e.drawArrays(e.TRIANGLES,r,a)},e.drawArrayLines=function(e,r,a){t.DrawInfo.ins.renderCount++,e.drawArrays(e.LINES,r,a)},e.drawElementTris=function(e,r,a){t.DrawInfo.ins.triCount+=a/3,t.DrawInfo.ins.renderCount++,e.drawElements(e.TRIANGLES,a,e.UNSIGNED_SHORT,2*r)},e.drawElementLines=function(e,r,a){t.DrawInfo.ins.renderCount++,e.drawElements(e.LINES,a,e.UNSIGNED_SHORT,2*r)},e.resetState=function(){this._activeTextureIndex=-1,this._showFace=void 0,this._zWrite=void 0,this._zTest=void 0,this._zTestMethod=void 0,this._blend=void 0,this._program=void 0},e.initConst=function(t){null==e._texNumber&&(this.webgl=t,e._texNumber=[],e._texNumber.push(t.TEXTURE0),e._texNumber.push(t.TEXTURE1),e._texNumber.push(t.TEXTURE2),e._texNumber.push(t.TEXTURE3),e._texNumber.push(t.TEXTURE4),e._texNumber.push(t.TEXTURE5),e._texNumber.push(t.TEXTURE6),e._texNumber.push(t.TEXTURE7),e._texNumber.push(t.TEXTURE8),e._texNumber.push(t.TEXTURE9),e.LEQUAL=t.LEQUAL,e.NEVER=t.NEVER,e.EQUAL=t.EQUAL,e.GEQUAL=t.GEQUAL,e.NOTEQUAL=t.NOTEQUAL,e.LESS=t.LESS,e.GREATER=t.GREATER,e.ALWAYS=t.ALWAYS,e.FUNC_ADD=t.FUNC_ADD,e.FUNC_SUBTRACT=t.FUNC_SUBTRACT,e.FUNC_REVERSE_SUBTRACT=t.FUNC_REVERSE_SUBTRACT,e.ONE=t.ONE,e.ZERO=t.ZERO,e.SRC_ALPHA=t.SRC_ALPHA,e.SRC_COLOR=t.SRC_COLOR,e.ONE_MINUS_SRC_ALPHA=t.ONE_MINUS_SRC_ALPHA,e.ONE_MINUS_SRC_COLOR=t.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_DST_ALPHA=t.ONE_MINUS_DST_ALPHA,e.ONE_MINUS_DST_COLOR=t.ONE_MINUS_DST_COLOR,this.caps.initialize(t))},e._maxVertexAttribArray=0,e._texNumber=null,e._activeTextureIndex=-1,e.caps=new r,e}();t.Webglkit=a,__reflect(a.prototype,"egret3d.render.Webglkit")}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e;!function(t){t[t.ALL=0]="ALL",t[t.CCW=1]="CCW",t[t.CW=2]="CW"}(e=t.ShowFaceStateEnum||(t.ShowFaceStateEnum={}));var r;!function(t){t[t.VboTri=0]="VboTri",t[t.VboLine=1]="VboLine",t[t.EboTri=2]="EboTri",t[t.EboLine=3]="EboLine"}(r=t.DrawModeEnum||(t.DrawModeEnum={}));var a;!function(t){t[t.Close=0]="Close",t[t.Blend=1]="Blend",t[t.Blend_PreMultiply=2]="Blend_PreMultiply",t[t.Add=3]="Add",t[t.Add_PreMultiply=4]="Add_PreMultiply"}(a=t.BlendModeEnum||(t.BlendModeEnum={}));var i=function(){function r(r,a){this.uniforms={},this.state_showface=e.CCW,this.state_zwrite=!1,this.state_ztest=!1,this.state_ztest_method=t.Webglkit.LEQUAL,this.state_blend=!1,this.state_blendEquation=0,this.state_blendSrcRGB=0,this.state_blendDestRGB=0,this.state_blendSrcAlpha=0,this.state_blendDestALpha=0,this.vShaderInfo=r,this.fShaderInfo=a;for(var i in r.uniforms)this.uniforms[i]=r.uniforms[i];for(var i in a.uniforms)this.uniforms[i]=a.uniforms[i]}return Object.defineProperty(r.prototype,"program",{get:function(){return this._program||(this._program=t.GlProgram.get(this.vShaderInfo,this.fShaderInfo)),this._program},enumerable:!0,configurable:!0}),r.prototype.setAlphaBlend=function(e){e==a.Add?(this.state_blend=!0,this.state_blendEquation=t.Webglkit.FUNC_ADD,this.state_blendSrcRGB=t.Webglkit.SRC_ALPHA,this.state_blendDestRGB=t.Webglkit.ONE,this.state_blendSrcAlpha=t.Webglkit.SRC_ALPHA,this.state_blendDestALpha=t.Webglkit.ONE):e==a.Add_PreMultiply?(this.state_blend=!0,this.state_blendEquation=t.Webglkit.FUNC_ADD,this.state_blendSrcRGB=t.Webglkit.ONE,this.state_blendDestRGB=t.Webglkit.ONE,this.state_blendSrcAlpha=t.Webglkit.SRC_ALPHA,this.state_blendDestALpha=t.Webglkit.ONE):e==a.Blend?(this.state_blend=!0,this.state_zwrite=!1,this.state_blendEquation=t.Webglkit.FUNC_ADD,this.state_blendSrcRGB=t.Webglkit.SRC_ALPHA,this.state_blendDestRGB=t.Webglkit.ONE_MINUS_SRC_ALPHA,this.state_blendSrcAlpha=t.Webglkit.SRC_ALPHA,this.state_blendDestALpha=t.Webglkit.ONE):e==a.Blend_PreMultiply?(this.state_blend=!0,this.state_blendEquation=t.Webglkit.FUNC_ADD,this.state_blendSrcRGB=t.Webglkit.ONE,this.state_blendDestRGB=t.Webglkit.ONE_MINUS_SRC_ALPHA,this.state_blendSrcAlpha=t.Webglkit.SRC_ALPHA,this.state_blendDestALpha=t.Webglkit.ONE):e==a.Close&&(this.state_blend=!1)},r.prototype.use=function(e){return t.Webglkit.showFace(this.state_showface),t.Webglkit.zWrite(this.state_zwrite),t.Webglkit.zTest(this.state_ztest),t.Webglkit.blend(this.state_blend,this.state_blendEquation,this.state_blendSrcRGB,this.state_blendDestRGB,this.state_blendSrcAlpha,this.state_blendDestALpha),this.state_ztest&&t.Webglkit.zTestMethod(this.state_ztest_method),t.Webglkit.useProgram(this.program.program)},r}();t.GlDrawPass=i,__reflect(i.prototype,"egret3d.render.GlDrawPass")}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e;!function(t){t[t.Position=1]="Position",t[t.Normal=2]="Normal",t[t.Tangent=4]="Tangent",t[t.Color=8]="Color",t[t.UV0=16]="UV0",t[t.UV1=32]="UV1",t[t.BlendIndex4=64]="BlendIndex4",t[t.BlendWeight4=128]="BlendWeight4",t[t.ColorEX=256]="ColorEX"}(e=t.VertexFormatMask||(t.VertexFormatMask={}));var r=function(){function t(){}return t}();t.Number4=r,__reflect(r.prototype,"egret3d.render.Number4");var a;!function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic",t[t.Stream=2]="Stream"}(a=t.MeshTypeEnum||(t.MeshTypeEnum={}));var i=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return null==t._ins&&(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t}();t.DrawInfo=i,__reflect(i.prototype,"egret3d.render.DrawInfo");var o=function(){function r(){this.vertexFormat=e.Position,this.version=0}return r.prototype.initBuffer=function(e,r,i,o){if(void 0===o&&(o=a.Static),null!=this.vbo)throw new Error("you can only initbuffer once.");o==a.Static?this.mode=e.STATIC_DRAW:o==a.Dynamic?this.mode=e.DYNAMIC_DRAW:o==a.Stream&&(this.mode=e.STREAM_DRAW),this.vertexFormat=r,this.vertexCount=i,i>0&&(this.vertexByteSize=t.MeshData.calcByteSize(r),this.vbo=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vbo),e.bufferData(e.ARRAY_BUFFER,i*this.vertexByteSize,this.mode)),this.indexCounts=[],this.ebos=[],this.version++},r.prototype.addIndex=function(t,e){var r=this.ebos.length,a=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,2*e,this.mode),this.ebos.push(a),this.indexCounts.push(e),this.version++,r},r.prototype.resetVboSize=function(t,e){this.vertexCount=e,t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,e*this.vertexByteSize,this.mode),this.version++},r.prototype.resetEboSize=function(t,e,r){this.indexCounts[e]=r,t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ebos[e]),t.bufferData(t.ELEMENT_ARRAY_BUFFER,2*r,this.mode),this.version++},r.prototype.dispose=function(t){if(t.deleteBuffer(this.vbo),this.vbo=null,this.ebos){for(var e=0;e<this.ebos.length;e++)t.deleteBuffer(this.ebos[e]);this.ebos.length=0}this.version++},r.prototype.caclByteLength=function(){var t=0;t+=this.vertexByteSize*this.vertexCount;for(var e in this.indexCounts)t+=2*this.indexCounts[e];return t},r.prototype.uploadVertexSubData=function(t,e,r){void 0===r&&(r=0),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferSubData(t.ARRAY_BUFFER,r,e),this.version++},r.prototype.uploadIndexSubData=function(t,e,r,a){void 0===a&&(a=0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ebos[e]),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,a,r),this.version++},r}();t.GlMesh=o,__reflect(o.prototype,"egret3d.render.GlMesh")}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){}return r.addQuadPos=function(t,e){var a=t.pos.length;r.addQuadVec3(t.pos,e),t.trisindex.push(a+0),t.trisindex.push(a+1),t.trisindex.push(a+2),t.trisindex.push(a+2),t.trisindex.push(a+1),t.trisindex.push(a+3)},r.addQuadPos_Quad=function(t,e){var a=t.pos.length;r.addQuadVec3(t.pos,e),t.trisindex.push(a+0),t.trisindex.push(a+1),t.trisindex.push(a+3),t.trisindex.push(a+2)},r.addQuadVec3ByValue=function(e,r){for(var a=0;4>a;a++){var i=t.math.Pool.clone_vector3(r);e.push(i)}},r.addQuadVec3=function(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2]),t.push(e[3])},r.addQuadVec2=function(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2]),t.push(e[3])},r.genQuad=function(e){var a=.5*e,i=new r;return i.pos=[],i.trisindex=[],i.normal=[],i.tangent=[],i.uv=[],r.addQuadVec3ByValue(i.normal,new t.math.Vector3(0,0,1)),r.addQuadPos(i,[new t.math.Vector3(-a,a,0),new t.math.Vector3(-a,-a,0),new t.math.Vector3(a,a,0),new t.math.Vector3(a,-a,0)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,0),new t.math.Vector2(0,1),new t.math.Vector2(1,0),new t.math.Vector2(1,1)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(1,0,0)),i},r.genQuad_forparticle=function(e){var a=.5*e,i=new r;return i.pos=[],i.trisindex=[],i.normal=[],i.tangent=[],i.uv=[],r.addQuadVec3ByValue(i.normal,new t.math.Vector3(0,0,1)),r.addQuadPos(i,[new t.math.Vector3(0,a,0),new t.math.Vector3(0,-a,0),new t.math.Vector3(2*a,a,0),new t.math.Vector3(2*a,-a,0)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,0),new t.math.Vector2(0,1),new t.math.Vector2(1,0),new t.math.Vector2(1,1)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(1,0,0)),i},r.genPlaneCCW=function(e){var a=.5*e,i=new r;return i.pos=[],i.trisindex=[],i.normal=[],i.tangent=[],i.uv=[],r.addQuadVec3ByValue(i.normal,new t.math.Vector3(0,1,0)),r.addQuadPos(i,[new t.math.Vector3(-a,0,a),new t.math.Vector3(-a,0,-a),new t.math.Vector3(a,0,a),new t.math.Vector3(a,0,-a)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,0),new t.math.Vector2(0,1),new t.math.Vector2(1,0),new t.math.Vector2(1,1)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(1,0,0)),i},r.genCylinderCCW=function(e,a,i){void 0===i&&(i=20);var o=new r;o.pos=[],o.trisindex=[],o.normal=[],o.uv=[];for(var n=new t.math.Vector3(0,1,0),s=0;4>s;s++){var h=(2>s?.5:-.5)*e;0==s?n=new t.math.Vector3(0,1,0):3==s&&(n=new t.math.Vector3(0,-1,0));for(var l=0;i>l;l++){var c=l/i*Math.PI*2,u=Math.sin(c),d=Math.cos(c);(1==s||2==s)&&(n=new t.math.Vector3(u,0,d)),o.pos.push(new t.math.Vector3(u*a,h,d*a));var p=t.math.Pool.clone_vector3(n);o.normal.push(p),0==s||3==s?o.uv.push(new t.math.Vector2(u/2+.5,d/2+.5)):o.uv.push(new t.math.Vector2(l/i,0>h?0:1))}}var m=o.pos.length;o.pos.push(new t.math.Vector3(0,.5*e,0)),o.normal.push(new t.math.Vector3(0,1,0)),o.uv.push(new t.math.Vector2(.5,.5));var f=o.pos.length;o.pos.push(new t.math.Vector3(0,-.5*e,0)),o.normal.push(new t.math.Vector3(0,-1,0)),o.uv.push(new t.math.Vector2(.5,.5));for(var l=0;i>l;l++){o.trisindex.push(m),o.trisindex.push(l==i-1?0*i+0:0*i+l+1),o.trisindex.push(0*i+l+0),o.trisindex.push(f),o.trisindex.push(3*i+l+0),o.trisindex.push(l==i-1?3*i+0:3*i+l+1);var v=1*i+l,_=l==i-1?1*i+0:1*i+l+1,g=2*i+l,y=l==i-1?2*i+0:2*i+l+1;o.trisindex.push(v),o.trisindex.push(_),o.trisindex.push(g),o.trisindex.push(_),o.trisindex.push(y),o.trisindex.push(g)}return o},r.genPyramid=function(e,a){var i=new r;i.pos=[],i.trisindex=[],i.normal=[],i.uv=[];var o=new t.math.Vector3,n=new t.math.Vector3,s=new t.math.Vector3,h=new t.math.Vector3,l=new t.math.Vector3(0,-1,0),c=new t.math.Vector2(.5,.5),u=new t.math.Vector2(0,0),d=new t.math.Vector2(0,1),p=new t.math.Vector2(1,0),m=new t.math.Vector2(1,1),f=0;return i.pos.push(new t.math.Vector3(-a,.5*-e,-a)),i.pos.push(new t.math.Vector3(0,.5*e,0)),i.pos.push(new t.math.Vector3(a,.5*-e,-a)),i.normal.push(o),i.normal.push(o),i.normal.push(o),i.uv.push(u),i.uv.push(c),i.uv.push(d),i.trisindex.push(f),i.trisindex.push(f+2),i.trisindex.push(f+1),f+=3,i.pos.push(new t.math.Vector3(a,.5*-e,-a)),i.pos.push(new t.math.Vector3(0,.5*e,0)),i.pos.push(new t.math.Vector3(a,.5*-e,a)),i.normal.push(n),i.normal.push(n),i.normal.push(n),i.uv.push(d),i.uv.push(c),i.uv.push(m),i.trisindex.push(f),i.trisindex.push(f+2),i.trisindex.push(f+1),f+=3,i.pos.push(new t.math.Vector3(a,.5*-e,a)),i.pos.push(new t.math.Vector3(0,.5*e,0)),i.pos.push(new t.math.Vector3(-a,.5*-e,a)),i.normal.push(s),i.normal.push(s),i.normal.push(s),i.uv.push(m),i.uv.push(c),i.uv.push(p),i.trisindex.push(f),i.trisindex.push(f+2),i.trisindex.push(f+1),f+=3,i.pos.push(new t.math.Vector3(-a,.5*-e,a)),i.pos.push(new t.math.Vector3(0,.5*e,0)),i.pos.push(new t.math.Vector3(-a,.5*-e,-a)),i.normal.push(h),i.normal.push(h),i.normal.push(h),i.uv.push(p),i.uv.push(c),i.uv.push(u),i.trisindex.push(f),i.trisindex.push(f+2),i.trisindex.push(f+1),f+=3,i.pos.push(new t.math.Vector3(-a,.5*-e,-a)),i.pos.push(new t.math.Vector3(a,.5*-e,-a)),i.pos.push(new t.math.Vector3(a,.5*-e,a)),i.pos.push(new t.math.Vector3(-a,.5*-e,a)),i.normal.push(l),i.normal.push(l),i.normal.push(l),i.normal.push(l),i.uv.push(u),i.uv.push(p),i.uv.push(m),i.uv.push(d),i.trisindex.push(f),i.trisindex.push(f+2),i.trisindex.push(f+1),i.trisindex.push(f+3),i.trisindex.push(f+2),i.trisindex.push(f),f+=4,i
},r.genSphereCCW=function(e,a,i){void 0===e&&(e=1),void 0===a&&(a=24),void 0===i&&(i=12);var o=new r;o.pos=[],o.trisindex=[],o.normal=[],o.tangent=[],o.uv=[],a=Math.max(3,Math.floor(a)),i=Math.max(2,Math.floor(i));var n,s,h=0,l=[],c=new t.math.Vector3,u=new t.math.Vector3;for(s=0;i>=s;s++){var d=[],p=s/i;for(n=0;a>=n;n++){var m=n/a;c.x=-e*Math.cos(m*Math.PI*2)*Math.sin(p*Math.PI),c.y=e*Math.cos(p*Math.PI),c.z=e*Math.sin(m*Math.PI*2)*Math.sin(p*Math.PI),o.pos.push(t.math.Pool.clone_vector3(c)),u=t.math.Pool.clone_vector3(c);var f=Math.sqrt(u.x*u.x+u.y*u.y+u.z*u.z);f>Number.MIN_VALUE?(u.x=u.x/f,u.y=u.y/f,u.z=u.z/f):(u.x=0,u.y=0,u.z=0),o.normal.push(u);var v=new t.math.Vector2(1-m,p);o.uv.push(v),d.push(h++)}l.push(d)}for(s=0;i>s;s++)for(n=0;a>n;n++){var _=l[s][n+1],g=l[s][n],y=l[s+1][n],w=l[s+1][n+1];0!==s&&o.trisindex.push(_,w,g),s!==i-1&&o.trisindex.push(g,w,y)}return o},r.genBoxCCW=function(e){var a=.5*e,i=new r;return i.pos=[],i.trisindex=[],i.normal=[],i.tangent=[],i.uv=[],r.addQuadVec3ByValue(i.normal,new t.math.Vector3(0,-1,0)),r.addQuadPos(i,[new t.math.Vector3(-a,-a,-a),new t.math.Vector3(-a,-a,a),new t.math.Vector3(a,-a,-a),new t.math.Vector3(a,-a,a)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,0),new t.math.Vector2(0,1),new t.math.Vector2(1,0),new t.math.Vector2(1,1)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(-1,0,0)),r.addQuadVec3ByValue(i.normal,new t.math.Vector3(0,1,0)),r.addQuadPos(i,[new t.math.Vector3(-a,a,a),new t.math.Vector3(-a,a,-a),new t.math.Vector3(a,a,a),new t.math.Vector3(a,a,-a)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,0),new t.math.Vector2(0,1),new t.math.Vector2(1,0),new t.math.Vector2(1,1)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(1,0,0)),r.addQuadVec3ByValue(i.normal,new t.math.Vector3(0,0,1)),r.addQuadPos(i,[new t.math.Vector3(-a,-a,a),new t.math.Vector3(-a,a,a),new t.math.Vector3(a,-a,a),new t.math.Vector3(a,a,a)]),r.addQuadVec2(i.uv,[new t.math.Vector2(1,1),new t.math.Vector2(1,0),new t.math.Vector2(0,1),new t.math.Vector2(0,0)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(-1,0,0)),r.addQuadVec3ByValue(i.normal,new t.math.Vector3(0,0,-1)),r.addQuadPos(i,[new t.math.Vector3(-a,a,-a),new t.math.Vector3(-a,-a,-a),new t.math.Vector3(a,a,-a),new t.math.Vector3(a,-a,-a)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,0),new t.math.Vector2(0,1),new t.math.Vector2(1,0),new t.math.Vector2(1,1)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(1,0,0)),r.addQuadVec3ByValue(i.normal,new t.math.Vector3(1,0,0)),r.addQuadPos(i,[new t.math.Vector3(a,-a,-a),new t.math.Vector3(a,-a,a),new t.math.Vector3(a,a,-a),new t.math.Vector3(a,a,a)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,1),new t.math.Vector2(1,1),new t.math.Vector2(0,0),new t.math.Vector2(1,0)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(0,0,1)),r.addQuadVec3ByValue(i.normal,new t.math.Vector3(-1,0,0)),r.addQuadPos(i,[new t.math.Vector3(-a,-a,a),new t.math.Vector3(-a,-a,-a),new t.math.Vector3(-a,a,a),new t.math.Vector3(-a,a,-a)]),r.addQuadVec2(i.uv,[new t.math.Vector2(0,1),new t.math.Vector2(1,1),new t.math.Vector2(0,0),new t.math.Vector2(1,0)]),r.addQuadVec3ByValue(i.tangent,new t.math.Vector3(0,0,-1)),i},r.genBoxByArray=function(e){var a=new r;return a.pos=[],a.trisindex=[],a.normal=[],a.tangent=[],a.uv=[],r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,-1,0)),r.addQuadPos(a,[e[0],e[1],e[2],e[3]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(-1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,1,0)),r.addQuadPos(a,[e[4],e[5],e[6],e[7]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,0,1)),r.addQuadPos(a,[e[1],e[3],e[5],e[7]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,0,-1)),r.addQuadPos(a,[e[0],e[2],e[4],e[6]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(-1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(1,0,0)),r.addQuadPos(a,[e[6],e[2],e[7],e[3]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(0,0,-1)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(-1,0,0)),r.addQuadPos(a,[e[0],e[4],e[1],e[5]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(0,0,1)),a},r.genBoxByArray_Quad=function(e){var a=new r;return a.pos=[],a.trisindex=[],a.normal=[],a.tangent=[],a.uv=[],r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,-1,0)),r.addQuadPos_Quad(a,[e[0],e[1],e[2],e[3]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(-1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,1,0)),r.addQuadPos_Quad(a,[e[4],e[5],e[6],e[7]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,0,1)),r.addQuadPos_Quad(a,[e[1],e[3],e[5],e[7]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(0,0,-1)),r.addQuadPos_Quad(a,[e[0],e[2],e[4],e[6]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(-1,0,0)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(1,0,0)),r.addQuadPos_Quad(a,[e[6],e[2],e[7],e[3]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(0,0,-1)),r.addQuadVec3ByValue(a.normal,new t.math.Vector3(-1,0,0)),r.addQuadPos_Quad(a,[e[0],e[4],e[1],e[5]]),r.addQuadVec3ByValue(a.tangent,new t.math.Vector3(0,0,1)),a},r.genCircleLineCCW=function(e,a,i){void 0===a&&(a=64),void 0===i&&(i=.05);var o=new r;o.pos=[],o.trisindex=[],o.normal=[],o.uv=[];for(var n=0;a>n;n++){var s=2*Math.PI*n/a,h=Math.sin(s)*e,l=Math.cos(s)*e,c=2*Math.PI*(n+1)/a,u=Math.sin(c)*e,d=Math.cos(c)*e;r.addQuadPos(o,[new t.math.Vector3(u,i,d),new t.math.Vector3(h,i,l),new t.math.Vector3(u,-i,d),new t.math.Vector3(h,-i,l)])}return o},r.prototype.caclByteLength=function(){var t=0;return void 0!=this.pos&&(t+=12),void 0!=this.color&&(t+=16),void 0!=this.normal&&(t+=12),void 0!=this.tangent&&(t+=12),void 0!=this.uv&&(t+=8),void 0!=this.uv2&&(t+=8),void 0!=this.blendIndex&&(t+=16),void 0!=this.blendWeight&&(t+=16),void 0!=this.colorex&&(t+=16),void 0!=this.trisindex&&(t+=12),t*=this.pos.length},r.calcByteSize=function(t){var r=0;return t&e.VertexFormatMask.Position&&(r+=12),t&e.VertexFormatMask.Normal&&(r+=12),t&e.VertexFormatMask.Tangent&&(r+=12),t&e.VertexFormatMask.Color&&(r+=16),t&e.VertexFormatMask.UV0&&(r+=8),t&e.VertexFormatMask.UV1&&(r+=8),t&e.VertexFormatMask.BlendIndex4&&(r+=16),t&e.VertexFormatMask.BlendWeight4&&(r+=16),t&e.VertexFormatMask.ColorEX&&(r+=16),r},r.prototype.genVertexDataArray=function(t){for(var a=this.pos.length,i=r.calcByteSize(t)/4,o=new Float32Array(i*a),n=0;a>n;n++){var s=0;o[n*i+s]=this.pos[n].x,s++,o[n*i+s]=this.pos[n].y,s++,o[n*i+s]=this.pos[n].z,s++,t&e.VertexFormatMask.Normal&&(void 0==this.normal||0==this.normal.length?(o[n*i+s]=0,s++,o[n*i+s]=0,s++,o[n*i+s]=0,s++):(o[n*i+s]=this.normal[n].x,s++,o[n*i+s]=this.normal[n].y,s++,o[n*i+s]=this.normal[n].z,s++)),t&e.VertexFormatMask.Tangent&&(void 0==this.tangent||0==this.tangent.length?(o[n*i+s]=0,s++,o[n*i+s]=0,s++,o[n*i+s]=0,s++):(o[n*i+s]=this.tangent[n].x,s++,o[n*i+s]=this.tangent[n].y,s++,o[n*i+s]=this.tangent[n].z,s++)),t&e.VertexFormatMask.Color&&(void 0==this.color||0==this.color.length?(o[n*i+s]=1,s++,o[n*i+s]=1,s++,o[n*i+s]=1,s++,o[n*i+s]=1,s++):(o[n*i+s]=this.color[n].r,s++,o[n*i+s]=this.color[n].g,s++,o[n*i+s]=this.color[n].b,s++,o[n*i+s]=this.color[n].a,s++)),t&e.VertexFormatMask.UV0&&(void 0==this.uv||0==this.uv.length?(o[n*i+s]=0,s++,o[n*i+s]=0,s++):(o[n*i+s]=this.uv[n].x,s++,o[n*i+s]=this.uv[n].y,s++)),t&e.VertexFormatMask.UV1&&(void 0==this.uv2||0==this.uv2.length?(o[n*i+s]=0,s++,o[n*i+s]=0,s++):(o[n*i+s]=this.uv2[n].x,s++,o[n*i+s]=this.uv2[n].y,s++)),t&e.VertexFormatMask.BlendIndex4&&(void 0==this.blendIndex||0==this.blendIndex.length?(o[n*i+s]=0,s++,o[n*i+s]=0,s++,o[n*i+s]=0,s++,o[n*i+s]=0,s++):(o[n*i+s]=this.blendIndex[n].v0,s++,o[n*i+s]=this.blendIndex[n].v1,s++,o[n*i+s]=this.blendIndex[n].v2,s++,o[n*i+s]=this.blendIndex[n].v3,s++)),t&e.VertexFormatMask.BlendWeight4&&(void 0==this.blendWeight||0==this.blendWeight.length?(o[n*i+s]=1,s++,o[n*i+s]=0,s++,o[n*i+s]=0,s++,o[n*i+s]=0,s++):(o[n*i+s]=this.blendWeight[n].v0,s++,o[n*i+s]=this.blendWeight[n].v1,s++,o[n*i+s]=this.blendWeight[n].v2,s++,o[n*i+s]=this.blendWeight[n].v3,s++)),t&e.VertexFormatMask.ColorEX&&(void 0==this.colorex||0==this.colorex.length?(o[n*i+s]=1,s++,o[n*i+s]=1,s++,o[n*i+s]=1,s++,o[n*i+s]=1,s++):(o[n*i+s]=this.colorex[n].r,s++,o[n*i+s]=this.colorex[n].g,s++,o[n*i+s]=this.colorex[n].b,s++,o[n*i+s]=this.colorex[n].a,s++))}return o},r.prototype.genIndexDataArray=function(){return new Uint16Array(this.trisindex)},r.prototype.genIndexDataArrayTri2Line=function(){for(var t=[],e=0;e<(this.trisindex.length/3|0);e++)t.push(this.trisindex[3*e+0]),t.push(this.trisindex[3*e+1]),t.push(this.trisindex[3*e+1]),t.push(this.trisindex[3*e+2]),t.push(this.trisindex[3*e+2]),t.push(this.trisindex[3*e+0]);return new Uint16Array(t)},r.prototype.genIndexDataArrayQuad2Line=function(){for(var t=[],e=0;e<(this.trisindex.length/4|0);e++)t.push(this.trisindex[4*e+0]),t.push(this.trisindex[4*e+1]),t.push(this.trisindex[4*e+1]),t.push(this.trisindex[4*e+2]),t.push(this.trisindex[4*e+2]),t.push(this.trisindex[4*e+3]);return new Uint16Array(t)},r}();e.MeshData=r,__reflect(r.prototype,"egret3d.render.MeshData")}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){var e=function(){function e(){this.eboIndex=0,this.drawMode=t.DrawModeEnum.EboTri,this.drawbegin=0,this.drawcount=-1}return e.prototype.draw=function(e){var r=this.material.use(e);this.material.program.bindAttributes(this.mesh,this.eboIndex,r),this.drawMode==t.DrawModeEnum.VboTri?t.Webglkit.drawArrayTris(e,this.drawbegin,this.drawcount):this.drawMode==t.DrawModeEnum.VboLine?t.Webglkit.drawArrayLines(e,this.drawbegin,this.drawcount):this.drawMode==t.DrawModeEnum.EboTri?t.Webglkit.drawElementTris(e,this.drawbegin,this.drawcount):this.drawMode==t.DrawModeEnum.EboLine&&t.Webglkit.drawElementLines(e,this.drawbegin,this.drawcount)},e}();t.StaticMeshRenderer=e,__reflect(e.prototype,"egret3d.render.StaticMeshRenderer");var r=function(){function e(){this.vboCount=0,this.eboCount=0}return e.prototype.initBuffer=function(e,r,a){this.mesh=new t.GlMesh,this.mesh.initBuffer(e,r,128,t.MeshTypeEnum.Dynamic),this.dataForVbo=new Float32Array(128),this.drawMode=a,(a==t.DrawModeEnum.EboLine||a==t.DrawModeEnum.EboTri)&&(this.mesh.addIndex(e,128),this.dataForEbo=new Uint16Array(128))},e.prototype.begin=function(t,e){this.vboCount>0&&this.end(t),this.curmaterial=e},e.prototype.push=function(e,r,a){if((this.vboCount+r.length>2048||null!=a&&this.eboCount+a.length>2048)&&this.end(e),this.vboCount+r.length>this.dataForVbo.length){for(var i=new Float32Array(2*this.dataForVbo.length),o=0;o<this.dataForVbo.length;o++)i[o]=this.dataForVbo[o];this.dataForVbo=i,this.mesh.resetVboSize(e,this.dataForVbo.length)}for(var o=0;o<r.length;o++)this.dataForVbo[this.vboCount+o]=r[o];if(this.vboCount+=r.length,this.drawMode!=t.DrawModeEnum.VboLine&&this.drawMode!=t.DrawModeEnum.VboTri&&null!=a){if(this.eboCount+a.length>this.dataForEbo.length){for(var i=new Uint16Array(2*this.dataForEbo.length),o=0;o<this.dataForEbo.length;o++)i[o]=this.dataForEbo[o];this.dataForEbo=i,this.mesh.resetEboSize(e,0,this.dataForEbo.length)}for(var o=0;o<a.length;o++)this.dataForEbo[this.eboCount+o]=a[o];this.eboCount+=a.length}},e.prototype.end=function(e){if(0!=this.vboCount){this.mesh.uploadVertexSubData(e,this.dataForVbo.slice(0,this.vboCount),0),this.eboCount>0&&this.mesh.uploadIndexSubData(e,0,this.dataForEbo.slice(0,this.eboCount),0);var r=this.vboCount/(this.mesh.vertexByteSize/4)|0,a=this.curmaterial.use(e);this.curmaterial.program.bindAttributes(this.mesh,this.drawMode==t.DrawModeEnum.EboLine||this.drawMode==t.DrawModeEnum.EboTri?0:-1,a),this.drawMode==t.DrawModeEnum.EboLine?t.Webglkit.drawElementLines(e,0,this.eboCount):this.drawMode==t.DrawModeEnum.EboTri?t.Webglkit.drawElementTris(e,0,this.eboCount):this.drawMode==t.DrawModeEnum.VboLine?t.Webglkit.drawArrayLines(e,0,r):this.drawMode==t.DrawModeEnum.VboTri&&t.Webglkit.drawArrayTris(e,0,r),this.vboCount=0,this.eboCount=0}},e}();t.BatchRenderer=r,__reflect(r.prototype,"egret3d.render.BatchRenderer")}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function e(){this.clearop_Color=!1,this.backColor=new t.math.Color(1,0,1,1),this.clearop_Depth=!1,this.clearop_Stencil=!1,this.viewport=new t.math.Rect(0,0,1,1)}return e.prototype.use=function(e){null!=this.renderTarget?this.renderTarget.use(e):t.render.GlRenderTarget.useNull(e),null!=this.backColor&&e.clearColor(this.backColor.r,this.backColor.g,this.backColor.b,this.backColor.a);var r=0;this.clearop_Color&&(r|=e.COLOR_BUFFER_BIT),this.clearop_Depth&&(r|=e.DEPTH_BUFFER_BIT),this.clearop_Stencil&&(r|=e.STENCIL_BUFFER_BIT),e.clear(r),null!=this.renderTarget?e.viewport(this.renderTarget.width*this.viewport.x,this.renderTarget.height*this.viewport.y,this.renderTarget.width*this.viewport.w,this.renderTarget.height*this.viewport.h):e.viewport(e.canvas.width*this.viewport.x,e.canvas.height*this.viewport.y,e.canvas.width*this.viewport.w,e.canvas.height*this.viewport.h)},e}();e.GlWindow=r,__reflect(r.prototype,"egret3d.render.GlWindow")}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(t){function e(t,e,r){if(t==e.VERTEX_SHADER&&i[r.name])return i[r.name];if(t==e.FRAGMENT_SHADER&&o[r.name])return o[r.name];var a=e.createShader(t);e.shaderSource(a,r.src),e.compileShader(a);var n=e.getShaderParameter(a,e.COMPILE_STATUS);return n?(t==e.VERTEX_SHADER?i[r.name]=a:o[r.name]=a,a):(confirm("shader compile:"+r.name+" "+t+" error! ->"+e.getShaderInfoLog(a)+"\n. did you want see the code?")&&(e.deleteShader(a),alert(r.src)),null)}function r(t,r,a){var i=t.createProgram();t.attachShader(i,e(t.VERTEX_SHADER,t,r)),t.attachShader(i,e(t.FRAGMENT_SHADER,t,a)),t.linkProgram(i);var o=t.getProgramParameter(i,t.LINK_STATUS);return o?i:(alert("program compile: "+r.name+"_"+a.name+" error! ->"+t.getProgramInfoLog(i)),t.deleteProgram(i),null)}var a;!function(t){t[t.Texture=0]="Texture",t[t.Float=1]="Float",t[t.Floatv=2]="Floatv",t[t.Float4=3]="Float4",t[t.Float4v=4]="Float4v",t[t.Float4x4=5]="Float4x4",t[t.Float4x4v=6]="Float4x4v"}(a=t.UniformTypeEnum||(t.UniformTypeEnum={}));var i={},o={},n=function(){function e(e,i,o){function n(t){return e.getAttribLocation(s,t)}this.uniforms={},this._cacheContextVer=-1,this._cacheMeshVer=-1,this._cacheMeshEbo=-1,this._cacheMaterialVer=-1,this._textureLocations={},this._cacheTextureUniforms=[];var s=r(e,i,o);this.program=s,this.gl=e,this._vertexAttributeFormat=[{name:"_glesVertex",mask:t.VertexFormatMask.Position,location:n("_glesVertex"),size:3,type:e.FLOAT,normalized:!1},{name:"_glesNormal",mask:t.VertexFormatMask.Normal,location:n("_glesNormal"),size:3,type:e.FLOAT,normalized:!0},{name:"_glesTangent",mask:t.VertexFormatMask.Tangent,location:n("_glesTangent"),size:3,type:e.FLOAT,normalized:!0},{name:"_glesColor",mask:t.VertexFormatMask.Color,location:n("_glesColor"),size:4,type:e.FLOAT,normalized:!1},{name:"_glesMultiTexCoord0",mask:t.VertexFormatMask.UV0,location:n("_glesMultiTexCoord0"),size:2,type:e.FLOAT,normalized:!1},{name:"_glesMultiTexCoord1",mask:t.VertexFormatMask.UV1,location:n("_glesMultiTexCoord1"),size:2,type:e.FLOAT,normalized:!1},{name:"_glesBlendIndex4",mask:t.VertexFormatMask.BlendIndex4,location:n("_glesBlendIndex4"),size:4,type:e.FLOAT,normalized:!1},{name:"_glesBlendWeight4",mask:t.VertexFormatMask.BlendWeight4,location:n("_glesBlendWeight4"),size:4,type:e.FLOAT,normalized:!1},{name:"_glesColorEx",mask:t.VertexFormatMask.ColorEX,location:n("_glesColorEx"),size:4,type:e.FLOAT,normalized:!1}];for(var h in i.uniforms)this.uniforms[h]={type:i.uniforms[h],location:e.getUniformLocation(s,h),value:null};for(var h in o.uniforms)this.uniforms[h]={type:o.uniforms[h],location:e.getUniformLocation(s,h),value:null};var l=0;for(var h in this.uniforms)this.uniforms[h].type==a.Texture&&(this._textureLocations[h]=l,l++)}return e.get=function(r,a){var i=r.name+"_"+a.name;if(!this._programMap[i]){var o=t.Webglkit.webgl;this._programMap[i]=new e(o,r,a)}return this._programMap[i]},e.prototype.bindAttributes=function(e,r,a){if(void 0===r&&(r=0),void 0===a&&(a=!1),a||this._cacheMesh!=e||this._cacheMeshVer!=e.version||this._cacheMeshEbo!=r){this._cacheMesh=e,this._cacheMeshVer=e.version,this._cacheMeshEbo=r;var i=this.gl;i.bindBuffer(i.ARRAY_BUFFER,e.vbo),r>=0&&i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,e.ebos[r]);for(var o=e.vertexByteSize,n=0,s=0,h=0,l=this._vertexAttributeFormat.length;l>h;h++){var c=this._vertexAttributeFormat[h];c.mask&e.vertexFormat||c.mask==t.VertexFormatMask.Position?(c.location>=0&&(i.enableVertexAttribArray(c.location),i.vertexAttribPointer(c.location,c.size,c.type,c.normalized,o,n),s++),n+=4*c.size):c.location>=0&&(i.disableVertexAttribArray(c.location),s++)}t.Webglkit.SetMaxVertexAttribArray(i,s)}},e.prototype._updateRenderContextUniforms=function(t){for(var e in this.uniforms)switch(e){case"glstate_matrix_model":this.setMatrix(e,t.matrixModel);break;case"glstate_matrix_view":this.setMatrix(e,t.matrixView);break;case"glstate_matrix_project":this.setMatrix(e,t.matrixProject);break;case"glstate_matrix_modelview":this.setMatrix(e,t.matrixModelView);break;case"glstate_matrix_viewproject":this.setMatrix(e,t.matrixViewProject);break;case"glstate_matrix_mvp":this.setMatrix(e,t.matrixModelViewProject);break;case"glstate_timer":this.setFloat(e,t.floatTimer);break;case"glstate_lightcount":this.setFloat(e,t.intLightCount);break;case"glstate_vec4_lightposs":t.vec4LightPos.length>0&&this.setVector4v(e,t.vec4LightPos);break;case"glstate_vec4_lightdirs":t.vec4LightDir.length>0&&this.setVector4v(e,t.vec4LightDir);break;case"glstate_float_spotangelcoss":t.floatLightSpotAngleCos.length>0&&this.setFloatv(e,t.floatLightSpotAngleCos);break;case"glstate_eyepos":this.setVector4(e,t.eyePos);break;case"_LightmapTex":this.setTexture(e,t.lightmap);break;case"glstate_lightmapOffset":this.setVector4(e,t.lightmapOffset);break;case"glstate_lightmapUV":this.setFloat(e,t.lightmapUV);break;case"glstate_vec4_bones":this.setVector4v(e,t.boneData);break;case"glstate_matrix_bones":this.setVector4v(e,t.boneData)}},e.prototype.setMatrix=function(t,e){var r=this.uniforms[t];r.value=e.rawData,this.gl.uniformMatrix4fv(r.location,!1,r.value)},e.prototype.setVector4v=function(t,e){var r=this.uniforms[t];r.value=e,this.gl.uniform4fv(r.location,r.value)},e.prototype.setFloat=function(t,e){if(this.uniforms[t].value!=e){var r=this.uniforms[t];r.value=e,this.gl.uniform1f(r.location,r.value)}},e.prototype.setFloatv=function(t,e){var r=this.uniforms[t];r.value=e,this.gl.uniform1fv(r.location,r.value)},e.prototype.setVector4=function(t,e){var r=this.uniforms[t],a=r.value;a?(a[0]!=e.x||a[1]!=e.y||a[2]!=e.z||a[3]!=e.w)&&(a[0]=e.x,a[1]=e.y,a[2]=e.z,a[3]=e.w,this.gl.uniform4fv(r.location,r.value)):(r.value=[e.x,e.y,e.z,e.w],this.gl.uniform4fv(r.location,r.value))},e.prototype.setTexture=function(t,e){var r=this.uniforms[t];r.value=e?e.glTexture:null;var a=this._textureLocations[t],i=null!=r.value?r.value.texture:null;this._cacheTextureUniforms[a]?(this._cacheTextureUniforms[a].texture=i,this._cacheTextureUniforms[a].dirty=!0):(this.gl.uniform1i(r.location,a),this._cacheTextureUniforms[a]={dirty:!0,texture:i})},e.prototype._updateUniforms=function(e){for(var r in e){var a=e[r].type,i=void 0==e[r].value?e[r].defaultValue:e[r].value,o=this.uniforms[r];if(null!=o)switch(a){case t.UniformTypeEnum.Float:this.setFloat(r,i);break;case t.UniformTypeEnum.Floatv:this.setFloatv(r,i);break;case t.UniformTypeEnum.Float4:this.setVector4(r,i);break;case t.UniformTypeEnum.Float4v:this.setVector4v(r,i);break;case t.UniformTypeEnum.Float4x4:this.setMatrix(r,i);break;case t.UniformTypeEnum.Float4x4v:this.setMatrix(r,i);break;case t.UniformTypeEnum.Texture:this.setTexture(r,i)}}},e.prototype.uploadUniforms=function(e,r,a){void 0===a&&(a=!1);var i=this._cacheMaterial!==e||this._cacheMaterialVer!==e.version;i&&(this._updateUniforms(e.mapUniform),this._updateUniforms(e.mapUniformTemp),this._cacheMaterial=e,this._cacheMaterialVer=e.version);var o=this._cacheContext!=r||this._cacheContextVer!=r.version;if(o&&(this._updateRenderContextUniforms(r),this._cacheContext=r,this._cacheContextVer=r.version),a)for(var n=0;n<this._cacheTextureUniforms.length;n++){var s=this._cacheTextureUniforms[n];s&&(t.Webglkit.activeTexture(n),this.gl.bindTexture(this.gl.TEXTURE_2D,s.texture))}else if(i||o)for(var n=0;n<this._cacheTextureUniforms.length;n++){var s=this._cacheTextureUniforms[n];s&&s.dirty&&(t.Webglkit.activeTexture(n),this.gl.bindTexture(this.gl.TEXTURE_2D,s.texture))}},e._programMap={},e}();t.GlProgram=n,__reflect(n.prototype,"egret3d.render.GlProgram")}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r;!function(t){t[t.RGBA=1]="RGBA",t[t.RGB=2]="RGB",t[t.Gray=3]="Gray",t[t.PVRTC4_RGB=4]="PVRTC4_RGB",t[t.PVRTC4_RGBA=4]="PVRTC4_RGBA",t[t.PVRTC2_RGB=4]="PVRTC2_RGB",t[t.PVRTC2_RGBA=4]="PVRTC2_RGBA"}(r=e.TextureFormatEnum||(e.TextureFormatEnum={}));var a=function(){function e(t,e,r,a,i){void 0===i&&(i=!0),this.gray=i,this.width=r,this.height=a;var o=t.createFramebuffer(),n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);var s=new Uint8Array(this.width*this.height*4);if(s[0]=2,t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,s),t.deleteFramebuffer(o),t.bindFramebuffer(t.FRAMEBUFFER,n),i){this.data=new Uint8Array(this.width*this.height);for(var h=0;r*a>h;h++)this.data[h]=s[4*h]}else this.data=s}return e.prototype.getPixel=function(e,r){var a=e*this.width|0,i=r*this.height|0;if(0>a||a>=this.width||0>i||i>=this.height)return 0;if(this.gray)return this.data[i*this.width+a];var o=4*(i*this.width+a);return new t.math.Color(this.data[o],this.data[o+1],this.data[o+2],this.data[o+3])},e}();e.TextureReader=a,__reflect(a.prototype,"egret3d.render.TextureReader");var i=function(){function t(t,e,r,a,i){void 0===a&&(a=!1),void 0===i&&(i=!1),this.width=e,this.height=r,this.fbo=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),(a||i)&&(this.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),a&&i?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer)):a?(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer)):(t.renderbufferStorage(t.RENDERBUFFER,t.STENCIL_INDEX8,e,r),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer))),this.texture=t.createTexture(),this.fbo.width=e,this.fbo.height=r,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,r,0,t.RGBA,t.UNSIGNED_BYTE,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}return t.prototype.use=function(t){t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.bindTexture(t.TEXTURE_2D,this.texture)},t.useNull=function(t){t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null)},t.prototype.dispose=function(t){null!=this.texture&&(t.deleteFramebuffer(this.renderbuffer),this.renderbuffer=null,t.deleteTexture(this.texture),this.texture=null)},t.prototype.caclByteLength=function(){return this.width*this.height*4},t.prototype.isFrameBuffer=function(){return!0},t}();e.GlRenderTarget=i,__reflect(i.prototype,"egret3d.render.GlRenderTarget",["egret3d.render.ITexture"]);var o=function(){function t(t,e,a,i){void 0===e&&(e=r.RGBA),void 0===a&&(a=!1),void 0===i&&(i=!0),this.loaded=!1,this.width=0,this.height=0,this.mipmap=!1,this.webgl=t,this.format=e,this.texture=t.createTexture()}return t.prototype.uploadImage=function(t,e,a,i,o,n,s){void 0===i&&(i=!0),void 0===o&&(o=!1),void 0===n&&(n=!1),void 0===s&&(s=!1),this.width=t.width,this.height=t.height,this.mipmap=e,this.loaded=!0,this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,0),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture);var h=this.webgl.RGBA;this.format==r.RGB?h=this.webgl.RGB:this.format==r.Gray&&(h=this.webgl.LUMINANCE),this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,h,h,this.webgl.UNSIGNED_BYTE,t),e?(this.webgl.generateMipmap(this.webgl.TEXTURE_2D),a?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST_MIPMAP_NEAREST))):a?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),o?n&&s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):n?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))},t.prototype.uploadByteArray=function(t,e,a,i,o,n,s,h){void 0===n&&(n=!1),void 0===s&&(s=!1),void 0===h&&(h=!1),this.width=a,this.height=i,this.mipmap=t,this.loaded=!0,this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,0),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture);var l=this.webgl.RGBA;this.format==r.RGB?l=this.webgl.RGB:this.format==r.Gray&&(l=this.webgl.LUMINANCE),this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,l,a,i,0,l,this.webgl.UNSIGNED_BYTE,o),t?(this.webgl.generateMipmap(this.webgl.TEXTURE_2D),e?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR_MIPMAP_LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST_MIPMAP_NEAREST))):e?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),n?s&&h?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):s?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):h?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))},t.prototype.caclByteLength=function(){var t=1;this.format==r.RGBA?t=4:this.format==r.RGB&&(t=3);var e=this.width*this.height*t;return this.mipmap&&(e=e*(1-Math.pow(.25,10))/.75),e},t.prototype.getReader=function(t){if(void 0===t&&(t=!1),null!=this.reader){if(this.reader.gray!=t)throw new Error("get param diff with this.reader");return this.reader}if(this.format!=r.RGBA)throw new Error("only rgba texture can read");return null==this.texture?null:(null==this.reader&&(this.reader=new a(this.webgl,this.texture,this.width,this.height,t)),this.reader)},t.prototype.dispose=function(t){null!=this.texture&&(t.deleteTexture(this.texture),this.texture=null)},t.prototype.isFrameBuffer=function(){return!1},t.formGrayArray=function(e,a,i,o){for(var n=!1,s=!0,h=new t(e,r.RGBA,n,s),l=new Uint8Array(4*a.length),c=0;i>c;c++)for(var u=0;i>u;u++){var d=512*c+u,p=c*i+u;l[4*d]=255*a[p],l[4*d+1]=255*a[p],l[4*d+2]=255*a[p],l[4*d+3]=255}return h.uploadByteArray(n,s,512,512,l),h},t.staticTexture=function(e,a){var i=t.mapTexture[a];if(void 0!=i)return i;var o=!1,n=!0;i=new t(e,r.RGBA,o,n);var s=new Uint8Array(4),h=1,l=1;if(s[0]=128,s[1]=0,s[2]=128,s[3]=255,"gray"==a)s[0]=128,s[1]=128,s[2]=128,s[3]=255;else if("white"==a)s[0]=255,s[1]=255,s[2]=255,s[3]=255;else if("black"==a)s[0]=0,s[1]=0,s[2]=0,s[3]=255;else if("grid"==a){h=256,l=256,s=new Uint8Array(h*h*4);for(var c=0;l>c;c++)for(var u=0;h>u;u++){var d=4*(c*h+u);(u-.5*h)*(c-.5*l)>0?(s[d]=0,s[d+1]=0,s[d+2]=0,s[d+3]=255):(s[d]=255,s[d+1]=255,s[d+2]=255,s[d+3]=255)}}return i.uploadByteArray(o,n,h,l,s),t.mapTexture[a]=i,i},t.mapTexture={},t}();e.GlTexture2D=o,__reflect(o.prototype,"egret3d.render.GlTexture2D",["egret3d.render.ITexture"]);var n=function(){function t(t,e,a,i,o,n,s,h,l){void 0===e&&(e=r.RGBA),void 0===n&&(n=!0),void 0===s&&(s=!1),void 0===h&&(h=!1),void 0===l&&(l=!1),this.premultiply=!0,this.repeat=!1,this.mirroredU=!1,this.mirroredV=!1,this.width=0,this.height=0,this.webgl=t,this.texture=t.createTexture(),this.webgl.pixelStorei(this.webgl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0),this.webgl.pixelStorei(this.webgl.UNPACK_FLIP_Y_WEBGL,0),this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.format=e,this.formatGL=this.webgl.RGBA,e==r.RGB?this.formatGL=this.webgl.RGB:e==r.Gray&&(this.formatGL=this.webgl.LUMINANCE);var c=null;this.webgl.texImage2D(this.webgl.TEXTURE_2D,0,this.formatGL,a,i,0,this.formatGL,this.webgl.UNSIGNED_BYTE,c),o?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.LINEAR),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.LINEAR)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MAG_FILTER,this.webgl.NEAREST),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_MIN_FILTER,this.webgl.NEAREST)),s?h&&l?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):h?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.MIRRORED_REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):l?(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.MIRRORED_REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.REPEAT),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.REPEAT)):(this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_S,this.webgl.CLAMP_TO_EDGE),this.webgl.texParameteri(this.webgl.TEXTURE_2D,this.webgl.TEXTURE_WRAP_T,this.webgl.CLAMP_TO_EDGE))
}return t.prototype.updateRect=function(t,e,r,a,i){this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.webgl.texSubImage2D(this.webgl.TEXTURE_2D,0,e,r,a,i,this.formatGL,this.webgl.UNSIGNED_BYTE,t)},t.prototype.updateRectImg=function(t,e,r){this.webgl.bindTexture(this.webgl.TEXTURE_2D,this.texture),this.webgl.texSubImage2D(this.webgl.TEXTURE_2D,0,e,r,this.formatGL,this.webgl.UNSIGNED_BYTE,t)},t.prototype.isFrameBuffer=function(){return!1},t.prototype.dispose=function(t){null!=this.texture&&(t.deleteTexture(this.texture),this.texture=null)},t.prototype.caclByteLength=function(){var t=1;this.format==r.RGBA?t=4:this.format==r.RGB&&(t=3);var e=this.width*this.height*t;return e},t}();e.WriteableTexture2D=n,__reflect(n.prototype,"egret3d.render.WriteableTexture2D",["egret3d.render.ITexture"])}(e=t.render||(t.render={}))}(egret3d||(egret3d={}));var egret3d;!function(t){var e;!function(e){var r=function(){function r(){this.frustumTest=!1,this.layer=e.RenderLayerEnum.UI,this.renderLayer=e.CullingMask.UI,this.queue=0,this._screenAdapter=new e.ConstantAdapter,this._catchedEvent={},this._stageWidth=0,this._stageHeight=0,this._scaler=1;var t=new egret.Stage;t.maxTouches=1,this.stage=t,this.root=new egret.DisplayObjectContainer,this.stage.addChild(this.root)}return r.prototype.getBound=function(){return null},r.prototype.intersectsTransform=function(t){return!1},Object.defineProperty(r.prototype,"screenAdapter",{get:function(){return this._screenAdapter},set:function(t){t.$dirty=!0,this._screenAdapter=t},enumerable:!0,configurable:!0}),r.prototype.start=function(){this.app=this.gameObject.getScene().app;var t=this.app.webgl;this.renderer||(this.renderer=egret.web.Renderer.getInstance(t,this.app));var e=this.stage,r=new egret.sys.DisplayList(e);r.renderBuffer=new egret.sys.RenderBuffer(void 0,void 0,!0),e.$displayList=r,this.app.inputManager.touch.addEventListener("touchstart",this._onTouchStart,this),this.app.inputManager.touch.addEventListener("touchend",this._onTouchEnd,this),this.app.inputManager.touch.addEventListener("touchcancel",this._onTouchEnd,this),this.app.inputManager.touch.addEventListener("touchmove",this._onTouchMove,this),this.app.inputManager.mouse.addEventListener("mousedown",this._onTouchStart,this),this.app.inputManager.mouse.addEventListener("mouseup",this._onTouchEnd,this),this.app.inputManager.mouse.addEventListener("mousemove",this._onTouchMove,this)},r.prototype.checkEventThrough=function(t,e){return!!this._catchedEvent[t+"_"+e]},r.prototype._onTouchStart=function(t){this.stage.$onTouchBegin(t.x/this._scaler,t.y/this._scaler,t.identifier)&&(this._catchedEvent[t.x+"_"+t.y]=!0)},r.prototype._onTouchMove=function(t){this.stage.$onTouchMove(t.x/this._scaler,t.y/this._scaler,t.identifier)&&(this._catchedEvent[t.x+"_"+t.y]=!0)},r.prototype._onTouchEnd=function(t){this.stage.$onTouchEnd(t.x/this._scaler,t.y/this._scaler,t.identifier)&&(this._catchedEvent[t.x+"_"+t.y]=!0)},r.prototype.screenPosToUIPos=function(e,r){return void 0===r&&(r=new t.math.Vector2),r.x=e.x/this._scaler,r.y=e.y/this._scaler,r},Object.defineProperty(r.prototype,"scaler",{get:function(){return this._scaler},enumerable:!0,configurable:!0}),r.prototype.update=function(t){var e=this.stage;if(this._stageWidth!=this.app.width||this._stageHeight!=this.app.height||this.screenAdapter.$dirty){var r={w:0,h:0,s:0};this.screenAdapter.calculateScaler(this.app.width,this.app.height,r),this.screenAdapter.$dirty=!1,e.$displayList.offsetMatrix.a=r.s,e.$displayList.offsetMatrix.d=r.s,this._scaler=r.s;var a=r.w,i=r.h;e.$stageWidth=a,e.$stageHeight=i,e.$displayList.setClipRect(this.app.width,this.app.height),e.dispatchEventWith(egret.Event.RESIZE),this._stageWidth=this.app.width,this._stageHeight=this.app.height}this._catchedEvent={}},r.prototype.render=function(e,r){this.app.webgl;this.renderer.beforeRender(),this.stage.drawToSurface(),t.render.Webglkit.resetState()},r.prototype.remove=function(){this.app.inputManager.touch.removeEventListener("touchstart",this._onTouchStart,this),this.app.inputManager.touch.removeEventListener("touchend",this._onTouchEnd,this),this.app.inputManager.touch.removeEventListener("touchcancel",this._onTouchEnd,this),this.app.inputManager.touch.removeEventListener("touchmove",this._onTouchMove,this),this.app.inputManager.mouse.removeEventListener("mousedown",this._onTouchStart,this),this.app.inputManager.mouse.removeEventListener("mouseup",this._onTouchEnd,this),this.app.inputManager.mouse.removeEventListener("mousemove",this._onTouchMove,this)},r.prototype.clone=function(){},r=__decorate([t.reflect.nodeRender,t.reflect.nodeComponent,t.reflect.nodeCanvasRendererCollider,__metadata("design:paramtypes",[])],r)}();e.Egret2DRenderer=r,__reflect(r.prototype,"egret3d.framework.Egret2DRenderer",["egret3d.framework.IRenderer","egret3d.framework.INodeComponent","egret3d.framework.ICollider"])}(e=t.framework||(t.framework={}))}(egret3d||(egret3d={}));